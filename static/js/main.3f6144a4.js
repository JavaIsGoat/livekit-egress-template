/*! For license information please see main.3f6144a4.js.LICENSE.txt */
(()=>{var e={278:(e,t,n)=>{"use strict";const i=n(357),r={getLiveKitURL(){const e=l("url");if(!e)throw new Error("url is not found in query string");return e},getAccessToken(){const e=l("token");if(!e)throw new Error("token is not found in query string");return e},getLayout(){if(s.layout)return s.layout;const e=l("layout");return null!==e&&void 0!==e?e:""},setRoom(e){o&&o.off(i.RoomEvent.Disconnected,r.endRecording),o=e,o.localParticipant.on(i.ParticipantEvent.ParticipantMetadataChanged,c),o.on(i.RoomEvent.Disconnected,r.endRecording),c()},startRecording(){console.log("START_RECORDING")},endRecording(){o=void 0,console.log("END_RECORDING")},onLayoutChanged(e){a=e}};let o,a,s={layout:""};function c(){const e=null===o||void 0===o?void 0:o.localParticipant.metadata;if(e){const t=JSON.parse(e);t&&t.layout!==s.layout&&(s=t,a(s.layout))}}function l(e){return new URLSearchParams(window.location.search).get(e)}t.A=r},357:function(e,t,n){!function(e){"use strict";function t(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var i=Object.defineProperty,r=(e,t,n)=>((e,t,n)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class o{constructor(){r(this,"_locking"),r(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){let e;this._locks+=1;const t=new Promise((t=>e=()=>{this._locks-=1,t()})),n=this._locking.then((()=>e));return this._locking=this._locking.then((()=>t)),n}}function a(e,t){if(!e)throw new Error(t)}const s=34028234663852886e22,c=-34028234663852886e22,l=4294967295,d=2147483647,u=-2147483648;function h(e){if("number"!=typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>d||e<u)throw new Error("invalid int 32: "+e)}function p(e){if("number"!=typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>l||e<0)throw new Error("invalid uint 32: "+e)}function m(e){if("number"!=typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>s||e<c))throw new Error("invalid float 32: "+e)}const f=Symbol("@bufbuild/protobuf/enum-type");function g(e){const t=e[f];return a(t,"missing enum type on enum object"),t}function v(e,t,n,i){e[f]=b(t,n.map((t=>({no:t.no,name:t.name,localName:e[t.no]}))))}function b(e,t,n){const i=Object.create(null),r=Object.create(null),o=[];for(const a of t){const e=k(a);o.push(e),i[a.name]=e,r[a.no]=e}return{typeName:e,values:o,findName:e=>i[e],findNumber:e=>r[e]}}function y(e,t,n){const i={};for(const r of t){const e=k(r);i[e.localName]=e.no,i[e.no]=e.localName}return v(i,e,t),i}function k(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}class T{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const n=this.getType().runtime.bin,i=n.makeReadOptions(t);return n.readMessage(this,i.readerFactory(e),e.byteLength,i),this}fromJson(e,t){const n=this.getType(),i=n.runtime.json,r=i.makeReadOptions(t);return i.readMessage(n,e,r,this),this}fromJsonString(e,t){let n;try{n=JSON.parse(e)}catch(e){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(e instanceof Error?e.message:String(e)))}return this.fromJson(n,t)}toBinary(e){const t=this.getType().runtime.bin,n=t.makeWriteOptions(e),i=n.writerFactory();return t.writeMessage(this,i,n),i.finish()}toJson(e){const t=this.getType().runtime.json,n=t.makeWriteOptions(e);return t.writeMessage(this,n)}toJsonString(e){var t;const n=this.toJson(e);return JSON.stringify(n,null,null!==(t=null==e?void 0:e.prettySpaces)&&void 0!==t?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function S(){let e=0,t=0;for(let i=0;i<28;i+=7){let n=this.buf[this.pos++];if(e|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(15&n)<<28,t=(112&n)>>4,0==(128&n))return this.assertBounds(),[e,t];for(let i=3;i<=31;i+=7){let n=this.buf[this.pos++];if(t|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function C(e,t,n){for(let o=0;o<28;o+=7){const i=e>>>o,r=!(i>>>7==0&&0==t),a=255&(r?128|i:i);if(n.push(a),!r)return}const i=e>>>28&15|(7&t)<<4,r=!(t>>3==0);if(n.push(255&(r?128|i:i)),r){for(let e=3;e<31;e+=7){const i=t>>>e,r=!(i>>>7==0),o=255&(r?128|i:i);if(n.push(o),!r)return}n.push(t>>>31&1)}}const E=4294967296;function w(e){const t="-"===e[0];t&&(e=e.slice(1));const n=1e6;let i=0,r=0;function o(t,o){const a=Number(e.slice(t,o));r*=n,i=i*n+a,i>=E&&(r+=i/E|0,i%=E)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),t?I(i,r):R(i,r)}function P(e,t){if(({lo:e,hi:t}=function(e,t){return{lo:e>>>0,hi:t>>>0}}(e,t)),t<=2097151)return String(E*t+e);const n=16777215&(e>>>24|t<<8),i=t>>16&65535;let r=(16777215&e)+6777216*n+6710656*i,o=n+8147497*i,a=2*i;const s=1e7;return r>=s&&(o+=Math.floor(r/s),r%=s),o>=s&&(a+=Math.floor(o/s),o%=s),a.toString()+O(o)+O(r)}function R(e,t){return{lo:0|e,hi:0|t}}function I(e,t){return t=~t,e?e=1+~e:t+=1,R(e,t)}const O=e=>{const t=String(e);return"0000000".slice(t.length)+t};function x(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function _(){let e=this.buf[this.pos++],t=127&e;if(0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,0==(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let n=5;0!=(128&e)&&n<10;n++)e=this.buf[this.pos++];if(0!=(128&e))throw new Error("invalid varint");return this.assertBounds(),t>>>0}const N=function(){const e=new DataView(new ArrayBuffer(8));if("function"==typeof BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64&&("object"!=typeof process||"1"!=={NODE_ENV:"production",PUBLIC_URL:"/livekit-egress-template",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.BUF_BIGINT_DISABLE)){const t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),i=BigInt("0"),r=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){const i="bigint"==typeof e?e:BigInt(e);if(i>n||i<t)throw new Error("int64 invalid: ".concat(e));return i},uParse(e){const t="bigint"==typeof e?e:BigInt(e);if(t>r||t<i)throw new Error("uint64 invalid: ".concat(e));return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)),uDec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0))}}const t=e=>a(/^-?[0-9]+$/.test(e),"int64 invalid: ".concat(e)),n=e=>a(/^[0-9]+$/.test(e),"uint64 invalid: ".concat(e));return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),t(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),n(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),t(e),w(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),n(e),w(e)),dec:(e,t)=>function(e,t){let n=R(e,t);const i=2147483648&n.hi;i&&(n=I(n.lo,n.hi));const r=P(n.lo,n.hi);return i?"-"+r:r}(e,t),uDec:(e,t)=>P(e,t)}}();var M,D,A;function L(e,t,n){if(t===n)return!0;if(e==M.BYTES){if(!(t instanceof Uint8Array&&n instanceof Uint8Array))return!1;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}switch(e){case M.UINT64:case M.FIXED64:case M.INT64:case M.SFIXED64:case M.SINT64:return t==n}return!1}function U(e,t){switch(e){case M.BOOL:return!1;case M.UINT64:case M.FIXED64:case M.INT64:case M.SFIXED64:case M.SINT64:return 0==t?N.zero:"0";case M.DOUBLE:case M.FLOAT:return 0;case M.BYTES:return new Uint8Array(0);case M.STRING:return"";default:return 0}}function j(e,t){switch(e){case M.BOOL:return!1===t;case M.STRING:return""===t;case M.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return 0==t}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(M||(M={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING"}(D||(D={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(A||(A={}));class F{constructor(e){this.stack=[],this.textEncoder=null!=e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let t=new Uint8Array(e),n=0;for(let i=0;i<this.chunks.length;i++)t.set(this.chunks[i],n),n+=this.chunks[i].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(p(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return h(e),x(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){m(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){p(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){h(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return h(e),x(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=N.enc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=N.uEnc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=N.enc(e);return C(t.lo,t.hi,this.buf),this}sint64(e){let t=N.enc(e),n=t.hi>>31;return C(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}uint64(e){let t=N.uEnc(e);return C(t.lo,t.hi,this.buf),this}}class B{constructor(e,t){this.varint64=S,this.uint32=_,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!=t?t:new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e,t){let n=this.pos;switch(e){case A.Varint:for(;128&this.buf[this.pos++];);break;case A.Bit64:this.pos+=4;case A.Bit32:this.pos+=4;break;case A.LengthDelimited:let n=this.uint32();this.pos+=n;break;case A.StartGroup:for(;;){const[e,n]=this.tag();if(n===A.EndGroup){if(void 0!==t&&e!==t)throw new Error("invalid end group tag");break}this.skip(n,e)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return N.dec(...this.varint64())}uint64(){return N.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(1&e);return e=(e>>>1|(1&t)<<31)^n,t=t>>>1^n,N.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return N.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return N.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function V(e){const t=e.field.localName,n=Object.create(null);return n[t]=function(e){const t=e.field;if(t.repeated)return[];if(void 0!==t.default)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return U(t.T,t.L);case"message":const e=t.T,n=new e;return e.fieldWrapper?e.fieldWrapper.unwrapField(n):n;case"map":throw"map fields are not allowed to be extensions"}}(e),[n,()=>n[t]]}let q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),z=[];for(let n=0;n<q.length;n++)z[q[n].charCodeAt(0)]=n;z["-".charCodeAt(0)]=q.indexOf("+"),z["_".charCodeAt(0)]=q.indexOf("/");const W={dec(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let n,i=new Uint8Array(t),r=0,o=0,a=0;for(let s=0;s<e.length;s++){if(n=z[e.charCodeAt(s)],void 0===n)switch(e[s]){case"=":o=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(o){case 0:a=n,o=1;break;case 1:i[r++]=a<<2|(48&n)>>4,a=n,o=2;break;case 2:i[r++]=(15&a)<<4|(60&n)>>2,a=n,o=3;break;case 3:i[r++]=(3&a)<<6|n,o=0}}if(1==o)throw Error("invalid base64 string.");return i.subarray(0,r)},enc(e){let t,n="",i=0,r=0;for(let o=0;o<e.length;o++)switch(t=e[o],i){case 0:n+=q[t>>2],r=(3&t)<<4,i=1;break;case 1:n+=q[r|t>>4],r=(15&t)<<2,i=2;break;case 2:n+=q[r|t>>6],n+=q[63&t],i=0}return i&&(n+=q[r],n+="=",1==i&&(n+="=")),n}};function K(e,t,n){Q(t,e);const i=t.runtime.bin.makeReadOptions(n),r=function(e,t){if(!t.repeated&&("enum"==t.kind||"scalar"==t.kind)){for(let n=e.length-1;n>=0;--n)if(e[n].no==t.no)return[e[n]];return[]}return e.filter((e=>e.no===t.no))}(e.getType().runtime.bin.listUnknownFields(e),t.field),[o,a]=V(t);for(const s of r)t.runtime.bin.readField(o,i.readerFactory(s.data),t.field,s.wireType,i);return a()}function H(e,t,n,i){Q(t,e);const r=t.runtime.bin.makeReadOptions(i),o=t.runtime.bin.makeWriteOptions(i);if(G(e,t)){const n=e.getType().runtime.bin.listUnknownFields(e).filter((e=>e.no!=t.field.no));e.getType().runtime.bin.discardUnknownFields(e);for(const t of n)e.getType().runtime.bin.onUnknownField(e,t.no,t.wireType,t.data)}const a=o.writerFactory();let s=t.field;s.opt||s.repeated||"enum"!=s.kind&&"scalar"!=s.kind||(s=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(s,n,a,o);const c=r.readerFactory(a.finish());for(;c.pos<c.len;){const[t,n]=c.tag(),i=c.skip(n,t);e.getType().runtime.bin.onUnknownField(e,t,n,i)}}function G(e,t){const n=e.getType();return t.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(e).find((e=>e.no==t.field.no))}function Q(e,t){a(e.extendee.typeName==t.getType().typeName,"extension ".concat(e.typeName," can only be applied to message ").concat(e.extendee.typeName))}function J(e,t){const n=e.localName;if(e.repeated)return t[n].length>0;if(e.oneof)return t[e.oneof.localName].case===n;switch(e.kind){case"enum":case"scalar":return e.opt||e.req?void 0!==t[n]:"enum"==e.kind?t[n]!==e.T.values[0].no:!j(e.T,t[n]);case"message":return void 0!==t[n];case"map":return Object.keys(t[n]).length>0}}function Y(e,t){const n=e.localName,i=!e.opt&&!e.req;if(e.repeated)t[n]=[];else if(e.oneof)t[e.oneof.localName]={case:void 0};else switch(e.kind){case"map":t[n]={};break;case"enum":t[n]=i?e.T.values[0].no:void 0;break;case"scalar":t[n]=i?U(e.T,e.L):void 0;break;case"message":t[n]=void 0}}function $(e,t){if(null===e||"object"!=typeof e)return!1;if(!Object.getOwnPropertyNames(T.prototype).every((t=>t in e&&"function"==typeof e[t])))return!1;const n=e.getType();return null!==n&&"function"==typeof n&&"typeName"in n&&"string"==typeof n.typeName&&(void 0===t||n.typeName==t.typeName)}function X(e,t){return $(t)||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}M.DOUBLE,M.FLOAT,M.INT64,M.UINT64,M.INT32,M.UINT32,M.BOOL,M.STRING,M.BYTES;const Z={ignoreUnknownFields:!1},ee={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function te(e){return e?Object.assign(Object.assign({},Z),e):Z}function ne(e){return e?Object.assign(Object.assign({},ee),e):ee}const ie=Symbol(),re=Symbol();function oe(e){if(null===e)return"null";switch(typeof e){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":'"'.concat(e.split('"').join('\\"'),'"');default:return String(e)}}function ae(e,t,n,i,r){let o=n.localName;if(n.repeated){if(a("map"!=n.kind),null===t)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(oe(t)));const s=e[o];for(const e of t){if(null===e)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(oe(e)));switch(n.kind){case"message":s.push(n.T.fromJson(e,i));break;case"enum":const o=le(n.T,e,i.ignoreUnknownFields,!0);o!==re&&s.push(o);break;case"scalar":try{s.push(ce(n.T,e,n.L,!0))}catch(t){let i="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(oe(e));throw t instanceof Error&&t.message.length>0&&(i+=": ".concat(t.message)),new Error(i)}}}}else if("map"==n.kind){if(null===t)return;if("object"!=typeof t||Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(oe(t)));const a=e[o];for(const[o,s]of Object.entries(t)){if(null===s)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let c;try{c=se(n.K,o)}catch(e){let i="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(oe(t));throw e instanceof Error&&e.message.length>0&&(i+=": ".concat(e.message)),new Error(i)}switch(n.V.kind){case"message":a[c]=n.V.T.fromJson(s,i);break;case"enum":const o=le(n.V.T,s,i.ignoreUnknownFields,!0);o!==re&&(a[c]=o);break;case"scalar":try{a[c]=ce(n.V.T,s,D.BIGINT,!0)}catch(e){let i="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(oe(t));throw e instanceof Error&&e.message.length>0&&(i+=": ".concat(e.message)),new Error(i)}}}}else switch(n.oneof&&(e=e[n.oneof.localName]={case:o},o="value"),n.kind){case"message":const a=n.T;if(null===t&&"google.protobuf.Value"!=a.typeName)return;let s=e[o];$(s)?s.fromJson(t,i):(e[o]=s=a.fromJson(t,i),a.fieldWrapper&&!n.oneof&&(e[o]=a.fieldWrapper.unwrapField(s)));break;case"enum":const c=le(n.T,t,i.ignoreUnknownFields,!1);switch(c){case ie:Y(n,e);break;case re:break;default:e[o]=c}break;case"scalar":try{const i=ce(n.T,t,n.L,!1);i===ie?Y(n,e):e[o]=i}catch(e){let i="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(oe(t));throw e instanceof Error&&e.message.length>0&&(i+=": ".concat(e.message)),new Error(i)}}}function se(e,t){if(e===M.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1}return ce(e,t,D.BIGINT,!0).toString()}function ce(e,t,n,i){if(null===t)return i?U(e,n):ie;switch(e){case M.DOUBLE:case M.FLOAT:if("NaN"===t)return Number.NaN;if("Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(""===t)break;if("string"==typeof t&&t.trim().length!==t.length)break;if("string"!=typeof t&&"number"!=typeof t)break;const i=Number(t);if(Number.isNaN(i))break;if(!Number.isFinite(i))break;return e==M.FLOAT&&m(i),i;case M.INT32:case M.FIXED32:case M.SFIXED32:case M.SINT32:case M.UINT32:let r;if("number"==typeof t?r=t:"string"==typeof t&&t.length>0&&t.trim().length===t.length&&(r=Number(t)),void 0===r)break;return e==M.UINT32||e==M.FIXED32?p(r):h(r),r;case M.INT64:case M.SFIXED64:case M.SINT64:if("number"!=typeof t&&"string"!=typeof t)break;const o=N.parse(t);return n?o.toString():o;case M.FIXED64:case M.UINT64:if("number"!=typeof t&&"string"!=typeof t)break;const a=N.uParse(t);return n?a.toString():a;case M.BOOL:if("boolean"!=typeof t)break;return t;case M.STRING:if("string"!=typeof t)break;try{encodeURIComponent(t)}catch(e){throw new Error("invalid UTF8")}return t;case M.BYTES:if(""===t)return new Uint8Array(0);if("string"!=typeof t)break;return W.dec(t)}throw new Error}function le(e,t,n,i){if(null===t)return"google.protobuf.NullValue"==e.typeName?0:i?e.values[0].no:ie;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const i=e.findName(t);if(void 0!==i)return i.no;if(n)return re}throw new Error("cannot decode enum ".concat(e.typeName," from JSON: ").concat(oe(t)))}function de(e){return!(!e.repeated&&"map"!=e.kind)||!e.oneof&&"message"!=e.kind&&!e.opt&&!e.req}function ue(e,t,n){if("map"==e.kind){a("object"==typeof t&&null!=t);const i={},r=Object.entries(t);switch(e.V.kind){case"scalar":for(const[n,o]of r)i[n.toString()]=pe(e.V.T,o);break;case"message":for(const[e,o]of r)i[e.toString()]=o.toJson(n);break;case"enum":const t=e.V.T;for(const[e,o]of r)i[e.toString()]=he(t,o,n.enumAsInteger)}return n.emitDefaultValues||r.length>0?i:void 0}if(e.repeated){a(Array.isArray(t));const i=[];switch(e.kind){case"scalar":for(let n=0;n<t.length;n++)i.push(pe(e.T,t[n]));break;case"enum":for(let r=0;r<t.length;r++)i.push(he(e.T,t[r],n.enumAsInteger));break;case"message":for(let e=0;e<t.length;e++)i.push(t[e].toJson(n))}return n.emitDefaultValues||i.length>0?i:void 0}switch(e.kind){case"scalar":return pe(e.T,t);case"enum":return he(e.T,t,n.enumAsInteger);case"message":return X(e.T,t).toJson(n)}}function he(e,t,n){var i;if(a("number"==typeof t),"google.protobuf.NullValue"==e.typeName)return null;if(n)return t;const r=e.findNumber(t);return null!==(i=null==r?void 0:r.name)&&void 0!==i?i:t}function pe(e,t){switch(e){case M.INT32:case M.SFIXED32:case M.SINT32:case M.FIXED32:case M.UINT32:return a("number"==typeof t),t;case M.FLOAT:case M.DOUBLE:return a("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case M.STRING:return a("string"==typeof t),t;case M.BOOL:return a("boolean"==typeof t),t;case M.UINT64:case M.FIXED64:case M.INT64:case M.SFIXED64:case M.SINT64:return a("bigint"==typeof t||"string"==typeof t||"number"==typeof t),t.toString();case M.BYTES:return a(t instanceof Uint8Array),W.enc(t)}}const me=Symbol("@bufbuild/protobuf/unknown-fields"),fe={readUnknownFields:!0,readerFactory:e=>new B(e)},ge={writeUnknownFields:!0,writerFactory:()=>new F};function ve(e){return e?Object.assign(Object.assign({},fe),e):fe}function be(e){return e?Object.assign(Object.assign({},ge),e):ge}function ye(e,t,n,i,r){let{repeated:o,localName:a}=n;switch(n.oneof&&((e=e[n.oneof.localName]).case!=a&&delete e.value,e.case=a,a="value"),n.kind){case"scalar":case"enum":const s="enum"==n.kind?M.INT32:n.T;let c=Se;if("scalar"==n.kind&&n.L>0&&(c=Te),o){let n=e[a];if(i==A.LengthDelimited&&s!=M.STRING&&s!=M.BYTES){let e=t.uint32()+t.pos;for(;t.pos<e;)n.push(c(t,s))}else n.push(c(t,s))}else e[a]=c(t,s);break;case"message":const l=n.T;o?e[a].push(ke(t,new l,r,n)):$(e[a])?ke(t,e[a],r,n):(e[a]=ke(t,new l,r,n),!l.fieldWrapper||n.oneof||n.repeated||(e[a]=l.fieldWrapper.unwrapField(e[a])));break;case"map":let[d,u]=function(e,t,n){const i=t.uint32(),r=t.pos+i;let o,a;for(;t.pos<r;){const[i]=t.tag();switch(i){case 1:o=Se(t,e.K);break;case 2:switch(e.V.kind){case"scalar":a=Se(t,e.V.T);break;case"enum":a=t.int32();break;case"message":a=ke(t,new e.V.T,n,void 0)}}}if(void 0===o&&(o=U(e.K,D.BIGINT)),"string"!=typeof o&&"number"!=typeof o&&(o=o.toString()),void 0===a)switch(e.V.kind){case"scalar":a=U(e.V.T,D.BIGINT);break;case"enum":a=e.V.T.values[0].no;break;case"message":a=new e.V.T}return[o,a]}(n,t,r);e[a][d]=u}}function ke(e,t,n,i){const r=t.getType().runtime.bin,o=null==i?void 0:i.delimited;return r.readMessage(t,e,o?i.no:e.uint32(),n,o),t}function Te(e,t){const n=Se(e,t);return"bigint"==typeof n?n.toString():n}function Se(e,t){switch(t){case M.STRING:return e.string();case M.BOOL:return e.bool();case M.DOUBLE:return e.double();case M.FLOAT:return e.float();case M.INT32:return e.int32();case M.INT64:return e.int64();case M.UINT64:return e.uint64();case M.FIXED64:return e.fixed64();case M.BYTES:return e.bytes();case M.FIXED32:return e.fixed32();case M.SFIXED32:return e.sfixed32();case M.SFIXED64:return e.sfixed64();case M.SINT64:return e.sint64();case M.UINT32:return e.uint32();case M.SINT32:return e.sint32()}}function Ce(e,t,n,i){a(void 0!==t);const r=e.repeated;switch(e.kind){case"scalar":case"enum":let o="enum"==e.kind?M.INT32:e.T;if(r)if(a(Array.isArray(t)),e.packed)!function(e,t,n,i){if(!i.length)return;e.tag(n,A.LengthDelimited).fork();let[,r]=Re(t);for(let o=0;o<i.length;o++)e[r](i[o]);e.join()}(n,o,e.no,t);else for(const i of t)Pe(n,o,e.no,i);else Pe(n,o,e.no,t);break;case"message":if(r){a(Array.isArray(t));for(const r of t)we(n,i,e,r)}else we(n,i,e,t);break;case"map":a("object"==typeof t&&null!=t);for(const[r,a]of Object.entries(t))Ee(n,i,e,r,a)}}function Ee(e,t,n,i,r){e.tag(n.no,A.LengthDelimited),e.fork();let o=i;switch(n.K){case M.INT32:case M.FIXED32:case M.UINT32:case M.SFIXED32:case M.SINT32:o=Number.parseInt(i);break;case M.BOOL:a("true"==i||"false"==i),o="true"==i}switch(Pe(e,n.K,1,o),n.V.kind){case"scalar":Pe(e,n.V.T,2,r);break;case"enum":Pe(e,M.INT32,2,r);break;case"message":a(void 0!==r),e.tag(2,A.LengthDelimited).bytes(r.toBinary(t))}e.join()}function we(e,t,n,i){const r=X(n.T,i);n.delimited?e.tag(n.no,A.StartGroup).raw(r.toBinary(t)).tag(n.no,A.EndGroup):e.tag(n.no,A.LengthDelimited).bytes(r.toBinary(t))}function Pe(e,t,n,i){a(void 0!==i);let[r,o]=Re(t);e.tag(n,r)[o](i)}function Re(e){let t=A.Varint;switch(e){case M.BYTES:case M.STRING:t=A.LengthDelimited;break;case M.DOUBLE:case M.FIXED64:case M.SFIXED64:t=A.Bit64;break;case M.FIXED32:case M.SFIXED32:case M.FLOAT:t=A.Bit32}return[t,M[e].toLowerCase()]}function Ie(e){if(void 0===e)return e;if($(e))return e.clone();if(e instanceof Uint8Array){const t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function Oe(e){return e instanceof Uint8Array?e:new Uint8Array(e)}class xe{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const e={};for(const t of this.list())e[t.jsonName]=e[t.name]=t;this.jsonNames=e}return this.jsonNames[e]}find(e){if(!this.numbers){const e={};for(const t of this.list())e[t.no]=t;this.numbers=e}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort(((e,t)=>e.no-t.no))),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const n of this.list())n.oneof?n.oneof!==t&&(t=n.oneof,e.push(t)):e.push(n)}return this.members}}function _e(e,t){const n=Me(e);return t?n:je(Ue(n))}const Ne=Me;function Me(e){let t=!1;const n=[];for(let i=0;i<e.length;i++){let r=e.charAt(i);switch(r){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),t=!1;break;default:t&&(t=!1,r=r.toUpperCase()),n.push(r)}}return n.join("")}const De=new Set(["constructor","toString","toJSON","valueOf"]),Ae=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Le=e=>"".concat(e,"$"),Ue=e=>Ae.has(e)?Le(e):e,je=e=>De.has(e)?Le(e):e;class Fe{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=_e(e,!1)}addField(e){a(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[e]}}const Be=(Ve=e=>new xe(e,(e=>function(e){var t,n,i,r,o,a;const s=[];let c;for(const l of"function"==typeof e?e():e){const e=l;if(e.localName=_e(l.name,void 0!==l.oneof),e.jsonName=null!==(t=l.jsonName)&&void 0!==t?t:Ne(l.name),e.repeated=null!==(n=l.repeated)&&void 0!==n&&n,"scalar"==l.kind&&(e.L=null!==(i=l.L)&&void 0!==i?i:D.BIGINT),e.delimited=null!==(r=l.delimited)&&void 0!==r&&r,e.req=null!==(o=l.req)&&void 0!==o&&o,e.opt=null!==(a=l.opt)&&void 0!==a&&a,void 0===l.packed&&(e.packed="enum"==l.kind||"scalar"==l.kind&&l.T!=M.BYTES&&l.T!=M.STRING),void 0!==l.oneof){const t="string"==typeof l.oneof?l.oneof:l.oneof.name;c&&c.name==t||(c=new Fe(t)),e.oneof=c,c.addField(e)}s.push(e)}return s}(e))),qe=e=>{for(const t of e.getType().fields.byMember()){if(t.opt)continue;const n=t.localName,i=e;if(t.repeated)i[n]=[];else switch(t.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=U(t.T,t.L)}}},{syntax:"proto3",json:{makeReadOptions:te,makeWriteOptions:ne,readMessage(e,t,n,i){if(null==t||Array.isArray(t)||"object"!=typeof t)throw new Error("cannot decode message ".concat(e.typeName," from JSON: ").concat(oe(t)));i=null!=i?i:new e;const r=new Map,o=n.typeRegistry;for(const[a,s]of Object.entries(t)){const t=e.fields.findJsonName(a);if(t){if(t.oneof){if(null===s&&"scalar"==t.kind)continue;const n=r.get(t.oneof);if(void 0!==n)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: multiple keys for oneof "').concat(t.oneof.name,'" present: "').concat(n,'", "').concat(a,'"'));r.set(t.oneof,a)}ae(i,s,t,n,e)}else{let t=!1;if((null==o?void 0:o.findExtension)&&a.startsWith("[")&&a.endsWith("]")){const r=o.findExtension(a.substring(1,a.length-1));if(r&&r.extendee.typeName==e.typeName){t=!0;const[e,o]=V(r);ae(e,s,r.field,n,r),H(i,r,o(),n)}}if(!t&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: key "').concat(a,'" is unknown'))}}return i},writeMessage(e,t){const n=e.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!J(r,e)){if(r.req)throw"required field not set";if(!t.emitDefaultValues)continue;if(!de(r))continue}const n=ue(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t);void 0!==n&&(i[t.useProtoFieldName?r.name:r.jsonName]=n)}const o=t.typeRegistry;if(null==o?void 0:o.findExtensionFor)for(const r of n.runtime.bin.listUnknownFields(e)){const a=o.findExtensionFor(n.typeName,r.no);if(a&&G(e,a)){const n=K(e,a,t),r=ue(a.field,n,t);void 0!==r&&(i[a.field.jsonName]=r)}}}catch(e){const t=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),i=e instanceof Error?e.message:String(e);throw new Error(t+(i.length>0?": ".concat(i):""))}return i},readScalar:(e,t,n)=>ce(e,t,null!=n?n:D.BIGINT,!0),writeScalar(e,t,n){if(void 0!==t)return n||j(e,t)?pe(e,t):void 0},debug:oe},bin:{makeReadOptions:ve,makeWriteOptions:be,listUnknownFields(e){var t;return null!==(t=e[me])&&void 0!==t?t:[]},discardUnknownFields(e){delete e[me]},writeUnknownFields(e,t){const n=e[me];if(n)for(const i of n)t.tag(i.no,i.wireType).raw(i.data)},onUnknownField(e,t,n,i){const r=e;Array.isArray(r[me])||(r[me]=[]),r[me].push({no:t,wireType:n,data:i})},readMessage(e,t,n,i,r){const o=e.getType(),a=r?t.len:t.pos+n;let s,c;for(;t.pos<a&&([s,c]=t.tag(),!0!==r||c!=A.EndGroup);){const n=o.fields.find(s);if(n)ye(e,t,n,c,i);else{const n=t.skip(c,s);i.readUnknownFields&&this.onUnknownField(e,s,c,n)}}if(r&&(c!=A.EndGroup||s!==n))throw new Error("invalid end group tag")},readField:ye,writeMessage(e,t,n){const i=e.getType();for(const r of i.fields.byNumber())if(J(r,e))Ce(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t,n);else if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));return n.writeUnknownFields&&this.writeUnknownFields(e,t),t},writeField(e,t,n,i){void 0!==t&&Ce(e,t,n,i)}},util:Object.assign(Object.assign({},{setEnumType:v,initPartial(e,t){if(void 0===e)return;const n=t.getType();for(const i of n.fields.byMember()){const n=i.localName,r=t,o=e;if(null!=o[n])switch(i.kind){case"oneof":const e=o[n].case;if(void 0===e)continue;const t=i.findField(e);let a=o[n].value;t&&"message"==t.kind&&!$(a,t.T)?a=new t.T(a):t&&"scalar"===t.kind&&t.T===M.BYTES&&(a=Oe(a)),r[n]={case:e,value:a};break;case"scalar":case"enum":let s=o[n];i.T===M.BYTES&&(s=i.repeated?s.map(Oe):Oe(s)),r[n]=s;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===M.BYTES)for(const[t,i]of Object.entries(o[n]))r[n][t]=Oe(i);else Object.assign(r[n],o[n]);break;case"message":const e=i.V.T;for(const t of Object.keys(o[n])){let i=o[n][t];e.fieldWrapper||(i=new e(i)),r[n][t]=i}}break;case"message":const c=i.T;if(i.repeated)r[n]=o[n].map((e=>$(e,c)?e:new c(e)));else{const e=o[n];c.fieldWrapper?"google.protobuf.BytesValue"===c.typeName?r[n]=Oe(e):r[n]=e:r[n]=$(e,c)?e:new c(e)}}}},equals:(e,t,n)=>t===n||!(!t||!n)&&e.fields.byMember().every((e=>{const i=t[e.localName],r=n[e.localName];if(e.repeated){if(i.length!==r.length)return!1;switch(e.kind){case"message":return i.every(((t,n)=>e.T.equals(t,r[n])));case"scalar":return i.every(((t,n)=>L(e.T,t,r[n])));case"enum":return i.every(((e,t)=>L(M.INT32,e,r[t])))}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":return e.T.equals(i,r);case"enum":return L(M.INT32,i,r);case"scalar":return L(e.T,i,r);case"oneof":if(i.case!==r.case)return!1;const t=e.findField(i.case);if(void 0===t)return!0;switch(t.kind){case"message":return t.T.equals(i.value,r.value);case"enum":return L(M.INT32,i.value,r.value);case"scalar":return L(t.T,i.value,r.value)}throw new Error("oneof cannot contain ".concat(t.kind));case"map":const n=Object.keys(i).concat(Object.keys(r));switch(e.V.kind){case"message":const t=e.V.T;return n.every((e=>t.equals(i[e],r[e])));case"enum":return n.every((e=>L(M.INT32,i[e],r[e])));case"scalar":const o=e.V.T;return n.every((e=>L(o,i[e],r[e])))}}})),clone(e){const t=e.getType(),n=new t,i=n;for(const r of t.fields.byMember()){const t=e[r.localName];let n;if(r.repeated)n=t.map(Ie);else if("map"==r.kind){n=i[r.localName];for(const[e,i]of Object.entries(t))n[e]=Ie(i)}else n="oneof"==r.kind?r.findField(t.case)?{case:t.case,value:Ie(t.value)}:{case:void 0}:Ie(t);i[r.localName]=n}for(const r of t.runtime.bin.listUnknownFields(e))t.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}),{newFieldList:Ve,initFields:qe}),makeMessageType(e,t,n){return function(e,t,n,i){var r;const o=null!==(r=null==i?void 0:i.localName)&&void 0!==r?r:t.substring(t.lastIndexOf(".")+1),a={[o]:function(t){e.util.initFields(this),e.util.initPartial(t,this)}}[o];return Object.setPrototypeOf(a.prototype,new T),Object.assign(a,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary:(e,t)=>(new a).fromBinary(e,t),fromJson:(e,t)=>(new a).fromJson(e,t),fromJsonString:(e,t)=>(new a).fromJsonString(e,t),equals:(t,n)=>e.util.equals(a,t,n)}),a}(this,e,t,n)},makeEnum:y,makeEnumType:b,getEnumType:g,makeExtension(e,t,n){return function(e,t,n,i){let r;return{typeName:t,extendee:n,get field(){if(!r){const n="function"==typeof i?i():i;n.name=t.split(".").pop(),n.jsonName="[".concat(t,"]"),r=e.util.newFieldList([n]).list()[0]}return r},runtime:e}}(this,e,t,n)}});var Ve,qe;class ze extends T{constructor(e){super(),this.seconds=N.zero,this.nanos=0,Be.util.initPartial(e,this)}fromJson(e,t){if("string"!=typeof e)throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(Be.json.debug(e)));const n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=N.parse(i/1e3),this.nanos=0,n[7]&&(this.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),this}toJson(e){const t=1e3*Number(this.seconds);if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let n="Z";if(this.nanos>0){const e=(this.nanos+1e9).toString().substring(1);n="000000"===e.substring(3)?"."+e.substring(0,3)+"Z":"000"===e.substring(6)?"."+e.substring(0,6)+"Z":"."+e+"Z"}return new Date(t).toISOString().replace(".000Z",n)}toDate(){return new Date(1e3*Number(this.seconds)+Math.ceil(this.nanos/1e6))}static now(){return ze.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new ze({seconds:N.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return(new ze).fromBinary(e,t)}static fromJson(e,t){return(new ze).fromJson(e,t)}static fromJsonString(e,t){return(new ze).fromJsonString(e,t)}static equals(e,t){return Be.util.equals(ze,e,t)}}ze.runtime=Be,ze.typeName="google.protobuf.Timestamp",ze.fields=Be.util.newFieldList((()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]));const We=Be.makeMessageType("livekit.MetricsBatch",(()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:ze},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:Ke,repeated:!0},{no:5,name:"events",kind:"message",T:Ge,repeated:!0}])),Ke=Be.makeMessageType("livekit.TimeSeriesMetric",(()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:He,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}])),He=Be.makeMessageType("livekit.MetricSample",(()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:ze},{no:3,name:"value",kind:"scalar",T:2}])),Ge=Be.makeMessageType("livekit.EventMetric",(()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:ze},{no:7,name:"normalized_end_timestamp",kind:"message",T:ze,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}])),Qe=Be.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Je=Be.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Ye=Be.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),$e=Be.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Xe=Be.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Ze=Be.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"}]),et=Be.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),tt=Be.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),nt=Be.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),it=Be.makeMessageType("livekit.Room",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:rt,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Dt}])),rt=Be.makeMessageType("livekit.Codec",(()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}])),ot=Be.makeMessageType("livekit.ParticipantPermission",(()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:Be.getEnumType(Je),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}])),at=Be.makeMessageType("livekit.ParticipantInfo",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:Be.getEnumType(st)},{no:4,name:"tracks",kind:"message",T:ut,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:ot},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:Be.getEnumType(ct)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:Be.getEnumType(Ze)}])),st=Be.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),ct=Be.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),lt=Be.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),dt=Be.makeMessageType("livekit.SimulcastCodecInfo",(()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ht,repeated:!0}])),ut=Be.makeMessageType("livekit.TrackInfo",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:Be.getEnumType(Qe)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:Be.getEnumType(Je)},{no:10,name:"layers",kind:"message",T:ht,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:dt,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:Be.getEnumType(lt)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Dt},{no:19,name:"audio_features",kind:"enum",T:Be.getEnumType(nt),repeated:!0}])),ht=Be.makeMessageType("livekit.VideoLayer",(()=>[{no:1,name:"quality",kind:"enum",T:Be.getEnumType(Ye)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}])),pt=Be.makeMessageType("livekit.DataPacket",(()=>[{no:1,name:"kind",kind:"enum",T:Be.getEnumType(mt)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:vt,oneof:"value"},{no:3,name:"speaker",kind:"message",T:ft,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:bt,oneof:"value"},{no:7,name:"transcription",kind:"message",T:yt,oneof:"value"},{no:8,name:"metrics",kind:"message",T:We,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Tt,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:St,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Ct,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Et,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:jt,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Ft,oneof:"value"}])),mt=Be.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),ft=Be.makeMessageType("livekit.ActiveSpeakerUpdate",(()=>[{no:1,name:"speakers",kind:"message",T:gt,repeated:!0}])),gt=Be.makeMessageType("livekit.SpeakerInfo",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}])),vt=Be.makeMessageType("livekit.UserPacket",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0}])),bt=Be.makeMessageType("livekit.SipDTMF",(()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}])),yt=Be.makeMessageType("livekit.Transcription",(()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:kt,repeated:!0}])),kt=Be.makeMessageType("livekit.TranscriptionSegment",(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}])),Tt=Be.makeMessageType("livekit.ChatMessage",(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}])),St=Be.makeMessageType("livekit.RpcRequest",(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}])),Ct=Be.makeMessageType("livekit.RpcAck",(()=>[{no:1,name:"request_id",kind:"scalar",T:9}])),Et=Be.makeMessageType("livekit.RpcResponse",(()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:wt,oneof:"value"}])),wt=Be.makeMessageType("livekit.RpcError",(()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}])),Pt=Be.makeMessageType("livekit.ParticipantTracks",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}])),Rt=Be.makeMessageType("livekit.ServerInfo",(()=>[{no:1,name:"edition",kind:"enum",T:Be.getEnumType(It)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}])),It=Be.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),Ot=Be.makeMessageType("livekit.ClientInfo",(()=>[{no:1,name:"sdk",kind:"enum",T:Be.getEnumType(xt)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}])),xt=Be.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"}]),_t=Be.makeMessageType("livekit.ClientConfiguration",(()=>[{no:1,name:"video",kind:"message",T:Nt},{no:2,name:"screen",kind:"message",T:Nt},{no:3,name:"resume_connection",kind:"enum",T:Be.getEnumType(Xe)},{no:4,name:"disabled_codecs",kind:"message",T:Mt},{no:5,name:"force_relay",kind:"enum",T:Be.getEnumType(Xe)}])),Nt=Be.makeMessageType("livekit.VideoConfiguration",(()=>[{no:1,name:"hardware_encoder",kind:"enum",T:Be.getEnumType(Xe)}])),Mt=Be.makeMessageType("livekit.DisabledCodecs",(()=>[{no:1,name:"codecs",kind:"message",T:rt,repeated:!0},{no:2,name:"publish",kind:"message",T:rt,repeated:!0}])),Dt=Be.makeMessageType("livekit.TimedVersion",(()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}])),At=Be.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),Lt=Be.makeMessageType("livekit.DataStream.TextHeader",(()=>[{no:1,name:"operation_type",kind:"enum",T:Be.getEnumType(At)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}]),{localName:"DataStream_TextHeader"}),Ut=Be.makeMessageType("livekit.DataStream.FileHeader",(()=>[{no:1,name:"file_name",kind:"scalar",T:9}]),{localName:"DataStream_FileHeader"}),jt=Be.makeMessageType("livekit.DataStream.Header",(()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:6,name:"total_chunks",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:Be.getEnumType(lt)},{no:8,name:"extensions",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Lt,oneof:"content_header"},{no:10,name:"file_header",kind:"message",T:Ut,oneof:"content_header"}]),{localName:"DataStream_Header"}),Ft=Be.makeMessageType("livekit.DataStream.Chunk",(()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"complete",kind:"scalar",T:8},{no:5,name:"version",kind:"scalar",T:5},{no:6,name:"iv",kind:"scalar",T:12,opt:!0}]),{localName:"DataStream_Chunk"}),Bt=Be.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Vt=Be.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),qt=Be.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),zt=Be.makeMessageType("livekit.SignalRequest",(()=>[{no:1,name:"offer",kind:"message",T:Zt,oneof:"message"},{no:2,name:"answer",kind:"message",T:Zt,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Gt,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Ht,oneof:"message"},{no:5,name:"mute",kind:"message",T:Qt,oneof:"message"},{no:6,name:"subscription",kind:"message",T:tn,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:nn,oneof:"message"},{no:8,name:"leave",kind:"message",T:an,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:cn,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:Tn,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Cn,oneof:"message"},{no:13,name:"simulate",kind:"message",T:wn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:ln,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Pn,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:rn,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:on,oneof:"message"}])),Wt=Be.makeMessageType("livekit.SignalResponse",(()=>[{no:1,name:"join",kind:"message",T:Jt,oneof:"message"},{no:2,name:"answer",kind:"message",T:Zt,oneof:"message"},{no:3,name:"offer",kind:"message",T:Zt,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Gt,oneof:"message"},{no:5,name:"update",kind:"message",T:en,oneof:"message"},{no:6,name:"track_published",kind:"message",T:$t,oneof:"message"},{no:8,name:"leave",kind:"message",T:an,oneof:"message"},{no:9,name:"mute",kind:"message",T:Qt,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:un,oneof:"message"},{no:11,name:"room_update",kind:"message",T:hn,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:mn,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:gn,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:yn,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:Sn,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:Xt,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:Yt,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Rn,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:xn,oneof:"message"},{no:22,name:"request_response",kind:"message",T:_n,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:Mn,oneof:"message"}])),Kt=Be.makeMessageType("livekit.SimulcastCodec",(()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}])),Ht=Be.makeMessageType("livekit.AddTrackRequest",(()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:Be.getEnumType(Qe)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:Be.getEnumType(Je)},{no:9,name:"layers",kind:"message",T:ht,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Kt,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:Be.getEnumType(lt)},{no:15,name:"stream",kind:"scalar",T:9}])),Gt=Be.makeMessageType("livekit.TrickleRequest",(()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:Be.getEnumType(Bt)},{no:3,name:"final",kind:"scalar",T:8}])),Qt=Be.makeMessageType("livekit.MuteTrackRequest",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}])),Jt=Be.makeMessageType("livekit.JoinResponse",(()=>[{no:1,name:"room",kind:"message",T:it},{no:2,name:"participant",kind:"message",T:at},{no:3,name:"other_participants",kind:"message",T:at,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:dn,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:_t},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Rt},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:rt,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}])),Yt=Be.makeMessageType("livekit.ReconnectResponse",(()=>[{no:1,name:"ice_servers",kind:"message",T:dn,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:_t}])),$t=Be.makeMessageType("livekit.TrackPublishedResponse",(()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:ut}])),Xt=Be.makeMessageType("livekit.TrackUnpublishedResponse",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9}])),Zt=Be.makeMessageType("livekit.SessionDescription",(()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}])),en=Be.makeMessageType("livekit.ParticipantUpdate",(()=>[{no:1,name:"participants",kind:"message",T:at,repeated:!0}])),tn=Be.makeMessageType("livekit.UpdateSubscription",(()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:Pt,repeated:!0}])),nn=Be.makeMessageType("livekit.UpdateTrackSettings",(()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:Be.getEnumType(Ye)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}])),rn=Be.makeMessageType("livekit.UpdateLocalAudioTrack",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:Be.getEnumType(nt),repeated:!0}])),on=Be.makeMessageType("livekit.UpdateLocalVideoTrack",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}])),an=Be.makeMessageType("livekit.LeaveRequest",(()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:Be.getEnumType(Ze)},{no:3,name:"action",kind:"enum",T:Be.getEnumType(sn)},{no:4,name:"regions",kind:"message",T:In}])),sn=Be.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),cn=Be.makeMessageType("livekit.UpdateVideoLayers",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:ht,repeated:!0}])),ln=Be.makeMessageType("livekit.UpdateParticipantMetadata",(()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}])),dn=Be.makeMessageType("livekit.ICEServer",(()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}])),un=Be.makeMessageType("livekit.SpeakersChanged",(()=>[{no:1,name:"speakers",kind:"message",T:gt,repeated:!0}])),hn=Be.makeMessageType("livekit.RoomUpdate",(()=>[{no:1,name:"room",kind:"message",T:it}])),pn=Be.makeMessageType("livekit.ConnectionQualityInfo",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:Be.getEnumType($e)},{no:3,name:"score",kind:"scalar",T:2}])),mn=Be.makeMessageType("livekit.ConnectionQualityUpdate",(()=>[{no:1,name:"updates",kind:"message",T:pn,repeated:!0}])),fn=Be.makeMessageType("livekit.StreamStateInfo",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:Be.getEnumType(Vt)}])),gn=Be.makeMessageType("livekit.StreamStateUpdate",(()=>[{no:1,name:"stream_states",kind:"message",T:fn,repeated:!0}])),vn=Be.makeMessageType("livekit.SubscribedQuality",(()=>[{no:1,name:"quality",kind:"enum",T:Be.getEnumType(Ye)},{no:2,name:"enabled",kind:"scalar",T:8}])),bn=Be.makeMessageType("livekit.SubscribedCodec",(()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:vn,repeated:!0}])),yn=Be.makeMessageType("livekit.SubscribedQualityUpdate",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:vn,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:bn,repeated:!0}])),kn=Be.makeMessageType("livekit.TrackPermission",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}])),Tn=Be.makeMessageType("livekit.SubscriptionPermission",(()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:kn,repeated:!0}])),Sn=Be.makeMessageType("livekit.SubscriptionPermissionUpdate",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}])),Cn=Be.makeMessageType("livekit.SyncState",(()=>[{no:1,name:"answer",kind:"message",T:Zt},{no:2,name:"subscription",kind:"message",T:tn},{no:3,name:"publish_tracks",kind:"message",T:$t,repeated:!0},{no:4,name:"data_channels",kind:"message",T:En,repeated:!0},{no:5,name:"offer",kind:"message",T:Zt},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0}])),En=Be.makeMessageType("livekit.DataChannelInfo",(()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:Be.getEnumType(Bt)}])),wn=Be.makeMessageType("livekit.SimulateScenario",(()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:Be.getEnumType(qt),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}])),Pn=Be.makeMessageType("livekit.Ping",(()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}])),Rn=Be.makeMessageType("livekit.Pong",(()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}])),In=Be.makeMessageType("livekit.RegionSettings",(()=>[{no:1,name:"regions",kind:"message",T:On,repeated:!0}])),On=Be.makeMessageType("livekit.RegionInfo",(()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}])),xn=Be.makeMessageType("livekit.SubscriptionResponse",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:Be.getEnumType(tt)}])),_n=Be.makeMessageType("livekit.RequestResponse",(()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:Be.getEnumType(Nn)},{no:3,name:"message",kind:"scalar",T:9}])),Nn=Be.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),Mn=Be.makeMessageType("livekit.TrackSubscribed",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]));function Dn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var An,Ln,Un,jn={exports:{}},Fn=jn.exports,Bn=(An||(An=1,function(e){var t,n;t=Fn,n=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],r={},o=null;function a(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var n=this.getLevel(),r=0;r<i.length;r++){var o=i[r];this[o]=r<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function l(e){return function(){typeof console!==t&&(c.call(this),this[e].apply(this,arguments))}}function d(i,r,o){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?s:void 0!==console[i]?a(console,i):void 0!==console.log?a(console,"log"):e)}(i)||l.apply(this,arguments)}function u(e,n){var a,s,l,u=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,i=encodeURIComponent(h),r=n.indexOf(i+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r+i.length+1))[1])}catch(e){}return void 0===u.levels[e]&&(e=void 0),e}}function m(e){var t=e;if("string"==typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=u.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=n||d,u.getLevel=function(){return null!=l?l:null!=s?s:a},u.setLevel=function(e,n){return l=m(e),!1!==n&&function(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch(e){}}}(l),c.call(u)},u.setDefaultLevel=function(e){s=m(e),p()||u.setLevel(e,!1)},u.resetLevel=function(){l=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),c.call(u)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)},u.rebuild=function(){if(o!==u&&(a=m(o.getLevel())),c.call(u),o===u)for(var e in r)r[e].rebuild()},a=m(o?o.getLevel():"WARN");var f=p();null!=f&&(l=m(f)),c.call(u)}(o=new u).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=r[e];return t||(t=r[e]=new u(e,o.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=h),o},o.getLoggers=function(){return r},o.default=o,o},e.exports?e.exports=n():t.log=n()}(jn)),jn.exports);e.LogLevel=void 0,(Ln=e.LogLevel||(e.LogLevel={}))[Ln.trace=0]="trace",Ln[Ln.debug=1]="debug",Ln[Ln.info=2]="info",Ln[Ln.warn=3]="warn",Ln[Ln.error=4]="error",Ln[Ln.silent=5]="silent",e.LoggerNames=void 0,(Un=e.LoggerNames||(e.LoggerNames={})).Default="livekit",Un.Room="livekit-room",Un.Participant="livekit-participant",Un.Track="livekit-track",Un.Publication="livekit-track-publication",Un.Engine="livekit-engine",Un.Signal="livekit-signal",Un.PCManager="livekit-pc-manager",Un.PCTransport="livekit-pc-transport",Un.E2EE="lk-e2ee";let Vn=Bn.getLogger("livekit");const qn=Object.values(e.LoggerNames).map((e=>Bn.getLogger(e)));function zn(e){const t=Bn.getLogger(e);return t.setDefaultLevel(Vn.getLevel()),t}Vn.setDefaultLevel(e.LogLevel.info);const Wn=Bn.getLogger("lk-e2ee"),Kn=7e3,Hn=[0,300,1200,2700,4800,Kn,Kn,Kn,Kn,Kn];class Gn{constructor(e){this._retryDelays=void 0!==e?[...e]:Hn}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+1e3*Math.random()}}function Qn(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))}function Jn(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Yn(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Jn(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,r){!function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)}(i,r,(t=e[n](t)).done,t.value)}))}}}"function"==typeof SuppressedError&&SuppressedError;var $n,Xn={exports:{}},Zn=function(){if($n)return Xn.exports;$n=1;var e,t="object"==typeof Reflect?Reflect:null,n=t&&"function"==typeof t.apply?t.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};e=t&&"function"==typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function r(){r.init.call(this)}Xn.exports=r,Xn.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,o),i(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}m(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&m(e,"error",t,n)}(e,r,{once:!0})}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function s(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var r,o,c,l;if(a(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),c=o[t]),void 0===c)c=o[t]=n,++e._eventsCount;else if("function"==typeof c?c=o[t]=i?[n,c]:[c,n]:i?c.unshift(n):c.push(n),(r=s(e))>0&&c.length>r&&!c.warned){c.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=c.length,l=d,console&&console.warn&&console.warn(l)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=l.bind(i);return r.listener=n,i.wrapFn=r,r}function u(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):p(r,r.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function m(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(o){i.once&&e.removeEventListener(t,r),n(o)}))}}return Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return s(this)},r.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var l=c.length,d=p(c,l);for(i=0;i<l;++i)n(d[i],this,t)}return!0},r.prototype.addListener=function(e,t){return c(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return c(this,e,t,!0)},r.prototype.once=function(e,t){return a(t),this.on(e,d(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,d(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,i,r,o,s;if(a(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},r.prototype.listeners=function(e){return u(this,e,!0)},r.prototype.rawListeners=function(e){return u(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},r.prototype.listenerCount=h,r.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]},Xn.exports}();let ei=!0,ti=!0;function ni(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function ii(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);const o=e=>{const t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,o),r.apply(this,[e,o])};const o=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function ri(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(ei=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function oi(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(ti=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function ai(){if("object"==typeof window){if(ei)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function si(e,t){ti&&console.warn(e+" is deprecated, please use "+t+" instead.")}function ci(e){return"[object Object]"===Object.prototype.toString.call(e)}function li(e){return ci(e)?Object.keys(e).reduce((function(t,n){const i=ci(e[n]),r=i?li(e[n]):e[n],o=i&&!Object.keys(r).length;return void 0===r||o?t:Object.assign(t,{[n]:r})}),{}):e}function di(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((i=>{i.endsWith("Id")?di(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach((t=>{di(e,e.get(t),n)}))})))}function ui(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===i&&n.trackId===t.id&&di(e,n,r)}))})),r}const hi=ai;function pi(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"==typeof i.ideal?(e[r("min",n)]=i.ideal,t.optional.push(e),e={},e[r("max",n)]=i.ideal,t.optional.push(e)):(e[r("",n)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach((e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const a=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let a=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!a&&n.length&&t.includes("back")&&(a=n[n.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=i(e.video),hi("chrome: "+JSON.stringify(e)),r(e)}))}e.video=i(e.video)}return hi("chrome: "+JSON.stringify(e)),r(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){r(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{i&&i(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return r(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(o(e))))))}}}function mi(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function fi(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const r=new Event("track");r.track=n.track,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)})),t.stream.getTracks().forEach((n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const r=new Event("track");r.track=n,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else ii(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function gi(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function vi(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>ui(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),ii(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>ui(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,i;return this.getSenders().forEach((n=>{n.track===e&&(t?i=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?i=!0:n=t),t.track===e))),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function bi(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),r.apply(this,arguments)}}function yi(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return bi(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[n.id];if(r)r.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=i[t]}));const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=s.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ki(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}))}function Ti(e,t){ii(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var Si=Object.freeze({__proto__:null,fixNegotiationNeeded:Ti,shimAddTrackRemoveTrack:yi,shimAddTrackRemoveTrackWithNative:bi,shimGetSendersWithDtmf:gi,shimGetUserMedia:pi,shimMediaStream:mi,shimOnTrack:fi,shimPeerConnection:ki,shimSenderReceiverGetStats:vi});function Ci(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){si("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function Ei(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function wi(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,o]=arguments;return i.apply(this,[e||null]).then((e=>{if(t.version<53&&!r)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(r,o)}}function Pi(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Ri(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),ii(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Ii(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){si("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function Oi(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function xi(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const i=t.apply(this,arguments);if(n){const{sender:t}=i,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return i})}function _i(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function Ni(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function Mi(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var Di=Object.freeze({__proto__:null,shimAddTransceiver:xi,shimCreateAnswer:Mi,shimCreateOffer:Ni,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:_i,shimGetUserMedia:Ci,shimOnTrack:Ei,shimPeerConnection:wi,shimRTCDataChannel:Oi,shimReceiverGetStats:Ri,shimRemoveStream:Ii,shimSenderGetStats:Pi});function Ai(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i&&i.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function Li(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function Ui(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};let s=function(e,t,n){const i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=s,s=function(e,t,n){const i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=s,s=function(e,t,n){const i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=s}function ji(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(Fi(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function Fi(e){return e&&void 0!==e.video?Object.assign({},e,{video:li(e.video)}):e}function Bi(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];void 0===i.urls&&i.url?(si("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Vi(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function qi(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function zi(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Wi,Ki=Object.freeze({__proto__:null,shimAudioContext:zi,shimCallbacksAPI:Ui,shimConstraints:Fi,shimCreateOfferLegacy:qi,shimGetUserMedia:ji,shimLocalStreamsAPI:Ai,shimRTCIceServerUrls:Bi,shimRemoteStreamsAPI:Li,shimTrackEventTransceiver:Vi}),Hi={exports:{}},Gi=(Wi||(Wi=1,function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:void 0===n[t[i]]&&(n[t[i]]=t[i+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const i=e.substring(e.indexOf(" ")+1).split(";");for(let r=0;r<i.length;r++)n=i[r].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substring(t+1,i),n.value=e.substring(i+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],r=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");n.profile=i[2];for(let o=3;o<i.length;o++){const r=i[o],a=t.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(a){const i=t.parseRtpMap(a),o=t.matchPrefix(e,"a=fmtp:"+r+" ");switch(i.parameters=o.length?t.parseFmtp(o[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(t.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));const r=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{r.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)}));let r=0;return n.codecs.forEach((e=>{e.maxptime>r&&(r=e.maxptime)})),r>0&&(i+="a=maxptime:"+r+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{i+=t.writeExtmap(e)})),i},t.parseRtpEncodingParameters=function(e){const n=[],i=t.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),s=a.length>0&&a[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));l.length>0&&l[0].length>1&&l[0][0]===s&&(c=l[0][1]),i.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(t.rtx={ssrc:c}),n.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:o?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&s&&n.push({ssrc:s});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=d}))),n},t.parseRtcpParameters=function(e){const n={},i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};const r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return r.length>0?(n=r[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substring(19),10)),isNaN(r)&&(r=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:r};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,i){let r;const o=void 0!==n?n:2;return r=e||t.generateSessionId(),"v=0\r\no="+(i||"thisisadapterortc")+" "+r+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const i=t.splitLines(e);for(let t=0;t<i.length;t++)switch(i[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}(Hi)),Hi.exports),Qi=Dn(Gi),Ji=t({__proto__:null,default:Qi},[Gi]);function Yi(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),i=Qi.parseCandidate(e.candidate);for(const e in i)e in n||Object.defineProperty(n,e,{value:i[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,ii(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function $i(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||ii(e,"icecandidate",(e=>{if(e.candidate){const t=Qi.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function Xi(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=Qi.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Qi.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),i=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const r=Qi.matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i}(arguments[0],e);let r;r=0===n&&0===i?Number.POSITIVE_INFINITY:0===n||0===i?Math.max(n,i):Math.min(n,i);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>r}),this._sctp=o}return n.apply(this,arguments)}}function Zi(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},ii(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function er(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function tr(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function nr(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ir(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}var rr=Object.freeze({__proto__:null,removeExtmapAllowMixed:tr,shimAddIceCandidateNullOrEmpty:nr,shimConnectionState:er,shimMaxMessageSize:Xi,shimParameterlessSetLocalDescription:ir,shimRTCIceCandidate:Yi,shimRTCIceCandidateRelayProtocol:$i,shimSendThrowTypeError:Zi});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=ai,i=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.userAgentData&&n.userAgentData.brands){const e=n.userAgentData.brands.find((e=>"Chromium"===e.brand));if(e)return{browser:"chrome",version:parseInt(e.version,10)}}if(n.mozGetUserMedia)t.browser="firefox",t.version=ni(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=ni(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=ni(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),r={browserDetails:i,commonShim:rr,extractVersion:ni,disableLog:ri,disableWarnings:oi,sdp:Ji};switch(i.browser){case"chrome":if(!Si||!ki||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=Si,nr(e,i),ir(e),pi(e,i),mi(e),ki(e,i),fi(e),yi(e,i),gi(e),vi(e),Ti(e,i),Yi(e),$i(e),er(e),Xi(e,i),Zi(e),tr(e,i);break;case"firefox":if(!Di||!wi||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Di,nr(e,i),ir(e),Ci(e,i),wi(e,i),Ei(e),Ii(e),Pi(e),Ri(e),Oi(e),xi(e),_i(e),Ni(e),Mi(e),Yi(e),er(e),Xi(e,i),Zi(e);break;case"safari":if(!Ki||!t.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Ki,nr(e,i),ir(e),Bi(e),qi(e),Ui(e),Ai(e),Li(e),Vi(e),ji(e),zi(e),Yi(e),$i(e),Xi(e,i),Zi(e),tr(e,i);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});const or="AES-GCM",ar="lk_e2ee",sr={sharedKey:!1,ratchetSalt:"LKFrameEncryptionKey",ratchetWindowSize:8,failureTolerance:10,keyringSize:16};var cr,lr,dr,ur,hr,pr,mr,fr,gr;function vr(){return yr()||br()}function br(){return void 0!==window.RTCRtpScriptTransform}function yr(){return void 0!==window.RTCRtpSender&&void 0!==window.RTCRtpSender.prototype.createEncodedStreams}function kr(e){return Qn(this,void 0,void 0,(function*(){let t=new TextEncoder;return yield crypto.subtle.importKey("raw",t.encode(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])}))}function Tr(e){return Qn(this,void 0,void 0,(function*(){return yield crypto.subtle.importKey("raw",e,"HKDF",!1,["deriveBits","deriveKey"])}))}function Sr(e,t){const n=(new TextEncoder).encode(t);switch(e){case"HKDF":return{name:"HKDF",salt:n,hash:"SHA-256",info:new ArrayBuffer(128)};case"PBKDF2":return{name:"PBKDF2",salt:n,hash:"SHA-256",iterations:1e5};default:throw new Error("algorithm ".concat(e," is currently unsupported"))}}e.KeyProviderEvent=void 0,(cr=e.KeyProviderEvent||(e.KeyProviderEvent={})).SetKey="setKey",cr.RatchetRequest="ratchetRequest",cr.KeyRatcheted="keyRatcheted",e.KeyHandlerEvent=void 0,(e.KeyHandlerEvent||(e.KeyHandlerEvent={})).KeyRatcheted="keyRatcheted",e.EncryptionEvent=void 0,(lr=e.EncryptionEvent||(e.EncryptionEvent={})).ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",lr.EncryptionError="encryptionError",e.CryptorEvent=void 0,(e.CryptorEvent||(e.CryptorEvent={})).Error="cryptorError";class Cr extends Zn.EventEmitter{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.onKeyRatcheted=(e,t)=>{Vn.debug("key ratcheted event received",{material:e,keyIndex:t})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},sr),t),this.on(e.KeyProviderEvent.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(t,n,i){const r={key:t,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(null!=n?n:"shared","-").concat(null!=i?i:0),r),this.emit(e.KeyProviderEvent.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(t,n){this.emit(e.KeyProviderEvent.RatchetRequest,t,n)}}class Er extends Error{constructor(e,t){super(t||"an error has occured"),this.code=e}}e.ConnectionErrorReason=void 0,(dr=e.ConnectionErrorReason||(e.ConnectionErrorReason={}))[dr.NotAllowed=0]="NotAllowed",dr[dr.ServerUnreachable=1]="ServerUnreachable",dr[dr.InternalError=2]="InternalError",dr[dr.Cancelled=3]="Cancelled",dr[dr.LeaveRequest=4]="LeaveRequest";class wr extends Er{constructor(e,t,n,i){super(1,e),this.status=n,this.reason=t,this.context=i}}class Pr extends Er{constructor(e){super(21,null!=e?e:"device is unsupported")}}class Rr extends Er{constructor(e){super(20,null!=e?e:"track is invalid")}}class Ir extends Er{constructor(e){super(10,null!=e?e:"unsupported server")}}class Or extends Er{constructor(e){super(12,null!=e?e:"unexpected connection state")}}class xr extends Er{constructor(e){super(13,null!=e?e:"unable to negotiate")}}class _r extends Er{constructor(e,t){super(15,e),this.reason=t}}function Nr(e,t,n){var i,r,o;void 0===t&&(t=50),void 0===n&&(n={});var a=null!=(i=n.isImmediate)&&i,s=null!=(r=n.callback)&&r,c=n.maxWait,l=Date.now(),d=[];function u(){if(void 0!==c){var e=Date.now()-l;if(e+t>=c)return c-e}return t}var h=function(){var t=[].slice.call(arguments),n=this;return new Promise((function(i,r){var c=a&&void 0===o;if(void 0!==o&&clearTimeout(o),o=setTimeout((function(){if(o=void 0,l=Date.now(),!a){var i=e.apply(n,t);s&&s(i),d.forEach((function(e){return(0,e.resolve)(i)})),d=[]}}),u()),c){var h=e.apply(n,t);return s&&s(h),i(h)}d.push({resolve:i,reject:r})}))};return h.cancel=function(e){void 0!==o&&clearTimeout(o),d.forEach((function(t){return(0,t.reject)(e)})),d=[]},h}e.MediaDeviceFailure=void 0,(ur=e.MediaDeviceFailure||(e.MediaDeviceFailure={})).PermissionDenied="PermissionDenied",ur.NotFound="NotFound",ur.DeviceInUse="DeviceInUse",ur.Other="Other",function(e){e.getFailure=function(t){if(t&&"name"in t)return"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?e.NotFound:"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?e.PermissionDenied:"NotReadableError"===t.name||"TrackStartError"===t.name?e.DeviceInUse:e.Other}}(e.MediaDeviceFailure||(e.MediaDeviceFailure={})),e.CryptorErrorReason=void 0,(hr=e.CryptorErrorReason||(e.CryptorErrorReason={}))[hr.InvalidKey=0]="InvalidKey",hr[hr.MissingKey=1]="MissingKey",hr[hr.InternalError=2]="InternalError",e.RoomEvent=void 0,(pr=e.RoomEvent||(e.RoomEvent={})).Connected="connected",pr.Reconnecting="reconnecting",pr.SignalReconnecting="signalReconnecting",pr.Reconnected="reconnected",pr.Disconnected="disconnected",pr.ConnectionStateChanged="connectionStateChanged",pr.MediaDevicesChanged="mediaDevicesChanged",pr.ParticipantConnected="participantConnected",pr.ParticipantDisconnected="participantDisconnected",pr.TrackPublished="trackPublished",pr.TrackSubscribed="trackSubscribed",pr.TrackSubscriptionFailed="trackSubscriptionFailed",pr.TrackUnpublished="trackUnpublished",pr.TrackUnsubscribed="trackUnsubscribed",pr.TrackMuted="trackMuted",pr.TrackUnmuted="trackUnmuted",pr.LocalTrackPublished="localTrackPublished",pr.LocalTrackUnpublished="localTrackUnpublished",pr.LocalAudioSilenceDetected="localAudioSilenceDetected",pr.ActiveSpeakersChanged="activeSpeakersChanged",pr.ParticipantMetadataChanged="participantMetadataChanged",pr.ParticipantNameChanged="participantNameChanged",pr.ParticipantAttributesChanged="participantAttributesChanged",pr.RoomMetadataChanged="roomMetadataChanged",pr.DataReceived="dataReceived",pr.SipDTMFReceived="sipDTMFReceived",pr.TranscriptionReceived="transcriptionReceived",pr.ConnectionQualityChanged="connectionQualityChanged",pr.TrackStreamStateChanged="trackStreamStateChanged",pr.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",pr.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",pr.AudioPlaybackStatusChanged="audioPlaybackChanged",pr.VideoPlaybackStatusChanged="videoPlaybackChanged",pr.MediaDevicesError="mediaDevicesError",pr.ParticipantPermissionsChanged="participantPermissionsChanged",pr.SignalConnected="signalConnected",pr.RecordingStatusChanged="recordingStatusChanged",pr.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",pr.EncryptionError="encryptionError",pr.DCBufferStatusChanged="dcBufferStatusChanged",pr.ActiveDeviceChanged="activeDeviceChanged",pr.ChatMessage="chatMessage",pr.LocalTrackSubscribed="localTrackSubscribed",pr.MetricsReceived="metricsReceived",e.ParticipantEvent=void 0,(mr=e.ParticipantEvent||(e.ParticipantEvent={})).TrackPublished="trackPublished",mr.TrackSubscribed="trackSubscribed",mr.TrackSubscriptionFailed="trackSubscriptionFailed",mr.TrackUnpublished="trackUnpublished",mr.TrackUnsubscribed="trackUnsubscribed",mr.TrackMuted="trackMuted",mr.TrackUnmuted="trackUnmuted",mr.LocalTrackPublished="localTrackPublished",mr.LocalTrackUnpublished="localTrackUnpublished",mr.ParticipantMetadataChanged="participantMetadataChanged",mr.ParticipantNameChanged="participantNameChanged",mr.DataReceived="dataReceived",mr.SipDTMFReceived="sipDTMFReceived",mr.TranscriptionReceived="transcriptionReceived",mr.IsSpeakingChanged="isSpeakingChanged",mr.ConnectionQualityChanged="connectionQualityChanged",mr.TrackStreamStateChanged="trackStreamStateChanged",mr.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",mr.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",mr.MediaDevicesError="mediaDevicesError",mr.AudioStreamAcquired="audioStreamAcquired",mr.ParticipantPermissionsChanged="participantPermissionsChanged",mr.PCTrackAdded="pcTrackAdded",mr.AttributesChanged="attributesChanged",mr.LocalTrackSubscribed="localTrackSubscribed",mr.ChatMessage="chatMessage",e.EngineEvent=void 0,(fr=e.EngineEvent||(e.EngineEvent={})).TransportsCreated="transportsCreated",fr.Connected="connected",fr.Disconnected="disconnected",fr.Resuming="resuming",fr.Resumed="resumed",fr.Restarting="restarting",fr.Restarted="restarted",fr.SignalResumed="signalResumed",fr.SignalRestarted="signalRestarted",fr.Closing="closing",fr.MediaTrackAdded="mediaTrackAdded",fr.ActiveSpeakersUpdate="activeSpeakersUpdate",fr.DataPacketReceived="dataPacketReceived",fr.RTPVideoMapUpdate="rtpVideoMapUpdate",fr.DCBufferStatusChanged="dcBufferStatusChanged",fr.ParticipantUpdate="participantUpdate",fr.RoomUpdate="roomUpdate",fr.SpeakersChanged="speakersChanged",fr.StreamStateChanged="streamStateChanged",fr.ConnectionQualityUpdate="connectionQualityUpdate",fr.SubscriptionError="subscriptionError",fr.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",fr.RemoteMute="remoteMute",fr.SubscribedQualityUpdate="subscribedQualityUpdate",fr.LocalTrackUnpublished="localTrackUnpublished",fr.LocalTrackSubscribed="localTrackSubscribed",fr.Offline="offline",fr.SignalRequestResponse="signalRequestResponse",e.TrackEvent=void 0,(gr=e.TrackEvent||(e.TrackEvent={})).Message="message",gr.Muted="muted",gr.Unmuted="unmuted",gr.Restarted="restarted",gr.Ended="ended",gr.Subscribed="subscribed",gr.Unsubscribed="unsubscribed",gr.UpdateSettings="updateSettings",gr.UpdateSubscription="updateSubscription",gr.AudioPlaybackStarted="audioPlaybackStarted",gr.AudioPlaybackFailed="audioPlaybackFailed",gr.AudioSilenceDetected="audioSilenceDetected",gr.VisibilityChanged="visibilityChanged",gr.VideoDimensionsChanged="videoDimensionsChanged",gr.VideoPlaybackStarted="videoPlaybackStarted",gr.VideoPlaybackFailed="videoPlaybackFailed",gr.ElementAttached="elementAttached",gr.ElementDetached="elementDetached",gr.UpstreamPaused="upstreamPaused",gr.UpstreamResumed="upstreamResumed",gr.SubscriptionPermissionChanged="subscriptionPermissionChanged",gr.SubscriptionStatusChanged="subscriptionStatusChanged",gr.SubscriptionFailed="subscriptionFailed",gr.TrackProcessorUpdate="trackProcessorUpdate",gr.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",gr.TranscriptionReceived="transcriptionReceived",gr.TimeSyncUpdate="timeSyncUpdate";const Mr=/version\/(\d+(\.?_?\d+)+)/i;let Dr;function Ar(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===e&&"undefined"==typeof navigator)return;const n=(null!=e?e:navigator.userAgent).toLowerCase();if(void 0===Dr||t){const e=Lr.find((e=>{let{test:t}=e;return t.test(n)}));Dr=null==e?void 0:e.describe(n)}return Dr}const Lr=[{test:/firefox|iceweasel|fxios/i,describe:e=>({name:"Firefox",version:Ur(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:jr(e)})},{test:/chrom|crios|crmo/i,describe:e=>({name:"Chrome",version:Ur(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("crios")?"iOS":void 0,osVersion:jr(e)})},{test:/safari|applewebkit/i,describe:e=>({name:"Safari",version:Ur(Mr,e),os:e.includes("mobile/")?"iOS":"macOS",osVersion:jr(e)})}];function Ur(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=t.match(e);return i&&i.length>=n&&i[n]||""}function jr(e){return e.includes("mac os")?Ur(/\(.+?(\d+_\d+(:?_\d+)?)/,e,1).replace(/_/g,"."):void 0}const Fr="2.7.3";class Br{}Br.setTimeout=function(){return setTimeout(...arguments)},Br.setInterval=function(){return setInterval(...arguments)},Br.clearTimeout=function(){return clearTimeout(...arguments)},Br.clearInterval=function(){return clearInterval(...arguments)};class Vr{constructor(e,t,n,i,r){if("object"==typeof e)this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else{if(void 0===t||void 0===n)throw new TypeError("Unsupported options: provide at least width, height and maxBitrate");this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:n,maxFramerate:i,priority:r}}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const qr=["vp8","h264"],zr=["vp8","h264","vp9","av1"];function Wr(e){return!!qr.find((t=>t===e))}var Kr;e.AudioPresets=void 0,(Kr=e.AudioPresets||(e.AudioPresets={})).telephone={maxBitrate:12e3},Kr.speech={maxBitrate:24e3},Kr.music={maxBitrate:48e3},Kr.musicStereo={maxBitrate:64e3},Kr.musicHighQuality={maxBitrate:96e3},Kr.musicHighQualityStereo={maxBitrate:128e3};const Hr={h90:new Vr(160,90,9e4,20),h180:new Vr(320,180,16e4,20),h216:new Vr(384,216,18e4,20),h360:new Vr(640,360,45e4,20),h540:new Vr(960,540,8e5,25),h720:new Vr(1280,720,17e5,30),h1080:new Vr(1920,1080,3e6,30),h1440:new Vr(2560,1440,5e6,30),h2160:new Vr(3840,2160,8e6,30)},Gr={h120:new Vr(160,120,7e4,20),h180:new Vr(240,180,125e3,20),h240:new Vr(320,240,14e4,20),h360:new Vr(480,360,33e4,20),h480:new Vr(640,480,5e5,20),h540:new Vr(720,540,6e5,25),h720:new Vr(960,720,13e5,30),h1080:new Vr(1440,1080,23e5,30),h1440:new Vr(1920,1440,38e5,30)},Qr={h360fps3:new Vr(640,360,2e5,3,"medium"),h360fps15:new Vr(640,360,4e5,15,"medium"),h720fps5:new Vr(1280,720,8e5,5,"medium"),h720fps15:new Vr(1280,720,15e5,15,"medium"),h720fps30:new Vr(1280,720,2e6,30,"medium"),h1080fps15:new Vr(1920,1080,25e5,15,"medium"),h1080fps30:new Vr(1920,1080,5e6,30,"medium"),original:new Vr(0,0,7e6,30,"medium")},Jr=[];e.VideoQuality=void 0,function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH"}(e.VideoQuality||(e.VideoQuality={}));class Yr extends Zn.EventEmitter{constructor(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=Yr.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Vn,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),"hidden"===document.visibilityState?this.backgroundTimeout=setTimeout((()=>this.handleAppVisibilityChanged()),5e3):this.handleAppVisibilityChanged()},this.log=zn(null!==(r=i.loggerName)&&void 0!==r?r:e.LoggerNames.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=t,this._mediaStreamID=t.id,this.source=Yr.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),so(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(t){let n="audio";this.kind===Yr.Kind.Video&&(n="video"),0===this.attachedElements.length&&this.kind===Yr.Kind.Video&&this.addAppVisibilityListener(),t||("audio"===n&&(Jr.forEach((e=>{null!==e.parentElement||t||(t=e)})),t&&Jr.splice(Jr.indexOf(t),1)),t||(t=document.createElement(n))),this.attachedElements.includes(t)||this.attachedElements.push(t),$r(this.mediaStreamTrack,t);const i=t.srcObject.getTracks(),r=i.some((e=>"audio"===e.kind));return t.play().then((()=>{this.emit(r?e.TrackEvent.AudioPlaybackStarted:e.TrackEvent.VideoPlaybackStarted)})).catch((n=>{"NotAllowedError"===n.name?this.emit(r?e.TrackEvent.AudioPlaybackFailed:e.TrackEvent.VideoPlaybackFailed,n):"AbortError"===n.name?Vn.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):Vn.warn("could not playback ".concat(r?"audio":"video"),n),r&&t&&i.some((e=>"video"===e.kind))&&"NotAllowedError"===n.name&&(t.muted=!0,t.play().catch((()=>{})))})),this.emit(e.TrackEvent.ElementAttached,t),t}detach(t){try{if(t){Xr(this.mediaStreamTrack,t);const n=this.attachedElements.indexOf(t);return n>=0&&(this.attachedElements.splice(n,1),this.recycleElement(t),this.emit(e.TrackEvent.ElementDetached,t)),t}const n=[];return this.attachedElements.forEach((t=>{Xr(this.mediaStreamTrack,t),n.push(t),this.recycleElement(t),this.emit(e.TrackEvent.ElementDetached,t)})),this.attachedElements=[],n}finally{0===this.attachedElements.length&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=zn(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),Jr.forEach((e=>{e.parentElement||(t=!1)})),t&&Jr.push(e)}}handleAppVisibilityChanged(){return Qn(this,void 0,void 0,(function*(){this.isInBackground="hidden"===document.visibilityState,this.isInBackground||this.kind!==Yr.Kind.Video||setTimeout((()=>this.attachedElements.forEach((e=>e.play().catch((()=>{}))))),0)}))}addAppVisibilityListener(){Co()?(this.isInBackground="hidden"===document.visibilityState,document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Co()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function $r(e,t){let n,i;n=t.srcObject instanceof MediaStream?t.srcObject:new MediaStream,i="audio"===e.kind?n.getAudioTracks():n.getVideoTracks(),i.includes(e)||(i.forEach((e=>{n.removeTrack(e)})),n.addTrack(e)),ko()&&t instanceof HTMLVideoElement||(t.autoplay=!0),t.muted=0===n.getAudioTracks().length,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==n&&(t.srcObject=n,(ko()||yo())&&t instanceof HTMLVideoElement&&setTimeout((()=>{t.srcObject=n,t.play().catch((()=>{}))}),0))}function Xr(e,t){if(t.srcObject instanceof MediaStream){const n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}function Zr(e,t,n){var i;const{optionsWithoutProcessor:r,audioProcessor:o,videoProcessor:a}=co(null!=e?e:{}),s=null!==(i=function(e){if(void 0!==e)return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}(r))&&void 0!==i?i:{};return!0===s.audio&&(s.audio={}),!0===s.video&&(s.video={}),s.audio&&(eo(s.audio,t),o&&(s.audio.processor=o)),s.video&&(eo(s.video,n),a&&(s.video.processor=a)),s}function eo(e,t){return Object.keys(t).forEach((n=>{void 0===e[n]&&(e[n]=t[n])})),e}function to(e){const t={};if(e.video)if("object"==typeof e.video){const n={},i=n,r=e.video;Object.keys(r).forEach((e=>{"resolution"===e?eo(i,r.resolution):i[e]=r[e]})),t.video=n}else t.video=e.video;else t.video=!1;return e.audio?"object"==typeof e.audio?t.audio=e.audio:t.audio=!0:t.audio=!1,t}function no(){const e="undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext);if(e)return new e({latencyHint:"interactive"})}function io(e){return e===Yr.Source.Microphone?"audioinput":e===Yr.Source.Camera?"videoinput":void 0}function ro(e){var t,n;let i=null===(t=e.video)||void 0===t||t;return e.resolution&&e.resolution.width>0&&e.resolution.height>0&&(i="boolean"==typeof i?{}:i,i=ko()?Object.assign(Object.assign({},i),{width:{max:e.resolution.width},height:{max:e.resolution.height},frameRate:e.resolution.frameRate}):Object.assign(Object.assign({},i),{width:{ideal:e.resolution.width},height:{ideal:e.resolution.height},frameRate:e.resolution.frameRate})),{audio:null!==(n=e.audio)&&void 0!==n&&n,video:i,controller:e.controller,selfBrowserSurface:e.selfBrowserSurface,surfaceSwitching:e.surfaceSwitching,systemAudio:e.systemAudio,preferCurrentTab:e.preferCurrentTab}}function oo(e){return e.split("/")[1].toLowerCase()}function ao(e){const t=[];return e.forEach((e=>{void 0!==e.track&&t.push(new $t({cid:e.track.mediaStreamID,track:e.trackInfo}))})),t}function so(e){return e instanceof Yr?{trackID:e.sid,source:e.source,muted:e.isMuted,enabled:e.mediaStreamTrack.enabled,kind:e.kind,streamID:e.mediaStreamID,streamTrackID:e.mediaStreamTrack.id}:{trackID:e.trackSid,enabled:e.isEnabled,muted:e.isMuted,trackInfo:Object.assign({mimeType:e.mimeType,name:e.trackName,encrypted:e.isEncrypted,kind:e.kind,source:e.source},e.track?so(e.track):{})}}function co(e){const t=Object.assign({},e);let n,i;return"object"==typeof t.audio&&t.audio.processor&&(n=t.audio.processor,t.audio=Object.assign(Object.assign({},t.audio),{processor:void 0})),"object"==typeof t.video&&t.video.processor&&(i=t.video.processor,t.video=Object.assign(Object.assign({},t.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:t}}!function(e){let t,n,i;!function(e){e.Audio="audio",e.Video="video",e.Unknown="unknown"}(t=e.Kind||(e.Kind={})),function(e){e.Camera="camera",e.Microphone="microphone",e.ScreenShare="screen_share",e.ScreenShareAudio="screen_share_audio",e.Unknown="unknown"}(n=e.Source||(e.Source={})),function(e){e.Active="active",e.Paused="paused",e.Unknown="unknown"}(i=e.StreamState||(e.StreamState={})),e.kindToProto=function(e){switch(e){case t.Audio:return Qe.AUDIO;case t.Video:return Qe.VIDEO;default:return Qe.DATA}},e.kindFromProto=function(e){switch(e){case Qe.AUDIO:return t.Audio;case Qe.VIDEO:return t.Video;default:return t.Unknown}},e.sourceToProto=function(e){switch(e){case n.Camera:return Je.CAMERA;case n.Microphone:return Je.MICROPHONE;case n.ScreenShare:return Je.SCREEN_SHARE;case n.ScreenShareAudio:return Je.SCREEN_SHARE_AUDIO;default:return Je.UNKNOWN}},e.sourceFromProto=function(e){switch(e){case Je.CAMERA:return n.Camera;case Je.MICROPHONE:return n.Microphone;case Je.SCREEN_SHARE:return n.ScreenShare;case Je.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}},e.streamStateFromProto=function(e){switch(e){case Vt.ACTIVE:return i.Active;case Vt.PAUSED:return i.Paused;default:return i.Unknown}}}(Yr||(Yr={}));const lo="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function uo(e){return Qn(this,void 0,void 0,(function*(){return new Promise((t=>Br.setTimeout(t,e)))}))}function ho(){return"addTransceiver"in RTCPeerConnection.prototype}function po(){return"addTrack"in RTCPeerConnection.prototype}function mo(){if(!("getCapabilities"in RTCRtpSender))return!1;if(ko())return!1;const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/AV1"===n.mimeType){t=!0;break}return t}function fo(){if(!("getCapabilities"in RTCRtpSender))return!1;if(yo())return!1;if(ko()){const e=Ar();if((null==e?void 0:e.version)&&Oo(e.version,"16")<0)return!1}const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/VP9"===n.mimeType){t=!0;break}return t}function go(e){return"av1"===e||"vp9"===e}function vo(e){return!!document&&(e||(e=document.createElement("audio")),"setSinkId"in e)}function bo(){return"undefined"!=typeof RTCPeerConnection&&(ho()||po())}function yo(){var e;return"Firefox"===(null===(e=Ar())||void 0===e?void 0:e.name)}function ko(){var e;return"Safari"===(null===(e=Ar())||void 0===e?void 0:e.name)}function To(){const e=Ar();return"Safari"===(null==e?void 0:e.name)&&e.version.startsWith("17.")}function So(){var e,t;return!!Co()&&(null!==(t=null===(e=navigator.userAgentData)||void 0===e?void 0:e.mobile)&&void 0!==t?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent))}function Co(){return"undefined"!=typeof document}function Eo(){return"ReactNative"==navigator.product}function wo(e){return e.hostname.endsWith(".livekit.cloud")||e.hostname.endsWith(".livekit.run")}function Po(){if(n.g&&n.g.LiveKitReactNativeGlobal)return n.g.LiveKitReactNativeGlobal}function Ro(){if(!Eo())return;let e=Po();return e?e.platform:void 0}function Io(){if(Co())return window.devicePixelRatio;if(Eo()){let e=Po();if(e)return e.devicePixelRatio}return 1}function Oo(e,t){const n=e.split("."),i=t.split("."),r=Math.min(n.length,i.length);for(let o=0;o<r;++o){const e=parseInt(n[o],10),t=parseInt(i[o],10);if(e>t)return 1;if(e<t)return-1;if(o===r-1&&e===t)return 0}return""===e&&""!==t?-1:""===t?1:n.length==i.length?0:n.length<i.length?-1:1}function xo(e){for(const t of e)t.target.handleResize(t)}function _o(e){for(const t of e)t.target.handleVisibilityChanged(t)}let No=null;const Mo=()=>(No||(No=new ResizeObserver(xo)),No);let Do=null;const Ao=()=>(Do||(Do=new IntersectionObserver(_o,{root:null,rootMargin:"0px"})),Do);let Lo,Uo;function jo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=document.createElement("canvas");r.width=e,r.height=t;const o=r.getContext("2d");null==o||o.fillRect(0,0,r.width,r.height),i&&o&&(o.beginPath(),o.arc(e/2,t/2,50,0,2*Math.PI,!0),o.closePath(),o.fillStyle="grey",o.fill());const a=r.captureStream(),[s]=a.getTracks();if(!s)throw Error("Could not get empty media stream video track");return s.enabled=n,s}function Fo(){if(!Uo){const e=new AudioContext,t=e.createOscillator(),n=e.createGain();n.gain.setValueAtTime(0,0);const i=e.createMediaStreamDestination();if(t.connect(n),n.connect(i),t.start(),[Uo]=i.stream.getAudioTracks(),!Uo)throw Error("Could not get empty media stream audio track");Uo.enabled=!1}return Uo.clone()}class Bo{constructor(e,t){this.onFinally=t,this.promise=new Promise(((t,n)=>Qn(this,void 0,void 0,(function*(){this.resolve=t,this.reject=n,e&&(yield e(t,n))})))).finally((()=>{var e;return null===(e=this.onFinally)||void 0===e?void 0:e.call(this)}))}}function Vo(e){if("string"==typeof e||"number"==typeof e)return e;if(Array.isArray(e))return e[0];if(e.exact)return Array.isArray(e.exact)?e.exact[0]:e.exact;if(e.ideal)return Array.isArray(e.ideal)?e.ideal[0]:e.ideal;throw Error("could not unwrap constraint")}function qo(e){return e.startsWith("ws")?e.replace(/^(ws)/,"http"):e}function zo(t){switch(t.reason){case e.ConnectionErrorReason.LeaveRequest:return t.context;case e.ConnectionErrorReason.Cancelled:return Ze.CLIENT_INITIATED;case e.ConnectionErrorReason.NotAllowed:return Ze.USER_REJECTED;case e.ConnectionErrorReason.ServerUnreachable:return Ze.JOIN_FAILURE;default:return Ze.UNKNOWN_REASON}}const Wo="default";class Ko{static getInstance(){return void 0===this.instance&&(this.instance=new Ko),this.instance}getDevices(e){return Qn(this,arguments,void 0,(function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var i;if((null===(i=Ko.userMediaPromiseMap)||void 0===i?void 0:i.size)>0){Vn.debug("awaiting getUserMedia promise");try{e?yield Ko.userMediaPromiseMap.get(e):yield Promise.all(Ko.userMediaPromiseMap.values())}catch(e){Vn.warn("error waiting for media permissons")}}let r=yield navigator.mediaDevices.enumerateDevices();if(n&&(!ko()||!t.hasDeviceInUse(e))&&(0===r.filter((t=>t.kind===e)).length||r.some((t=>{const n=""===t.label,i=!e||t.kind===e;return n&&i})))){const t={video:"audioinput"!==e&&"audiooutput"!==e,audio:"videoinput"!==e},n=yield navigator.mediaDevices.getUserMedia(t);r=yield navigator.mediaDevices.enumerateDevices(),n.getTracks().forEach((e=>{e.stop()}))}return e&&(r=r.filter((t=>t.kind===e))),r}()}))}normalizeDeviceId(e,t,n){return Qn(this,void 0,void 0,(function*(){if(t!==Wo)return t;const i=yield this.getDevices(e),r=i.find((e=>e.deviceId===Wo));if(!r)return void Vn.warn("could not reliably determine default device");const o=i.find((e=>e.deviceId!==Wo&&e.groupId===(null!=n?n:r.groupId)));if(o)return null==o?void 0:o.deviceId;Vn.warn("could not reliably determine default device")}))}hasDeviceInUse(e){return e?Ko.userMediaPromiseMap.has(e):Ko.userMediaPromiseMap.size>0}}Ko.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],Ko.userMediaPromiseMap=new Map;class Ho extends Yr{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}constructor(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(t,n,arguments.length>4?arguments[4]:void 0),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch((()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext))),this.debouncedTrackMuteHandler=Nr((()=>Qn(this,void 0,void 0,(function*(){yield this.pauseUpstream()}))),5e3),this.handleTrackUnmuteEvent=()=>Qn(this,void 0,void 0,(function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()})),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(e.TrackEvent.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new o,this.pauseUpstreamLock=new o,this.processorLock=new o,this.restartLock=new o,this.setMediaStreamTrack(t,!0),this._constraints=t.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==Yr.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();return e&&t?{width:e,height:t}:void 0}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return null!==(t=null===(e=this.processor)||void 0===e?void 0:e.processedTrack)&&void 0!==t?t:this._mediaStreamTrack}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,t){return Qn(this,void 0,void 0,(function*(){if(e===this._mediaStreamTrack&&!t)return;let n;if(this._mediaStreamTrack&&(this.attachedElements.forEach((e=>{Xr(this._mediaStreamTrack,e)})),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints()),this.processor&&e){const t=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),"unknown"===this.kind)throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&($r(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),n=this.processor.processedTrack}finally{t()}}this.sender&&(yield this.sender.replaceTrack(null!=n?n:e)),this.providedByUser||this._mediaStreamTrack===e||this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach((t=>{$r(null!=n?n:e,t)})))}))}waitForDimensions(){return Qn(this,arguments,void 0,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return function*(){var n;if(e.kind===Yr.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");"iOS"===(null===(n=Ar())||void 0===n?void 0:n.os)&&(yield uo(10));const i=Date.now();for(;Date.now()-i<t;){const t=e.dimensions;if(t)return t;yield uo(50)}throw new Rr("unable to get track dimensions after timeout")}()}))}getDeviceId(){return Qn(this,arguments,void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){if(e.source===Yr.Source.ScreenShare)return;const{deviceId:n,groupId:i}=e._mediaStreamTrack.getSettings(),r=e.kind===Yr.Kind.Audio?"audioinput":"videoinput";return t?Ko.getInstance().normalizeDeviceId(r,n,i):n}()}))}mute(){return Qn(this,void 0,void 0,(function*(){return this.setTrackMuted(!0),this}))}unmute(){return Qn(this,void 0,void 0,(function*(){return this.setTrackMuted(!1),this}))}replaceTrack(e,t){return Qn(this,void 0,void 0,(function*(){if(!this.sender)throw new Rr("unable to replace an unpublished track");let n,i;return"boolean"==typeof t?n=t:void 0!==t&&(n=t.userProvidedTrack,i=t.stopProcessor),this.providedByUser=null==n||n,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),i&&this.processor&&(yield this.stopProcessor()),this}))}restart(t){return Qn(this,void 0,void 0,(function*(){this.manuallyStopped=!1;const n=yield this.restartLock.lock();try{t||(t=this._constraints),this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:t}));const n={audio:!1,video:!1};this.kind===Yr.Kind.Video?n.video=t:n.audio=t,this.attachedElements.forEach((e=>{Xr(this.mediaStreamTrack,e)})),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const i=(yield navigator.mediaDevices.getUserMedia(n)).getTracks()[0];return i.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(i),this._constraints=t,this.emit(e.TrackEvent.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}}))}setTrackMuted(t){this.log.debug("setting ".concat(this.kind," track ").concat(t?"muted":"unmuted"),this.logContext),this.isMuted===t&&this._mediaStreamTrack.enabled!==t||(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?e.TrackEvent.Muted:e.TrackEvent.Unmuted,this))}get needsReAcquisition(){return"live"!==this._mediaStreamTrack.readyState||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Qn(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),So()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),this.isInBackground||!this.needsReAcquisition||this.isUserProvided||this.isMuted||(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))}))}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),null===(e=this.processor)||void 0===e||e.destroy(),this.processor=void 0}pauseUpstream(){return Qn(this,void 0,void 0,(function*(){const t=yield this.pauseUpstreamLock.lock();try{if(!0===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to pause upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!0,this.emit(e.TrackEvent.UpstreamPaused,this);const t=Ar();if("Safari"===(null==t?void 0:t.name)&&Oo(t.version,"12.0")<0)throw new Pr("pauseUpstream is not supported on Safari < 12.");yield this.sender.replaceTrack(null)}finally{t()}}))}resumeUpstream(){return Qn(this,void 0,void 0,(function*(){const t=yield this.pauseUpstreamLock.lock();try{if(!1===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to resume upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!1,this.emit(e.TrackEvent.UpstreamResumed,this),yield this.sender.replaceTrack(this.mediaStreamTrack)}finally{t()}}))}getRTCStatsReport(){return Qn(this,void 0,void 0,(function*(){var e;if(null===(e=this.sender)||void 0===e?void 0:e.getStats)return yield this.sender.getStats()}))}setProcessor(t){return Qn(this,arguments,void 0,(function(t){var n=this;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var r;const o=yield n.processorLock.lock();try{n.log.debug("setting up processor",n.logContext);const o=document.createElement(n.kind),a={kind:n.kind,track:n._mediaStreamTrack,element:o,audioContext:n.audioContext};if(yield t.init(a),n.log.debug("processor initialized",n.logContext),n.processor&&(yield n.stopProcessor()),"unknown"===n.kind)throw TypeError("cannot set processor on track of unknown kind");if($r(n._mediaStreamTrack,o),o.muted=!0,o.play().catch((e=>n.log.error("failed to play processor element",Object.assign(Object.assign({},n.logContext),{error:e})))),n.processor=t,n.processorElement=o,n.processor.processedTrack){for(const e of n.attachedElements)e!==n.processorElement&&i&&(Xr(n._mediaStreamTrack,e),$r(n.processor.processedTrack,e));yield null===(r=n.sender)||void 0===r?void 0:r.replaceTrack(n.processor.processedTrack)}n.emit(e.TrackEvent.TrackProcessorUpdate,n.processor)}finally{o()}}()}))}getProcessor(){return this.processor}stopProcessor(){return Qn(this,arguments,void 0,(function(){var t=this;let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var i,r;t.processor&&(t.log.debug("stopping processor",t.logContext),null===(i=t.processor.processedTrack)||void 0===i||i.stop(),yield t.processor.destroy(),t.processor=void 0,n||(null===(r=t.processorElement)||void 0===r||r.remove(),t.processorElement=void 0),yield t._mediaStreamTrack.applyConstraints(t._constraints),yield t.setMediaStreamTrack(t._mediaStreamTrack,!0),t.emit(e.TrackEvent.TrackProcessorUpdate))}()}))}}class Go extends Zn.EventEmitter{constructor(t){super(),this.onWorkerMessage=t=>{var n,i;const{kind:r,data:o}=t.data;switch(r){case"error":Vn.error(o.error.message),this.emit(e.EncryptionEvent.EncryptionError,o.error);break;case"initAck":o.enabled&&this.keyProvider.getKeys().forEach((e=>{this.postKey(e)}));break;case"enable":if(o.enabled&&this.keyProvider.getKeys().forEach((e=>{this.postKey(e)})),this.encryptionEnabled!==o.enabled&&o.participantIdentity===(null===(n=this.room)||void 0===n?void 0:n.localParticipant.identity))this.emit(e.EncryptionEvent.ParticipantEncryptionStatusChanged,o.enabled,this.room.localParticipant),this.encryptionEnabled=o.enabled;else if(o.participantIdentity){const t=null===(i=this.room)||void 0===i?void 0:i.getParticipantByIdentity(o.participantIdentity);if(!t)throw TypeError("couldn't set encryption status, participant not found".concat(o.participantIdentity));this.emit(e.EncryptionEvent.ParticipantEncryptionStatusChanged,o.enabled,t)}break;case"ratchetKey":this.keyProvider.emit(e.KeyProviderEvent.KeyRatcheted,o.material,o.keyIndex)}},this.onWorkerError=t=>{Vn.error("e2ee worker encountered an error:",{error:t.error}),this.emit(e.EncryptionEvent.EncryptionError,t.error)},this.keyProvider=t.keyProvider,this.worker=t.worker,this.encryptionEnabled=!1}setup(e){if(!vr())throw new Pr("tried to setup end-to-end encryption on an unsupported browser");if(Vn.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:Wn.getLevel()}};this.worker&&(Vn.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){Vn.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){e&&0!==e.length?this.postSifTrailer(e):Vn.warn("ignoring server sent trailer as it's empty")}setupEngine(t){t.on(e.EngineEvent.RTPVideoMapUpdate,(e=>{this.postRTPMap(e)}))}setupEventListeners(t,n){t.on(e.RoomEvent.TrackPublished,((e,t)=>this.setParticipantCryptorEnabled(e.trackInfo.encryption!==lt.NONE,t.identity))),t.on(e.RoomEvent.ConnectionStateChanged,(n=>{n===e.ConnectionState.Connected&&t.remoteParticipants.forEach((e=>{e.trackPublications.forEach((t=>{this.setParticipantCryptorEnabled(t.trackInfo.encryption!==lt.NONE,e.identity)}))}))})).on(e.RoomEvent.TrackUnsubscribed,((e,t,n)=>{var i;const r={kind:"removeTransform",data:{participantIdentity:n.identity,trackId:e.mediaStreamID}};null===(i=this.worker)||void 0===i||i.postMessage(r)})).on(e.RoomEvent.TrackSubscribed,((e,t,n)=>{this.setupE2EEReceiver(e,n.identity,t.trackInfo)})).on(e.RoomEvent.SignalConnected,(()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach((e=>{this.postKey(e)})),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)})),t.localParticipant.on(e.ParticipantEvent.LocalTrackPublished,(e=>Qn(this,void 0,void 0,(function*(){this.setupE2EESender(e.track,e.track.sender)})))),n.on(e.KeyProviderEvent.SetKey,(e=>this.postKey(e))).on(e.KeyProviderEvent.RatchetRequest,((e,t)=>this.postRatchetRequest(e,t)))}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const n={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(n)}postKey(e){let{key:t,participantIdentity:n,keyIndex:i}=e;var r;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:n,isPublisher:n===(null===(r=this.room)||void 0===r?void 0:r.localParticipant.identity),key:t,keyIndex:i}};this.worker.postMessage(o)}postEnable(e,t){if(!this.worker)throw new ReferenceError("failed to enable e2ee, worker is not ready");{const n={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(n)}}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const n={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(n)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,n){if(e.receiver){if(!(null==n?void 0:n.mimeType)||""===n.mimeType)throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,"video"===e.kind?oo(n.mimeType):void 0)}}setupE2EESender(e,t){e instanceof Ho&&t?this.handleSender(t,e.mediaStreamID,void 0):t||Vn.warn("early return because sender is not ready")}handleReceiver(e,t,n,i){return Qn(this,void 0,void 0,(function*(){if(this.worker){if(br()){const r={kind:"decode",participantIdentity:n,trackId:t,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,r)}else{if(ar in e&&i){const e={kind:"updateCodec",data:{trackId:t,codec:i,participantIdentity:n}};return void this.worker.postMessage(e)}let r=e.writableStream,o=e.readableStream;if(!r||!o){const t=e.createEncodedStreams();e.writableStream=t.writable,r=t.writable,e.readableStream=t.readable,o=t.readable}const a={kind:"decode",data:{readableStream:o,writableStream:r,trackId:t,codec:i,participantIdentity:n}};this.worker.postMessage(a,[o,r])}e[ar]=!0}}))}handleSender(e,t,n){var i;if(!(ar in e)&&this.worker){if(!(null===(i=this.room)||void 0===i?void 0:i.localParticipant.identity)||""===this.room.localParticipant.identity)throw TypeError("local identity needs to be known in order to set up encrypted sender");if(br()){Vn.info("initialize script transform");const i={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:n};e.transform=new RTCRtpScriptTransform(this.worker,i)}else{Vn.info("initialize encoded streams");const i=e.createEncodedStreams(),r={kind:"encode",data:{readableStream:i.readable,writableStream:i.writable,codec:n,trackId:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r,[i.readable,i.writable])}e[ar]=!0}}}var Qo;!function(e){e[e.WAITING=0]="WAITING",e[e.RUNNING=1]="RUNNING",e[e.COMPLETED=2]="COMPLETED"}(Qo||(Qo={}));class Jo{constructor(){this.pendingTasks=new Map,this.taskMutex=new o,this.nextTaskIndex=0}run(e){return Qn(this,void 0,void 0,(function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Qo.WAITING};this.pendingTasks.set(t.id,t);const n=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=Qo.RUNNING,yield e()}finally{t.status=Qo.COMPLETED,this.pendingTasks.delete(t.id),n()}}))}flush(){return Qn(this,void 0,void 0,(function*(){return this.run((()=>Qn(this,void 0,void 0,(function*(){}))))}))}snapshot(){return Array.from(this.pendingTasks.values())}}const Yo=["syncState","trickle","offer","answer","simulate","leave"];var $o;!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.RECONNECTING=2]="RECONNECTING",e[e.DISCONNECTING=3]="DISCONNECTING",e[e.DISCONNECTED=4]="DISCONNECTED"}($o||($o={}));class Xo{get currentState(){return this.state}get isDisconnected(){return this.state===$o.DISCONNECTING||this.state===$o.DISCONNECTED}get isEstablishingConnection(){return this.state===$o.CONNECTING||this.state===$o.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;this.rtt=0,this.state=$o.DISCONNECTED,this.log=Vn,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=zn(null!==(i=n.loggerName)&&void 0!==i?i:e.LoggerNames.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=t,this.requestQueue=new Jo,this.queuedRequests=[],this.closingLock=new o,this.connectionLock=new o,this.state=$o.DISCONNECTED}get logContext(){var e,t;return null!==(t=null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this))&&void 0!==t?t:{}}join(e,t,n,i){return Qn(this,void 0,void 0,(function*(){return this.state=$o.CONNECTING,this.options=n,yield this.connect(e,t,n,i)}))}reconnect(e,t,n,i){return Qn(this,void 0,void 0,(function*(){if(this.options)return this.state=$o.RECONNECTING,this.clearPingInterval(),yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:n,reconnectReason:i}));this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext)}))}connect(t,n,i,r){this.connectOptions=i,t=(t=function(e){return e.startsWith("http")?e.replace(/^(http)/,"ws"):e}(t)).replace(/\/$/,""),t+="/rtc";const o=function(e,t,n){var i;const r=new URLSearchParams;return r.set("access_token",e),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",Eo()?"reactnative":"js"),r.set("version",t.version),r.set("protocol",t.protocol.toString()),t.deviceModel&&r.set("device_model",t.deviceModel),t.os&&r.set("os",t.os),t.osVersion&&r.set("os_version",t.osVersion),t.browser&&r.set("browser",t.browser),t.browserVersion&&r.set("browser_version",t.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),(null===(i=navigator.connection)||void 0===i?void 0:i.type)&&r.set("network",navigator.connection.type),"?".concat(r.toString())}(n,function(){var e;const t=new Ot({sdk:xt.JS,protocol:15,version:Fr});return Eo()&&(t.os=null!==(e=Ro())&&void 0!==e?e:""),t}(),i);return new Promise(((n,a)=>Qn(this,void 0,void 0,(function*(){const s=yield this.connectionLock.lock();try{const s=()=>Qn(this,void 0,void 0,(function*(){this.close(),clearTimeout(c),a(new wr("room connection has been cancelled (signal)",e.ConnectionErrorReason.Cancelled))})),c=setTimeout((()=>{this.close(),a(new wr("room connection has timed out (signal)",e.ConnectionErrorReason.ServerUnreachable))}),i.websocketTimeout);(null==r?void 0:r.aborted)&&s(),null==r||r.addEventListener("abort",s),this.log.debug("connecting to ".concat(t+o),this.logContext),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(t+o),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(c)},this.ws.onerror=n=>Qn(this,void 0,void 0,(function*(){if(this.state===$o.CONNECTED)this.handleWSError(n);else{this.state=$o.DISCONNECTED,clearTimeout(c);try{const n=yield fetch("http".concat(t.substring(2),"/validate").concat(o));if(n.status.toFixed(0).startsWith("4")){const t=yield n.text();a(new wr(t,e.ConnectionErrorReason.NotAllowed,n.status))}else a(new wr("Internal error",e.ConnectionErrorReason.InternalError,n.status))}catch(t){a(new wr("server was not reachable",e.ConnectionErrorReason.ServerUnreachable))}}})),this.ws.onmessage=t=>Qn(this,void 0,void 0,(function*(){var o,c,l;let d;if("string"==typeof t.data){const e=JSON.parse(t.data);d=Wt.fromJson(e,{ignoreUnknownFields:!0})}else{if(!(t.data instanceof ArrayBuffer))return void this.log.error("could not decode websocket message: ".concat(typeof t.data),this.logContext);d=Wt.fromBinary(new Uint8Array(t.data))}if(this.state!==$o.CONNECTED){let t=!1;if("join"===(null===(o=d.message)||void 0===o?void 0:o.case)?(this.state=$o.CONNECTED,null==r||r.removeEventListener("abort",s),this.pingTimeoutDuration=d.message.value.pingTimeout,this.pingIntervalDuration=d.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),n(d.message.value)):this.state===$o.RECONNECTING&&"leave"!==d.message.case?(this.state=$o.CONNECTED,null==r||r.removeEventListener("abort",s),this.startPingInterval(),"reconnect"===(null===(c=d.message)||void 0===c?void 0:c.case)?n(d.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),n(void 0),t=!0)):this.isEstablishingConnection&&"leave"===d.message.case?a(new wr("Received leave request while trying to (re)connect",e.ConnectionErrorReason.LeaveRequest,void 0,d.message.value.reason)):i.reconnect||a(new wr("did not receive join response, got ".concat(null===(l=d.message)||void 0===l?void 0:l.case," instead"),e.ConnectionErrorReason.InternalError)),!t)return}this.signalLatency&&(yield uo(this.signalLatency)),this.handleSignalResponse(d)})),this.ws.onclose=t=>{this.isEstablishingConnection&&a(new wr("Websocket got closed during a (re)connection attempt",e.ConnectionErrorReason.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:t.reason,code:t.code,wasClean:t.wasClean,state:this.state})),this.handleOnClose(t.reason)}}finally{s()}}))))}close(){return Qn(this,arguments,void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){const n=yield e.closingLock.lock();try{if(e.clearPingInterval(),t&&(e.state=$o.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const t=new Promise((t=>{e.ws?e.ws.onclose=()=>{t()}:t()}));e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([t,uo(250)])),e.ws=void 0}}finally{t&&(e.state=$o.DISCONNECTED),n()}}()}))}sendOffer(e){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:ea(e)})}sendAnswer(e){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:ea(e)})}sendIceCandidate(e,t){return this.log.trace("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Gt({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new Qt({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return Qn(this,arguments,void 0,(function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function*(){const r=n.getNextRequestId();return yield n.sendRequest({case:"updateMetadata",value:new ln({requestId:r,metadata:e,name:t,attributes:i})}),r}()}))}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new cn({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new Tn({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:N.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Pn({timestamp:N.parse(Date.now()),rtt:N.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,t){return this.sendRequest({case:"updateAudioTrack",value:new rn({trackSid:e,features:t})})}sendLeave(){return this.sendRequest({case:"leave",value:new an({reason:Ze.CLIENT_INITIATED,action:sn.DISCONNECT})})}sendRequest(e){return Qn(this,arguments,void 0,(function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function*(){const i=!n&&!function(e){const t=Yo.indexOf(e.case)>=0;return Vn.trace("request allowed to bypass queue:",{canPass:t,req:e}),t}(e);if(i&&t.state===$o.RECONNECTING)return void t.queuedRequests.push((()=>Qn(t,void 0,void 0,(function*(){yield this.sendRequest(e,!0)}))));if(n||(yield t.requestQueue.flush()),t.signalLatency&&(yield uo(t.signalLatency)),!t.ws||t.ws.readyState!==t.ws.OPEN)return void t.log.error("cannot send signal request before connected, type: ".concat(null==e?void 0:e.case),t.logContext);const r=new zt({message:e});try{t.useJSON?t.ws.send(r.toJsonString()):t.ws.send(r.toBinary())}catch(e){t.log.error("error sending signal message",Object.assign(Object.assign({},t.logContext),{error:e}))}}()}))}handleSignalResponse(e){var t,n;const i=e.message;if(null==i)return void this.log.debug("received unsupported message",this.logContext);let r=!1;if("answer"===i.case){const e=Zo(i.value);this.onAnswer&&this.onAnswer(e)}else if("offer"===i.case){const e=Zo(i.value);this.onOffer&&this.onOffer(e)}else if("trickle"===i.case){const e=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(e,i.value.target)}else"update"===i.case?this.onParticipantUpdate&&this.onParticipantUpdate(null!==(t=i.value.participants)&&void 0!==t?t:[]):"trackPublished"===i.case?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):"speakersChanged"===i.case?this.onSpeakersChanged&&this.onSpeakersChanged(null!==(n=i.value.speakers)&&void 0!==n?n:[]):"leave"===i.case?this.onLeave&&this.onLeave(i.value):"mute"===i.case?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):"roomUpdate"===i.case?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):"connectionQuality"===i.case?this.onConnectionQuality&&this.onConnectionQuality(i.value):"streamStateUpdate"===i.case?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):"subscribedQualityUpdate"===i.case?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):"subscriptionPermissionUpdate"===i.case?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):"refreshToken"===i.case?this.onTokenRefresh&&this.onTokenRefresh(i.value):"trackUnpublished"===i.case?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):"subscriptionResponse"===i.case?this.onSubscriptionError&&this.onSubscriptionError(i.value):"pong"===i.case||("pongResp"===i.case?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),r=!0):"requestResponse"===i.case?this.onRequestResponse&&this.onRequestResponse(i.value):"trackSubscribed"===i.case?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(i.value.trackSid):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));r||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return Qn(this,void 0,void 0,(function*(){if(this.state===$o.DISCONNECTED)return;const t=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)}))}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){this.clearPingTimeout(),this.pingTimeoutDuration?this.pingTimeout=Br.setTimeout((()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-1e3*this.pingTimeoutDuration).toUTCString()),this.logContext),this.handleOnClose("ping timeout")}),1e3*this.pingTimeoutDuration):this.log.warn("ping timeout duration not set",this.logContext)}clearPingTimeout(){this.pingTimeout&&Br.clearTimeout(this.pingTimeout)}startPingInterval(){this.clearPingInterval(),this.resetPingTimeout(),this.pingIntervalDuration?(this.log.debug("start ping interval",this.logContext),this.pingInterval=Br.setInterval((()=>{this.sendPing()}),1e3*this.pingIntervalDuration)):this.log.warn("ping interval duration not set",this.logContext)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Br.clearInterval(this.pingInterval)}}function Zo(e){const t={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=e.type}return t}function ea(e){return new Zt({sdp:e.sdp,type:e.type})}var ta,na,ia,ra,oa,aa={},sa={},ca={exports:{}};function la(){if(ta)return ca.exports;ta=1;var e=ca.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(e).forEach((function(t){e[t].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))})),ca.exports}function da(){return na||(na=1,function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,i){var r=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:r&&!n[e.name]&&(n[e.name]={});var o=e.push?{}:r?n[e.name]:n;!function(e,n,i,r){if(r&&!i)n[r]=t(e[1]);else for(var o=0;o<i.length;o+=1)null!=e[o+1]&&(n[i[o]]=t(e[o+1]))}(i.match(e.reg),o,e.names,e.name),e.push&&n[e.push].push(o)},i=la(),r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},o=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach((function(e){var t=e[0],r=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),a=o[o.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var c=i[t][s];if(c.reg.test(r))return n(c,a,r)}})),t.media=o,t};var o=function(e,n){var i=n.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&n.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],i=e.split(" ").map(t),r=0;r<i.length;r+=3)n.push({component:i[r],ip:i[r+1],port:i[r+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var n,i=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),i=!0),{scid:n,paused:i}}))}))}}(sa)),sa}function ua(){if(ra)return ia;ra=1;var e=la(),t=/%[sdv%]/g,n=function(e){var n=1,i=arguments,r=i.length;return e.replace(t,(function(e){if(n>=r)return e;var t=i[n];switch(n+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}}))},i=function(e,t,i){var r=[e+"="+(t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var a=t.names[o];t.name?r.push(i[t.name][a]):r.push(i[t.names[o]])}else r.push(i[t.name]);return n.apply(null,r)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return ia=function(t,n){n=n||{},null==t.version&&(t.version=0),null==t.name&&(t.name=" "),t.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var a=n.outerOrder||r,s=n.innerOrder||o,c=[];return a.forEach((function(n){e[n].forEach((function(e){e.name in t&&null!=t[e.name]?c.push(i(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach((function(t){c.push(i(n,e,t))}))}))})),t.media.forEach((function(t){c.push(i("m",e.m[0],t)),s.forEach((function(n){e[n].forEach((function(e){e.name in t&&null!=t[e.name]?c.push(i(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach((function(t){c.push(i(n,e,t))}))}))}))})),c.join("\r\n")+"\r\n"},ia}var ha=function(){if(oa)return aa;oa=1;var e=da(),t=ua();return aa.write=t,aa.parse=e.parse,aa.parseParams=e.parseParams,aa.parseFmtpConfig=e.parseFmtpConfig,aa.parsePayloads=e.parsePayloads,aa.parseRemoteCandidates=e.parseRemoteCandidates,aa.parseImageAttributes=e.parseImageAttributes,aa.parseSimulcastStreamList=e.parseSimulcastStreamList,aa}();const pa="negotiationStarted",ma="negotiationComplete",fa="rtpVideoPayloadTypes";class ga extends Zn.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;super(),this.log=Vn,this.ddExtID=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Nr((e=>Qn(this,void 0,void 0,(function*(){this.emit(pa);try{yield this.createAndSendOffer()}catch(t){if(!e)throw t;e(t)}}))),20),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=zn(null!==(i=n.loggerName)&&void 0!==i?i:e.LoggerNames.PCTransport),this.loggerOptions=n,this.config=t,this._pc=this.createPC()}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=e=>{var t;e.candidate&&(null===(t=this.onIceCandidate)||void 0===t||t.call(this,e.candidate))},e.onicecandidateerror=e=>{var t;null===(t=this.onIceCandidateError)||void 0===t||t.call(this,e)},e.oniceconnectionstatechange=()=>{var t;null===(t=this.onIceConnectionStateChange)||void 0===t||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;null===(t=this.onSignalingStatechange)||void 0===t||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,e.connectionState)},e.ondatachannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},e.ontrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},e}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}get isICEConnected(){return null!==this._pc&&("connected"===this.pc.iceConnectionState||"completed"===this.pc.iceConnectionState)}addIceCandidate(e){return Qn(this,void 0,void 0,(function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)}))}setRemoteDescription(e){return Qn(this,void 0,void 0,(function*(){var t;let n;if("offer"===e.type){let{stereoMids:t,nackMids:n}=function(e){var t;const n=[],i=[],r=ha.parse(null!==(t=e.sdp)&&void 0!==t?t:"");let o=0;return r.media.forEach((e=>{var t;"audio"===e.type&&(e.rtp.some((e=>"opus"===e.codec&&(o=e.payload,!0))),(null===(t=e.rtcpFb)||void 0===t?void 0:t.some((e=>e.payload===o&&"nack"===e.type)))&&i.push(e.mid),e.fmtp.some((t=>t.payload===o&&(t.config.includes("sprop-stereo=1")&&n.push(e.mid),!0))))})),{stereoMids:n,nackMids:i}}(e);this.remoteStereoMids=t,this.remoteNackMids=n}else if("answer"===e.type){const i=ha.parse(null!==(t=e.sdp)&&void 0!==t?t:"");i.media.forEach((e=>{"audio"===e.type&&this.trackBitrates.some((t=>{if(!t.transceiver||e.mid!=t.transceiver.mid)return!1;let n=0;if(e.rtp.some((e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0))),0===n)return!0;let i=!1;for(const r of e.fmtp)if(r.payload===n){r.config=r.config.split(";").filter((e=>!e.includes("maxaveragebitrate"))).join(";"),t.maxbr>0&&(r.config+=";maxaveragebitrate=".concat(1e3*t.maxbr)),i=!0;break}return i||t.maxbr>0&&e.fmtp.push({payload:n,config:"maxaveragebitrate=".concat(1e3*t.maxbr)}),!0}))})),n=ha.write(i)}yield this.setMungedSDP(e,n,!0),this.pendingCandidates.forEach((e=>{this.pc.addIceCandidate(e)})),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):"answer"===e.type&&(this.emit(ma),e.sdp)&&ha.parse(e.sdp).media.forEach((e=>{"video"===e.type&&this.emit(fa,e.rtp)}))}))}createAndSendOffer(e){return Qn(this,void 0,void 0,(function*(){var t;if(void 0===this.onOffer)return;if((null==e?void 0:e.iceRestart)&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&"have-local-offer"===this._pc.signalingState){const t=this._pc.remoteDescription;if(!(null==e?void 0:e.iceRestart)||!t)return void(this.renegotiate=!0);yield this._pc.setRemoteDescription(t)}else if(!this._pc||"closed"===this._pc.signalingState)return void this.log.warn("could not createOffer with closed peer connection",this.logContext);this.log.debug("starting to negotiate",this.logContext);const n=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:n.sdp},this.logContext));const i=ha.parse(null!==(t=n.sdp)&&void 0!==t?t:"");i.media.forEach((e=>{"audio"===e.type?va(e,[],[]):"video"===e.type&&this.trackBitrates.some((t=>{if(!e.msid||!t.cid||!e.msid.includes(t.cid))return!1;let n=0;if(e.rtp.some((e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0))),0===n)return!0;if(go(t.codec)&&this.ensureVideoDDExtensionForSVC(e,i),"av1"!==t.codec)return!0;const r=Math.round(.7*t.maxbr);for(const i of e.fmtp)if(i.payload===n){i.config.includes("x-google-start-bitrate")||(i.config+=";x-google-start-bitrate=".concat(r));break}return!0}))})),yield this.setMungedSDP(n,ha.write(i)),this.onOffer(n)}))}createAndSetAnswer(){return Qn(this,void 0,void 0,(function*(){var e;const t=yield this.pc.createAnswer(),n=ha.parse(null!==(e=t.sdp)&&void 0!==e?e:"");return n.media.forEach((e=>{"audio"===e.type&&va(e,this.remoteStereoMids,this.remoteNackMids)})),yield this.setMungedSDP(t,ha.write(n)),t}))}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new Or("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new Or("PC closed, cannot configure");return null===(t=this._pc)||void 0===t?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(null===(e=this._pc)||void 0===e?void 0:e.removeTrack)}removeTrack(e){var t;return null===(t=this._pc)||void 0===t?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.connectionState)&&void 0!==t?t:"closed"}getICEConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.iceConnectionState)&&void 0!==t?t:"closed"}getSignallingState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.signalingState)&&void 0!==t?t:"closed"}getTransceivers(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getTransceivers())&&void 0!==t?t:[]}getSenders(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getSenders())&&void 0!==t?t:[]}getLocalDescription(){var e;return null===(e=this._pc)||void 0===e?void 0:e.localDescription}getRemoteDescription(){var e;return null===(e=this.pc)||void 0===e?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return Qn(this,void 0,void 0,(function*(){var e;if(!this._pc)return;let t="";const n=new Map,i=new Map;if((yield this._pc.getStats()).forEach((e=>{switch(e.type){case"transport":t=e.selectedCandidatePairId;break;case"candidate-pair":""===t&&e.selected&&(t=e.id),n.set(e.id,e);break;case"remote-candidate":i.set(e.id,"".concat(e.address,":").concat(e.port))}})),""===t)return;const r=null===(e=n.get(t))||void 0===e?void 0:e.remoteCandidateId;return void 0!==r?i.get(r):void 0}))}setMungedSDP(e,t,n){return Qn(this,void 0,void 0,(function*(){if(t){const i=e.sdp;e.sdp=t;try{return this.log.debug("setting munged ".concat(n?"remote":"local"," description"),this.logContext),void(n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e))}catch(n){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:n,sdp:t})),e.sdp=i}}try{n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(t){let r="unknown error";t instanceof Error?r=t.message:"string"==typeof t&&(r=t);const o={error:r,sdp:e.sdp};throw!n&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new xr(r)}}))}ensureVideoDDExtensionForSVC(e,t){var n,i;if(!(null===(n=e.ext)||void 0===n?void 0:n.some((e=>e.uri===lo)))){if(0===this.ddExtID){let e=0;t.media.forEach((t=>{var n;"video"===t.type&&(null===(n=t.ext)||void 0===n||n.forEach((t=>{t.value>e&&(e=t.value)})))})),this.ddExtID=e+1}null===(i=e.ext)||void 0===i||i.push({value:this.ddExtID,uri:lo})}}}function va(e,t,n){let i=0;e.rtp.some((e=>"opus"===e.codec&&(i=e.payload,!0))),i>0&&(e.rtcpFb||(e.rtcpFb=[]),n.includes(e.mid)&&!e.rtcpFb.some((e=>e.payload===i&&"nack"===e.type))&&e.rtcpFb.push({payload:i,type:"nack"}),t.includes(e.mid)&&e.fmtp.some((e=>e.payload===i&&(e.config.includes("stereo=1")||(e.config+=";stereo=1"),!0))))}const ba="vp8",ya={audioPreset:e.AudioPresets.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Qr.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:ba,backupCodec:!0},ka={autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Ta={resolution:Hr.h720.resolution},Sa={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new Gn,disconnectOnPageLeave:!0,webAudioMix:!1},Ca={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Ea;!function(e){e[e.NEW=0]="NEW",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.FAILED=3]="FAILED",e[e.CLOSING=4]="CLOSING",e[e.CLOSED=5]="CLOSED"}(Ea||(Ea={}));class wa{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(t,n,i){var r;this.peerConnectionTimeout=Ca.peerConnectionTimeout,this.log=Vn,this.updateState=()=>{var e;const t=this.state,n=this.requiredTransports.map((e=>e.getConnectionState()));n.every((e=>"connected"===e))?this.state=Ea.CONNECTED:n.some((e=>"failed"===e))?this.state=Ea.FAILED:n.some((e=>"connecting"===e))?this.state=Ea.CONNECTING:n.every((e=>"closed"===e))?this.state=Ea.CLOSED:n.some((e=>"closed"===e))?this.state=Ea.CLOSING:n.every((e=>"new"===e))&&(this.state=Ea.NEW),t!==this.state&&(this.log.debug("pc state change: from ".concat(Ea[t]," to ").concat(Ea[this.state]),this.logContext),null===(e=this.onStateChange)||void 0===e||e.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=zn(null!==(r=i.loggerName)&&void 0!==r?r:e.LoggerNames.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=!n,this.isSubscriberConnectionRequired=n,this.publisher=new ga(t,i),this.subscriber=new ga(t,i),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,Bt.PUBLISHER)},this.subscriber.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,Bt.SUBSCRIBER)},this.subscriber.onDataChannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},this.subscriber.onTrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},this.publisher.onOffer=e=>{var t;null===(t=this.onPublisherOffer)||void 0===t||t.call(this,e)},this.state=Ea.NEW,this.connectionLock=new o,this.remoteOfferLock=new o}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}requirePublisher(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e){return this.publisher.setRemoteDescription(e)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return Qn(this,void 0,void 0,(function*(){if(this.publisher&&"closed"!==this.publisher.getSignallingState()){const t=this.publisher;for(const n of t.getSenders())try{t.canRemoveTrack()&&t.removeTrack(n)}catch(e){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:e}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()}))}triggerIceRestart(){return Qn(this,void 0,void 0,(function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))}))}addIceCandidate(e,t){return Qn(this,void 0,void 0,(function*(){t===Bt.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)}))}createSubscriberAnswerFromOffer(e){return Qn(this,void 0,void 0,(function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const t=yield this.remoteOfferLock.lock();try{return yield this.subscriber.setRemoteDescription(e),yield this.subscriber.createAndSetAnswer()}finally{t()}}))}updateConfiguration(e,t){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){return Qn(this,void 0,void 0,(function*(){var n;const i=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&"connected"!==this.publisher.getConnectionState()&&"connecting"!==this.publisher.getConnectionState()&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all(null===(n=this.requiredTransports)||void 0===n?void 0:n.map((n=>this.ensureTransportConnected(n,e,t))))}finally{i()}}))}negotiate(e){return Qn(this,void 0,void 0,(function*(){return new Promise(((t,n)=>Qn(this,void 0,void 0,(function*(){const i=setTimeout((()=>{n("negotiation timed out")}),this.peerConnectionTimeout);e.signal.addEventListener("abort",(()=>{clearTimeout(i),n("negotiation aborted")})),this.publisher.once(pa,(()=>{e.signal.aborted||this.publisher.once(ma,(()=>{clearTimeout(i),t()}))})),yield this.publisher.negotiate((e=>{clearTimeout(i),n(e)}))}))))}))}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===Bt.PUBLISHER||e===Bt.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(t,n){return Qn(this,arguments,void 0,(function(t,n){var i=this;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.peerConnectionTimeout;return function*(){if("connected"!==t.getConnectionState())return new Promise(((t,o)=>Qn(i,void 0,void 0,(function*(){const i=()=>{this.log.warn("abort transport connection",this.logContext),Br.clearTimeout(a),o(new wr("room connection has been cancelled",e.ConnectionErrorReason.Cancelled))};(null==n?void 0:n.signal.aborted)&&i(),null==n||n.signal.addEventListener("abort",i);const a=Br.setTimeout((()=>{null==n||n.signal.removeEventListener("abort",i),o(new wr("could not establish pc connection",e.ConnectionErrorReason.InternalError))}),r);for(;this.state!==Ea.CONNECTED;)if(yield uo(50),null==n?void 0:n.signal.aborted)return void o(new wr("room connection has been cancelled",e.ConnectionErrorReason.Cancelled));Br.clearTimeout(a),null==n||n.signal.removeEventListener("abort",i),t()}))))}()}))}}const Pa=2e3;function Ra(e,t){if(!t)return 0;let n,i;return"bytesReceived"in e?(n=e.bytesReceived,i=t.bytesReceived):"bytesSent"in e&&(n=e.bytesSent,i=t.bytesSent),void 0===n||void 0===i||void 0===e.timestamp||void 0===t.timestamp?0:8*(n-i)*1e3/(e.timestamp-t.timestamp)}class Ia extends Ho{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(t,n){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;super(t,Yr.Kind.Audio,n,i,o),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>Qn(this,void 0,void 0,(function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(e){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:e}))}e&&this.prevStats&&(this._currentBitrate=Ra(e,this.prevStats)),this.prevStats=e})),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(e.TrackEvent.AudioTrackFeatureUpdate,this,nt.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(e.TrackEvent.AudioTrackFeatureUpdate,this,nt.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}setDeviceId(e){return Qn(this,void 0,void 0,(function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Vo(e)||(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||Vo(e)===this._mediaStreamTrack.getSettings().deviceId)}))}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return Qn(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===Yr.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}}))}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return Qn(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const t=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Vo(this._constraints.deviceId);return this.source!==Yr.Source.Microphone||!this.stopOnMute&&"ended"!==this._mediaStreamTrack.readyState&&!t||this.isUserProvided||(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}}))}restartTrack(e){return Qn(this,void 0,void 0,(function*(){let t;if(e){const n=to({audio:e});"boolean"!=typeof n.audio&&(t=n.audio)}yield this.restart(t)}))}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return Qn(this,void 0,void 0,(function*(){const n=yield t.restart.call(this,e);return this.checkForSilence(),n}))}startMonitor(){Co()&&(this.monitorInterval||(this.monitorInterval=setInterval((()=>{this.monitorSender()}),Pa)))}setProcessor(t){return Qn(this,void 0,void 0,(function*(){var n;const i=yield this.processorLock.lock();try{if(!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const i={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(t.name),this.logContext),yield t.init(i),this.processor=t,this.processor.processedTrack&&(yield null===(n=this.sender)||void 0===n?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(e.TrackEvent.TrackProcessorUpdate,this.processor)}finally{i()}}))}setAudioContext(e){this.audioContext=e}getSenderStats(){return Qn(this,void 0,void 0,(function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return;let t;return(yield this.sender.getStats()).forEach((e=>{"outbound-rtp"===e.type&&(t={type:"audio",streamId:e.id,packetsSent:e.packetsSent,packetsLost:e.packetsLost,bytesSent:e.bytesSent,timestamp:e.timestamp,roundTripTime:e.roundTripTime,jitter:e.jitter})})),t}))}checkForSilence(){return Qn(this,void 0,void 0,(function*(){const t=yield function(e){return Qn(this,arguments,void 0,(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return function*(){const n=no();if(n){const i=n.createAnalyser();i.fftSize=2048;const r=i.frequencyBinCount,o=new Uint8Array(r);n.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),yield uo(t),i.getByteTimeDomainData(o);const a=o.some((e=>128!==e&&0!==e));return n.close(),!a}return!1}()}))}(this);return t&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(e.TrackEvent.AudioSilenceDetected)),t}))}}function Oa(e,t,n){switch(e.kind){case"audio":return new Ia(e,t,!1,void 0,n);case"video":return new qa(e,t,!1,n);default:throw new Rr("unsupported track type: ".concat(e.kind))}}const xa=Object.values(Hr),_a=Object.values(Gr),Na=Object.values(Qr),Ma=[Hr.h180,Hr.h360],Da=[Gr.h180,Gr.h360],Aa=e=>[{scaleResolutionDownBy:2,fps:e.encoding.maxFramerate}].map((t=>{var n,i;return new Vr(Math.floor(e.width/t.scaleResolutionDownBy),Math.floor(e.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(e.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*((null!==(n=e.encoding.maxFramerate)&&void 0!==n?n:30)/(null!==(i=t.fps)&&void 0!==i?i:30))))),t.fps,e.encoding.priority)})),La=["q","h","f"];function Ua(e,t,n,i){var r,o;let a=null==i?void 0:i.videoEncoding;e&&(a=null==i?void 0:i.screenShareEncoding);const s=null==i?void 0:i.simulcast,c=null==i?void 0:i.scalabilityMode,l=null==i?void 0:i.videoCodec;if(!a&&!s&&!c||!t||!n)return[{}];a||(a=function(e,t,n,i){const r=function(e,t,n){if(e)return Na;const i=t>n?t/n:n/t;return Math.abs(i-16/9)<Math.abs(i-4/3)?xa:_a}(e,t,n);let{encoding:o}=r[0];const a=Math.max(t,n);for(let s=0;s<r.length;s+=1){const e=r[s];if(o=e.encoding,e.width>=a)break}if(i)switch(i){case"av1":o=Object.assign({},o),o.maxBitrate=.7*o.maxBitrate;break;case"vp9":o=Object.assign({},o),o.maxBitrate=.85*o.maxBitrate}return o}(e,t,n,l),Vn.debug("using video encoding",a));const d=new Vr(t,n,a.maxBitrate,a.maxFramerate,a.priority);if(c&&go(l)){const e=new Va(c),t=[];if(e.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const n=Ar();if(ko()||Eo()||"Chrome"===(null==n?void 0:n.name)&&Oo(null==n?void 0:n.version,"113")<0){const n="h"==e.suffix?2:3;for(let i=0;i<e.spatial;i+=1)t.push({rid:La[2-i],maxBitrate:a.maxBitrate/Math.pow(n,i),maxFramerate:d.encoding.maxFramerate});t[0].scalabilityMode=c}else t.push({maxBitrate:a.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:c});return d.encoding.priority&&(t[0].priority=d.encoding.priority,t[0].networkPriority=d.encoding.priority),Vn.debug("using svc encoding",{encodings:t}),t}if(!s)return[a];let u,h=[];if(h=e?null!==(r=Ba(null==i?void 0:i.screenShareSimulcastLayers))&&void 0!==r?r:ja(e,d):null!==(o=Ba(null==i?void 0:i.videoSimulcastLayers))&&void 0!==o?o:ja(e,d),h.length>0){const e=h[0];h.length>1&&([,u]=h);const i=Math.max(t,n);if(i>=960&&u)return Fa(t,n,[e,u,d]);if(i>=480)return Fa(t,n,[e,d])}return Fa(t,n,[d])}function ja(e,t){if(e)return Aa(t);const{width:n,height:i}=t,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?Ma:Da}function Fa(e,t,n){const i=[];if(n.forEach(((n,r)=>{if(r>=La.length)return;const o=Math.min(e,t),a={rid:La[r],scaleResolutionDownBy:Math.max(1,o/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate};n.encoding.maxFramerate&&(a.maxFramerate=n.encoding.maxFramerate);const s=yo()||0===r;n.encoding.priority&&s&&(a.priority=n.encoding.priority,a.networkPriority=n.encoding.priority),i.push(a)})),Eo()&&"ios"===Ro()){let e;i.forEach((t=>{e?t.maxFramerate&&t.maxFramerate>e&&(e=t.maxFramerate):e=t.maxFramerate}));let t=!0;i.forEach((n=>{var i;n.maxFramerate!=e&&(t&&(t=!1,Vn.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Vn.info('Setting framerate of encoding "'.concat(null!==(i=n.rid)&&void 0!==i?i:"",'" to ').concat(e)),n.maxFramerate=e)}))}return i}function Ba(e){if(e)return e.sort(((e,t)=>{const{encoding:n}=e,{encoding:i}=t;return n.maxBitrate>i.maxBitrate?1:n.maxBitrate<i.maxBitrate?-1:n.maxBitrate===i.maxBitrate&&n.maxFramerate&&i.maxFramerate?n.maxFramerate>i.maxFramerate?1:-1:0}))}class Va{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat(null!==(e=this.suffix)&&void 0!==e?e:"")}}class qa extends Ho{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0;super(e,Yr.Kind.Video,t,n,i),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.monitorSender=()=>Qn(this,void 0,void 0,(function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(e){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:e}))}const t=new Map(e.map((e=>[e.rid,e])));if(this.prevStats){let e=0;t.forEach(((t,n)=>{var i;const r=null===(i=this.prevStats)||void 0===i?void 0:i.get(n);e+=Ra(t,r)})),this._currentBitrate=e}this.prevStats=t})),this.senderLock=new o}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!Co())return;const n=null===(t=this.sender)||void 0===t?void 0:t.getParameters();n&&(this.encodings=n.encodings),this.monitorInterval||(this.monitorInterval=setInterval((()=>{this.monitorSender()}),Pa))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach((e=>{e.mediaStreamTrack.stop()})),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return Qn(this,void 0,void 0,(function*(){var t,n,i,r,o;yield e.pauseUpstream.call(this);try{for(var a,s=!0,c=Yn(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);s=!0){r=a.value,s=!1;const e=r;yield null===(o=e.sender)||void 0===o?void 0:o.replaceTrack(null)}}catch(e){n={error:e}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}}))}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return Qn(this,void 0,void 0,(function*(){var t,n,i,r,o;yield e.resumeUpstream.call(this);try{for(var a,s=!0,c=Yn(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);s=!0){r=a.value,s=!1;const e=r;yield null===(o=e.sender)||void 0===o?void 0:o.replaceTrack(e.mediaStreamTrack)}}catch(e){n={error:e}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}}))}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return Qn(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source!==Yr.Source.Camera||this.isUserProvided||(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}}))}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return Qn(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.source!==Yr.Source.Camera||this.isUserProvided||(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{t()}}))}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){return Qn(this,void 0,void 0,(function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return[];const t=[],n=yield this.sender.getStats();return n.forEach((e=>{var i;if("outbound-rtp"===e.type){const r={type:"video",streamId:e.id,frameHeight:e.frameHeight,frameWidth:e.frameWidth,framesPerSecond:e.framesPerSecond,framesSent:e.framesSent,firCount:e.firCount,pliCount:e.pliCount,nackCount:e.nackCount,packetsSent:e.packetsSent,bytesSent:e.bytesSent,qualityLimitationReason:e.qualityLimitationReason,qualityLimitationDurations:e.qualityLimitationDurations,qualityLimitationResolutionChanges:e.qualityLimitationResolutionChanges,rid:null!==(i=e.rid)&&void 0!==i?i:e.id,retransmittedPacketsSent:e.retransmittedPacketsSent,targetBitrate:e.targetBitrate,timestamp:e.timestamp},o=n.get(e.remoteId);o&&(r.jitter=o.jitter,r.packetsLost=o.packetsLost,r.roundTripTime=o.roundTripTime),t.push(r)}})),t.sort(((e,t)=>{var n,i;return(null!==(n=t.frameWidth)&&void 0!==n?n:0)-(null!==(i=e.frameWidth)&&void 0!==i?i:0)})),t}))}setPublishingQuality(t){const n=[];for(let i=e.VideoQuality.LOW;i<=e.VideoQuality.HIGH;i+=1)n.push(new vn({quality:i,enabled:i<=t}));this.log.debug("setting publishing quality. max quality ".concat(t),this.logContext),this.setPublishingLayers(n)}setDeviceId(e){return Qn(this,void 0,void 0,(function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Vo(e)||(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||Vo(e)===this._mediaStreamTrack.getSettings().deviceId)}))}restartTrack(e){return Qn(this,void 0,void 0,(function*(){var t,n,i,r;let o;if(e){const t=to({video:e});"boolean"!=typeof t.video&&(o=t.video)}yield this.restart(o);try{for(var a,s=!0,c=Yn(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);s=!0){r=a.value,s=!1;const e=r;e.sender&&(e.mediaStreamTrack=this.mediaStreamTrack.clone(),yield e.sender.replaceTrack(e.mediaStreamTrack))}}catch(e){n={error:e}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}}))}setProcessor(e){const t=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return Qn(this,arguments,void 0,(function(e){var n=this;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var r,o,a,s,c,l;if(yield t.setProcessor.call(n,e,i),null===(c=n.processor)||void 0===c?void 0:c.processedTrack)try{for(var d,u=!0,h=Yn(n.simulcastCodecs.values());!(r=(d=yield h.next()).done);u=!0){s=d.value,u=!1;const e=s;yield null===(l=e.sender)||void 0===l?void 0:l.replaceTrack(n.processor.processedTrack)}}catch(e){o={error:e}}finally{try{u||r||!(a=h.return)||(yield a.call(h))}finally{if(o)throw o.error}}}()}))}setDegradationPreference(e){return Qn(this,void 0,void 0,(function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const t=this.sender.getParameters();t.degradationPreference=e,this.sender.setParameters(t)}catch(e){this.log.warn("failed to set degradationPreference",Object.assign({error:e},this.logContext))}}))}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e))return void this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);const n={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,n),n}setSimulcastTrackSender(e,t){const n=this.simulcastCodecs.get(e);n&&(n.sender=t,setTimeout((()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)}),5e3))}setPublishingCodecs(e){return Qn(this,void 0,void 0,(function*(){var t,n,i,r,o,a,s;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(t=!0,n=Yn(e);!(r=(i=yield n.next()).done);t=!0){s=i.value,t=!1;const e=s;if(this.codec&&this.codec!==e.codec){const t=this.simulcastCodecs.get(e.codec);if(this.log.debug("try setPublishingCodec for ".concat(e.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:t})),t&&t.sender)t.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(e.codec),this.logContext),yield za(t.sender,t.encodings,e.qualities,this.senderLock,this.log,this.logContext));else for(const n of e.qualities)if(n.enabled){c.push(e.codec);break}}else yield this.setPublishingLayers(e.qualities)}}catch(e){o={error:e}}finally{try{t||r||!(a=n.return)||(yield a.call(n))}finally{if(o)throw o.error}}return c}))}setPublishingLayers(e){return Qn(this,void 0,void 0,(function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:e})),this.sender&&this.encodings&&(yield za(this.sender,this.encodings,e,this.senderLock,this.log,this.logContext))}))}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Qn(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),So()&&this.isInBackground&&this.source===Yr.Source.Camera&&(this._mediaStreamTrack.enabled=!1)}))}}function za(e,t,n,i,r,o){return Qn(this,void 0,void 0,(function*(){const a=yield i.lock();r.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:e,qualities:n,senderEncodings:t}));try{const i=e.getParameters(),{encodings:a}=i;if(!a)return;if(a.length!==t.length)return void r.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:a,senderEncodings:t}));let s=!1;a.forEach(((e,i)=>{var a;let c=null!==(a=e.rid)&&void 0!==a?a:"";""===c&&(c="q");const l=Wa(c),d=n.find((e=>e.quality===l));d&&e.active!==d.enabled&&(s=!0,e.active=d.enabled,r.debug("setting layer ".concat(d.quality," to ").concat(e.active?"enabled":"disabled"),o),yo()&&(d.enabled?(e.scaleResolutionDownBy=t[i].scaleResolutionDownBy,e.maxBitrate=t[i].maxBitrate,e.maxFrameRate=t[i].maxFrameRate):(e.scaleResolutionDownBy=4,e.maxBitrate=10,e.maxFrameRate=2)))})),s&&(i.encodings=a,r.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:i.encodings})),yield e.setParameters(i))}finally{a()}}))}function Wa(t){switch(t){case"f":default:return e.VideoQuality.HIGH;case"h":return e.VideoQuality.MEDIUM;case"q":return e.VideoQuality.LOW}}function Ka(t,n,i,r){if(!i)return[new ht({quality:e.VideoQuality.HIGH,width:t,height:n,bitrate:0,ssrc:0})];if(r){const r=i[0].scalabilityMode,o=new Va(r),a=[],s="h"==o.suffix?1.5:2,c="h"==o.suffix?2:3;for(let l=0;l<o.spatial;l+=1)a.push(new ht({quality:Math.min(e.VideoQuality.HIGH,o.spatial-1)-l,width:Math.ceil(t/Math.pow(s,l)),height:Math.ceil(n/Math.pow(s,l)),bitrate:i[0].maxBitrate?Math.ceil(i[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return a}return i.map((e=>{var i,r,o;const a=null!==(i=e.scaleResolutionDownBy)&&void 0!==i?i:1;let s=Wa(null!==(r=e.rid)&&void 0!==r?r:"");return new ht({quality:s,width:Math.ceil(t/a),height:Math.ceil(n/a),bitrate:null!==(o=e.maxBitrate)&&void 0!==o?o:0,ssrc:0})}))}const Ha="_lossy",Ga="_reliable",Qa="leave-reconnect";var Ja,Ya,$a;!function(e){e[e.New=0]="New",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected",e[e.Reconnecting=3]="Reconnecting",e[e.Closed=4]="Closed"}(Ja||(Ja={}));class Xa extends Zn.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(t){var n;super(),this.options=t,this.rtcConfig={},this.peerConnectionTimeout=Ca.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=Ja.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Vn,this.handleDataChannel=e=>Qn(this,[e],void 0,(function(e){var t=this;let{channel:n}=e;return function*(){if(n){if(n.label===Ga)t.reliableDCSub=n;else{if(n.label!==Ha)return;t.lossyDCSub=n}t.log.debug("on data channel ".concat(n.id,", ").concat(n.label),t.logContext),n.onmessage=t.handleDataMessage}}()})),this.handleDataMessage=t=>Qn(this,void 0,void 0,(function*(){var n,i;const r=yield this.dataProcessLock.lock();try{let r;if(t.data instanceof ArrayBuffer)r=t.data;else{if(!(t.data instanceof Blob))return void this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:t.data}));r=yield t.data.arrayBuffer()}const o=pt.fromBinary(new Uint8Array(r));"speaker"===(null===(n=o.value)||void 0===n?void 0:n.case)?this.emit(e.EngineEvent.ActiveSpeakersUpdate,o.value.value.speakers):("user"===(null===(i=o.value)||void 0===i?void 0:i.case)&&function(e,t){const n=e.participantIdentity?e.participantIdentity:t.participantIdentity;e.participantIdentity=n,t.participantIdentity=n;const i=0!==e.destinationIdentities.length?e.destinationIdentities:t.destinationIdentities;e.destinationIdentities=i,t.destinationIdentities=i}(o,o.value.value),this.emit(e.EngineEvent.DataPacketReceived,o))}finally{r()}})),this.handleDataError=e=>{const t=0===e.currentTarget.maxRetransmits?"lossy":"reliable";if(e instanceof ErrorEvent&&e.error){const{error:n}=e.error;this.log.error("DataChannel error on ".concat(t,": ").concat(e.message),Object.assign(Object.assign({},this.logContext),{error:n}))}else this.log.error("Unknown DataChannel error on ".concat(t),Object.assign(Object.assign({},this.logContext),{event:e}))},this.handleBufferedAmountLow=e=>{const t=0===e.currentTarget.maxRetransmits?mt.LOSSY:mt.RELIABLE;this.updateAndEmitDCBufferStatus(t)},this.handleDisconnect=(t,n)=>{if(this._isClosed)return;this.log.warn("".concat(t," disconnected"),this.logContext),0===this.reconnectAttempts&&(this.reconnectStart=Date.now());const i=t=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(t,"ms. giving up"),this.logContext),this.emit(e.EngineEvent.Disconnected),this.close()},r=Date.now()-this.reconnectStart;let o=this.getNextRetryDelay({elapsedMs:r,retryCount:this.reconnectAttempts});null!==o?(t===Qa&&(o=0),this.log.debug("reconnecting in ".concat(o,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Br.setTimeout((()=>this.attemptReconnect(n).finally((()=>this.reconnectTimeout=void 0))),o)):i(r)},this.waitForRestarted=()=>new Promise(((t,n)=>{this.pcState===Ja.Connected&&t();const i=()=>{this.off(e.EngineEvent.Disconnected,r),t()},r=()=>{this.off(e.EngineEvent.Restarted,i),n()};this.once(e.EngineEvent.Restarted,i),this.once(e.EngineEvent.Disconnected,r)})),this.updateAndEmitDCBufferStatus=t=>{const n=this.isBufferStatusLow(t);void 0!==n&&n!==this.dcBufferStatus.get(t)&&(this.dcBufferStatus.set(t,n),this.emit(e.EngineEvent.DCBufferStatusChanged,n,t))},this.isBufferStatusLow=e=>{const t=this.dataChannelForKind(e);if(t)return t.bufferedAmount<=t.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===$o.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(et.RR_SIGNAL_DISCONNECTED))},this.log=zn(null!==(n=t.loggerName)&&void 0!==n?n:e.LoggerNames.Engine),this.loggerOptions={loggerName:t.loggerName,loggerContextCb:()=>this.logContext},this.client=new Xo(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new o,this.dataProcessLock=new o,this.dcBufferStatus=new Map([[mt.LOSSY,!0],[mt.RELIABLE,!0]]),this.client.onParticipantUpdate=t=>this.emit(e.EngineEvent.ParticipantUpdate,t),this.client.onConnectionQuality=t=>this.emit(e.EngineEvent.ConnectionQualityUpdate,t),this.client.onRoomUpdate=t=>this.emit(e.EngineEvent.RoomUpdate,t),this.client.onSubscriptionError=t=>this.emit(e.EngineEvent.SubscriptionError,t),this.client.onSubscriptionPermissionUpdate=t=>this.emit(e.EngineEvent.SubscriptionPermissionUpdate,t),this.client.onSpeakersChanged=t=>this.emit(e.EngineEvent.SpeakersChanged,t),this.client.onStreamStateUpdate=t=>this.emit(e.EngineEvent.StreamStateChanged,t),this.client.onRequestResponse=t=>this.emit(e.EngineEvent.SignalRequestResponse,t)}get logContext(){var e,t,n,i,r,o,a,s;return{room:null===(t=null===(e=this.latestJoinResponse)||void 0===e?void 0:e.room)||void 0===t?void 0:t.name,roomID:null===(i=null===(n=this.latestJoinResponse)||void 0===n?void 0:n.room)||void 0===i?void 0:i.sid,participant:null===(o=null===(r=this.latestJoinResponse)||void 0===r?void 0:r.participant)||void 0===o?void 0:o.identity,pID:null===(s=null===(a=this.latestJoinResponse)||void 0===a?void 0:a.participant)||void 0===s?void 0:s.sid}}join(t,n,i,r){return Qn(this,void 0,void 0,(function*(){this.url=t,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const e=yield this.client.join(t,n,i,r);return this._isClosed=!1,this.latestJoinResponse=e,this.subscriberPrimary=e.subscriberPrimary,this.pcManager||(yield this.configure(e)),this.subscriberPrimary&&!e.fastPublish||this.negotiate(),this.clientConfiguration=e.clientConfiguration,e}catch(a){if(a instanceof wr&&a.reason===e.ConnectionErrorReason.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(t,n,i,r);throw a}}))}close(){return Qn(this,void 0,void 0,(function*(){const t=yield this.closingLock.lock();if(this.isClosed)t();else try{this._isClosed=!0,this.joinAttempts=0,this.emit(e.EngineEvent.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{t()}}))}cleanupPeerConnections(){return Qn(this,void 0,void 0,(function*(){var e;yield null===(e=this.pcManager)||void 0===e?void 0:e.close(),this.pcManager=void 0;const t=e=>{e&&(e.close(),e.onbufferedamountlow=null,e.onclose=null,e.onclosing=null,e.onerror=null,e.onmessage=null,e.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0}))}cleanupClient(){return Qn(this,void 0,void 0,(function*(){yield this.client.close(),this.client.resetCallbacks()}))}addTrack(t){if(this.pendingTrackResolvers[t.cid])throw new Rr("a track with the same ID has already been published");return new Promise(((n,i)=>{const r=setTimeout((()=>{delete this.pendingTrackResolvers[t.cid],i(new wr("publication of local track timed out, no response from server",e.ConnectionErrorReason.InternalError))}),1e4);this.pendingTrackResolvers[t.cid]={resolve:e=>{clearTimeout(r),n(e)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(t)}))}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(e){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:e}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return null===(e=this.reliableDCSub)||void 0===e?void 0:e.readyState}getConnectedServerAddress(){return Qn(this,void 0,void 0,(function*(){var e;return null===(e=this.pcManager)||void 0===e?void 0:e.getConnectedAddress()}))}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(t){return Qn(this,void 0,void 0,(function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==Ea.NEW)return;this.participantSid=null===(n=t.participant)||void 0===n?void 0:n.sid;const r=this.makeRTCConfiguration(t);var o;this.pcManager=new wa(r,t.subscriberPrimary,this.loggerOptions),this.emit(e.EngineEvent.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(e,t)=>{this.client.sendIceCandidate(e,t)},this.pcManager.onPublisherOffer=e=>{this.client.sendOffer(e)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(n,i,r)=>Qn(this,void 0,void 0,(function*(){if(this.log.debug("primary PC state changed ".concat(n),this.logContext),["closed","disconnected","failed"].includes(i)&&(this.publisherConnectionPromise=void 0),n===Ea.CONNECTED){const n=this.pcState===Ja.New;this.pcState=Ja.Connected,n&&this.emit(e.EngineEvent.Connected,t)}else n===Ea.FAILED&&this.pcState===Ja.Connected&&(this.pcState=Ja.Disconnected,this.handleDisconnect("peerconnection failed","failed"===r?et.RR_SUBSCRIBER_FAILED:et.RR_PUBLISHER_FAILED));const o=this.client.isDisconnected||this.client.currentState===$o.RECONNECTING,a=[Ea.FAILED,Ea.CLOSING,Ea.CLOSED].includes(n);o&&a&&!this._isClosed&&this.emit(e.EngineEvent.Offline)})),this.pcManager.onTrack=t=>{this.emit(e.EngineEvent.MediaTrackAdded,t.track,t.streams[0],t.receiver)},void 0!==(o=null===(i=t.serverInfo)||void 0===i?void 0:i.protocol)&&o>13||this.createDataChannels()}))}setupSignalClientCallbacks(){this.client.onAnswer=e=>Qn(this,void 0,void 0,(function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e))})),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.trace("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=e=>Qn(this,void 0,void 0,(function*(){if(!this.pcManager)return;const t=yield this.pcManager.createSubscriberAnswerFromOffer(e);this.client.sendAnswer(t)})),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:null===(t=e.track)||void 0===t?void 0:t.sid})),!this.pendingTrackResolvers[e.cid])return void this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));const{resolve:n}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],n(e.track)},this.client.onLocalTrackUnpublished=t=>{this.emit(e.EngineEvent.LocalTrackUnpublished,t)},this.client.onLocalTrackSubscribed=t=>{this.emit(e.EngineEvent.LocalTrackSubscribed,t)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(t,n)=>{this.emit(e.EngineEvent.RemoteMute,t,n)},this.client.onSubscribedQualityUpdate=t=>{this.emit(e.EngineEvent.SubscribedQualityUpdate,t)},this.client.onClose=()=>{this.handleDisconnect("signal",et.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=t=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:null==t?void 0:t.reason})),t.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(t.regions)),t.action){case sn.DISCONNECT:this.emit(e.EngineEvent.Disconnected,null==t?void 0:t.reason),this.close();break;case sn.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Qa);break;case sn.RESUME:this.handleDisconnect(Qa)}}}makeRTCConfiguration(e){var t;const n=Object.assign({},this.rtcConfig);if((null===(t=this.signalOpts)||void 0===t?void 0:t.e2eeEnabled)&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),n.encodedInsertableStreams=!0),e.iceServers&&!n.iceServers){const t=[];e.iceServers.forEach((e=>{const n={urls:e.urls};e.username&&(n.username=e.username),e.credential&&(n.credential=e.credential),t.push(n)})),n.iceServers=t}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Xe.ENABLED&&(n.iceTransportPolicy="relay"),n.sdpSemantics="unified-plan",n.continualGatheringPolicy="gather_continually",n}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Ha,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Ga,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,t,n){return Qn(this,void 0,void 0,(function*(){if(ho())return yield this.createTransceiverRTCRtpSender(e,t,n);if(po())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Or("Required webRTC APIs not supported on this device")}))}createSimulcastSender(e,t,n,i){return Qn(this,void 0,void 0,(function*(){if(ho())return this.createSimulcastTransceiverSender(e,t,n,i);if(po())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Or("Cannot stream on this device")}))}createTransceiverRTCRtpSender(e,t,n){return Qn(this,void 0,void 0,(function*(){if(!this.pcManager)throw new Or("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream),e instanceof qa&&(e.codec=t.videoCodec);const r={direction:"sendonly",streams:i};return n&&(r.sendEncodings=n),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,r)).sender}))}createSimulcastTransceiverSender(e,t,n,i){return Qn(this,void 0,void 0,(function*(){if(!this.pcManager)throw new Or("publisher is closed");const r={direction:"sendonly"};i&&(r.sendEncodings=i);const o=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,r);if(n.videoCodec)return e.setSimulcastTrackSender(n.videoCodec,o.sender),o.sender}))}createRTCRtpSender(e){return Qn(this,void 0,void 0,(function*(){if(!this.pcManager)throw new Or("publisher is closed");return this.pcManager.addPublisherTrack(e)}))}attemptReconnect(t){return Qn(this,void 0,void 0,(function*(){var n,i,r;if(!this._isClosed)if(this.attemptingReconnect)Vn.warn("already attempting reconnect, returning early",this.logContext);else{(null===(n=this.clientConfiguration)||void 0===n?void 0:n.resumeConnection)!==Xe.DISABLED&&(null!==(r=null===(i=this.pcManager)||void 0===i?void 0:i.currentState)&&void 0!==r?r:Ea.NEW)!==Ea.NEW||(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(t),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(t){this.reconnectAttempts+=1;let i=!0;t instanceof Or?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:t})),i=!1):t instanceof Za||(this.fullReconnectOnNext=!0),i?this.handleDisconnect("reconnect",et.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(e.EngineEvent.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}}))}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(e){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:e}))}return null}restartConnection(t){return Qn(this,void 0,void 0,(function*(){var n,i,r;try{if(!this.url||!this.token)throw new Or("could not reconnect, url or token not saved");let i;this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(e.EngineEvent.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Za;i=yield this.join(null!=t?t:this.url,this.token,this.signalOpts)}catch(t){if(t instanceof wr&&t.reason===e.ConnectionErrorReason.NotAllowed)throw new Or("could not reconnect, token might be expired");throw new Za}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(e.EngineEvent.SignalRestarted,i),yield this.waitForPCReconnected(),this.client.currentState!==$o.CONNECTED)throw new Za("Signal connection got severed during reconnect");null===(n=this.regionUrlProvider)||void 0===n||n.resetAttempts(),this.emit(e.EngineEvent.Restarted)}catch(e){const n=yield null===(i=this.regionUrlProvider)||void 0===i?void 0:i.getNextBestRegionUrl();if(n)return void(yield this.restartConnection(n));throw null===(r=this.regionUrlProvider)||void 0===r||r.resetAttempts(),e}}))}resumeConnection(t){return Qn(this,void 0,void 0,(function*(){var n;if(!this.url||!this.token)throw new Or("could not reconnect, url or token not saved");if(!this.pcManager)throw new Or("publisher and subscriber connections unset");let i;this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(e.EngineEvent.Resuming);try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,t)}catch(t){let i="";if(t instanceof Error&&(i=t.message,this.log.error(t.message,Object.assign(Object.assign({},this.logContext),{error:t}))),t instanceof wr&&t.reason===e.ConnectionErrorReason.NotAllowed)throw new Or("could not reconnect, token might be expired");if(t instanceof wr&&t.reason===e.ConnectionErrorReason.LeaveRequest)throw t;throw new Za(i)}if(this.emit(e.EngineEvent.SignalResumed),i){const e=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(e)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==$o.CONNECTED)throw new Za("Signal connection got severed during reconnect");this.client.setReconnected(),"open"===(null===(n=this.reliableDC)||void 0===n?void 0:n.readyState)&&null===this.reliableDC.id&&this.createDataChannels(),this.emit(e.EngineEvent.Resumed)}))}waitForPCInitialConnection(e,t){return Qn(this,void 0,void 0,(function*(){if(!this.pcManager)throw new Or("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)}))}waitForPCReconnected(){return Qn(this,void 0,void 0,(function*(){this.pcState=Ja.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield uo(2e3),!this.pcManager)throw new Or("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Ja.Connected}catch(t){throw this.pcState=Ja.Disconnected,new wr("could not establish PC connection, ".concat(t.message),e.ConnectionErrorReason.InternalError)}}))}sendDataPacket(e,t){return Qn(this,void 0,void 0,(function*(){const n=e.toBinary();yield this.ensurePublisherConnected(t);const i=this.dataChannelForKind(t);i&&i.send(n),this.updateAndEmitDCBufferStatus(t)}))}ensureDataTransportConnected(t){return Qn(this,arguments,void 0,(function(t){var n=this;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.subscriberPrimary;return function*(){var r;if(!n.pcManager)throw new Or("PC manager is closed");const o=i?n.pcManager.subscriber:n.pcManager.publisher,a=i?"Subscriber":"Publisher";if(!o)throw new wr("".concat(a," connection not set"),e.ConnectionErrorReason.InternalError);let s=!1;i||n.dataChannelForKind(t,i)||(n.createDataChannels(),s=!0),s||i||n.pcManager.publisher.isICEConnected||"checking"===n.pcManager.publisher.getICEConnectionState()||(s=!0),s&&n.negotiate();const c=n.dataChannelForKind(t,i);if("open"===(null==c?void 0:c.readyState))return;const l=(new Date).getTime()+n.peerConnectionTimeout;for(;(new Date).getTime()<l;){if(o.isICEConnected&&"open"===(null===(r=n.dataChannelForKind(t,i))||void 0===r?void 0:r.readyState))return;yield uo(50)}throw new wr("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()),e.ConnectionErrorReason.InternalError)}()}))}ensurePublisherConnected(e){return Qn(this,void 0,void 0,(function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise}))}verifyTransport(){return!!this.pcManager&&this.pcManager.currentState===Ea.CONNECTED&&!(!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return Qn(this,void 0,void 0,(function*(){return new Promise(((t,n)=>Qn(this,void 0,void 0,(function*(){if(!this.pcManager)return void n(new xr("PC manager is closed"));this.pcManager.requirePublisher(),0!=this.pcManager.publisher.getTransceivers().length||this.lossyDC||this.reliableDC||this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),t()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(e.EngineEvent.Closing,r),this.pcManager.publisher.once(fa,(t=>{const n=new Map;t.forEach((e=>{const t=e.codec.toLowerCase();var i;i=t,zr.includes(i)&&n.set(e.payload,t)})),this.emit(e.EngineEvent.RTPVideoMapUpdate,n)}));try{yield this.pcManager.negotiate(i),t()}catch(e){e instanceof xr&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",et.RR_UNKNOWN),n(e)}finally{this.off(e.EngineEvent.Closing,r)}}))))}))}dataChannelForKind(e,t){if(t){if(e===mt.LOSSY)return this.lossyDCSub;if(e===mt.RELIABLE)return this.reliableDCSub}else{if(e===mt.LOSSY)return this.lossyDC;if(e===mt.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var n,i;if(!this.pcManager)return void this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);const r=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),a=null===(i=null===(n=this.signalOpts)||void 0===n?void 0:n.autoSubscribe)||void 0===i||i,s=new Array,c=new Array;e.forEach((e=>{e.isDesired!==a&&s.push(e.trackSid),e.isEnabled||c.push(e.trackSid)})),this.client.sendSyncState(new Cn({answer:r?ea({sdp:r.sdp,type:r.type}):void 0,offer:o?ea({sdp:o.sdp,type:o.type}):void 0,subscription:new tn({trackSids:s,subscribe:!a,participantTracks:[]}),publishTracks:ao(t),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:c}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(t,n)=>{void 0!==(null==t?void 0:t.id)&&null!==t.id&&e.push(new En({label:t.label,id:t.id,target:n}))};return t(this.dataChannelForKind(mt.LOSSY),Bt.PUBLISHER),t(this.dataChannelForKind(mt.RELIABLE),Bt.PUBLISHER),t(this.dataChannelForKind(mt.LOSSY,!0),Bt.SUBSCRIBER),t(this.dataChannelForKind(mt.RELIABLE,!0),Bt.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Br.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Co()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){Co()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class Za extends Error{}class es{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return wo(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return Qn(this,void 0,void 0,(function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter((e=>!this.attemptedRegions.find((t=>t.url===e.url))));if(t.length>0){const e=t[0];return this.attemptedRegions.push(e),Vn.debug("next region: ".concat(e.region)),e.url}return null}))}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(t){return Qn(this,void 0,void 0,(function*(){const n=yield fetch("".concat((i=this.serverUrl,"".concat(i.protocol.replace("ws","http"),"//").concat(i.host,"/settings")),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:t});var i;if(n.ok){const e=yield n.json();return this.lastUpdateAt=Date.now(),e}throw new wr("Could not fetch region settings: ".concat(n.statusText),401===n.status?e.ConnectionErrorReason.NotAllowed:e.ConnectionErrorReason.InternalError,n.status)}))}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}class ts extends Error{constructor(e,t,n){super(t),this.code=e,this.message=is(t,ts.MAX_MESSAGE_BYTES),this.data=n?is(n,ts.MAX_DATA_BYTES):void 0}static fromProto(e){return new ts(e.code,e.message,e.data)}toProto(){return new wt({code:this.code,message:this.message,data:this.data})}static builtIn(e,t){return new ts(ts.ErrorCode[e],ts.ErrorMessage[e],t)}}function ns(e){return(new TextEncoder).encode(e).length}function is(e,t){if(ns(e)<=t)return e;let n=0,i=e.length;const r=new TextEncoder;for(;n<i;){const o=Math.floor((n+i+1)/2);r.encode(e.slice(0,o)).length<=t?n=o:i=o-1}return e.slice(0,n)}ts.MAX_MESSAGE_BYTES=256,ts.MAX_DATA_BYTES=15360,ts.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404},ts.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};class rs extends Yr{constructor(e,t,n,i,r){super(e,n,r),this.sid=t,this.receiver=i}setMuted(t){this.isMuted!==t&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?e.TrackEvent.Muted:e.TrackEvent.Unmuted,this))}setMediaStream(t){this.mediaStream=t;const n=i=>{i.track===this._mediaStreamTrack&&(t.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(e.TrackEvent.Ended,this))};t.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return Qn(this,void 0,void 0,(function*(){var e;if(null===(e=this.receiver)||void 0===e?void 0:e.getStats)return yield this.receiver.getStats()}))}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval((()=>this.monitorReceiver()),Pa)),"undefined"!=typeof RTCRtpReceiver&&"getSynchronizationSources"in RTCRtpReceiver&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const t=()=>{var n;this.timeSyncHandle=requestAnimationFrame((()=>t()));const i=null===(n=this.receiver)||void 0===n?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:t,rtpTimestamp:n}=i;n&&this.rtpTimestamp!==n&&(this.emit(e.TrackEvent.TimeSyncUpdate,{timestamp:t,rtpTimestamp:n}),this.rtpTimestamp=n)}};t()}}class os extends rs{constructor(e,t,n,i,r,o){super(e,t,Yr.Kind.Audio,n,o),this.monitorReceiver=()=>Qn(this,void 0,void 0,(function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=Ra(e,this.prevStats)),this.prevStats=e})),this.audioContext=i,this.webAudioPluginNodes=[],r&&(this.sinkId=r.deviceId)}setVolume(e){var t;for(const n of this.attachedElements)this.audioContext?null===(t=this.gainNode)||void 0===t||t.gain.setTargetAtTime(e,0,.1):n.volume=e;Eo()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(Eo())return 1;let e=0;return this.attachedElements.forEach((t=>{t.volume>e&&(e=t.volume)})),e}setSinkId(e){return Qn(this,void 0,void 0,(function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map((t=>{if(vo(t))return t.setSinkId(e)})))}))}attach(e){const t=0===this.attachedElements.length;return e?super.attach(e):e=super.attach(),this.sinkId&&vo(e)&&e.setSinkId(this.sinkId),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(t,n){this.disconnectWebAudio(),this.sourceNode=t.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach((e=>{i.connect(e),i=e})),this.gainNode=t.createGain(),i.connect(this.gainNode),this.gainNode.connect(t.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),"running"!==t.state&&t.resume().then((()=>{"running"!==t.state&&this.emit(e.TrackEvent.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))})).catch((t=>{this.emit(e.TrackEvent.AudioPlaybackFailed,t)}))}disconnectWebAudio(){var e,t;null===(e=this.gainNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return Qn(this,void 0,void 0,(function*(){if(!this.receiver||!this.receiver.getStats)return;let e;return(yield this.receiver.getStats()).forEach((t=>{"inbound-rtp"===t.type&&(e={type:"audio",timestamp:t.timestamp,jitter:t.jitter,bytesReceived:t.bytesReceived,concealedSamples:t.concealedSamples,concealmentEvents:t.concealmentEvents,silentConcealedSamples:t.silentConcealedSamples,silentConcealmentEvents:t.silentConcealmentEvents,totalAudioEnergy:t.totalAudioEnergy,totalSamplesDuration:t.totalSamplesDuration})})),e}))}}class as extends rs{constructor(e,t,n,i,r){super(e,t,Yr.Kind.Video,n,r),this.elementInfos=[],this.monitorReceiver=()=>Qn(this,void 0,void 0,(function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=Ra(e,this.prevStats)),this.prevStats=e})),this.debouncedHandleResize=Nr((()=>{this.updateDimensions()}),100),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return void 0!==this.adaptiveStreamSettings}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach((t=>{e?Xr(this._mediaStreamTrack,t):$r(this._mediaStreamTrack,t)}))}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&void 0===this.elementInfos.find((t=>t.element===e))){const t=new ss(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&void 0===this.elementInfos.find((t=>t===e))?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream)return void this.log.warn("stopObservingElementInfo ignored",this.logContext);const t=this.elementInfos.filter((t=>t===e));for(const n of t)n.stopObserving();this.elementInfos=this.elementInfos.filter((t=>t!==e)),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const n of t)this.stopObservingElement(n);return t}getDecoderImplementation(){var e;return null===(e=this.prevStats)||void 0===e?void 0:e.decoderImplementation}getReceiverStats(){return Qn(this,void 0,void 0,(function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,n="",i=new Map;return e.forEach((e=>{"inbound-rtp"===e.type?(n=e.codecId,t={type:"video",framesDecoded:e.framesDecoded,framesDropped:e.framesDropped,framesReceived:e.framesReceived,packetsReceived:e.packetsReceived,packetsLost:e.packetsLost,frameWidth:e.frameWidth,frameHeight:e.frameHeight,pliCount:e.pliCount,firCount:e.firCount,nackCount:e.nackCount,jitter:e.jitter,timestamp:e.timestamp,bytesReceived:e.bytesReceived,decoderImplementation:e.decoderImplementation}):"codec"===e.type&&i.set(e.id,e)})),t&&""!==n&&i.get(n)&&(t.mimeType=i.get(n).mimeType),t}))}stopObservingElement(e){const t=this.elementInfos.filter((t=>t.element===e));for(const n of t)this.stopObservingElementInfo(n)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Qn(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()}))}updateVisibility(){var t,n;const i=this.elementInfos.reduce(((e,t)=>Math.max(e,t.visibilityChangedAt||0)),0),r=!(null!==(n=null===(t=this.adaptiveStreamSettings)||void 0===t?void 0:t.pauseVideoInBackground)&&void 0!==n&&!n)&&this.isInBackground,o=this.elementInfos.some((e=>e.pictureInPicture)),a=this.elementInfos.some((e=>e.visible))&&!r||o;this.lastVisible!==a&&(!a&&Date.now()-i<100?Br.setTimeout((()=>{this.updateVisibility()}),100):(this.lastVisible=a,this.emit(e.TrackEvent.VisibilityChanged,a,this)))}updateDimensions(){var t,n;let i=0,r=0;const o=this.getPixelDensity();for(const e of this.elementInfos){const t=e.width()*o,n=e.height()*o;t+n>i+r&&(i=t,r=n)}(null===(t=this.lastDimensions)||void 0===t?void 0:t.width)===i&&(null===(n=this.lastDimensions)||void 0===n?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(e.TrackEvent.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pixelDensity;return"screen"===t?Io():t||(Io()>2?2:1)}}class ss{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=e=>{var t;const{target:n,isIntersecting:i}=e;n===this.element&&(this.isIntersecting=i,this.isPiP=cs(this.element),this.visibilityChangedAt=Date.now(),null===(t=this.handleVisibilityChanged)||void 0===t||t.call(this))},this.onEnterPiP=()=>{var e,t,n;null===(t=null===(e=window.documentPictureInPicture)||void 0===e?void 0:e.window)||void 0===t||t.addEventListener("pagehide",this.onLeavePiP),this.isPiP=cs(this.element),null===(n=this.handleVisibilityChanged)||void 0===n||n.call(this)},this.onLeavePiP=()=>{var e;this.isPiP=cs(this.element),null===(e=this.handleVisibilityChanged)||void 0===e||e.call(this)},this.element=e,this.isIntersecting=null!=t?t:ls(e),this.isPiP=Co()&&cs(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,t,n;this.isIntersecting=ls(this.element),this.isPiP=cs(this.element),this.element.handleResize=()=>{var e;null===(e=this.handleResize)||void 0===e||e.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Ao().observe(this.element),Mo().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),null===(e=window.documentPictureInPicture)||void 0===e||e.addEventListener("enter",this.onEnterPiP),null===(n=null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)||void 0===n||n.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,t,n,i,r;null===(e=Ao())||void 0===e||e.unobserve(this.element),null===(t=Mo())||void 0===t||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),null===(n=window.documentPictureInPicture)||void 0===n||n.removeEventListener("enter",this.onEnterPiP),null===(r=null===(i=window.documentPictureInPicture)||void 0===i?void 0:i.window)||void 0===r||r.removeEventListener("pagehide",this.onLeavePiP)}}function cs(e){var t,n;return document.pictureInPictureElement===e||!!(null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)&&ls(e,null===(n=window.documentPictureInPicture)||void 0===n?void 0:n.window)}function ls(e,t){const n=t||window;let i=e.offsetTop,r=e.offsetLeft;const o=e.offsetWidth,a=e.offsetHeight,{hidden:s}=e,{display:c}=getComputedStyle(e);for(;e.offsetParent;)i+=(e=e.offsetParent).offsetTop,r+=e.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+a>n.pageYOffset&&r+o>n.pageXOffset&&!s&&"none"!==c}class ds extends Zn.EventEmitter{constructor(t,n,i,r){var o;super(),this.metadataMuted=!1,this.encryption=lt.NONE,this.log=Vn,this.handleMuted=()=>{this.emit(e.TrackEvent.Muted)},this.handleUnmuted=()=>{this.emit(e.TrackEvent.Unmuted)},this.log=zn(null!==(o=null==r?void 0:r.loggerName)&&void 0!==o?o:e.LoggerNames.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=t,this.trackSid=n,this.trackName=i,this.source=Yr.Source.Unknown}setTrack(t){this.track&&(this.track.off(e.TrackEvent.Muted,this.handleMuted),this.track.off(e.TrackEvent.Unmuted,this.handleUnmuted)),this.track=t,t&&(t.on(e.TrackEvent.Muted,this.handleMuted),t.on(e.TrackEvent.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),so(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return void 0!==this.track}get isEncrypted(){return this.encryption!==lt.NONE}get audioTrack(){if(this.track instanceof Ia||this.track instanceof os)return this.track}get videoTrack(){if(this.track instanceof qa||this.track instanceof as)return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=Yr.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===Yr.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}!function(e){var t,n;(t=e.SubscriptionStatus||(e.SubscriptionStatus={})).Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",(n=e.PermissionStatus||(e.PermissionStatus={})).Allowed="allowed",n.NotAllowed="not_allowed"}(ds||(ds={}));class us extends ds{get isUpstreamPaused(){var e;return null===(e=this.track)||void 0===e?void 0:e.isUpstreamPaused}constructor(t,n,i,r){super(t,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(e.TrackEvent.Ended)},this.updateInfo(n),this.setTrack(i)}setTrack(t){this.track&&this.track.off(e.TrackEvent.Ended,this.handleTrackEnded),super.setTrack(t),t&&t.on(e.TrackEvent.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}mute(){return Qn(this,void 0,void 0,(function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.mute()}))}unmute(){return Qn(this,void 0,void 0,(function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.unmute()}))}pauseUpstream(){return Qn(this,void 0,void 0,(function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.pauseUpstream()}))}resumeUpstream(){return Qn(this,void 0,void 0,(function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.resumeUpstream()}))}getTrackFeatures(){var e;if(this.track instanceof Ia){const t=this.track.getSourceTrackSettings(),n=new Set;return t.autoGainControl&&n.add(nt.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&n.add(nt.TF_ECHO_CANCELLATION),t.noiseSuppression&&n.add(nt.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&n.add(nt.TF_STEREO),(null===(e=this.options)||void 0===e?void 0:e.dtx)||n.add(nt.TF_NO_DTX),this.track.enhancedNoiseCancellation&&n.add(nt.TF_ENHANCED_NOISE_CANCELLATION),Array.from(n.values())}return[]}}e.ConnectionQuality=void 0,function(e){e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Lost="lost",e.Unknown="unknown"}(e.ConnectionQuality||(e.ConnectionQuality={}));class hs extends Zn.EventEmitter{get logContext(){var e,t;return Object.assign({},null===(t=null===(e=this.loggerOptions)||void 0===e?void 0:e.loggerContextCb)||void 0===t?void 0:t.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every((e=>e.isEncrypted))}get isAgent(){var e;return(null===(e=this.permissions)||void 0===e?void 0:e.agent)||this.kind===ct.AGENT}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(t,n,i,r,o){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ct.STANDARD;var s;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=e.ConnectionQuality.Unknown,this.log=Vn,this.log=zn(null!==(s=null==o?void 0:o.loggerName)&&void 0!==s?s:e.LoggerNames.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=t,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes={}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,t]of this.trackPublications)if(t.source===e)return t}getTrackPublicationByName(e){for(const[,t]of this.trackPublications)if(t.trackName===e)return t}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrackPublication(Yr.Source.Camera);return!(null===(e=null==t?void 0:t.isMuted)||void 0===e||e)}get isMicrophoneEnabled(){var e;const t=this.getTrackPublication(Yr.Source.Microphone);return!(null===(e=null==t?void 0:t.isMuted)||void 0===e||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(Yr.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(1e3*Number.parseInt(this.participantInfo.joinedAt.toString())):new Date}updateInfo(e){return!(this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version)&&(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:e})),!0)}_setMetadata(t){const n=this.metadata!==t,i=this.metadata;this.metadata=t,n&&this.emit(e.ParticipantEvent.ParticipantMetadataChanged,i)}_setName(t){const n=this.name!==t;this.name=t,n&&this.emit(e.ParticipantEvent.ParticipantNameChanged,t)}_setAttributes(t){const n=function(e,t){var n;void 0===e&&(e={}),void 0===t&&(t={});const i=[...Object.keys(t),...Object.keys(e)],r={};for(const o of i)e[o]!==t[o]&&(r[o]=null!==(n=t[o])&&void 0!==n?n:"");return r}(this.attributes,t);this._attributes=t,Object.keys(n).length>0&&this.emit(e.ParticipantEvent.AttributesChanged,n)}setPermissions(t){var n,i,r,o,a,s;const c=this.permissions,l=t.canPublish!==(null===(n=this.permissions)||void 0===n?void 0:n.canPublish)||t.canSubscribe!==(null===(i=this.permissions)||void 0===i?void 0:i.canSubscribe)||t.canPublishData!==(null===(r=this.permissions)||void 0===r?void 0:r.canPublishData)||t.hidden!==(null===(o=this.permissions)||void 0===o?void 0:o.hidden)||t.recorder!==(null===(a=this.permissions)||void 0===a?void 0:a.recorder)||t.canPublishSources.length!==this.permissions.canPublishSources.length||t.canPublishSources.some(((e,t)=>{var n;return e!==(null===(n=this.permissions)||void 0===n?void 0:n.canPublishSources[t])}))||t.canSubscribeMetrics!==(null===(s=this.permissions)||void 0===s?void 0:s.canSubscribeMetrics);return this.permissions=t,l&&this.emit(e.ParticipantEvent.ParticipantPermissionsChanged,c),l}setIsSpeaking(t){t!==this.isSpeaking&&(this.isSpeaking=t,t&&(this.lastSpokeAt=new Date),this.emit(e.ParticipantEvent.IsSpeakingChanged,t))}setConnectionQuality(t){const n=this._connectionQuality;this._connectionQuality=function(t){switch(t){case $e.EXCELLENT:return e.ConnectionQuality.Excellent;case $e.GOOD:return e.ConnectionQuality.Good;case $e.POOR:return e.ConnectionQuality.Poor;case $e.LOST:return e.ConnectionQuality.Lost;default:return e.ConnectionQuality.Unknown}}(t),n!==this._connectionQuality&&this.emit(e.ParticipantEvent.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach((t=>(t.track instanceof os||t.track instanceof Ia)&&t.track.setAudioContext(e)))}addTrackPublication(t){t.on(e.TrackEvent.Muted,(()=>{this.emit(e.ParticipantEvent.TrackMuted,t)})),t.on(e.TrackEvent.Unmuted,(()=>{this.emit(e.ParticipantEvent.TrackUnmuted,t)}));const n=t;switch(n.track&&(n.track.sid=t.trackSid),this.trackPublications.set(t.trackSid,t),t.kind){case Yr.Kind.Audio:this.audioTrackPublications.set(t.trackSid,t);break;case Yr.Kind.Video:this.videoTrackPublications.set(t.trackSid,t)}}}class ps extends hs{constructor(e,t,n,i){super(e,t,void 0,void 0,{loggerName:i.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=lt.NONE,this.enabledPublishVideoCodecs=[],this.rpcHandlers=new Map,this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Bo)},this.handleReconnected=()=>{var e,t;null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var e,t;this.reconnectFuture&&(this.reconnectFuture.promise.catch((e=>this.log.warn(e.message,this.logContext))),null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.reject)||void 0===t||t.call(e,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.handleSignalRequestResponse=e=>{const{requestId:t,reason:n,message:i}=e,r=this.pendingSignalRequests.get(t);r&&(n!==Nn.OK&&r.reject(new _r(i,n)),this.pendingSignalRequests.delete(t))},this.handleDataPacket=e=>{switch(e.value.case){case"rpcRequest":let t=e.value.value;this.handleIncomingRpcRequest(e.participantIdentity,t.id,t.method,t.payload,t.responseTimeoutMs,t.version);break;case"rpcResponse":let n=e.value.value,i=null,r=null;"payload"===n.value.case?i=n.value.value:"error"===n.value.case&&(r=ts.fromProto(n.value.value)),this.handleIncomingRpcResponse(n.requestId,i,r);break;case"rpcAck":let o=e.value.value;this.handleIncomingRpcAck(o.requestId)}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map((e=>function(e){var t,n,i;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new kn({participantIdentity:null!==(t=e.participantIdentity)&&void 0!==t?t:"",participantSid:null!==(n=e.participantSid)&&void 0!==n?n:"",allTracks:null!==(i=e.allowAll)&&void 0!==i&&i,trackSids:e.allowedTrackSids||[]})}(e))))},this.onTrackUnmuted=e=>{this.onTrackMuted(e,e.isUpstreamPaused)},this.onTrackMuted=(e,t)=>{void 0===t&&(t=!0),e.sid?this.engine.updateMuteStatus(e.sid,t):this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),so(e)))},this.onTrackUpstreamPaused=e=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),so(e))),this.onTrackMuted(e,!0)},this.onTrackUpstreamResumed=e=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),so(e))),this.onTrackMuted(e,e.isMuted)},this.onTrackFeatureUpdate=e=>{const t=this.audioTrackPublications.get(e.sid);t?this.engine.client.sendUpdateLocalAudioTrack(t.trackSid,t.getTrackFeatures()):this.log.warn("Could not update local audio track settings, missing publication for track ".concat(e.sid),this.logContext)},this.handleSubscribedQualityUpdate=e=>Qn(this,void 0,void 0,(function*(){var t,n,i,r,o,a;if(!(null===(o=this.roomOptions)||void 0===o?void 0:o.dynacast))return;const s=this.videoTrackPublications.get(e.trackSid);if(s)if(e.subscribedCodecs.length>0){if(!s.videoTrack)return;const o=yield s.videoTrack.setPublishingCodecs(e.subscribedCodecs);try{for(var c,l=!0,d=Yn(o);!(t=(c=yield d.next()).done);l=!0){r=c.value,l=!1;const e=r;Wr(e)&&(this.log.debug("publish ".concat(e," for ").concat(s.videoTrack.sid),Object.assign(Object.assign({},this.logContext),so(s))),yield this.publishAdditionalCodecForTrack(s.videoTrack,e,s.options))}}catch(e){n={error:e}}finally{try{l||t||!(i=d.return)||(yield i.call(d))}finally{if(n)throw n.error}}}else e.subscribedQualities.length>0&&(yield null===(a=s.videoTrack)||void 0===a?void 0:a.setPublishingLayers(e.subscribedQualities));else this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))})),this.handleLocalTrackUnpublished=e=>{const t=this.trackPublications.get(e.trackSid);t?this.unpublishTrack(t.track):this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))},this.handleTrackEnded=e=>Qn(this,void 0,void 0,(function*(){if(e.source===Yr.Source.ScreenShare||e.source===Yr.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),so(e))),this.unpublishTrack(e);else if(e.isUserProvided)yield e.mute();else if(e instanceof Ia||e instanceof qa)try{if(Co())try{const t=yield null===navigator||void 0===navigator?void 0:navigator.permissions.query({name:e.source===Yr.Source.Camera?"camera":"microphone"});if(t&&"denied"===t.state)throw this.log.warn("user has revoked access to ".concat(e.source),Object.assign(Object.assign({},this.logContext),so(e))),t.onchange=()=>{"denied"!==t.state&&(e.isMuted||e.restartTrack(),t.onchange=null)},new Error("GetUserMedia Permission denied")}catch(e){}e.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),so(e))),e instanceof Ia?yield e.restartTrack({deviceId:"default"}):yield e.restartTrack())}catch(t){this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),so(e))),yield e.mute()}})),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=n,this.roomOptions=i,this.setupEngine(n),this.activeDeviceMap=new Map,this.pendingSignalRequests=new Map}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==lt.NONE}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setupEngine(t){this.engine=t,this.engine.on(e.EngineEvent.RemoteMute,((e,t)=>{const n=this.trackPublications.get(e);n&&n.track&&(t?n.mute():n.unmute())})),this.engine.on(e.EngineEvent.Connected,this.handleReconnected).on(e.EngineEvent.SignalRestarted,this.handleReconnected).on(e.EngineEvent.SignalResumed,this.handleReconnected).on(e.EngineEvent.Restarting,this.handleReconnecting).on(e.EngineEvent.Resuming,this.handleReconnecting).on(e.EngineEvent.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(e.EngineEvent.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(e.EngineEvent.Disconnected,this.handleDisconnected).on(e.EngineEvent.SignalRequestResponse,this.handleSignalRequestResponse).on(e.EngineEvent.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return Qn(this,void 0,void 0,(function*(){yield this.requestMetadataUpdate({metadata:e})}))}setName(e){return Qn(this,void 0,void 0,(function*(){yield this.requestMetadataUpdate({name:e})}))}setAttributes(e){return Qn(this,void 0,void 0,(function*(){yield this.requestMetadataUpdate({attributes:e})}))}requestMetadataUpdate(e){return Qn(this,arguments,void 0,(function(e){var t=this;let{metadata:n,name:i,attributes:r}=e;return function*(){return new Promise(((e,o)=>Qn(t,void 0,void 0,(function*(){var t,a;try{let s=!1;const c=yield this.engine.client.sendUpdateLocalMetadata(null!==(t=null!=n?n:this.metadata)&&void 0!==t?t:"",null!==(a=null!=i?i:this.name)&&void 0!==a?a:"",r),l=performance.now();for(this.pendingSignalRequests.set(c,{resolve:e,reject:e=>{o(e),s=!0},values:{name:i,metadata:n,attributes:r}});performance.now()-l<5e3&&!s;){if((!i||this.name===i)&&(!n||this.metadata===n)&&(!r||Object.entries(r).every((e=>{let[t,n]=e;return this.attributes[t]===n||""===n&&!this.attributes[t]}))))return this.pendingSignalRequests.delete(c),void e();yield uo(50)}o(new _r("Request to update local metadata timed out","TimeoutError"))}catch(e){e instanceof Error&&o(e)}}))))}()}))}setCameraEnabled(e,t,n){return this.setTrackEnabled(Yr.Source.Camera,e,t,n)}setMicrophoneEnabled(e,t,n){return this.setTrackEnabled(Yr.Source.Microphone,e,t,n)}setScreenShareEnabled(e,t,n){return this.setTrackEnabled(Yr.Source.ScreenShare,e,t,n)}setPermissions(t){const n=this.permissions,i=super.setPermissions(t);return i&&n&&this.emit(e.ParticipantEvent.ParticipantPermissionsChanged,n),i}setE2EEEnabled(e){return Qn(this,void 0,void 0,(function*(){this.encryptionType=e?lt.GCM:lt.NONE,yield this.republishAllTracks(void 0,!1)}))}setTrackEnabled(t,n,i,r){return Qn(this,void 0,void 0,(function*(){var o,a;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:t,enabled:n})),this.republishPromise&&(yield this.republishPromise);let s=this.getTrackPublication(t);if(n)if(s)yield s.unmute();else{let n;if(this.pendingPublishing.has(t)){const e=yield this.waitForPendingPublicationOfSource(t);return e||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:t})),yield null==e?void 0:e.unmute(),e}this.pendingPublishing.add(t);try{switch(t){case Yr.Source.Camera:n=yield this.createTracks({video:null===(o=i)||void 0===o||o});break;case Yr.Source.Microphone:n=yield this.createTracks({audio:null===(a=i)||void 0===a||a});break;case Yr.Source.ScreenShare:n=yield this.createScreenTracks(Object.assign({},i));break;default:throw new Rr(t)}const e=[];for(const t of n)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),so(t))),e.push(this.publishTrack(t,r));const c=yield Promise.all(e);[s]=c}catch(t){throw null==n||n.forEach((e=>{e.stop()})),t instanceof Error&&!(t instanceof Rr)&&this.emit(e.ParticipantEvent.MediaDevicesError,t),t}finally{this.pendingPublishing.delete(t)}}else if(!(null==s?void 0:s.track)&&this.pendingPublishing.has(t)&&(s=yield this.waitForPendingPublicationOfSource(t),s||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:t}))),s&&s.track)if(t===Yr.Source.ScreenShare){s=yield this.unpublishTrack(s.track);const e=this.getTrackPublication(Yr.Source.ScreenShareAudio);e&&e.track&&this.unpublishTrack(e.track)}else yield s.mute();return s}))}enableCameraAndMicrophone(){return Qn(this,void 0,void 0,(function*(){if(!this.pendingPublishing.has(Yr.Source.Camera)&&!this.pendingPublishing.has(Yr.Source.Microphone)){this.pendingPublishing.add(Yr.Source.Camera),this.pendingPublishing.add(Yr.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map((e=>this.publishTrack(e))))}finally{this.pendingPublishing.delete(Yr.Source.Camera),this.pendingPublishing.delete(Yr.Source.Microphone)}}}))}createTracks(t){return Qn(this,void 0,void 0,(function*(){var n,i;null!=t||(t={});const{audioProcessor:r,videoProcessor:o,optionsWithoutProcessor:a}=co(t),s=Zr(a,null===(n=this.roomOptions)||void 0===n?void 0:n.audioCaptureDefaults,null===(i=this.roomOptions)||void 0===i?void 0:i.videoCaptureDefaults),c=to(s);let l;try{l=yield navigator.mediaDevices.getUserMedia(c)}catch(e){throw e instanceof Error&&(c.audio&&(this.microphoneError=e),c.video&&(this.cameraError=e)),e}return c.audio&&(this.microphoneError=void 0,this.emit(e.ParticipantEvent.AudioStreamAcquired)),c.video&&(this.cameraError=void 0),Promise.all(l.getTracks().map((e=>Qn(this,void 0,void 0,(function*(){const t="audio"===e.kind;let n;t?s.audio:s.video;const i=t?c.audio:c.video;"boolean"!=typeof i&&(n=i);const a=Oa(e,n,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return a.kind===Yr.Kind.Video?a.source=Yr.Source.Camera:a.kind===Yr.Kind.Audio&&(a.source=Yr.Source.Microphone,a.setAudioContext(this.audioContext)),a.mediaStream=l,a instanceof Ia&&r?yield a.setProcessor(r):a instanceof qa&&o&&(yield a.setProcessor(o)),a})))))}))}createScreenTracks(t){return Qn(this,void 0,void 0,(function*(){if(void 0===t&&(t={}),void 0===navigator.mediaDevices.getDisplayMedia)throw new Pr("getDisplayMedia not supported");void 0!==t.resolution||To()||(t.resolution=Qr.h1080fps30.resolution);const n=ro(t),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(0===r.length)throw new Rr("no video track found");const o=new qa(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});o.source=Yr.Source.ScreenShare,t.contentHint&&(o.mediaStreamTrack.contentHint=t.contentHint);const a=[o];if(i.getAudioTracks().length>0){this.emit(e.ParticipantEvent.AudioStreamAcquired);const t=new Ia(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});t.source=Yr.Source.ScreenShareAudio,a.push(t)}return a}))}publishTrack(e,t){return Qn(this,void 0,void 0,(function*(){return this.publishOrRepublishTrack(e,t)}))}publishOrRepublishTrack(e,t){return Qn(this,arguments,void 0,(function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function*(){var r,o,a,s;let c,l;if(e instanceof Ia&&e.setAudioContext(n.audioContext),yield null===(r=n.reconnectFuture)||void 0===r?void 0:r.promise,n.republishPromise&&!i&&(yield n.republishPromise),e instanceof Ho&&n.pendingPublishPromises.has(e)&&(yield n.pendingPublishPromises.get(e)),e instanceof MediaStreamTrack)c=e.getConstraints();else{let t;switch(c=e.constraints,e.source){case Yr.Source.Microphone:t="audioinput";break;case Yr.Source.Camera:t="videoinput"}t&&n.activeDeviceMap.has(t)&&(c=Object.assign(Object.assign({},c),{deviceId:n.activeDeviceMap.get(t)}))}if(e instanceof MediaStreamTrack)switch(e.kind){case"audio":e=new Ia(e,c,!0,n.audioContext,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;case"video":e=new qa(e,c,!0,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;default:throw new Rr("unsupported MediaStreamTrack kind ".concat(e.kind))}else e.updateLoggerOptions({loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});if(n.trackPublications.forEach((t=>{t.track&&t.track===e&&(l=t)})),l)return n.log.warn("track has already been published, skipping",Object.assign(Object.assign({},n.logContext),so(l))),l;const d="channelCount"in e.mediaStreamTrack.getSettings()&&2===e.mediaStreamTrack.getSettings().channelCount||2===e.mediaStreamTrack.getConstraints().channelCount,u=null!==(o=null==t?void 0:t.forceStereo)&&void 0!==o?o:d;u&&(t||(t={}),void 0===t.dtx&&n.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},n.logContext),so(e))),void 0===t.red&&n.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),null!==(a=t.dtx)&&void 0!==a||(t.dtx=!1),null!==(s=t.red)&&void 0!==s||(t.red=!1));const h=Object.assign(Object.assign({},n.roomOptions.publishDefaults),t);!function(){const e=Ar(),t="17.2";if(e)return"Safari"!==e.name&&"iOS"!==e.os||!!("iOS"===e.os&&e.osVersion&&Oo(t,e.osVersion)>=0)||"Safari"===e.name&&Oo(t,e.version)>=0}()&&n.roomOptions.e2ee&&(n.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},n.logContext)),h.simulcast=!1),h.source&&(e.source=h.source);const p=n.publish(e,h,u);n.pendingPublishPromises.set(e,p);try{return yield p}catch(e){throw e}finally{n.pendingPublishPromises.delete(e)}}()}))}publish(t,n,i){return Qn(this,void 0,void 0,(function*(){var r,o,a,s,c,l,d,u,h,p;Array.from(this.trackPublications.values()).find((e=>t instanceof Ho&&e.source===t.source))&&t.source!==Yr.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(t.source),Object.assign(Object.assign({},this.logContext),so(t))),n.stopMicTrackOnMute&&t instanceof Ia&&(t.stopOnMute=!0),t.source===Yr.Source.ScreenShare&&yo()&&(n.simulcast=!1),"av1"!==n.videoCodec||mo()||(n.videoCodec=void 0),"vp9"!==n.videoCodec||fo()||(n.videoCodec=void 0),void 0===n.videoCodec&&(n.videoCodec=ba),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some((e=>n.videoCodec===oo(e.mime)))||(n.videoCodec=oo(this.enabledPublishVideoCodecs[0].mime)));const m=n.videoCodec;t.on(e.TrackEvent.Muted,this.onTrackMuted),t.on(e.TrackEvent.Unmuted,this.onTrackUnmuted),t.on(e.TrackEvent.Ended,this.handleTrackEnded),t.on(e.TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.on(e.TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),t.on(e.TrackEvent.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const f=new Ht({cid:t.mediaStreamTrack.id,name:n.name,type:Yr.kindToProto(t.kind),muted:t.isMuted,source:Yr.sourceToProto(t.source),disableDtx:!(null===(r=n.dtx)||void 0===r||r),encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(null===(o=n.red)||void 0===o||o),stream:null==n?void 0:n.stream});let g;if(t.kind===Yr.Kind.Video){let e={width:0,height:0};try{e=yield t.waitForDimensions()}catch(n){const r=null!==(s=null===(a=this.roomOptions.videoCaptureDefaults)||void 0===a?void 0:a.resolution)&&void 0!==s?s:Hr.h720.resolution;e={width:r.width,height:r.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),so(t)),{dims:e}))}f.width=e.width,f.height=e.height,t instanceof qa&&(go(m)&&(t.source===Yr.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in t.mediaStreamTrack&&(t.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),so(t))))),n.scalabilityMode=null!==(c=n.scalabilityMode)&&void 0!==c?c:"L3T3_KEY"),f.simulcastCodecs=[new Kt({codec:m,cid:t.mediaStreamTrack.id})],!0===n.backupCodec&&(n.backupCodec={codec:ba}),n.backupCodec&&m!==n.backupCodec.codec&&f.encryption===lt.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),f.simulcastCodecs.push(new Kt({codec:n.backupCodec.codec,cid:""})))),g=Ua(t.source===Yr.Source.ScreenShare,f.width,f.height,n),f.layers=Ka(f.width,f.height,g,go(n.videoCodec))}else t.kind===Yr.Kind.Audio&&(g=[{maxBitrate:null===(l=n.audioPreset)||void 0===l?void 0:l.maxBitrate,priority:null!==(u=null===(d=n.audioPreset)||void 0===d?void 0:d.priority)&&void 0!==u?u:"high",networkPriority:null!==(p=null===(h=n.audioPreset)||void 0===h?void 0:h.priority)&&void 0!==p?p:"high"}]);if(!this.engine||this.engine.isClosed)throw new Or("cannot publish track when not connected");const v=()=>Qn(this,void 0,void 0,(function*(){var e,i,r;if(!this.engine.pcManager)throw new Or("pcManager is not ready");if(t.sender=yield this.engine.createSender(t,n,g),t instanceof qa&&(null!==(e=n.degradationPreference)&&void 0!==e||(n.degradationPreference=function(e){return e.source===Yr.Source.ScreenShare||e.constraints.height&&Vo(e.constraints.height)>=1080?"maintain-resolution":"balanced"}(t)),t.setDegradationPreference(n.degradationPreference)),g)if(yo()&&t.kind===Yr.Kind.Audio){let e;for(const n of this.engine.pcManager.publisher.getTransceivers())if(n.sender===t.sender){e=n;break}e&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:e,codec:"opus",maxbr:(null===(i=g[0])||void 0===i?void 0:i.maxBitrate)?g[0].maxBitrate/1e3:0})}else t.codec&&go(t.codec)&&(null===(r=g[0])||void 0===r?void 0:r.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:f.cid,codec:t.codec,maxbr:g[0].maxBitrate/1e3});yield this.engine.negotiate()}));let b;if(this.enabledPublishVideoCodecs.length>0)b=(yield Promise.all([this.engine.addTrack(f),v()]))[0];else{let e;if(b=yield this.engine.addTrack(f),b.codecs.forEach((t=>{void 0===e&&(e=t.mimeType)})),e&&t.kind===Yr.Kind.Video){const i=oo(e);i!==m&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),so(t)),{codec:i})),n.videoCodec=i,g=Ua(t.source===Yr.Source.ScreenShare,f.width,f.height,n))}yield v()}const y=new us(t.kind,b,t,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return y.options=n,t.sid=b.sid,this.log.debug("publishing ".concat(t.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:g,trackInfo:b})),t instanceof qa?t.startMonitor(this.engine.client):t instanceof Ia&&t.startMonitor(),this.addTrackPublication(y),this.emit(e.ParticipantEvent.LocalTrackPublished,y),y}))}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,n){return Qn(this,void 0,void 0,(function*(){var i;if(this.encryptionType!==lt.NONE)return;let r;if(this.trackPublications.forEach((t=>{t.track&&t.track===e&&(r=t)})),!r)throw new Rr("track is not published");if(!(e instanceof qa))throw new Rr("track is not a video track");const o=Object.assign(Object.assign({},null===(i=this.roomOptions)||void 0===i?void 0:i.publishDefaults),n),a=function(e,t,n){var i,r,o,a;if(!n.backupCodec||!0===n.backupCodec||n.backupCodec.codec===n.videoCodec)return;t!==n.backupCodec.codec&&Vn.warn("requested a different codec than specified as backup",{serverRequested:t,backup:n.backupCodec.codec}),n.videoCodec=t,n.videoEncoding=n.backupCodec.encoding;const s=e.mediaStreamTrack.getSettings(),c=null!==(i=s.width)&&void 0!==i?i:null===(r=e.dimensions)||void 0===r?void 0:r.width,l=null!==(o=s.height)&&void 0!==o?o:null===(a=e.dimensions)||void 0===a?void 0:a.height;return Ua(e.source===Yr.Source.ScreenShare,c,l,n)}(e,t,o);if(!a)return void this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),so(e)));const s=e.addSimulcastTrack(t,a);if(!s)return;const c=new Ht({cid:s.mediaStreamTrack.id,type:Yr.kindToProto(e.kind),muted:e.isMuted,source:Yr.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:s.mediaStreamTrack.id}]});if(c.layers=Ka(c.width,c.height,a),!this.engine||this.engine.isClosed)throw new Or("cannot publish track when not connected");const l=(yield Promise.all([this.engine.addTrack(c),(()=>Qn(this,void 0,void 0,(function*(){yield this.engine.createSimulcastSender(e,s,o,a),yield this.engine.negotiate()})))()]))[0];this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:l}))}))}unpublishTrack(t,n){return Qn(this,void 0,void 0,(function*(){var i,r;if(t instanceof Ho){const e=this.pendingPublishPromises.get(t);e&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),so(t))),yield e)}const o=this.getPublicationForTrack(t),a=o?so(o):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),a)),!o||!o.track)return void this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),a));(t=o.track).off(e.TrackEvent.Muted,this.onTrackMuted),t.off(e.TrackEvent.Unmuted,this.onTrackUnmuted),t.off(e.TrackEvent.Ended,this.handleTrackEnded),t.off(e.TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.off(e.TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),t.off(e.TrackEvent.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),void 0===n&&(n=null===(r=null===(i=this.roomOptions)||void 0===i?void 0:i.stopLocalTrackOnUnpublish)||void 0===r||r),n&&t.stop();let s=!1;const c=t.sender;if(t.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Ea.FAILED&&c)try{for(const e of this.engine.pcManager.publisher.getTransceivers())e.sender===c&&(e.direction="inactive",s=!0);if(this.engine.removeTrack(c)&&(s=!0),t instanceof qa){for(const[,e]of t.simulcastCodecs)e.sender&&(this.engine.removeTrack(e.sender)&&(s=!0),e.sender=void 0);t.simulcastCodecs.clear()}}catch(e){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),a),{error:e}))}switch(this.trackPublications.delete(o.trackSid),o.kind){case Yr.Kind.Audio:this.audioTrackPublications.delete(o.trackSid);break;case Yr.Kind.Video:this.videoTrackPublications.delete(o.trackSid)}return this.emit(e.ParticipantEvent.LocalTrackUnpublished,o),o.setTrack(void 0),s&&(yield this.engine.negotiate()),o}))}unpublishTracks(e){return Qn(this,void 0,void 0,(function*(){return(yield Promise.all(e.map((e=>this.unpublishTrack(e))))).filter((e=>e instanceof us))}))}republishAllTracks(e){return Qn(this,arguments,void 0,(function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){t.republishPromise&&(yield t.republishPromise),t.republishPromise=new Promise(((i,r)=>Qn(t,void 0,void 0,(function*(){try{const t=[];this.trackPublications.forEach((n=>{n.track&&(e&&(n.options=Object.assign(Object.assign({},n.options),e)),t.push(n))})),yield Promise.all(t.map((e=>Qn(this,void 0,void 0,(function*(){const t=e.track;yield this.unpublishTrack(t,!1),n&&!t.isMuted&&t.source!==Yr.Source.ScreenShare&&t.source!==Yr.Source.ScreenShareAudio&&(t instanceof Ia||t instanceof qa)&&!t.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:e.trackSid})),yield t.restartTrack()),yield this.publishOrRepublishTrack(t,e.options,!0)}))))),i()}catch(e){r(e)}finally{this.republishPromise=void 0}})))),yield t.republishPromise}()}))}publishData(e){return Qn(this,arguments,void 0,(function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){const i=n.reliable?mt.RELIABLE:mt.LOSSY,r=n.destinationIdentities,o=n.topic,a=new pt({kind:i,value:{case:"user",value:new vt({participantIdentity:t.identity,payload:e,destinationIdentities:r,topic:o})}});yield t.engine.sendDataPacket(a,i)}()}))}publishDtmf(e,t){return Qn(this,void 0,void 0,(function*(){const n=new pt({kind:mt.RELIABLE,value:{case:"sipDtmf",value:new bt({code:e,digit:t})}});yield this.engine.sendDataPacket(n,mt.RELIABLE)}))}sendChatMessage(t){return Qn(this,void 0,void 0,(function*(){const n={id:crypto.randomUUID(),message:t,timestamp:Date.now()},i=new pt({value:{case:"chatMessage",value:new Tt(Object.assign(Object.assign({},n),{timestamp:N.parse(n.timestamp)}))}});return yield this.engine.sendDataPacket(i,mt.RELIABLE),this.emit(e.ParticipantEvent.ChatMessage,n),n}))}editChatMessage(t,n){return Qn(this,void 0,void 0,(function*(){const i=Object.assign(Object.assign({},n),{message:t,editTimestamp:Date.now()}),r=new pt({value:{case:"chatMessage",value:new Tt(Object.assign(Object.assign({},i),{timestamp:N.parse(i.timestamp),editTimestamp:N.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,mt.RELIABLE),this.emit(e.ParticipantEvent.ChatMessage,i),i}))}performRpc(e){return Qn(this,arguments,void 0,(function(e){var t=this;let{destinationIdentity:n,method:i,payload:r,responseTimeout:o=1e4}=e;return function*(){return new Promise(((e,a)=>Qn(t,void 0,void 0,(function*(){var t,s,c,l;if(ns(r)>15360)return void a(ts.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));if((null===(s=null===(t=this.engine.latestJoinResponse)||void 0===t?void 0:t.serverInfo)||void 0===s?void 0:s.version)&&Oo(null===(l=null===(c=this.engine.latestJoinResponse)||void 0===c?void 0:c.serverInfo)||void 0===l?void 0:l.version,"1.8.0")<0)return void a(ts.builtIn("UNSUPPORTED_SERVER"));const d=crypto.randomUUID();yield this.publishRpcRequest(n,d,i,r,o-2e3);const u=setTimeout((()=>{this.pendingAcks.delete(d),a(ts.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(d),clearTimeout(h)}),2e3);this.pendingAcks.set(d,{resolve:()=>{clearTimeout(u)},participantIdentity:n});const h=setTimeout((()=>{this.pendingResponses.delete(d),a(ts.builtIn("RESPONSE_TIMEOUT"))}),o);this.pendingResponses.set(d,{resolve:(t,n)=>{clearTimeout(h),this.pendingAcks.has(d)&&(console.warn("RPC response received before ack",d),this.pendingAcks.delete(d),clearTimeout(u)),n?a(n):e(null!=t?t:"")},participantIdentity:n})}))))}()}))}registerRpcMethod(e,t){this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const t=this.pendingAcks.get(e);t?(t.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,t,n){const i=this.pendingResponses.get(e);i?(i.resolve(t,n),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}handleIncomingRpcRequest(e,t,n,i,r,o){return Qn(this,void 0,void 0,(function*(){if(yield this.publishRpcAck(e,t),1!==o)return void(yield this.publishRpcResponse(e,t,null,ts.builtIn("UNSUPPORTED_VERSION")));const a=this.rpcHandlers.get(n);if(!a)return void(yield this.publishRpcResponse(e,t,null,ts.builtIn("UNSUPPORTED_METHOD")));let s=null,c=null;try{const o=yield a({requestId:t,callerIdentity:e,payload:i,responseTimeout:r});ns(o)>15360?(s=ts.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(n))):c=o}catch(e){e instanceof ts?s=e:(console.warn("Uncaught error returned by RPC handler for ".concat(n,". Returning APPLICATION_ERROR instead."),e),s=ts.builtIn("APPLICATION_ERROR"))}yield this.publishRpcResponse(e,t,c,s)}))}publishRpcRequest(e,t,n,i,r){return Qn(this,void 0,void 0,(function*(){const o=new pt({destinationIdentities:[e],kind:mt.RELIABLE,value:{case:"rpcRequest",value:new St({id:t,method:n,payload:i,responseTimeoutMs:r,version:1})}});yield this.engine.sendDataPacket(o,mt.RELIABLE)}))}publishRpcResponse(e,t,n,i){return Qn(this,void 0,void 0,(function*(){const r=new pt({destinationIdentities:[e],kind:mt.RELIABLE,value:{case:"rpcResponse",value:new Et({requestId:t,value:i?{case:"error",value:i.toProto()}:{case:"payload",value:null!=n?n:""}})}});yield this.engine.sendDataPacket(r,mt.RELIABLE)}))}publishRpcAck(e,t){return Qn(this,void 0,void 0,(function*(){const n=new pt({destinationIdentities:[e],kind:mt.RELIABLE,value:{case:"rpcAck",value:new Ct({requestId:t})}});yield this.engine.sendDataPacket(n,mt.RELIABLE)}))}handleParticipantDisconnected(e){for(const[t,{participantIdentity:n}]of this.pendingAcks)n===e&&this.pendingAcks.delete(t);for(const[t,{participantIdentity:n,resolve:i}]of this.pendingResponses)n===e&&(i(null,ts.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(t))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter((e=>"video"===e.mime.split("/")[0].toLowerCase()))}updateInfo(e){return e.sid===this.sid&&!!super.updateInfo(e)&&(e.tracks.forEach((e=>{var t,n;const i=this.trackPublications.get(e.sid);if(i){const r=i.isMuted||null!==(n=null===(t=i.track)||void 0===t?void 0:t.isUpstreamPaused)&&void 0!==n&&n;r!==e.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),so(i)),{mutedOnServer:r})),this.engine.client.sendMuteTrack(e.sid,r))}})),!0)}getPublicationForTrack(e){let t;return this.trackPublications.forEach((n=>{const i=n.track;i&&(e instanceof MediaStreamTrack?(i instanceof Ia||i instanceof qa)&&i.mediaStreamTrack===e&&(t=n):e===i&&(t=n))})),t}waitForPendingPublicationOfSource(e){return Qn(this,void 0,void 0,(function*(){const t=Date.now();for(;Date.now()<t+1e4;){const t=Array.from(this.pendingPublishPromises.entries()).find((t=>{let[n]=t;return n.source===e}));if(t)return t[1];yield uo(20)}}))}}class ms extends ds{constructor(t,n,i,r){super(t,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=e.VideoQuality.HIGH,this.handleEnded=t=>{this.setTrack(void 0),this.emit(e.TrackEvent.Ended,t)},this.handleVisibilityChange=e=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(e),this.logContext),this.disabled=!e,this.emitTrackUpdate()},this.handleVideoDimensionsChange=e=>{this.log.debug("adaptivestream video dimensions ".concat(e.width,"x").concat(e.height),this.logContext),this.videoDimensions=e,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(t){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=t,t&&(this.allowed=!0);const r=new tn({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new Pt({participantSid:"",trackSids:[this.trackSid]})]});this.emit(e.TrackEvent.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return!1===this.subscribed?ds.SubscriptionStatus.Unsubscribed:super.isSubscribed?ds.SubscriptionStatus.Subscribed:ds.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?ds.PermissionStatus.Allowed:ds.PermissionStatus.NotAllowed}get isSubscribed(){return!1!==this.subscribed&&super.isSubscribed}get isDesired(){return!1!==this.subscribed}get isEnabled(){return!this.disabled}setEnabled(e){this.isManualOperationAllowed()&&this.disabled!==!e&&(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){this.isManualOperationAllowed()&&this.currentVideoQuality!==e&&(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,n;this.isManualOperationAllowed()&&((null===(t=this.videoDimensions)||void 0===t?void 0:t.width)===e.width&&(null===(n=this.videoDimensions)||void 0===n?void 0:n.height)===e.height||(this.track instanceof as&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&this.track instanceof as&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(t){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==t&&(r&&(r.off(e.TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(e.TrackEvent.VisibilityChanged,this.handleVisibilityChange),r.off(e.TrackEvent.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(e.TrackEvent.Unsubscribed,r)),super.setTrack(t),t&&(t.sid=this.trackSid,t.on(e.TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),t.on(e.TrackEvent.VisibilityChanged,this.handleVisibilityChange),t.on(e.TrackEvent.Ended,this.handleEnded),this.emit(e.TrackEvent.Subscribed,t)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(t){this.emit(e.TrackEvent.SubscriptionFailed,t)}updateInfo(t){super.updateInfo(t);const n=this.metadataMuted;this.metadataMuted=t.muted,this.track?this.track.setMuted(t.muted):n!==t.muted&&this.emit(t.muted?e.TrackEvent.Muted:e.TrackEvent.Unmuted)}emitSubscriptionUpdateIfChanged(t){const n=this.subscriptionStatus;t!==n&&this.emit(e.TrackEvent.SubscriptionStatusChanged,n,t)}emitPermissionUpdateIfChanged(t){this.permissionStatus!==t&&this.emit(e.TrackEvent.SubscriptionPermissionChanged,this.permissionStatus,t)}isManualOperationAllowed(){return this.kind===Yr.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):!!this.isDesired||(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return this.track instanceof as&&this.track.isAdaptiveStream}emitTrackUpdate(){const t=new nn({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(t.width=Math.ceil(this.videoDimensions.width),t.height=Math.ceil(this.videoDimensions.height)):void 0!==this.currentVideoQuality?t.quality=this.currentVideoQuality:t.quality=e.VideoQuality.HIGH,this.emit(e.TrackEvent.UpdateSettings,t)}}class fs extends hs{static fromParticipantInfo(e,t,n){return new fs(e,t.sid,t.identity,t.name,t.metadata,n,t.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,t,n,i,r,o){super(t,n||"",i,r,o,arguments.length>6&&void 0!==arguments[6]?arguments[6]:ct.STANDARD),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(t){super.addTrackPublication(t),t.on(e.TrackEvent.UpdateSettings,(e=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),so(t))),this.signalClient.sendUpdateTrackSettings(e)})),t.on(e.TrackEvent.UpdateSubscription,(e=>{e.participantTracks.forEach((e=>{e.participantSid=this.sid})),this.signalClient.sendUpdateSubscription(e)})),t.on(e.TrackEvent.SubscriptionPermissionChanged,(n=>{this.emit(e.ParticipantEvent.TrackSubscriptionPermissionChanged,t,n)})),t.on(e.TrackEvent.SubscriptionStatusChanged,(n=>{this.emit(e.ParticipantEvent.TrackSubscriptionStatusChanged,t,n)})),t.on(e.TrackEvent.Subscribed,(n=>{this.emit(e.ParticipantEvent.TrackSubscribed,n,t)})),t.on(e.TrackEvent.Unsubscribed,(n=>{this.emit(e.ParticipantEvent.TrackUnsubscribed,n,t)})),t.on(e.TrackEvent.SubscriptionFailed,(n=>{this.emit(e.ParticipantEvent.TrackSubscriptionFailed,t.trackSid,n)}))}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yr.Source.Microphone;this.volumeMap.set(t,e);const n=this.getTrackPublication(t);n&&n.track&&n.track.setVolume(e)}getVolume(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yr.Source.Microphone;const t=this.getTrackPublication(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(t,n,i,r,o,a){let s,c=this.getTrackPublicationBySid(n);return c||n.startsWith("TR")||this.trackPublications.forEach((e=>{c||t.kind!==e.kind.toString()||(c=e)})),c?"ended"===t.readyState?(this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),so(c))),void this.emit(e.ParticipantEvent.TrackSubscriptionFailed,n)):(s="video"===t.kind?new as(t,n,r,o):new os(t,n,r,this.audioContext,this.audioOutput),s.source=c.source,s.isMuted=c.isMuted,s.setMediaStream(i),s.start(),c.setTrack(s),this.volumeMap.has(c.source)&&s instanceof os&&s.setVolume(this.volumeMap.get(c.source)),c):0===a?(this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),void this.emit(e.ParticipantEvent.TrackSubscriptionFailed,n)):(void 0===a&&(a=20),void setTimeout((()=>{this.addSubscribedMediaTrack(t,n,i,r,o,a-1)}),150))}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(t){if(!super.updateInfo(t))return!1;const n=new Map,i=new Map;return t.tracks.forEach((e=>{var t,r;let o=this.getTrackPublicationBySid(e.sid);if(o)o.updateInfo(e);else{const n=Yr.kindFromProto(e.type);if(!n)return;o=new ms(n,e,null===(t=this.signalClient.connectOptions)||void 0===t?void 0:t.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:null===(r=this.loggerOptions)||void 0===r?void 0:r.loggerName}),o.updateInfo(e),i.set(e.sid,o);const a=Array.from(this.trackPublications.values()).find((e=>e.source===(null==o?void 0:o.source)));a&&o.source!==Yr.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(o.source),Object.assign(Object.assign({},this.logContext),{oldTrack:so(a),newTrack:so(o)})),this.addTrackPublication(o)}n.set(e.sid,o)})),this.trackPublications.forEach((e=>{n.has(e.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),so(e))),this.unpublishTrack(e.trackSid,!0))})),i.forEach((t=>{this.emit(e.ParticipantEvent.TrackPublished,t)})),!0}unpublishTrack(t,n){const i=this.trackPublications.get(t);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(t),i.kind){case Yr.Kind.Audio:this.audioTrackPublications.delete(t);break;case Yr.Kind.Video:this.videoTrackPublications.delete(t)}n&&this.emit(e.ParticipantEvent.TrackUnpublished,i)}setAudioOutput(e){return Qn(this,void 0,void 0,(function*(){this.audioOutput=e;const t=[];this.audioTrackPublications.forEach((n=>{var i;n.track instanceof os&&t.push(n.track.setSinkId(null!==(i=e.deviceId)&&void 0!==i?i:"default"))})),yield Promise.all(t)}))}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:n})),super.emit(e,...n)}}e.ConnectionState=void 0,(Ya=e.ConnectionState||(e.ConnectionState={})).Disconnected="disconnected",Ya.Connecting="connecting",Ya.Connected="connected",Ya.Reconnecting="reconnecting",Ya.SignalReconnecting="signalReconnecting";class gs extends Zn.EventEmitter{constructor(t){var n,i,r;super(),n=this,this.state=e.ConnectionState.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Vn,this.bufferedEvents=[],this.isResuming=!1,this.connect=(t,n,i)=>Qn(this,void 0,void 0,(function*(){var r;if(!bo())throw Eo()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const o=yield this.disconnectLock.lock();if(this.state===e.ConnectionState.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),o(),Promise.resolve();if(this.connectFuture)return o(),this.connectFuture.promise;this.setAndEmitConnectionState(e.ConnectionState.Connecting),(null===(r=this.regionUrlProvider)||void 0===r?void 0:r.getServerUrl().toString())!==t&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),wo(new URL(t))&&(void 0===this.regionUrlProvider?this.regionUrlProvider=new es(t,n):this.regionUrlProvider.updateToken(n),this.regionUrlProvider.fetchRegionSettings().then((e=>{var t;null===(t=this.regionUrlProvider)||void 0===t||t.setServerReportedRegions(e)})).catch((e=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:e}))})));const a=(r,s,c)=>Qn(this,void 0,void 0,(function*(){var l,d;this.abortController&&this.abortController.abort();const u=new AbortController;this.abortController=u,null==o||o();try{yield this.attemptConnection(null!=c?c:t,n,i,u),this.abortController=void 0,r()}catch(t){if(this.regionUrlProvider&&t instanceof wr&&t.reason!==e.ConnectionErrorReason.Cancelled&&t.reason!==e.ConnectionErrorReason.NotAllowed){let i=null;try{i=yield this.regionUrlProvider.getNextBestRegionUrl(null===(l=this.abortController)||void 0===l?void 0:l.signal)}catch(t){if(t instanceof wr&&(401===t.status||t.reason===e.ConnectionErrorReason.Cancelled))return this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),void s(t)}i&&!(null===(d=this.abortController)||void 0===d?void 0:d.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(t.message,". Retrying with another region: ").concat(i),this.logContext),this.recreateEngine(),yield a(r,s,i)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,zo(t)),s(t))}else{let e=Ze.UNKNOWN_REASON;t instanceof wr&&(e=zo(t)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e),s(t)}}})),s=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Bo(((e,t)=>{a(e,t,s)}),(()=>{this.clearConnectionFutures()})),this.connectFuture.promise})),this.connectSignal=(e,t,n,i,r,o)=>Qn(this,void 0,void 0,(function*(){var a,s,c;const l=yield n.join(e,t,{autoSubscribe:i.autoSubscribe,adaptiveStream:"object"==typeof r.adaptiveStream||r.adaptiveStream,maxRetries:i.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:i.websocketTimeout},o.signal);let d=l.serverInfo;if(d||(d={version:l.serverVersion,region:l.serverRegion}),this.serverInfo=d,this.log.debug("connected to Livekit Server ".concat(Object.entries(d).map((e=>{let[t,n]=e;return"".concat(t,": ").concat(n)})).join(", ")),{room:null===(a=l.room)||void 0===a?void 0:a.name,roomSid:null===(s=l.room)||void 0===s?void 0:s.sid,identity:null===(c=l.participant)||void 0===c?void 0:c.identity}),!d.version)throw new Ir("unknown server version");return"0.15.1"===d.version&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),r.dynacast=!1),l})),this.applyJoinResponse=e=>{const t=e.participant;if(this.localParticipant.sid=t.sid,this.localParticipant.identity=t.identity,this.localParticipant.setEnabledPublishCodecs(e.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(e.sifTrailer)}catch(e){this.log.error(e instanceof Error?e.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:e}))}this.handleParticipantUpdates([t,...e.otherParticipants]),e.room&&this.handleRoomUpdate(e.room)},this.attemptConnection=(t,n,i,r)=>Qn(this,void 0,void 0,(function*(){var o,a,s;this.state===e.ConnectionState.Reconnecting||this.isResuming||(null===(o=this.engine)||void 0===o?void 0:o.pendingReconnect)?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),(null===(a=this.regionUrlProvider)||void 0===a?void 0:a.isCloud())&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Ca),i),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const i=yield this.connectSignal(t,n,this.engine,this.connOptions,this.options,r);this.applyJoinResponse(i),this.setupLocalParticipantEvents(),this.emit(e.RoomEvent.SignalConnected)}catch(t){yield this.engine.close(),this.recreateEngine();const i=new wr("could not establish signal connection",e.ConnectionErrorReason.ServerUnreachable);throw t instanceof Error&&(i.message="".concat(i.message,": ").concat(t.message)),t instanceof wr&&(i.reason=t.reason,i.status=t.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:t})),i}if(r.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new wr("Connection attempt aborted",e.ConnectionErrorReason.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,r)}catch(e){throw yield this.engine.close(),this.recreateEngine(),e}Co()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Co()&&(document.addEventListener("freeze",this.onPageLeave),null===(s=navigator.mediaDevices)||void 0===s||s.addEventListener("devicechange",this.handleDeviceChange)),this.setAndEmitConnectionState(e.ConnectionState.Connected),this.emit(e.RoomEvent.Connected),this.registerConnectionReconcile()})),this.disconnect=function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return Qn(n,[...i],void 0,(function(){var t=this;let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var i,r,o,a;const s=yield t.disconnectLock.lock();try{if(t.state===e.ConnectionState.Disconnected)return void t.log.debug("already disconnected",t.logContext);t.log.info("disconnect from room",Object.assign({},t.logContext)),(t.state===e.ConnectionState.Connecting||t.state===e.ConnectionState.Reconnecting||t.isResuming)&&(t.log.warn("abort connection attempt",t.logContext),null===(i=t.abortController)||void 0===i||i.abort(),null===(o=null===(r=t.connectFuture)||void 0===r?void 0:r.reject)||void 0===o||o.call(r,new wr("Client initiated disconnect",e.ConnectionErrorReason.Cancelled)),t.connectFuture=void 0),(null===(a=t.engine)||void 0===a?void 0:a.client.isDisconnected)||(yield t.engine.client.sendLeave()),t.engine&&(yield t.engine.close()),t.handleDisconnect(n,Ze.CLIENT_INITIATED),t.engine=void 0}finally{s()}}()}))},this.onPageLeave=()=>Qn(this,void 0,void 0,(function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()})),this.startAudio=()=>Qn(this,void 0,void 0,(function*(){const t=[],n=Ar();if(n&&"iOS"===n.os){const n="livekit-dummy-audio-el";let i=document.getElementById(n);if(!i){i=document.createElement("audio"),i.id=n,i.autoplay=!0,i.hidden=!0;const t=Fo();t.enabled=!0;const r=new MediaStream([t]);i.srcObject=r,document.addEventListener("visibilitychange",(()=>{i&&(i.srcObject=document.hidden?null:r,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))})),document.body.append(i),this.once(e.RoomEvent.Disconnected,(()=>{null==i||i.remove(),i=null}))}t.push(i)}this.remoteParticipants.forEach((e=>{e.audioTrackPublications.forEach((e=>{e.track&&e.track.attachedElements.forEach((e=>{t.push(e)}))}))}));try{yield Promise.all([this.acquireAudioContext(),...t.map((e=>(e.muted=!1,e.play())))]),this.handleAudioPlaybackStarted()}catch(e){throw this.handleAudioPlaybackFailed(e),e}})),this.startVideo=()=>Qn(this,void 0,void 0,(function*(){const e=[];for(const t of this.remoteParticipants.values())t.videoTrackPublications.forEach((t=>{var n;null===(n=t.track)||void 0===n||n.attachedElements.forEach((t=>{e.includes(t)||e.push(t)}))}));yield Promise.all(e.map((e=>e.play()))).then((()=>{this.handleVideoPlaybackStarted()})).catch((e=>{"NotAllowedError"===e.name?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)}))})),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const e of this.remoteParticipants.values())this.handleParticipantDisconnected(e.identity,e);this.setAndEmitConnectionState(e.ConnectionState.Reconnecting)&&this.emit(e.RoomEvent.Reconnecting)},this.handleSignalRestarted=t=>Qn(this,void 0,void 0,(function*(){this.log.debug("signal reconnected to server, region ".concat(t.serverRegion),Object.assign(Object.assign({},this.logContext),{region:t.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(t);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(e){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:e}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:t.serverRegion}))}catch(e){return}this.setAndEmitConnectionState(e.ConnectionState.Connected),this.emit(e.RoomEvent.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()})),this.handleParticipantUpdates=e=>{e.forEach((e=>{var t;if(e.identity===this.localParticipant.identity)return void this.localParticipant.updateInfo(e);""===e.identity&&(e.identity=null!==(t=this.sidToIdentity.get(e.sid))&&void 0!==t?t:"");let n=this.remoteParticipants.get(e.identity);e.state===st.DISCONNECTED?this.handleParticipantDisconnected(e.identity,n):n=this.getOrCreateParticipant(e.identity,e)}))},this.handleActiveSpeakersUpdate=t=>{const n=[],i={};t.forEach((e=>{if(i[e.sid]=!0,e.sid===this.localParticipant.sid)this.localParticipant.audioLevel=e.level,this.localParticipant.setIsSpeaking(!0),n.push(this.localParticipant);else{const t=this.getRemoteParticipantBySid(e.sid);t&&(t.audioLevel=e.level,t.setIsSpeaking(!0),n.push(t))}})),i[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach((e=>{i[e.sid]||(e.audioLevel=0,e.setIsSpeaking(!1))})),this.activeSpeakers=n,this.emitWhenConnected(e.RoomEvent.ActiveSpeakersChanged,n)},this.handleSpeakersChanged=t=>{const n=new Map;this.activeSpeakers.forEach((e=>{const t=this.remoteParticipants.get(e.identity);t&&t.sid!==e.sid||n.set(e.sid,e)})),t.forEach((e=>{let t=this.getRemoteParticipantBySid(e.sid);e.sid===this.localParticipant.sid&&(t=this.localParticipant),t&&(t.audioLevel=e.level,t.setIsSpeaking(e.active),e.active?n.set(e.sid,t):n.delete(e.sid))}));const i=Array.from(n.values());i.sort(((e,t)=>t.audioLevel-e.audioLevel)),this.activeSpeakers=i,this.emitWhenConnected(e.RoomEvent.ActiveSpeakersChanged,i)},this.handleStreamStateUpdate=t=>{t.streamStates.forEach((t=>{const n=this.getRemoteParticipantBySid(t.participantSid);if(!n)return;const i=n.getTrackPublicationBySid(t.trackSid);if(!i||!i.track)return;const r=Yr.streamStateFromProto(t.state);r!==i.track.streamState&&(i.track.streamState=r,n.emit(e.ParticipantEvent.TrackStreamStateChanged,i,i.track.streamState),this.emitWhenConnected(e.RoomEvent.TrackStreamStateChanged,i,i.track.streamState,n))}))},this.handleSubscriptionPermissionUpdate=e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setAllowed(e.allowed)},this.handleSubscriptionError=e=>{const t=Array.from(this.remoteParticipants.values()).find((t=>t.trackPublications.has(e.trackSid)));if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setSubscriptionError(e.err)},this.handleDataPacket=e=>{const t=this.remoteParticipants.get(e.participantIdentity);"user"===e.value.case?this.handleUserPacket(t,e.value.value,e.kind):"transcription"===e.value.case?this.handleTranscription(t,e.value.value):"sipDtmf"===e.value.case?this.handleSipDtmf(t,e.value.value):"chatMessage"===e.value.case?this.handleChatMessage(t,e.value.value):"metrics"===e.value.case&&this.handleMetrics(e.value.value,t)},this.handleUserPacket=(t,n,i)=>{this.emit(e.RoomEvent.DataReceived,n.payload,t,i,n.topic),null==t||t.emit(e.ParticipantEvent.DataReceived,n.payload,i)},this.handleSipDtmf=(t,n)=>{this.emit(e.RoomEvent.SipDTMFReceived,n,t),null==t||t.emit(e.ParticipantEvent.SipDTMFReceived,n)},this.bufferedSegments=new Map,this.handleTranscription=(t,n)=>{const i=n.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(n.transcribedParticipantIdentity),r=null==i?void 0:i.trackPublications.get(n.trackId),o=function(e,t){return e.segments.map((e=>{let{id:n,text:i,language:r,startTime:o,endTime:a,final:s}=e;var c;const l=null!==(c=t.get(n))&&void 0!==c?c:Date.now(),d=Date.now();return s?t.delete(n):t.set(n,l),{id:n,text:i,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:s,language:r,firstReceivedTime:l,lastReceivedTime:d}}))}(n,this.transcriptionReceivedTimes);null==r||r.emit(e.TrackEvent.TranscriptionReceived,o),null==i||i.emit(e.ParticipantEvent.TranscriptionReceived,o,r),this.emit(e.RoomEvent.TranscriptionReceived,o,i,r)},this.handleChatMessage=(t,n)=>{const i=function(e){const{id:t,timestamp:n,message:i,editTimestamp:r}=e;return{id:t,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}(n);this.emit(e.RoomEvent.ChatMessage,i,t)},this.handleMetrics=(t,n)=>{this.emit(e.RoomEvent.MetricsReceived,t,n)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(e.RoomEvent.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=t=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:t})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(e.RoomEvent.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(e.RoomEvent.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(e.RoomEvent.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>Qn(this,void 0,void 0,(function*(){const t=yield Ko.getInstance().getDevices(void 0,!1),n=["audiooutput"];for(let e of n){const n=t.filter((t=>t.kind===e));n.length>0&&!n.find((t=>t.deviceId===this.getActiveDevice(e)))&&(yield this.switchActiveDevice(e,n[0].deviceId))}this.emit(e.RoomEvent.MediaDevicesChanged)})),this.handleRoomUpdate=t=>{const n=this.roomInfo;this.roomInfo=t,n&&n.metadata!==t.metadata&&this.emitWhenConnected(e.RoomEvent.RoomMetadataChanged,t.metadata),(null==n?void 0:n.activeRecording)!==t.activeRecording&&this.emitWhenConnected(e.RoomEvent.RecordingStatusChanged,t.activeRecording)},this.handleConnectionQualityUpdate=e=>{e.updates.forEach((e=>{if(e.participantSid===this.localParticipant.sid)return void this.localParticipant.setConnectionQuality(e.quality);const t=this.getRemoteParticipantBySid(e.participantSid);t&&t.setConnectionQuality(e.quality)}))},this.onLocalParticipantMetadataChanged=t=>{this.emit(e.RoomEvent.ParticipantMetadataChanged,t,this.localParticipant)},this.onLocalParticipantNameChanged=t=>{this.emit(e.RoomEvent.ParticipantNameChanged,t,this.localParticipant)},this.onLocalAttributesChanged=t=>{this.emit(e.RoomEvent.ParticipantAttributesChanged,t,this.localParticipant)},this.onLocalTrackMuted=t=>{this.emit(e.RoomEvent.TrackMuted,t,this.localParticipant)},this.onLocalTrackUnmuted=t=>{this.emit(e.RoomEvent.TrackUnmuted,t,this.localParticipant)},this.onTrackProcessorUpdate=e=>{var t;null===(t=null==e?void 0:e.onPublish)||void 0===t||t.call(e,this)},this.onLocalTrackPublished=t=>Qn(this,void 0,void 0,(function*(){var n,i,r,o,a,s;null===(n=t.track)||void 0===n||n.on(e.TrackEvent.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(i=t.track)||void 0===i||i.on(e.TrackEvent.Restarted,this.onLocalTrackRestarted),null===(a=null===(o=null===(r=t.track)||void 0===r?void 0:r.getProcessor())||void 0===o?void 0:o.onPublish)||void 0===a||a.call(o,this),this.emit(e.RoomEvent.LocalTrackPublished,t,this.localParticipant),t.track instanceof Ia&&(yield t.track.checkForSilence())&&this.emit(e.RoomEvent.LocalAudioSilenceDetected,t);const c=yield null===(s=t.track)||void 0===s?void 0:s.getDeviceId(),l=io(t.source);l&&c&&c!==this.localParticipant.activeDeviceMap.get(l)&&(this.localParticipant.activeDeviceMap.set(l,c),this.emit(e.RoomEvent.ActiveDeviceChanged,l,c))})),this.onLocalTrackUnpublished=t=>{var n,i;null===(n=t.track)||void 0===n||n.off(e.TrackEvent.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(i=t.track)||void 0===i||i.off(e.TrackEvent.Restarted,this.onLocalTrackRestarted),this.emit(e.RoomEvent.LocalTrackUnpublished,t,this.localParticipant)},this.onLocalTrackRestarted=t=>Qn(this,void 0,void 0,(function*(){const n=yield t.getDeviceId(!1),i=io(t.source);i&&n&&n!==this.localParticipant.activeDeviceMap.get(i)&&(this.log.debug("local track restarted, setting ".concat(i," ").concat(n," active"),this.logContext),this.localParticipant.activeDeviceMap.set(i,n),this.emit(e.RoomEvent.ActiveDeviceChanged,i,n))})),this.onLocalConnectionQualityChanged=t=>{this.emit(e.RoomEvent.ConnectionQualityChanged,t,this.localParticipant)},this.onMediaDevicesError=t=>{this.emit(e.RoomEvent.MediaDevicesError,t)},this.onLocalParticipantPermissionsChanged=t=>{this.emit(e.RoomEvent.ParticipantPermissionsChanged,t,this.localParticipant)},this.onLocalChatMessageSent=t=>{this.emit(e.RoomEvent.ChatMessage,t,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},Sa),t),this.log=zn(null!==(i=this.options.loggerName)&&void 0!==i?i:e.LoggerNames.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},ka),null==t?void 0:t.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Ta),null==t?void 0:t.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},ya),null==t?void 0:t.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new o,this.localParticipant=new ps("","",this.engine,this.options),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Vo(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Vo(this.options.audioCaptureDefaults.deviceId)),(null===(r=this.options.audioOutput)||void 0===r?void 0:r.deviceId)&&this.switchActiveDevice("audiooutput",Vo(this.options.audioOutput.deviceId)).catch((e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext))),this.options.e2ee&&this.setupE2EE()}setE2EEEnabled(e){return Qn(this,void 0,void 0,(function*(){if(!this.e2eeManager)throw Error("e2ee not configured, please set e2ee settings within the room options");yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),""!==this.localParticipant.identity&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity)}))}setupE2EE(){var t;this.options.e2ee&&(this.e2eeManager=new Go(this.options.e2ee),this.e2eeManager.on(e.EncryptionEvent.ParticipantEncryptionStatusChanged,((t,n)=>{n instanceof ps&&(this.isE2EEEnabled=t),this.emit(e.RoomEvent.ParticipantEncryptionStatusChanged,t,n)})),this.e2eeManager.on(e.EncryptionEvent.EncryptionError,(t=>this.emit(e.RoomEvent.EncryptionError,t))),null===(t=this.e2eeManager)||void 0===t||t.setup(this))}get logContext(){var e;return{room:this.name,roomID:null===(e=this.roomInfo)||void 0===e?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.activeRecording)&&void 0!==t&&t}getSid(){return Qn(this,void 0,void 0,(function*(){return this.state===e.ConnectionState.Disconnected?"":this.roomInfo&&""!==this.roomInfo.sid?this.roomInfo.sid:new Promise(((t,n)=>{const i=n=>{""!==n.sid&&(this.engine.off(e.EngineEvent.RoomUpdate,i),t(n.sid))};this.engine.on(e.EngineEvent.RoomUpdate,i),this.once(e.RoomEvent.Disconnected,(()=>{this.engine.off(e.EngineEvent.RoomUpdate,i),n("Room disconnected before room server id was available")}))}))}))}get name(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.name)&&void 0!==t?t:""}get metadata(){var e;return null===(e=this.roomInfo)||void 0===e?void 0:e.metadata}get numParticipants(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numParticipants)&&void 0!==t?t:0}get numPublishers(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numPublishers)&&void 0!==t?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new Xa(this.options),this.engine.on(e.EngineEvent.ParticipantUpdate,this.handleParticipantUpdates).on(e.EngineEvent.RoomUpdate,this.handleRoomUpdate).on(e.EngineEvent.SpeakersChanged,this.handleSpeakersChanged).on(e.EngineEvent.StreamStateChanged,this.handleStreamStateUpdate).on(e.EngineEvent.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(e.EngineEvent.SubscriptionError,this.handleSubscriptionError).on(e.EngineEvent.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(e.EngineEvent.MediaTrackAdded,((e,t,n)=>{this.onTrackAdded(e,t,n)})).on(e.EngineEvent.Disconnected,(e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)})).on(e.EngineEvent.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(e.EngineEvent.DataPacketReceived,this.handleDataPacket).on(e.EngineEvent.Resuming,(()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(e.ConnectionState.SignalReconnecting)&&this.emit(e.RoomEvent.SignalReconnecting)})).on(e.EngineEvent.Resumed,(()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(e.ConnectionState.Connected)&&this.emit(e.RoomEvent.Reconnected)})).on(e.EngineEvent.SignalResumed,(()=>{this.bufferedEvents=[],(this.state===e.ConnectionState.Reconnecting||this.isResuming)&&this.sendSyncState()})).on(e.EngineEvent.Restarting,this.handleRestarting).on(e.EngineEvent.SignalRestarted,this.handleSignalRestarted).on(e.EngineEvent.Offline,(()=>{this.setAndEmitConnectionState(e.ConnectionState.Reconnecting)&&this.emit(e.RoomEvent.Reconnecting)})).on(e.EngineEvent.DCBufferStatusChanged,((t,n)=>{this.emit(e.RoomEvent.DCBufferStatusChanged,t,n)})).on(e.EngineEvent.LocalTrackSubscribed,(t=>{const n=this.localParticipant.getTrackPublications().find((e=>{let{trackSid:n}=e;return n===t}));n?(this.localParticipant.emit(e.ParticipantEvent.LocalTrackSubscribed,n),this.emitWhenConnected(e.RoomEvent.LocalTrackSubscribed,n,this.localParticipant)):this.log.warn("could not find local track subscription for subscribed event",this.logContext)})),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Ko.getInstance().getDevices(e,t)}prepareConnection(t,n){return Qn(this,void 0,void 0,(function*(){if(this.state===e.ConnectionState.Disconnected){this.log.debug("prepareConnection to ".concat(t),this.logContext);try{if(wo(new URL(t))&&n){this.regionUrlProvider=new es(t,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===e.ConnectionState.Disconnected&&(this.regionUrl=i,yield fetch(qo(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(qo(t),{method:"HEAD"})}catch(e){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:e}))}}}))}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return Qn(this,void 0,void 0,(function*(){let n,i=()=>{};switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":n=new wn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":n=new wn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":n=new wn({scenario:{case:"serverLeave",value:!0}});break;case"migration":n=new wn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>Qn(this,void 0,void 0,(function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")})),n=new wn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>Qn(this,void 0,void 0,(function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")})),n=new wn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":n=new wn({scenario:{case:"switchCandidateProtocol",value:"force-tls"===e?2:1}}),i=()=>Qn(this,void 0,void 0,(function*(){const e=this.engine.client.onLeave;e&&e(new an({reason:Ze.CLIENT_INITIATED,action:sn.RECONNECT}))}));break;case"subscriber-bandwidth":if(void 0===t||"number"!=typeof t)throw new Error("subscriber-bandwidth requires a number as argument");n=new wn({scenario:{case:"subscriberBandwidth",value:BigInt(t)}});break;case"leave-full-reconnect":n=new wn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}n&&(yield this.engine.client.sendSimulateScenario(n),yield i())}))}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(t,n){return Qn(this,arguments,void 0,(function(t,n){var i=this;let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function*(){var o,a,s,c,l,d,u;let h=!1,p=!0;const m=r?{exact:n}:n;if("audioinput"===t){const e=null!==(o=i.getActiveDevice(t))&&void 0!==o?o:i.options.audioCaptureDefaults.deviceId;i.options.audioCaptureDefaults.deviceId=m,h=e!==m;const n=Array.from(i.localParticipant.audioTrackPublications.values()).filter((e=>e.source===Yr.Source.Microphone));try{p=(yield Promise.all(n.map((e=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.setDeviceId(m)})))).every((e=>!0===e))}catch(t){throw i.options.audioCaptureDefaults.deviceId=e,t}}else if("videoinput"===t){const e=null!==(a=i.getActiveDevice(t))&&void 0!==a?a:i.options.videoCaptureDefaults.deviceId;i.options.videoCaptureDefaults.deviceId=m,h=e!==m;const n=Array.from(i.localParticipant.videoTrackPublications.values()).filter((e=>e.source===Yr.Source.Camera));try{p=(yield Promise.all(n.map((e=>{var t;return null===(t=e.videoTrack)||void 0===t?void 0:t.setDeviceId(m)})))).every((e=>!0===e))}catch(t){throw i.options.videoCaptureDefaults.deviceId=e,t}}else if("audiooutput"===t){if(!vo()&&!i.options.webAudioMix||i.options.webAudioMix&&i.audioContext&&!("setSinkId"in i.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");i.options.webAudioMix&&(n=null!==(s=yield Ko.getInstance().normalizeDeviceId("audiooutput",n))&&void 0!==s?s:""),null!==(c=(u=i.options).audioOutput)&&void 0!==c||(u.audioOutput={});const e=null!==(l=i.getActiveDevice(t))&&void 0!==l?l:i.options.audioOutput.deviceId;i.options.audioOutput.deviceId=n,h=e!==m;try{i.options.webAudioMix&&(null===(d=i.audioContext)||void 0===d||d.setSinkId(n)),yield Promise.all(Array.from(i.remoteParticipants.values()).map((e=>e.setAudioOutput({deviceId:n}))))}catch(t){throw i.options.audioOutput.deviceId=e,t}}return h&&p&&(i.localParticipant.activeDeviceMap.set(t,n),i.emit(e.RoomEvent.ActiveDeviceChanged,t,n)),p}()}))}setupLocalParticipantEvents(){this.localParticipant.on(e.ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(e.ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(e.ParticipantEvent.AttributesChanged,this.onLocalAttributesChanged).on(e.ParticipantEvent.TrackMuted,this.onLocalTrackMuted).on(e.ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).on(e.ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).on(e.ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(e.ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(e.ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).on(e.ParticipantEvent.AudioStreamAcquired,this.startAudio).on(e.ParticipantEvent.ChatMessage,this.onLocalChatMessageSent).on(e.ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;null===(e=this.engine)||void 0===e||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(t,n,i){if(this.state===e.ConnectionState.Connecting||this.state===e.ConnectionState.Reconnecting){const r=()=>{this.onTrackAdded(t,n,i),o()},o=()=>{this.off(e.RoomEvent.Reconnected,r),this.off(e.RoomEvent.Connected,r),this.off(e.RoomEvent.Disconnected,o)};return this.once(e.RoomEvent.Reconnected,r),this.once(e.RoomEvent.Connected,r),void this.once(e.RoomEvent.Disconnected,o)}if(this.state===e.ConnectionState.Disconnected)return void this.log.warn("skipping incoming track after Room disconnected",this.logContext);const r=function(e){const t=e.split("|");return t.length>1?[t[0],e.substr(t[0].length+1)]:[e,""]}(n.id),o=r[0];let a=r[1],s=t.id;if(a&&a.startsWith("TR")&&(s=a),o===this.localParticipant.sid)return void this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);const c=Array.from(this.remoteParticipants.values()).find((e=>e.sid===o));if(!c)return void this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(o),this.logContext);let l;this.options.adaptiveStream&&(l="object"==typeof this.options.adaptiveStream?this.options.adaptiveStream:{}),c.addSubscribedMediaTrack(t,s,n,i,l)}handleDisconnect(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==e.ConnectionState.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach((e=>{e.trackPublications.forEach((t=>{e.unpublishTrack(t.trackSid)}))})),this.localParticipant.trackPublications.forEach((e=>{var n,i;e.track&&this.localParticipant.unpublishTrack(e.track,t),t&&(null===(n=e.track)||void 0===n||n.detach(),null===(i=e.track)||void 0===i||i.stop())})),this.localParticipant.off(e.ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(e.ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(e.ParticipantEvent.AttributesChanged,this.onLocalAttributesChanged).off(e.ParticipantEvent.TrackMuted,this.onLocalTrackMuted).off(e.ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).off(e.ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).off(e.ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(e.ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(e.ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).off(e.ParticipantEvent.AudioStreamAcquired,this.startAudio).off(e.ParticipantEvent.ChatMessage,this.onLocalChatMessageSent).off(e.ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&"boolean"==typeof this.options.webAudioMix&&(this.audioContext.close(),this.audioContext=void 0),Co()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),null===(i=navigator.mediaDevices)||void 0===i||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(e.ConnectionState.Disconnected),this.emit(e.RoomEvent.Disconnected,n)}}}handleParticipantDisconnected(t,n){var i;this.remoteParticipants.delete(t),n&&(n.trackPublications.forEach((e=>{n.unpublishTrack(e.trackSid,!0)})),this.emit(e.RoomEvent.ParticipantDisconnected,n),null===(i=this.localParticipant)||void 0===i||i.handleParticipantDisconnected(n.identity))}acquireAudioContext(){return Qn(this,void 0,void 0,(function*(){var t,n;if("boolean"!=typeof this.options.webAudioMix&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:this.audioContext&&"closed"!==this.audioContext.state||(this.audioContext=null!==(t=no())&&void 0!==t?t:void 0),this.audioContext&&"suspended"===this.audioContext.state)try{yield this.audioContext.resume()}catch(e){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:e}))}this.options.webAudioMix&&this.remoteParticipants.forEach((e=>e.setAudioContext(this.audioContext))),this.localParticipant.setAudioContext(this.audioContext);const i="running"===(null===(n=this.audioContext)||void 0===n?void 0:n.state);i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(e.RoomEvent.AudioPlaybackStatusChanged,i))}))}createParticipant(e,t){var n;let i;return i=t?fs.fromParticipantInfo(this.engine.client,t,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):new fs(this.engine.client,"",e,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&i.setAudioContext(this.audioContext),(null===(n=this.options.audioOutput)||void 0===n?void 0:n.deviceId)&&i.setAudioOutput(this.options.audioOutput).catch((e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext))),i}getOrCreateParticipant(t,n){if(this.remoteParticipants.has(t)){const e=this.remoteParticipants.get(t);return n&&e.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),e}const i=this.createParticipant(t,n);return this.remoteParticipants.set(t,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(e.RoomEvent.ParticipantConnected,i),i.on(e.ParticipantEvent.TrackPublished,(t=>{this.emitWhenConnected(e.RoomEvent.TrackPublished,t,i)})).on(e.ParticipantEvent.TrackSubscribed,((t,n)=>{t.kind===Yr.Kind.Audio?(t.on(e.TrackEvent.AudioPlaybackStarted,this.handleAudioPlaybackStarted),t.on(e.TrackEvent.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):t.kind===Yr.Kind.Video&&(t.on(e.TrackEvent.VideoPlaybackFailed,this.handleVideoPlaybackFailed),t.on(e.TrackEvent.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(e.RoomEvent.TrackSubscribed,t,n,i)})).on(e.ParticipantEvent.TrackUnpublished,(t=>{this.emit(e.RoomEvent.TrackUnpublished,t,i)})).on(e.ParticipantEvent.TrackUnsubscribed,((t,n)=>{this.emit(e.RoomEvent.TrackUnsubscribed,t,n,i)})).on(e.ParticipantEvent.TrackSubscriptionFailed,(t=>{this.emit(e.RoomEvent.TrackSubscriptionFailed,t,i)})).on(e.ParticipantEvent.TrackMuted,(t=>{this.emitWhenConnected(e.RoomEvent.TrackMuted,t,i)})).on(e.ParticipantEvent.TrackUnmuted,(t=>{this.emitWhenConnected(e.RoomEvent.TrackUnmuted,t,i)})).on(e.ParticipantEvent.ParticipantMetadataChanged,(t=>{this.emitWhenConnected(e.RoomEvent.ParticipantMetadataChanged,t,i)})).on(e.ParticipantEvent.ParticipantNameChanged,(t=>{this.emitWhenConnected(e.RoomEvent.ParticipantNameChanged,t,i)})).on(e.ParticipantEvent.AttributesChanged,(t=>{this.emitWhenConnected(e.RoomEvent.ParticipantAttributesChanged,t,i)})).on(e.ParticipantEvent.ConnectionQualityChanged,(t=>{this.emitWhenConnected(e.RoomEvent.ConnectionQualityChanged,t,i)})).on(e.ParticipantEvent.ParticipantPermissionsChanged,(t=>{this.emitWhenConnected(e.RoomEvent.ParticipantPermissionsChanged,t,i)})).on(e.ParticipantEvent.TrackSubscriptionStatusChanged,((t,n)=>{this.emitWhenConnected(e.RoomEvent.TrackSubscriptionStatusChanged,t,n,i)})).on(e.ParticipantEvent.TrackSubscriptionFailed,((t,n)=>{this.emit(e.RoomEvent.TrackSubscriptionFailed,t,i,n)})).on(e.ParticipantEvent.TrackSubscriptionPermissionChanged,((t,n)=>{this.emitWhenConnected(e.RoomEvent.TrackSubscriptionPermissionChanged,t,n,i)})),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce(((e,t)=>(e.push(...t.getTrackPublications()),e)),[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const t of e.videoTrackPublications.values())t.isSubscribed&&t instanceof ms&&t.emitTrackUpdate()}getRemoteParticipantBySid(e){const t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Br.setInterval((()=>{this.engine&&!this.engine.isClosed&&this.engine.verifyTransport()?e=0:(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Ze.STATE_MISMATCH)))}),4e3)}clearConnectionReconcile(){this.connectionReconcileInterval&&Br.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(t){return t!==this.state&&(this.state=t,this.emit(e.RoomEvent.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach((e=>{let[t,n]=e;this.emit(t,...n)})),this.bufferedEvents=[]}emitWhenConnected(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===e.ConnectionState.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([t,i]);else if(this.state===e.ConnectionState.Connected)return this.emit(t,...i);return!1}simulateParticipants(t){return Qn(this,void 0,void 0,(function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},t.publish),o=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},t.participants);if(this.handleDisconnect(),this.roomInfo=new it({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:N.parse((new Date).getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new at({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(e.RoomEvent.SignalConnected),this.emit(e.RoomEvent.Connected),this.setAndEmitConnectionState(e.ConnectionState.Connected),r.video){const t=new us(Yr.Kind.Video,new ut({source:Je.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:Qe.AUDIO,name:"video-dummy"}),new qa(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:jo(160*(null!==(n=o.aspectRatios[0])&&void 0!==n?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(t),this.localParticipant.emit(e.ParticipantEvent.LocalTrackPublished,t)}if(r.audio){const t=new us(Yr.Kind.Audio,new ut({source:Je.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:Qe.AUDIO}),new Ia(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Fo(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(t),this.localParticipant.emit(e.ParticipantEvent.LocalTrackPublished,t)}for(let e=0;e<o.count-1;e+=1){let t=new at({sid:Math.floor(1e4*Math.random()).toString(),identity:"simulated-".concat(e),state:st.ACTIVE,tracks:[],joinedAt:N.parse(Date.now())});const n=this.getOrCreateParticipant(t.identity,t);if(o.video){const r=jo(160*(null!==(i=o.aspectRatios[e%o.aspectRatios.length])&&void 0!==i?i:1),160,!1,!0),a=new ut({source:Je.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:Qe.AUDIO});n.addSubscribedMediaTrack(r,a.sid,new MediaStream([r]),new RTCRtpReceiver),t.tracks=[...t.tracks,a]}if(o.audio){const e=Fo(),i=new ut({source:Je.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:Qe.AUDIO});n.addSubscribedMediaTrack(e,i.sid,new MediaStream([e]),new RTCRtpReceiver),t.tracks=[...t.tracks,i]}n.updateInfo(t)}}))}emit(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(t!==e.RoomEvent.ActiveSpeakersChanged){const e=vs(i).filter((e=>void 0!==e));this.log.debug("room event ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:e}))}return super.emit(t,...i)}}function vs(e){return e.map((e=>{if(e)return Array.isArray(e)?vs(e):"object"==typeof e?"logContext"in e&&e.logContext:e}))}e.CheckStatus=void 0,($a=e.CheckStatus||(e.CheckStatus={}))[$a.IDLE=0]="IDLE",$a[$a.RUNNING=1]="RUNNING",$a[$a.SKIPPED=2]="SKIPPED",$a[$a.SUCCESS=3]="SUCCESS",$a[$a.FAILED=4]="FAILED";class bs extends Zn.EventEmitter{constructor(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.status=e.CheckStatus.IDLE,this.logs=[],this.errorsAsWarnings=!1,this.url=t,this.token=n,this.name=this.constructor.name,this.room=new gs(i.roomOptions),this.connectOptions=i.connectOptions,i.errorsAsWarnings&&(this.errorsAsWarnings=i.errorsAsWarnings)}run(t){return Qn(this,void 0,void 0,(function*(){if(this.status!==e.CheckStatus.IDLE)throw Error("check is running already");this.setStatus(e.CheckStatus.RUNNING);try{yield this.perform()}catch(e){e instanceof Error&&(this.errorsAsWarnings?this.appendWarning(e.message):this.appendError(e.message))}return yield this.disconnect(),yield new Promise((e=>setTimeout(e,500))),this.status!==e.CheckStatus.SKIPPED&&this.setStatus(this.isSuccess()?e.CheckStatus.SUCCESS:e.CheckStatus.FAILED),t&&t(),this.getInfo()}))}isSuccess(){return!this.logs.some((e=>"error"===e.level))}connect(){return Qn(this,void 0,void 0,(function*(){return this.room.state===e.ConnectionState.Connected||(yield this.room.connect(this.url,this.token,this.connectOptions)),this.room}))}disconnect(){return Qn(this,void 0,void 0,(function*(){this.room&&this.room.state!==e.ConnectionState.Disconnected&&(yield this.room.disconnect(),yield new Promise((e=>setTimeout(e,500))))}))}skip(){this.setStatus(e.CheckStatus.SKIPPED)}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return null===(e=this.room)||void 0===e?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}function ys(e){return Qn(this,void 0,void 0,(function*(){var t,n;null!=e||(e={}),null!==(t=e.audio)&&void 0!==t||(e.audio=!0),null!==(n=e.video)&&void 0!==n||(e.video=!0);const{audioProcessor:i,videoProcessor:r}=co(e),o=Zr(e,ka,Ta),a=to(o),s=navigator.mediaDevices.getUserMedia(a);e.audio&&(Ko.userMediaPromiseMap.set("audioinput",s),s.catch((()=>Ko.userMediaPromiseMap.delete("audioinput")))),e.video&&(Ko.userMediaPromiseMap.set("videoinput",s),s.catch((()=>Ko.userMediaPromiseMap.delete("videoinput"))));const c=yield s;return Promise.all(c.getTracks().map((e=>Qn(this,void 0,void 0,(function*(){const t="audio"===e.kind;let n;t?o.audio:o.video;const s=t?a.audio:a.video;"boolean"!=typeof s&&(n=s),n?n.deviceId=e.getSettings().deviceId:n={deviceId:e.getSettings().deviceId};const l=Oa(e,n);return l.kind===Yr.Kind.Video?l.source=Yr.Source.Camera:l.kind===Yr.Kind.Audio&&(l.source=Yr.Source.Microphone),l.mediaStream=c,l instanceof Ia&&i?yield l.setProcessor(i):l instanceof qa&&r&&(yield l.setProcessor(r)),l})))))}))}function ks(e){return Qn(this,void 0,void 0,(function*(){return(yield ys({audio:!1,video:e}))[0]}))}function Ts(e){return Qn(this,void 0,void 0,(function*(){return(yield ys({audio:e,video:!1}))[0]}))}class Ss extends bs{get description(){return"Can publish audio"}perform(){return Qn(this,void 0,void 0,(function*(){var e;const t=yield this.connect(),n=yield Ts();t.localParticipant.publishTrack(n),yield new Promise((e=>setTimeout(e,3e3)));const i=yield null===(e=n.sender)||void 0===e?void 0:e.getStats();if(!i)throw new Error("Could not get RTCStats");let r=0;if(i.forEach((e=>{"outbound-rtp"!==e.type||"audio"!==e.kind&&(e.kind||"audio"!==e.mediaType)||(r=e.packetsSent)})),0===r)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(r," audio packets"))}))}}class Cs extends bs{get description(){return"Can publish video"}perform(){return Qn(this,void 0,void 0,(function*(){var e;const t=yield this.connect(),n=yield ks();t.localParticipant.publishTrack(n),yield new Promise((e=>setTimeout(e,5e3)));const i=yield null===(e=n.sender)||void 0===e?void 0:e.getStats();if(!i)throw new Error("Could not get RTCStats");let r=0;if(i.forEach((e=>{"outbound-rtp"!==e.type||"video"!==e.kind&&(e.kind||"video"!==e.mediaType)||(r+=e.packetsSent)})),0===r)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(r," video packets"))}))}}class Es extends bs{get description(){return"Resuming connection after interruption"}perform(){return Qn(this,void 0,void 0,(function*(){var t;const n=yield this.connect();let i,r=!1,o=!1;const a=new Promise((e=>{setTimeout(e,5e3),i=e})),s=()=>{r=!0};n.on(e.RoomEvent.SignalReconnecting,s).on(e.RoomEvent.Reconnecting,s).on(e.RoomEvent.Reconnected,(()=>{o=!0,i(!0)})),null===(t=n.engine.client.ws)||void 0===t||t.close();const c=n.engine.client.onClose;if(c&&c(""),yield a,!r)throw new Error("Did not attempt to reconnect");if(!o||n.state!==e.ConnectionState.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}))}}class ws extends bs{get description(){return"Can connect via TURN"}perform(){return Qn(this,void 0,void 0,(function*(){var e,t;const n=new Xo,i=yield n.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let r=!1,o=!1,a=!1;for(let s of i.iceServers)for(let e of s.urls)e.startsWith("turn:")?(o=!0,a=!0):e.startsWith("turns:")&&(o=!0,a=!0,r=!0),e.startsWith("stun:")&&(a=!0);a?o&&!r&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield n.close(),(null===(t=null===(e=this.connectOptions)||void 0===e?void 0:e.rtcConfig)||void 0===t?void 0:t.iceServers)||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise((e=>setTimeout(e,0))))}))}}class Ps extends bs{get description(){return"Establishing WebRTC connection"}perform(){return Qn(this,void 0,void 0,(function*(){let t=!1,n=!1;this.room.on(e.RoomEvent.SignalConnected,(()=>{const e=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(i,r)=>{if(i.candidate){const e=new RTCIceCandidate(i);let r="".concat(e.protocol," ").concat(e.address,":").concat(e.port," ").concat(e.type);e.address&&(function(e){const t=e.split(".");if(4===t.length){if("10"===t[0])return!0;if("192"===t[0]&&"168"===t[1])return!0;if("172"===t[0]){const e=parseInt(t[1],10);if(e>=16&&e<=31)return!0}}return!1}(e.address)?r+=" (private)":"tcp"===e.protocol&&"passive"===e.tcpType?(t=!0,r+=" (passive)"):"udp"===e.protocol&&(n=!0)),this.appendMessage(r)}e&&e(i,r)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=e=>{e instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(e.errorCode," ").concat(e.errorText," ").concat(e.url))})}));try{yield this.connect(),Vn.info("now the room is connected")}catch(e){throw this.appendWarning("ports need to be open on firewall in order to connect."),e}t||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")}))}}class Rs extends bs{get description(){return"Connecting to signal connection via WebSocket"}perform(){return Qn(this,void 0,void 0,(function*(){var e,t,n;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let i=new Xo;const r=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(r.serverVersion,".")),(null===(e=r.serverInfo)||void 0===e?void 0:e.edition)===It.Cloud&&(null===(t=r.serverInfo)||void 0===t?void 0:t.region)&&this.appendMessage("LiveKit Cloud: ".concat(null===(n=r.serverInfo)||void 0===n?void 0:n.region)),yield i.close()}))}}class Is extends Zn.EventEmitter{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=t,this.options=n}getNextCheckId(){const t=this.checkResults.size;return this.checkResults.set(t,{logs:[],status:e.CheckStatus.IDLE,name:"",description:""}),t}updateCheck(e,t){this.checkResults.set(e,t),this.emit("checkUpdate",e,t)}isSuccess(){return Array.from(this.checkResults.values()).every((t=>t.status!==e.CheckStatus.FAILED))}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return Qn(this,void 0,void 0,(function*(){const t=this.getNextCheckId(),n=new e(this.url,this.token,this.options),i=e=>{this.updateCheck(t,e)};n.on("update",i);const r=yield n.run();return n.off("update",i),r}))}checkWebsocket(){return Qn(this,void 0,void 0,(function*(){return this.createAndRunCheck(Rs)}))}checkWebRTC(){return Qn(this,void 0,void 0,(function*(){return this.createAndRunCheck(Ps)}))}checkTURN(){return Qn(this,void 0,void 0,(function*(){return this.createAndRunCheck(ws)}))}checkReconnect(){return Qn(this,void 0,void 0,(function*(){return this.createAndRunCheck(Es)}))}checkPublishAudio(){return Qn(this,void 0,void 0,(function*(){return this.createAndRunCheck(Ss)}))}checkPublishVideo(){return Qn(this,void 0,void 0,(function*(){return this.createAndRunCheck(Cs)}))}}const Os=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),xs=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);function _s(e){var t;const n=e.trim().toLowerCase();if(""!==n)return Os.has(n)?Os.get(n):null===(t=Array.from(xs.entries()).find((e=>{let[t]=e;return n.includes(t)})))||void 0===t?void 0:t[1]}e.BaseKeyProvider=Cr,e.Checker=bs,e.ConnectionCheck=Is,e.ConnectionError=wr,e.CriticalTimers=Br,e.CryptorError=class extends Er{constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.CryptorErrorReason.InternalError,i=arguments.length>2?arguments[2]:void 0;super(40,t),this.reason=n,this.participantIdentity=i}},e.DataPacket_Kind=mt,e.DefaultReconnectPolicy=Gn,e.DeviceUnsupportedError=Pr,e.DisconnectReason=Ze,e.ExternalE2EEKeyProvider=class extends Cr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(Object.assign(Object.assign({},e),{sharedKey:!0,ratchetWindowSize:0,failureTolerance:-1}))}setKey(e){return Qn(this,void 0,void 0,(function*(){const t="string"==typeof e?yield kr(e):yield Tr(e);this.onSetEncryptionKey(t)}))}},e.LivekitError=Er,e.LocalAudioTrack=Ia,e.LocalParticipant=ps,e.LocalTrack=Ho,e.LocalTrackPublication=us,e.LocalVideoTrack=qa,e.Mutex=o,e.NegotiationError=xr,e.Participant=hs,e.ParticipantKind=ct,e.PublishDataError=class extends Er{constructor(e){super(13,null!=e?e:"unable to publish data")}},e.RemoteAudioTrack=os,e.RemoteParticipant=fs,e.RemoteTrack=rs,e.RemoteTrackPublication=ms,e.RemoteVideoTrack=as,e.Room=gs,e.RpcError=ts,e.ScreenSharePresets=Qr,e.SignalRequestError=_r,e.SubscriptionError=tt,e.Track=Yr,e.TrackInvalidError=Rr,e.TrackPublication=ds,e.UnexpectedConnectionState=Or,e.UnsupportedServer=Ir,e.VideoPreset=Vr,e.VideoPresets=Hr,e.VideoPresets43=Gr,e.attachToElement=$r,e.compareVersions=Oo,e.createAudioAnalyser=function(e,t){const n=Object.assign({cloneTrack:!1,fftSize:2048,smoothingTimeConstant:.8,minDecibels:-100,maxDecibels:-80},t),i=no();if(!i)throw new Error("Audio Context not supported on this browser");const r=n.cloneTrack?e.mediaStreamTrack.clone():e.mediaStreamTrack,o=i.createMediaStreamSource(new MediaStream([r])),a=i.createAnalyser();a.minDecibels=n.minDecibels,a.maxDecibels=n.maxDecibels,a.fftSize=n.fftSize,a.smoothingTimeConstant=n.smoothingTimeConstant,o.connect(a);const s=new Uint8Array(a.frequencyBinCount);return{calculateVolume:()=>{a.getByteFrequencyData(s);let e=0;for(const t of s)e+=Math.pow(t/255,2);return Math.sqrt(e/s.length)},analyser:a,cleanup:()=>Qn(this,void 0,void 0,(function*(){yield i.close(),n.cloneTrack&&r.stop()}))}},e.createE2EEKey=function(){return window.crypto.getRandomValues(new Uint8Array(32))},e.createKeyMaterialFromBuffer=Tr,e.createKeyMaterialFromString=kr,e.createLocalAudioTrack=Ts,e.createLocalScreenTracks=function(e){return Qn(this,void 0,void 0,(function*(){if(void 0===e&&(e={}),void 0!==e.resolution||To()||(e.resolution=Qr.h1080fps30.resolution),void 0===navigator.mediaDevices.getDisplayMedia)throw new Pr("getDisplayMedia not supported");const t=ro(e),n=yield navigator.mediaDevices.getDisplayMedia(t),i=n.getVideoTracks();if(0===i.length)throw new Rr("no video track found");const r=new qa(i[0],void 0,!1);r.source=Yr.Source.ScreenShare;const o=[r];if(n.getAudioTracks().length>0){const e=new Ia(n.getAudioTracks()[0],void 0,!1);e.source=Yr.Source.ScreenShareAudio,o.push(e)}return o}))},e.createLocalTracks=ys,e.createLocalVideoTrack=ks,e.deriveKeys=function(e,t){return Qn(this,void 0,void 0,(function*(){const n=Sr(e.algorithm.name,t),i=yield crypto.subtle.deriveKey(n,e,{name:or,length:128},!1,["encrypt","decrypt"]);return{material:e,encryptionKey:i}}))},e.detachTrack=Xr,e.facingModeFromDeviceLabel=_s,e.facingModeFromLocalTrack=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;const i=e instanceof Ho?e.mediaStreamTrack:e,r=i.getSettings();let o={facingMode:null!==(n=t.defaultFacingMode)&&void 0!==n?n:"user",confidence:"low"};if("facingMode"in r){const e=r.facingMode;Vn.trace("rawFacingMode",{rawFacingMode:e}),e&&"string"==typeof e&&function(e){return void 0===e||["user","environment","left","right"].includes(e)}(e)&&(o={facingMode:e,confidence:"high"})}if(["low","medium"].includes(o.confidence)){Vn.trace("Try to get facing mode from device label: (".concat(i.label,")"));const e=_s(i.label);void 0!==e&&(o=e)}return o},e.getBrowser=Ar,e.getEmptyAudioStreamTrack=Fo,e.getEmptyVideoStreamTrack=function(){return Lo||(Lo=jo()),Lo.clone()},e.getLogger=zn,e.importKey=function(e){return Qn(this,arguments,void 0,(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{name:or},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"encrypt";return function*(){return crypto.subtle.importKey("raw",e,t,!1,"derive"===n?["deriveBits","deriveKey"]:["encrypt","decrypt"])}()}))},e.isBackupCodec=Wr,e.isBrowserSupported=bo,e.isE2EESupported=vr,e.isInsertableStreamSupported=yr,e.isScriptTransformSupported=br,e.isVideoFrame=function(e){return"type"in e},e.needsRbspUnescaping=function(e){for(var t=0;t<e.length-3;t++)if(0==e[t]&&0==e[t+1]&&3==e[t+2])return!0;return!1},e.parseRbsp=function(e){const t=[];for(var n=e.length,i=0;i<e.length;)n-i>=3&&!e[i]&&!e[i+1]&&3==e[i+2]?(t.push(e[i++]),t.push(e[i++]),i++):t.push(e[i++]);return new Uint8Array(t)},e.protocolVersion=15,e.ratchet=function(e,t){return Qn(this,void 0,void 0,(function*(){const n=Sr(e.algorithm.name,t);return crypto.subtle.deriveBits(n,e,256)}))},e.setLogExtension=function(t,n){(n?[n]:qn).forEach((n=>{const i=n.methodFactory;n.methodFactory=(n,r,o)=>{const a=i(n,r,o),s=e.LogLevel[n],c=s>=r&&s<e.LogLevel.silent;return(e,n)=>{n?a(e,n):a(e),c&&t(s,e,n)}},n.setLevel(n.getLevel())}))},e.setLogLevel=function(e,t){if(t)Bn.getLogger(t).setLevel(e);else for(const n of qn)n.setLevel(e)},e.supportsAV1=mo,e.supportsAdaptiveStream=function(){return void 0!==typeof ResizeObserver&&void 0!==typeof IntersectionObserver},e.supportsDynacast=function(){return ho()},e.supportsVP9=fo,e.version=Fr,e.videoCodecs=zr,e.writeRbsp=function(e){const t=[];for(var n=0,i=0;i<e.length;++i){var r=e[i];r<=3&&n>=2&&(t.push(3),n=0),t.push(r),0==r?++n:n=0}return new Uint8Array(t)}}(t)},730:(e,t,n)=>{"use strict";var i=n(43),r=n(853);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,s={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(s[e]=t,e=0;e<t.length;e++)a.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function f(e,t,n,i,r,o,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new f(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new f(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new f(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new f(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new f(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new f(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)}));var v=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function y(e,t,n,i){var r=g.hasOwnProperty(t)?g[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!u.call(m,e)||!u.call(p,e)&&(h.test(e)?m[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(v,b);g[t]=new f(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(v,b);g[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(v,b);g[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)}));var k=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,T=Symbol.for("react.element"),S=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),P=Symbol.for("react.provider"),R=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),x=Symbol.for("react.suspense_list"),_=Symbol.for("react.memo"),N=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var M=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var D=Symbol.iterator;function A(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=D&&e[D]||e["@@iterator"])?e:null}var L,U=Object.assign;function j(e){if(void 0===L)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var F=!1;function B(e,t){if(!e||F)return"";F=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var i=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){i=l}e.call(t.prototype)}else{try{throw Error()}catch(l){i=l}e()}}catch(l){if(l&&i&&"string"===typeof l.stack){for(var r=l.stack.split("\n"),o=i.stack.split("\n"),a=r.length-1,s=o.length-1;1<=a&&0<=s&&r[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(r[a]!==o[s]){if(1!==a||1!==s)do{if(a--,0>--s||r[a]!==o[s]){var c="\n"+r[a].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=a&&0<=s);break}}}finally{F=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?j(e):""}function V(e){switch(e.tag){case 5:return j(e.type);case 16:return j("Lazy");case 13:return j("Suspense");case 19:return j("SuspenseList");case 0:case 2:case 15:return e=B(e.type,!1);case 11:return e=B(e.type.render,!1);case 1:return e=B(e.type,!0);default:return""}}function q(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case C:return"Fragment";case S:return"Portal";case w:return"Profiler";case E:return"StrictMode";case O:return"Suspense";case x:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case R:return(e.displayName||"Context")+".Consumer";case P:return(e._context.displayName||"Context")+".Provider";case I:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case _:return null!==(t=e.displayName||null)?t:q(e.type)||"Memo";case N:t=e._payload,e=e._init;try{return q(e(t))}catch(n){}}return null}function z(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return q(t);case 8:return t===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function W(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function K(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function H(e){e._valueTracker||(e._valueTracker=function(e){var t=K(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function G(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=K(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function Q(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function J(e,t){var n=t.checked;return U({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Y(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=W(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function $(e,t){null!=(t=t.checked)&&y(e,"checked",t,!1)}function X(e,t){$(e,t);var n=W(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,W(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Q(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+W(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return U({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:W(n)}}function oe(e,t){var n=W(t.value),i=W(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,de,ue=(de=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return de(e,t)}))}:de);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];function fe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=fe(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(pe).forEach((function(e){me.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ve=U({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function be(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function ye(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ke=null;function Te(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Se=null,Ce=null,Ee=null;function we(e){if(e=yr(e)){if("function"!==typeof Se)throw Error(o(280));var t=e.stateNode;t&&(t=Tr(t),Se(e.stateNode,e.type,t))}}function Pe(e){Ce?Ee?Ee.push(e):Ee=[e]:Ce=e}function Re(){if(Ce){var e=Ce,t=Ee;if(Ee=Ce=null,we(e),t)for(e=0;e<t.length;e++)we(t[e])}}function Ie(e,t){return e(t)}function Oe(){}var xe=!1;function _e(e,t,n){if(xe)return e(t,n);xe=!0;try{return Ie(e,t,n)}finally{xe=!1,(null!==Ce||null!==Ee)&&(Oe(),Re())}}function Ne(e,t){var n=e.stateNode;if(null===n)return null;var i=Tr(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var Me=!1;if(d)try{var De={};Object.defineProperty(De,"passive",{get:function(){Me=!0}}),window.addEventListener("test",De,De),window.removeEventListener("test",De,De)}catch(de){Me=!1}function Ae(e,t,n,i,r,o,a,s,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(d){this.onError(d)}}var Le=!1,Ue=null,je=!1,Fe=null,Be={onError:function(e){Le=!0,Ue=e}};function Ve(e,t,n,i,r,o,a,s,c){Le=!1,Ue=null,Ae.apply(Be,arguments)}function qe(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function ze(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function We(e){if(qe(e)!==e)throw Error(o(188))}function Ke(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=qe(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(i=r.return)){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return We(r),e;if(a===i)return We(r),t;a=a.sibling}throw Error(o(188))}if(n.return!==i.return)n=r,i=a;else{for(var s=!1,c=r.child;c;){if(c===n){s=!0,n=r,i=a;break}if(c===i){s=!0,i=r,n=a;break}c=c.sibling}if(!s){for(c=a.child;c;){if(c===n){s=!0,n=a,i=r;break}if(c===i){s=!0,i=a,n=r;break}c=c.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==i)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?He(e):null}function He(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=He(e);if(null!==t)return t;e=e.sibling}return null}var Ge=r.unstable_scheduleCallback,Qe=r.unstable_cancelCallback,Je=r.unstable_shouldYield,Ye=r.unstable_requestPaint,$e=r.unstable_now,Xe=r.unstable_getCurrentPriorityLevel,Ze=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,it=r.unstable_IdlePriority,rt=null,ot=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/ct|0)|0},st=Math.log,ct=Math.LN2;var lt=64,dt=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,o=e.pingedLanes,a=268435455&n;if(0!==a){var s=a&~r;0!==s?i=ut(s):0!==(o&=a)&&(i=ut(o))}else 0!==(a=n&~r)?i=ut(a):0!==o&&(i=ut(o));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(o=t&-t)||16===r&&0!==(4194240&o)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-at(t)),i|=e[n],t&=~r;return i}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function mt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ft(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function bt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-at(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var yt=0;function kt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var Tt,St,Ct,Et,wt,Pt=!1,Rt=[],It=null,Ot=null,xt=null,_t=new Map,Nt=new Map,Mt=[],Dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function At(e,t){switch(e){case"focusin":case"focusout":It=null;break;case"dragenter":case"dragleave":Ot=null;break;case"mouseover":case"mouseout":xt=null;break;case"pointerover":case"pointerout":_t.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nt.delete(t.pointerId)}}function Lt(e,t,n,i,r,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},null!==t&&(null!==(t=yr(t))&&St(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Ut(e){var t=br(e.target);if(null!==t){var n=qe(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=ze(n)))return e.blockedOn=t,void wt(e.priority,(function(){Ct(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function jt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Jt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=yr(n))&&St(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);ke=i,n.target.dispatchEvent(i),ke=null,t.shift()}return!0}function Ft(e,t,n){jt(e)&&n.delete(t)}function Bt(){Pt=!1,null!==It&&jt(It)&&(It=null),null!==Ot&&jt(Ot)&&(Ot=null),null!==xt&&jt(xt)&&(xt=null),_t.forEach(Ft),Nt.forEach(Ft)}function Vt(e,t){e.blockedOn===t&&(e.blockedOn=null,Pt||(Pt=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Bt)))}function qt(e){function t(t){return Vt(t,e)}if(0<Rt.length){Vt(Rt[0],e);for(var n=1;n<Rt.length;n++){var i=Rt[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==It&&Vt(It,e),null!==Ot&&Vt(Ot,e),null!==xt&&Vt(xt,e),_t.forEach(t),Nt.forEach(t),n=0;n<Mt.length;n++)(i=Mt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Mt.length&&null===(n=Mt[0]).blockedOn;)Ut(n),null===n.blockedOn&&Mt.shift()}var zt=k.ReactCurrentBatchConfig,Wt=!0;function Kt(e,t,n,i){var r=yt,o=zt.transition;zt.transition=null;try{yt=1,Gt(e,t,n,i)}finally{yt=r,zt.transition=o}}function Ht(e,t,n,i){var r=yt,o=zt.transition;zt.transition=null;try{yt=4,Gt(e,t,n,i)}finally{yt=r,zt.transition=o}}function Gt(e,t,n,i){if(Wt){var r=Jt(e,t,n,i);if(null===r)Wi(e,t,i,Qt,n),At(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return It=Lt(It,e,t,n,i,r),!0;case"dragenter":return Ot=Lt(Ot,e,t,n,i,r),!0;case"mouseover":return xt=Lt(xt,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return _t.set(o,Lt(_t.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,Nt.set(o,Lt(Nt.get(o)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(At(e,i),4&t&&-1<Dt.indexOf(e)){for(;null!==r;){var o=yr(r);if(null!==o&&Tt(o),null===(o=Jt(e,t,n,i))&&Wi(e,t,i,Qt,n),o===r)break;r=o}null!==r&&i.stopPropagation()}else Wi(e,t,i,null,n)}}var Qt=null;function Jt(e,t,n,i){if(Qt=null,null!==(e=br(e=Te(i))))if(null===(t=qe(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=ze(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Qt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xe()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var $t=null,Xt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Xt,i=n.length,r="value"in $t?$t.value:$t.textContent,o=r.length;for(e=0;e<i&&n[e]===r[e];e++);var a=i-e;for(t=1;t<=a&&n[i-t]===r[o-t];t++);return Zt=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,i,r,o){for(var a in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return U(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,sn,cn,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dn=on(ln),un=U({},ln,{view:0,detail:0}),hn=on(un),pn=U({},un,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(an=e.screenX-cn.screenX,sn=e.screenY-cn.screenY):sn=an=0,cn=e),an)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),mn=on(pn),fn=on(U({},pn,{dataTransfer:0})),gn=on(U({},un,{relatedTarget:0})),vn=on(U({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),bn=U({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yn=on(bn),kn=on(U({},ln,{data:0})),Tn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Cn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function En(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Cn[e])&&!!t[e]}function wn(){return En}var Pn=U({},un,{key:function(e){if(e.key){var t=Tn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Rn=on(Pn),In=on(U({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),On=on(U({},un,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wn})),xn=on(U({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),_n=U({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Nn=on(_n),Mn=[9,13,27,32],Dn=d&&"CompositionEvent"in window,An=null;d&&"documentMode"in document&&(An=document.documentMode);var Ln=d&&"TextEvent"in window&&!An,Un=d&&(!Dn||An&&8<An&&11>=An),jn=String.fromCharCode(32),Fn=!1;function Bn(e,t){switch(e){case"keyup":return-1!==Mn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var qn=!1;var zn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!zn[e.type]:"textarea"===t}function Kn(e,t,n,i){Pe(i),0<(t=Hi(t,"onChange")).length&&(n=new dn("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Hn=null,Gn=null;function Qn(e){ji(e,0)}function Jn(e){if(G(kr(e)))return e}function Yn(e,t){if("change"===e)return t}var $n=!1;if(d){var Xn;if(d){var Zn="oninput"in document;if(!Zn){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),Zn="function"===typeof ei.oninput}Xn=Zn}else Xn=!1;$n=Xn&&(!document.documentMode||9<document.documentMode)}function ti(){Hn&&(Hn.detachEvent("onpropertychange",ni),Gn=Hn=null)}function ni(e){if("value"===e.propertyName&&Jn(Gn)){var t=[];Kn(t,Gn,e,Te(e)),_e(Qn,t)}}function ii(e,t,n){"focusin"===e?(ti(),Gn=n,(Hn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Jn(Gn)}function oi(e,t){if("click"===e)return Jn(t)}function ai(e,t){if("input"===e||"change"===e)return Jn(t)}var si="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ci(e,t){if(si(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!u.call(t,r)||!si(e[r],t[r]))return!1}return!0}function li(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function di(e,t){var n,i=li(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=li(i)}}function ui(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?ui(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hi(){for(var e=window,t=Q();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=Q((e=t.contentWindow).document)}return t}function pi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function mi(e){var t=hi(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&ui(n.ownerDocument.documentElement,n)){if(null!==i&&pi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(i.start,r);i=void 0===i.end?o:Math.min(i.end,r),!e.extend&&o>i&&(r=i,i=o,o=r),r=di(n,o);var a=di(n,i);r&&a&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),o>i?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var fi=d&&"documentMode"in document&&11>=document.documentMode,gi=null,vi=null,bi=null,yi=!1;function ki(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;yi||null==gi||gi!==Q(i)||("selectionStart"in(i=gi)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},bi&&ci(bi,i)||(bi=i,0<(i=Hi(vi,"onSelect")).length&&(t=new dn("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=gi)))}function Ti(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Si={animationend:Ti("Animation","AnimationEnd"),animationiteration:Ti("Animation","AnimationIteration"),animationstart:Ti("Animation","AnimationStart"),transitionend:Ti("Transition","TransitionEnd")},Ci={},Ei={};function wi(e){if(Ci[e])return Ci[e];if(!Si[e])return e;var t,n=Si[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ei)return Ci[e]=n[t];return e}d&&(Ei=document.createElement("div").style,"AnimationEvent"in window||(delete Si.animationend.animation,delete Si.animationiteration.animation,delete Si.animationstart.animation),"TransitionEvent"in window||delete Si.transitionend.transition);var Pi=wi("animationend"),Ri=wi("animationiteration"),Ii=wi("animationstart"),Oi=wi("transitionend"),xi=new Map,_i="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ni(e,t){xi.set(e,t),c(t,[e])}for(var Mi=0;Mi<_i.length;Mi++){var Di=_i[Mi];Ni(Di.toLowerCase(),"on"+(Di[0].toUpperCase()+Di.slice(1)))}Ni(Pi,"onAnimationEnd"),Ni(Ri,"onAnimationIteration"),Ni(Ii,"onAnimationStart"),Ni("dblclick","onDoubleClick"),Ni("focusin","onFocus"),Ni("focusout","onBlur"),Ni(Oi,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ai="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Li=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ai));function Ui(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,a,s,c,l){if(Ve.apply(this,arguments),Le){if(!Le)throw Error(o(198));var d=Ue;Le=!1,Ue=null,je||(je=!0,Fe=d)}}(i,t,void 0,e),e.currentTarget=null}function ji(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var a=i.length-1;0<=a;a--){var s=i[a],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==o&&r.isPropagationStopped())break e;Ui(r,s,l),o=c}else for(a=0;a<i.length;a++){if(c=(s=i[a]).instance,l=s.currentTarget,s=s.listener,c!==o&&r.isPropagationStopped())break e;Ui(r,s,l),o=c}}}if(je)throw e=Fe,je=!1,Fe=null,e}function Fi(e,t){var n=t[fr];void 0===n&&(n=t[fr]=new Set);var i=e+"__bubble";n.has(i)||(zi(t,e,2,!1),n.add(i))}function Bi(e,t,n){var i=0;t&&(i|=4),zi(n,e,i,t)}var Vi="_reactListening"+Math.random().toString(36).slice(2);function qi(e){if(!e[Vi]){e[Vi]=!0,a.forEach((function(t){"selectionchange"!==t&&(Li.has(t)||Bi(t,!1,e),Bi(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vi]||(t[Vi]=!0,Bi("selectionchange",!1,t))}}function zi(e,t,n,i){switch(Yt(t)){case 1:var r=Kt;break;case 4:r=Ht;break;default:r=Gt}n=r.bind(null,t,n,e),r=void 0,!Me||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Wi(e,t,n,i,r){var o=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var s=i.stateNode.containerInfo;if(s===r||8===s.nodeType&&s.parentNode===r)break;if(4===a)for(a=i.return;null!==a;){var c=a.tag;if((3===c||4===c)&&((c=a.stateNode.containerInfo)===r||8===c.nodeType&&c.parentNode===r))return;a=a.return}for(;null!==s;){if(null===(a=br(s)))return;if(5===(c=a.tag)||6===c){i=o=a;continue e}s=s.parentNode}}i=i.return}_e((function(){var i=o,r=Te(n),a=[];e:{var s=xi.get(e);if(void 0!==s){var c=dn,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":c=Rn;break;case"focusin":l="focus",c=gn;break;case"focusout":l="blur",c=gn;break;case"beforeblur":case"afterblur":c=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=mn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=fn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=On;break;case Pi:case Ri:case Ii:c=vn;break;case Oi:c=xn;break;case"scroll":c=hn;break;case"wheel":c=Nn;break;case"copy":case"cut":case"paste":c=yn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=In}var d=0!==(4&t),u=!d&&"scroll"===e,h=d?null!==s?s+"Capture":null:s;d=[];for(var p,m=i;null!==m;){var f=(p=m).stateNode;if(5===p.tag&&null!==f&&(p=f,null!==h&&(null!=(f=Ne(m,h))&&d.push(Ki(m,f,p)))),u)break;m=m.return}0<d.length&&(s=new c(s,l,null,n,r),a.push({event:s,listeners:d}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===ke||!(l=n.relatedTarget||n.fromElement)||!br(l)&&!l[mr])&&(c||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,c?(c=i,null!==(l=(l=n.relatedTarget||n.toElement)?br(l):null)&&(l!==(u=qe(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(c=null,l=i),c!==l)){if(d=mn,f="onMouseLeave",h="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(d=In,f="onPointerLeave",h="onPointerEnter",m="pointer"),u=null==c?s:kr(c),p=null==l?s:kr(l),(s=new d(f,m+"leave",c,n,r)).target=u,s.relatedTarget=p,f=null,br(r)===i&&((d=new d(h,m+"enter",l,n,r)).target=p,d.relatedTarget=u,f=d),u=f,c&&l)e:{for(h=l,m=0,p=d=c;p;p=Gi(p))m++;for(p=0,f=h;f;f=Gi(f))p++;for(;0<m-p;)d=Gi(d),m--;for(;0<p-m;)h=Gi(h),p--;for(;m--;){if(d===h||null!==h&&d===h.alternate)break e;d=Gi(d),h=Gi(h)}d=null}else d=null;null!==c&&Qi(a,s,c,d,!1),null!==l&&null!==u&&Qi(a,u,l,d,!0)}if("select"===(c=(s=i?kr(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type)var g=Yn;else if(Wn(s))if($n)g=ai;else{g=ri;var v=ii}else(c=s.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=oi);switch(g&&(g=g(e,i))?Kn(a,g,n,r):(v&&v(e,s,i),"focusout"===e&&(v=s._wrapperState)&&v.controlled&&"number"===s.type&&ee(s,"number",s.value)),v=i?kr(i):window,e){case"focusin":(Wn(v)||"true"===v.contentEditable)&&(gi=v,vi=i,bi=null);break;case"focusout":bi=vi=gi=null;break;case"mousedown":yi=!0;break;case"contextmenu":case"mouseup":case"dragend":yi=!1,ki(a,n,r);break;case"selectionchange":if(fi)break;case"keydown":case"keyup":ki(a,n,r)}var b;if(Dn)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else qn?Bn(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart");y&&(Un&&"ko"!==n.locale&&(qn||"onCompositionStart"!==y?"onCompositionEnd"===y&&qn&&(b=en()):(Xt="value"in($t=r)?$t.value:$t.textContent,qn=!0)),0<(v=Hi(i,y)).length&&(y=new kn(y,e,null,n,r),a.push({event:y,listeners:v}),b?y.data=b:null!==(b=Vn(n))&&(y.data=b))),(b=Ln?function(e,t){switch(e){case"compositionend":return Vn(t);case"keypress":return 32!==t.which?null:(Fn=!0,jn);case"textInput":return(e=t.data)===jn&&Fn?null:e;default:return null}}(e,n):function(e,t){if(qn)return"compositionend"===e||!Dn&&Bn(e,t)?(e=en(),Zt=Xt=$t=null,qn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Un&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Hi(i,"onBeforeInput")).length&&(r=new kn("onBeforeInput","beforeinput",null,n,r),a.push({event:r,listeners:i}),r.data=b))}ji(a,t)}))}function Ki(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Hi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,o=r.stateNode;5===r.tag&&null!==o&&(r=o,null!=(o=Ne(e,n))&&i.unshift(Ki(e,o,r)),null!=(o=Ne(e,t))&&i.push(Ki(e,o,r))),e=e.return}return i}function Gi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Qi(e,t,n,i,r){for(var o=t._reactName,a=[];null!==n&&n!==i;){var s=n,c=s.alternate,l=s.stateNode;if(null!==c&&c===i)break;5===s.tag&&null!==l&&(s=l,r?null!=(c=Ne(n,o))&&a.unshift(Ki(n,c,s)):r||null!=(c=Ne(n,o))&&a.push(Ki(n,c,s))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Ji=/\r\n?/g,Yi=/\u0000|\uFFFD/g;function $i(e){return("string"===typeof e?e:""+e).replace(Ji,"\n").replace(Yi,"")}function Xi(e,t,n){if(t=$i(t),$i(e)!==t&&n)throw Error(o(425))}function Zi(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ir="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,or="function"===typeof Promise?Promise:void 0,ar="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof or?function(e){return or.resolve(null).then(e).catch(sr)}:ir;function sr(e){setTimeout((function(){throw e}))}function cr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void qt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);qt(t)}function lr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function dr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var ur=Math.random().toString(36).slice(2),hr="__reactFiber$"+ur,pr="__reactProps$"+ur,mr="__reactContainer$"+ur,fr="__reactEvents$"+ur,gr="__reactListeners$"+ur,vr="__reactHandles$"+ur;function br(e){var t=e[hr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[mr]||n[hr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=dr(e);null!==e;){if(n=e[hr])return n;e=dr(e)}return t}n=(e=n).parentNode}return null}function yr(e){return!(e=e[hr]||e[mr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function kr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function Tr(e){return e[pr]||null}var Sr=[],Cr=-1;function Er(e){return{current:e}}function wr(e){0>Cr||(e.current=Sr[Cr],Sr[Cr]=null,Cr--)}function Pr(e,t){Cr++,Sr[Cr]=e.current,e.current=t}var Rr={},Ir=Er(Rr),Or=Er(!1),xr=Rr;function _r(e,t){var n=e.type.contextTypes;if(!n)return Rr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,o={};for(r in n)o[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Nr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Mr(){wr(Or),wr(Ir)}function Dr(e,t,n){if(Ir.current!==Rr)throw Error(o(168));Pr(Ir,t),Pr(Or,n)}function Ar(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(o(108,z(e)||"Unknown",r));return U({},n,i)}function Lr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Rr,xr=Ir.current,Pr(Ir,e),Pr(Or,Or.current),!0}function Ur(e,t,n){var i=e.stateNode;if(!i)throw Error(o(169));n?(e=Ar(e,t,xr),i.__reactInternalMemoizedMergedChildContext=e,wr(Or),wr(Ir),Pr(Ir,e)):wr(Or),Pr(Or,n)}var jr=null,Fr=!1,Br=!1;function Vr(e){null===jr?jr=[e]:jr.push(e)}function qr(){if(!Br&&null!==jr){Br=!0;var e=0,t=yt;try{var n=jr;for(yt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}jr=null,Fr=!1}catch(r){throw null!==jr&&(jr=jr.slice(e+1)),Ge(Ze,qr),r}finally{yt=t,Br=!1}}return null}var zr=[],Wr=0,Kr=null,Hr=0,Gr=[],Qr=0,Jr=null,Yr=1,$r="";function Xr(e,t){zr[Wr++]=Hr,zr[Wr++]=Kr,Kr=e,Hr=t}function Zr(e,t,n){Gr[Qr++]=Yr,Gr[Qr++]=$r,Gr[Qr++]=Jr,Jr=e;var i=Yr;e=$r;var r=32-at(i)-1;i&=~(1<<r),n+=1;var o=32-at(t)+r;if(30<o){var a=r-r%5;o=(i&(1<<a)-1).toString(32),i>>=a,r-=a,Yr=1<<32-at(t)+r|n<<r|i,$r=o+e}else Yr=1<<o|n<<r|i,$r=e}function eo(e){null!==e.return&&(Xr(e,1),Zr(e,1,0))}function to(e){for(;e===Kr;)Kr=zr[--Wr],zr[Wr]=null,Hr=zr[--Wr],zr[Wr]=null;for(;e===Jr;)Jr=Gr[--Qr],Gr[Qr]=null,$r=Gr[--Qr],Gr[Qr]=null,Yr=Gr[--Qr],Gr[Qr]=null}var no=null,io=null,ro=!1,oo=null;function ao(e,t){var n=_l(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function so(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,io=lr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,io=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Jr?{id:Yr,overflow:$r}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=_l(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,io=null,!0);default:return!1}}function co(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function lo(e){if(ro){var t=io;if(t){var n=t;if(!so(e,t)){if(co(e))throw Error(o(418));t=lr(n.nextSibling);var i=no;t&&so(e,t)?ao(i,n):(e.flags=-4097&e.flags|2,ro=!1,no=e)}}else{if(co(e))throw Error(o(418));e.flags=-4097&e.flags|2,ro=!1,no=e}}}function uo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function ho(e){if(e!==no)return!1;if(!ro)return uo(e),ro=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=io)){if(co(e))throw po(),Error(o(418));for(;t;)ao(e,t),t=lr(t.nextSibling)}if(uo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){io=lr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}io=null}}else io=no?lr(e.stateNode.nextSibling):null;return!0}function po(){for(var e=io;e;)e=lr(e.nextSibling)}function mo(){io=no=null,ro=!1}function fo(e){null===oo?oo=[e]:oo.push(e)}var go=k.ReactCurrentBatchConfig;function vo(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var i=n.stateNode}if(!i)throw Error(o(147,e));var r=i,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function bo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function yo(e){return(0,e._init)(e._payload)}function ko(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Ml(e,t)).index=0,e.sibling=null,e}function a(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,i){return null===t||6!==t.tag?((t=Ul(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function l(e,t,n,i){var o=n.type;return o===C?u(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===N&&yo(o)===t.type)?((i=r(t,n.props)).ref=vo(e,t,n),i.return=e,i):((i=Dl(n.type,n.key,n.props,null,e.mode,i)).ref=vo(e,t,n),i.return=e,i)}function d(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=jl(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function u(e,t,n,i,o){return null===t||7!==t.tag?((t=Al(n,e.mode,i,o)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Ul(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case T:return(n=Dl(t.type,t.key,t.props,null,e.mode,n)).ref=vo(e,null,t),n.return=e,n;case S:return(t=jl(t,e.mode,n)).return=e,t;case N:return h(e,(0,t._init)(t._payload),n)}if(te(t)||A(t))return(t=Al(t,e.mode,n,null)).return=e,t;bo(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:c(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case T:return n.key===r?l(e,t,n,i):null;case S:return n.key===r?d(e,t,n,i):null;case N:return p(e,t,(r=n._init)(n._payload),i)}if(te(n)||A(n))return null!==r?null:u(e,t,n,i,null);bo(e,n)}return null}function m(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return c(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case T:return l(t,e=e.get(null===i.key?n:i.key)||null,i,r);case S:return d(t,e=e.get(null===i.key?n:i.key)||null,i,r);case N:return m(e,t,n,(0,i._init)(i._payload),r)}if(te(i)||A(i))return u(t,e=e.get(n)||null,i,r,null);bo(t,i)}return null}function f(r,o,s,c){for(var l=null,d=null,u=o,f=o=0,g=null;null!==u&&f<s.length;f++){u.index>f?(g=u,u=null):g=u.sibling;var v=p(r,u,s[f],c);if(null===v){null===u&&(u=g);break}e&&u&&null===v.alternate&&t(r,u),o=a(v,o,f),null===d?l=v:d.sibling=v,d=v,u=g}if(f===s.length)return n(r,u),ro&&Xr(r,f),l;if(null===u){for(;f<s.length;f++)null!==(u=h(r,s[f],c))&&(o=a(u,o,f),null===d?l=u:d.sibling=u,d=u);return ro&&Xr(r,f),l}for(u=i(r,u);f<s.length;f++)null!==(g=m(u,r,f,s[f],c))&&(e&&null!==g.alternate&&u.delete(null===g.key?f:g.key),o=a(g,o,f),null===d?l=g:d.sibling=g,d=g);return e&&u.forEach((function(e){return t(r,e)})),ro&&Xr(r,f),l}function g(r,s,c,l){var d=A(c);if("function"!==typeof d)throw Error(o(150));if(null==(c=d.call(c)))throw Error(o(151));for(var u=d=null,f=s,g=s=0,v=null,b=c.next();null!==f&&!b.done;g++,b=c.next()){f.index>g?(v=f,f=null):v=f.sibling;var y=p(r,f,b.value,l);if(null===y){null===f&&(f=v);break}e&&f&&null===y.alternate&&t(r,f),s=a(y,s,g),null===u?d=y:u.sibling=y,u=y,f=v}if(b.done)return n(r,f),ro&&Xr(r,g),d;if(null===f){for(;!b.done;g++,b=c.next())null!==(b=h(r,b.value,l))&&(s=a(b,s,g),null===u?d=b:u.sibling=b,u=b);return ro&&Xr(r,g),d}for(f=i(r,f);!b.done;g++,b=c.next())null!==(b=m(f,r,g,b.value,l))&&(e&&null!==b.alternate&&f.delete(null===b.key?g:b.key),s=a(b,s,g),null===u?d=b:u.sibling=b,u=b);return e&&f.forEach((function(e){return t(r,e)})),ro&&Xr(r,g),d}return function e(i,o,a,c){if("object"===typeof a&&null!==a&&a.type===C&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case T:e:{for(var l=a.key,d=o;null!==d;){if(d.key===l){if((l=a.type)===C){if(7===d.tag){n(i,d.sibling),(o=r(d,a.props.children)).return=i,i=o;break e}}else if(d.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===N&&yo(l)===d.type){n(i,d.sibling),(o=r(d,a.props)).ref=vo(i,d,a),o.return=i,i=o;break e}n(i,d);break}t(i,d),d=d.sibling}a.type===C?((o=Al(a.props.children,i.mode,c,a.key)).return=i,i=o):((c=Dl(a.type,a.key,a.props,null,i.mode,c)).ref=vo(i,o,a),c.return=i,i=c)}return s(i);case S:e:{for(d=a.key;null!==o;){if(o.key===d){if(4===o.tag&&o.stateNode.containerInfo===a.containerInfo&&o.stateNode.implementation===a.implementation){n(i,o.sibling),(o=r(o,a.children||[])).return=i,i=o;break e}n(i,o);break}t(i,o),o=o.sibling}(o=jl(a,i.mode,c)).return=i,i=o}return s(i);case N:return e(i,o,(d=a._init)(a._payload),c)}if(te(a))return f(i,o,a,c);if(A(a))return g(i,o,a,c);bo(i,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==o&&6===o.tag?(n(i,o.sibling),(o=r(o,a)).return=i,i=o):(n(i,o),(o=Ul(a,i.mode,c)).return=i,i=o),s(i)):n(i,o)}}var To=ko(!0),So=ko(!1),Co=Er(null),Eo=null,wo=null,Po=null;function Ro(){Po=wo=Eo=null}function Io(e){var t=Co.current;wr(Co),e._currentValue=t}function Oo(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function xo(e,t){Eo=e,Po=wo=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ys=!0),e.firstContext=null)}function _o(e){var t=e._currentValue;if(Po!==e)if(e={context:e,memoizedValue:t,next:null},null===wo){if(null===Eo)throw Error(o(308));wo=e,Eo.dependencies={lanes:0,firstContext:e}}else wo=wo.next=e;return t}var No=null;function Mo(e){null===No?No=[e]:No.push(e)}function Do(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Mo(t)):(n.next=r.next,r.next=n),t.interleaved=n,Ao(e,i)}function Ao(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Lo=!1;function Uo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function jo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Fo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Bo(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Ic)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Ao(e,n)}return null===(r=i.interleaved)?(t.next=t,Mo(i)):(t.next=r.next,r.next=t),i.interleaved=t,Ao(e,n)}function Vo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,bt(e,n)}}function qo(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?r=o=a:o=o.next=a,n=n.next}while(null!==n);null===o?r=o=t:o=o.next=t}else r=o=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function zo(e,t,n,i){var r=e.updateQueue;Lo=!1;var o=r.firstBaseUpdate,a=r.lastBaseUpdate,s=r.shared.pending;if(null!==s){r.shared.pending=null;var c=s,l=c.next;c.next=null,null===a?o=l:a.next=l,a=c;var d=e.alternate;null!==d&&((s=(d=d.updateQueue).lastBaseUpdate)!==a&&(null===s?d.firstBaseUpdate=l:s.next=l,d.lastBaseUpdate=c))}if(null!==o){var u=r.baseState;for(a=0,d=l=c=null,s=o;;){var h=s.lane,p=s.eventTime;if((i&h)===h){null!==d&&(d=d.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var m=e,f=s;switch(h=t,p=n,f.tag){case 1:if("function"===typeof(m=f.payload)){u=m.call(p,u,h);break e}u=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(h="function"===typeof(m=f.payload)?m.call(p,u,h):m)||void 0===h)break e;u=U({},u,h);break e;case 2:Lo=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[s]:h.push(s))}else p={eventTime:p,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===d?(l=d=p,c=u):d=d.next=p,a|=h;if(null===(s=s.next)){if(null===(s=r.shared.pending))break;s=(h=s).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}if(null===d&&(c=u),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=d,null!==(t=r.shared.interleaved)){r=t;do{a|=r.lane,r=r.next}while(r!==t)}else null===o&&(r.shared.lanes=0);Lc|=a,e.lanes=a,e.memoizedState=u}}function Wo(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(o(191,r));r.call(i)}}}var Ko={},Ho=Er(Ko),Go=Er(Ko),Qo=Er(Ko);function Jo(e){if(e===Ko)throw Error(o(174));return e}function Yo(e,t){switch(Pr(Qo,t),Pr(Go,e),Pr(Ho,Ko),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}wr(Ho),Pr(Ho,t)}function $o(){wr(Ho),wr(Go),wr(Qo)}function Xo(e){Jo(Qo.current);var t=Jo(Ho.current),n=ce(t,e.type);t!==n&&(Pr(Go,e),Pr(Ho,n))}function Zo(e){Go.current===e&&(wr(Ho),wr(Go))}var ea=Er(0);function ta(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var na=[];function ia(){for(var e=0;e<na.length;e++)na[e]._workInProgressVersionPrimary=null;na.length=0}var ra=k.ReactCurrentDispatcher,oa=k.ReactCurrentBatchConfig,aa=0,sa=null,ca=null,la=null,da=!1,ua=!1,ha=0,pa=0;function ma(){throw Error(o(321))}function fa(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!si(e[n],t[n]))return!1;return!0}function ga(e,t,n,i,r,a){if(aa=a,sa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ra.current=null===e||null===e.memoizedState?Za:es,e=n(i,r),ua){a=0;do{if(ua=!1,ha=0,25<=a)throw Error(o(301));a+=1,la=ca=null,t.updateQueue=null,ra.current=ts,e=n(i,r)}while(ua)}if(ra.current=Xa,t=null!==ca&&null!==ca.next,aa=0,la=ca=sa=null,da=!1,t)throw Error(o(300));return e}function va(){var e=0!==ha;return ha=0,e}function ba(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===la?sa.memoizedState=la=e:la=la.next=e,la}function ya(){if(null===ca){var e=sa.alternate;e=null!==e?e.memoizedState:null}else e=ca.next;var t=null===la?sa.memoizedState:la.next;if(null!==t)la=t,ca=e;else{if(null===e)throw Error(o(310));e={memoizedState:(ca=e).memoizedState,baseState:ca.baseState,baseQueue:ca.baseQueue,queue:ca.queue,next:null},null===la?sa.memoizedState=la=e:la=la.next=e}return la}function ka(e,t){return"function"===typeof t?t(e):t}function Ta(e){var t=ya(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=ca,r=i.baseQueue,a=n.pending;if(null!==a){if(null!==r){var s=r.next;r.next=a.next,a.next=s}i.baseQueue=r=a,n.pending=null}if(null!==r){a=r.next,i=i.baseState;var c=s=null,l=null,d=a;do{var u=d.lane;if((aa&u)===u)null!==l&&(l=l.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),i=d.hasEagerState?d.eagerState:e(i,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===l?(c=l=h,s=i):l=l.next=h,sa.lanes|=u,Lc|=u}d=d.next}while(null!==d&&d!==a);null===l?s=i:l.next=c,si(i,t.memoizedState)||(ys=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=l,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{a=r.lane,sa.lanes|=a,Lc|=a,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Sa(e){var t=ya(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,a=t.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{a=e(a,s.action),s=s.next}while(s!==r);si(a,t.memoizedState)||(ys=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,i]}function Ca(){}function Ea(e,t){var n=sa,i=ya(),r=t(),a=!si(i.memoizedState,r);if(a&&(i.memoizedState=r,ys=!0),i=i.queue,La(Ra.bind(null,n,i,e),[e]),i.getSnapshot!==t||a||null!==la&&1&la.memoizedState.tag){if(n.flags|=2048,_a(9,Pa.bind(null,n,i,r,t),void 0,null),null===Oc)throw Error(o(349));0!==(30&aa)||wa(n,t,r)}return r}function wa(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=sa.updateQueue)?(t={lastEffect:null,stores:null},sa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Pa(e,t,n,i){t.value=n,t.getSnapshot=i,Ia(t)&&Oa(e)}function Ra(e,t,n){return n((function(){Ia(t)&&Oa(e)}))}function Ia(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!si(e,n)}catch(i){return!0}}function Oa(e){var t=Ao(e,1);null!==t&&nl(t,e,1,-1)}function xa(e){var t=ba();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ka,lastRenderedState:e},t.queue=e,e=e.dispatch=Qa.bind(null,sa,e),[t.memoizedState,e]}function _a(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=sa.updateQueue)?(t={lastEffect:null,stores:null},sa.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Na(){return ya().memoizedState}function Ma(e,t,n,i){var r=ba();sa.flags|=e,r.memoizedState=_a(1|t,n,void 0,void 0===i?null:i)}function Da(e,t,n,i){var r=ya();i=void 0===i?null:i;var o=void 0;if(null!==ca){var a=ca.memoizedState;if(o=a.destroy,null!==i&&fa(i,a.deps))return void(r.memoizedState=_a(t,n,o,i))}sa.flags|=e,r.memoizedState=_a(1|t,n,o,i)}function Aa(e,t){return Ma(8390656,8,e,t)}function La(e,t){return Da(2048,8,e,t)}function Ua(e,t){return Da(4,2,e,t)}function ja(e,t){return Da(4,4,e,t)}function Fa(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ba(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Da(4,4,Fa.bind(null,t,e),n)}function Va(){}function qa(e,t){var n=ya();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&fa(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function za(e,t){var n=ya();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&fa(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Wa(e,t,n){return 0===(21&aa)?(e.baseState&&(e.baseState=!1,ys=!0),e.memoizedState=n):(si(n,t)||(n=ft(),sa.lanes|=n,Lc|=n,e.baseState=!0),t)}function Ka(e,t){var n=yt;yt=0!==n&&4>n?n:4,e(!0);var i=oa.transition;oa.transition={};try{e(!1),t()}finally{yt=n,oa.transition=i}}function Ha(){return ya().memoizedState}function Ga(e,t,n){var i=tl(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Ja(e))Ya(t,n);else if(null!==(n=Do(e,t,n,i))){nl(n,e,i,el()),$a(n,t,i)}}function Qa(e,t,n){var i=tl(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ja(e))Ya(t,r);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=o(a,n);if(r.hasEagerState=!0,r.eagerState=s,si(s,a)){var c=t.interleaved;return null===c?(r.next=r,Mo(t)):(r.next=c.next,c.next=r),void(t.interleaved=r)}}catch(l){}null!==(n=Do(e,t,r,i))&&(nl(n,e,i,r=el()),$a(n,t,i))}}function Ja(e){var t=e.alternate;return e===sa||null!==t&&t===sa}function Ya(e,t){ua=da=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function $a(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,bt(e,n)}}var Xa={readContext:_o,useCallback:ma,useContext:ma,useEffect:ma,useImperativeHandle:ma,useInsertionEffect:ma,useLayoutEffect:ma,useMemo:ma,useReducer:ma,useRef:ma,useState:ma,useDebugValue:ma,useDeferredValue:ma,useTransition:ma,useMutableSource:ma,useSyncExternalStore:ma,useId:ma,unstable_isNewReconciler:!1},Za={readContext:_o,useCallback:function(e,t){return ba().memoizedState=[e,void 0===t?null:t],e},useContext:_o,useEffect:Aa,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ma(4194308,4,Fa.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ma(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ma(4,2,e,t)},useMemo:function(e,t){var n=ba();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=ba();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Ga.bind(null,sa,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},ba().memoizedState=e},useState:xa,useDebugValue:Va,useDeferredValue:function(e){return ba().memoizedState=e},useTransition:function(){var e=xa(!1),t=e[0];return e=Ka.bind(null,e[1]),ba().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=sa,r=ba();if(ro){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===Oc)throw Error(o(349));0!==(30&aa)||wa(i,t,n)}r.memoizedState=n;var a={value:n,getSnapshot:t};return r.queue=a,Aa(Ra.bind(null,i,a,e),[e]),i.flags|=2048,_a(9,Pa.bind(null,i,a,n,t),void 0,null),n},useId:function(){var e=ba(),t=Oc.identifierPrefix;if(ro){var n=$r;t=":"+t+"R"+(n=(Yr&~(1<<32-at(Yr)-1)).toString(32)+n),0<(n=ha++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=pa++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},es={readContext:_o,useCallback:qa,useContext:_o,useEffect:La,useImperativeHandle:Ba,useInsertionEffect:Ua,useLayoutEffect:ja,useMemo:za,useReducer:Ta,useRef:Na,useState:function(){return Ta(ka)},useDebugValue:Va,useDeferredValue:function(e){return Wa(ya(),ca.memoizedState,e)},useTransition:function(){return[Ta(ka)[0],ya().memoizedState]},useMutableSource:Ca,useSyncExternalStore:Ea,useId:Ha,unstable_isNewReconciler:!1},ts={readContext:_o,useCallback:qa,useContext:_o,useEffect:La,useImperativeHandle:Ba,useInsertionEffect:Ua,useLayoutEffect:ja,useMemo:za,useReducer:Sa,useRef:Na,useState:function(){return Sa(ka)},useDebugValue:Va,useDeferredValue:function(e){var t=ya();return null===ca?t.memoizedState=e:Wa(t,ca.memoizedState,e)},useTransition:function(){return[Sa(ka)[0],ya().memoizedState]},useMutableSource:Ca,useSyncExternalStore:Ea,useId:Ha,unstable_isNewReconciler:!1};function ns(e,t){if(e&&e.defaultProps){for(var n in t=U({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function is(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:U({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var rs={isMounted:function(e){return!!(e=e._reactInternals)&&qe(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=el(),r=tl(e),o=Fo(i,r);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Bo(e,o,r))&&(nl(t,e,r,i),Vo(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=el(),r=tl(e),o=Fo(i,r);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Bo(e,o,r))&&(nl(t,e,r,i),Vo(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=el(),i=tl(e),r=Fo(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Bo(e,r,i))&&(nl(t,e,i,n),Vo(t,e,i))}};function os(e,t,n,i,r,o,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,o,a):!t.prototype||!t.prototype.isPureReactComponent||(!ci(n,i)||!ci(r,o))}function as(e,t,n){var i=!1,r=Rr,o=t.contextType;return"object"===typeof o&&null!==o?o=_o(o):(r=Nr(t)?xr:Ir.current,o=(i=null!==(i=t.contextTypes)&&void 0!==i)?_r(e,r):Rr),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=rs,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function ss(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&rs.enqueueReplaceState(t,t.state,null)}function cs(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},Uo(e);var o=t.contextType;"object"===typeof o&&null!==o?r.context=_o(o):(o=Nr(t)?xr:Ir.current,r.context=_r(e,o)),r.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(is(e,t,o,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&rs.enqueueReplaceState(r,r.state,null),zo(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function ls(e,t){try{var n="",i=t;do{n+=V(i),i=i.return}while(i);var r=n}catch(o){r="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:r,digest:null}}function ds(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function us(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var hs="function"===typeof WeakMap?WeakMap:Map;function ps(e,t,n){(n=Fo(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Wc||(Wc=!0,Kc=i),us(0,t)},n}function ms(e,t,n){(n=Fo(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){us(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){us(0,t),"function"!==typeof i&&(null===Hc?Hc=new Set([this]):Hc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function fs(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new hs;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=wl.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vs(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Fo(-1,1)).tag=2,Bo(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var bs=k.ReactCurrentOwner,ys=!1;function ks(e,t,n,i){t.child=null===e?So(t,null,n,i):To(t,e.child,n,i)}function Ts(e,t,n,i,r){n=n.render;var o=t.ref;return xo(t,r),i=ga(e,t,n,i,o,r),n=va(),null===e||ys?(ro&&n&&eo(t),t.flags|=1,ks(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ws(e,t,r))}function Ss(e,t,n,i,r){if(null===e){var o=n.type;return"function"!==typeof o||Nl(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Dl(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Cs(e,t,o,i,r))}if(o=e.child,0===(e.lanes&r)){var a=o.memoizedProps;if((n=null!==(n=n.compare)?n:ci)(a,i)&&e.ref===t.ref)return Ws(e,t,r)}return t.flags|=1,(e=Ml(o,i)).ref=t.ref,e.return=t,t.child=e}function Cs(e,t,n,i,r){if(null!==e){var o=e.memoizedProps;if(ci(o,i)&&e.ref===t.ref){if(ys=!1,t.pendingProps=i=o,0===(e.lanes&r))return t.lanes=e.lanes,Ws(e,t,r);0!==(131072&e.flags)&&(ys=!0)}}return Ps(e,t,n,i,r)}function Es(e,t,n){var i=t.pendingProps,r=i.children,o=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Pr(Mc,Nc),Nc|=n;else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Pr(Mc,Nc),Nc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==o?o.baseLanes:n,Pr(Mc,Nc),Nc|=i}else null!==o?(i=o.baseLanes|n,t.memoizedState=null):i=n,Pr(Mc,Nc),Nc|=i;return ks(e,t,r,n),t.child}function ws(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ps(e,t,n,i,r){var o=Nr(n)?xr:Ir.current;return o=_r(t,o),xo(t,r),n=ga(e,t,n,i,o,r),i=va(),null===e||ys?(ro&&i&&eo(t),t.flags|=1,ks(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ws(e,t,r))}function Rs(e,t,n,i,r){if(Nr(n)){var o=!0;Lr(t)}else o=!1;if(xo(t,r),null===t.stateNode)zs(e,t),as(t,n,i),cs(t,n,i,r),i=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var c=a.context,l=n.contextType;"object"===typeof l&&null!==l?l=_o(l):l=_r(t,l=Nr(n)?xr:Ir.current);var d=n.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof a.getSnapshotBeforeUpdate;u||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==i||c!==l)&&ss(t,a,i,l),Lo=!1;var h=t.memoizedState;a.state=h,zo(t,i,a,r),c=t.memoizedState,s!==i||h!==c||Or.current||Lo?("function"===typeof d&&(is(t,n,d,i),c=t.memoizedState),(s=Lo||os(t,n,s,i,h,c,l))?(u||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=c),a.props=i,a.state=c,a.context=l,i=s):("function"===typeof a.componentDidMount&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,jo(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:ns(t.type,s),a.props=l,u=t.pendingProps,h=a.context,"object"===typeof(c=n.contextType)&&null!==c?c=_o(c):c=_r(t,c=Nr(n)?xr:Ir.current);var p=n.getDerivedStateFromProps;(d="function"===typeof p||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==u||h!==c)&&ss(t,a,i,c),Lo=!1,h=t.memoizedState,a.state=h,zo(t,i,a,r);var m=t.memoizedState;s!==u||h!==m||Or.current||Lo?("function"===typeof p&&(is(t,n,p,i),m=t.memoizedState),(l=Lo||os(t,n,l,i,h,m,c)||!1)?(d||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(i,m,c),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,m,c)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=m),a.props=i,a.state=m,a.context=c,i=l):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return Is(e,t,n,i,o,r)}function Is(e,t,n,i,r,o){ws(e,t);var a=0!==(128&t.flags);if(!i&&!a)return r&&Ur(t,n,!1),Ws(e,t,o);i=t.stateNode,bs.current=t;var s=a&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&a?(t.child=To(t,e.child,null,o),t.child=To(t,null,s,o)):ks(e,t,s,o),t.memoizedState=i.state,r&&Ur(t,n,!0),t.child}function Os(e){var t=e.stateNode;t.pendingContext?Dr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Dr(0,t.context,!1),Yo(e,t.containerInfo)}function xs(e,t,n,i,r){return mo(),fo(r),t.flags|=256,ks(e,t,n,i),t.child}var _s,Ns,Ms,Ds,As={dehydrated:null,treeContext:null,retryLane:0};function Ls(e){return{baseLanes:e,cachePool:null,transitions:null}}function Us(e,t,n){var i,r=t.pendingProps,a=ea.current,s=!1,c=0!==(128&t.flags);if((i=c)||(i=(null===e||null!==e.memoizedState)&&0!==(2&a)),i?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Pr(ea,1&a),null===e)return lo(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=r.children,e=r.fallback,s?(r=t.mode,s=t.child,c={mode:"hidden",children:c},0===(1&r)&&null!==s?(s.childLanes=0,s.pendingProps=c):s=Ll(c,r,0,null),e=Al(e,r,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ls(n),t.memoizedState=As,e):js(t,c));if(null!==(a=e.memoizedState)&&null!==(i=a.dehydrated))return function(e,t,n,i,r,a,s){if(n)return 256&t.flags?(t.flags&=-257,Fs(e,t,s,i=ds(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=i.fallback,r=t.mode,i=Ll({mode:"visible",children:i.children},r,0,null),(a=Al(a,r,s,null)).flags|=2,i.return=t,a.return=t,i.sibling=a,t.child=i,0!==(1&t.mode)&&To(t,e.child,null,s),t.child.memoizedState=Ls(s),t.memoizedState=As,a);if(0===(1&t.mode))return Fs(e,t,s,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var c=i.dgst;return i=c,Fs(e,t,s,i=ds(a=Error(o(419)),i,void 0))}if(c=0!==(s&e.childLanes),ys||c){if(null!==(i=Oc)){switch(s&-s){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|s))?0:r)&&r!==a.retryLane&&(a.retryLane=r,Ao(e,r),nl(i,e,r,-1))}return fl(),Fs(e,t,s,i=ds(Error(o(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Rl.bind(null,e),r._reactRetry=t,null):(e=a.treeContext,io=lr(r.nextSibling),no=t,ro=!0,oo=null,null!==e&&(Gr[Qr++]=Yr,Gr[Qr++]=$r,Gr[Qr++]=Jr,Yr=e.id,$r=e.overflow,Jr=t),t=js(t,i.children),t.flags|=4096,t)}(e,t,c,r,i,a,n);if(s){s=r.fallback,c=t.mode,i=(a=e.child).sibling;var l={mode:"hidden",children:r.children};return 0===(1&c)&&t.child!==a?((r=t.child).childLanes=0,r.pendingProps=l,t.deletions=null):(r=Ml(a,l)).subtreeFlags=14680064&a.subtreeFlags,null!==i?s=Ml(i,s):(s=Al(s,c,n,null)).flags|=2,s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,c=null===(c=e.child.memoizedState)?Ls(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},s.memoizedState=c,s.childLanes=e.childLanes&~n,t.memoizedState=As,r}return e=(s=e.child).sibling,r=Ml(s,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function js(e,t){return(t=Ll({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Fs(e,t,n,i){return null!==i&&fo(i),To(t,e.child,null,n),(e=js(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Bs(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Oo(e.return,t,n)}function Vs(e,t,n,i,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function qs(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(ks(e,t,i.children,n),0!==(2&(i=ea.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Bs(e,n,t);else if(19===e.tag)Bs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Pr(ea,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===ta(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Vs(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ta(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Vs(t,!0,n,null,o);break;case"together":Vs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function zs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ws(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Lc|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Ml(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Ml(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ks(e,t){if(!ro)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Hs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Gs(e,t,n){var i=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hs(t),null;case 1:case 17:return Nr(t.type)&&Mr(),Hs(t),null;case 3:return i=t.stateNode,$o(),wr(Or),wr(Ir),ia(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(ho(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==oo&&(al(oo),oo=null))),Ns(e,t),Hs(t),null;case 5:Zo(t);var r=Jo(Qo.current);if(n=t.type,null!==e&&null!=t.stateNode)Ms(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(o(166));return Hs(t),null}if(e=Jo(Ho.current),ho(t)){i=t.stateNode,n=t.type;var a=t.memoizedProps;switch(i[hr]=t,i[pr]=a,e=0!==(1&t.mode),n){case"dialog":Fi("cancel",i),Fi("close",i);break;case"iframe":case"object":case"embed":Fi("load",i);break;case"video":case"audio":for(r=0;r<Ai.length;r++)Fi(Ai[r],i);break;case"source":Fi("error",i);break;case"img":case"image":case"link":Fi("error",i),Fi("load",i);break;case"details":Fi("toggle",i);break;case"input":Y(i,a),Fi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},Fi("invalid",i);break;case"textarea":re(i,a),Fi("invalid",i)}for(var c in be(n,a),r=null,a)if(a.hasOwnProperty(c)){var l=a[c];"children"===c?"string"===typeof l?i.textContent!==l&&(!0!==a.suppressHydrationWarning&&Xi(i.textContent,l,e),r=["children",l]):"number"===typeof l&&i.textContent!==""+l&&(!0!==a.suppressHydrationWarning&&Xi(i.textContent,l,e),r=["children",""+l]):s.hasOwnProperty(c)&&null!=l&&"onScroll"===c&&Fi("scroll",i)}switch(n){case"input":H(i),Z(i,a,!0);break;case"textarea":H(i),ae(i);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(i.onclick=Zi)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{c=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=c.createElement(n,{is:i.is}):(e=c.createElement(n),"select"===n&&(c=e,i.multiple?c.multiple=!0:i.size&&(c.size=i.size))):e=c.createElementNS(e,n),e[hr]=t,e[pr]=i,_s(e,t,!1,!1),t.stateNode=e;e:{switch(c=ye(n,i),n){case"dialog":Fi("cancel",e),Fi("close",e),r=i;break;case"iframe":case"object":case"embed":Fi("load",e),r=i;break;case"video":case"audio":for(r=0;r<Ai.length;r++)Fi(Ai[r],e);r=i;break;case"source":Fi("error",e),r=i;break;case"img":case"image":case"link":Fi("error",e),Fi("load",e),r=i;break;case"details":Fi("toggle",e),r=i;break;case"input":Y(e,i),r=J(e,i),Fi("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=U({},i,{value:void 0}),Fi("invalid",e);break;case"textarea":re(e,i),r=ie(e,i),Fi("invalid",e)}for(a in be(n,r),l=r)if(l.hasOwnProperty(a)){var d=l[a];"style"===a?ge(e,d):"dangerouslySetInnerHTML"===a?null!=(d=d?d.__html:void 0)&&ue(e,d):"children"===a?"string"===typeof d?("textarea"!==n||""!==d)&&he(e,d):"number"===typeof d&&he(e,""+d):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(s.hasOwnProperty(a)?null!=d&&"onScroll"===a&&Fi("scroll",e):null!=d&&y(e,a,d,c))}switch(n){case"input":H(e),Z(e,i,!1);break;case"textarea":H(e),ae(e);break;case"option":null!=i.value&&e.setAttribute("value",""+W(i.value));break;case"select":e.multiple=!!i.multiple,null!=(a=i.value)?ne(e,!!i.multiple,a,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=Zi)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Hs(t),null;case 6:if(e&&null!=t.stateNode)Ds(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(o(166));if(n=Jo(Qo.current),Jo(Ho.current),ho(t)){if(i=t.stateNode,n=t.memoizedProps,i[hr]=t,(a=i.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:Xi(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Xi(i.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[hr]=t,t.stateNode=i}return Hs(t),null;case 13:if(wr(ea),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ro&&null!==io&&0!==(1&t.mode)&&0===(128&t.flags))po(),mo(),t.flags|=98560,a=!1;else if(a=ho(t),null!==i&&null!==i.dehydrated){if(null===e){if(!a)throw Error(o(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(o(317));a[hr]=t}else mo(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Hs(t),a=!1}else null!==oo&&(al(oo),oo=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&ea.current)?0===Dc&&(Dc=3):fl())),null!==t.updateQueue&&(t.flags|=4),Hs(t),null);case 4:return $o(),Ns(e,t),null===e&&qi(t.stateNode.containerInfo),Hs(t),null;case 10:return Io(t.type._context),Hs(t),null;case 19:if(wr(ea),null===(a=t.memoizedState))return Hs(t),null;if(i=0!==(128&t.flags),null===(c=a.rendering))if(i)Ks(a,!1);else{if(0!==Dc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=ta(e))){for(t.flags|=128,Ks(a,!1),null!==(i=c.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(a=n).flags&=14680066,null===(c=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,e=c.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Pr(ea,1&ea.current|2),t.child}e=e.sibling}null!==a.tail&&$e()>qc&&(t.flags|=128,i=!0,Ks(a,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=ta(c))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ks(a,!0),null===a.tail&&"hidden"===a.tailMode&&!c.alternate&&!ro)return Hs(t),null}else 2*$e()-a.renderingStartTime>qc&&1073741824!==n&&(t.flags|=128,i=!0,Ks(a,!1),t.lanes=4194304);a.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=a.last)?n.sibling=c:t.child=c,a.last=c)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=$e(),t.sibling=null,n=ea.current,Pr(ea,i?1&n|2:1&n),t):(Hs(t),null);case 22:case 23:return ul(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Nc)&&(Hs(t),6&t.subtreeFlags&&(t.flags|=8192)):Hs(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function Qs(e,t){switch(to(t),t.tag){case 1:return Nr(t.type)&&Mr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return $o(),wr(Or),wr(Ir),ia(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Zo(t),null;case 13:if(wr(ea),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));mo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return wr(ea),null;case 4:return $o(),null;case 10:return Io(t.type._context),null;case 22:case 23:return ul(),null;default:return null}}_s=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ns=function(){},Ms=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,Jo(Ho.current);var o,a=null;switch(n){case"input":r=J(e,r),i=J(e,i),a=[];break;case"select":r=U({},r,{value:void 0}),i=U({},i,{value:void 0}),a=[];break;case"textarea":r=ie(e,r),i=ie(e,i),a=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(e.onclick=Zi)}for(d in be(n,i),n=null,r)if(!i.hasOwnProperty(d)&&r.hasOwnProperty(d)&&null!=r[d])if("style"===d){var c=r[d];for(o in c)c.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(s.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in i){var l=i[d];if(c=null!=r?r[d]:void 0,i.hasOwnProperty(d)&&l!==c&&(null!=l||null!=c))if("style"===d)if(c){for(o in c)!c.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&c[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(a||(a=[]),a.push(d,n)),n=l;else"dangerouslySetInnerHTML"===d?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(a=a||[]).push(d,l)):"children"===d?"string"!==typeof l&&"number"!==typeof l||(a=a||[]).push(d,""+l):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(s.hasOwnProperty(d)?(null!=l&&"onScroll"===d&&Fi("scroll",e),a||c===l||(a=[])):(a=a||[]).push(d,l))}n&&(a=a||[]).push("style",n);var d=a;(t.updateQueue=d)&&(t.flags|=4)}},Ds=function(e,t,n,i){n!==i&&(t.flags|=4)};var Js=!1,Ys=!1,$s="function"===typeof WeakSet?WeakSet:Set,Xs=null;function Zs(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){El(e,t,i)}else n.current=null}function ec(e,t,n){try{n()}catch(i){El(e,t,i)}}var tc=!1;function nc(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,void 0!==o&&ec(t,n,o)}r=r.next}while(r!==i)}}function ic(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function rc(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function oc(e){var t=e.alternate;null!==t&&(e.alternate=null,oc(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hr],delete t[pr],delete t[fr],delete t[gr],delete t[vr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ac(e){return 5===e.tag||3===e.tag||4===e.tag}function sc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ac(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zi));else if(4!==i&&null!==(e=e.child))for(cc(e,t,n),e=e.sibling;null!==e;)cc(e,t,n),e=e.sibling}function lc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(lc(e,t,n),e=e.sibling;null!==e;)lc(e,t,n),e=e.sibling}var dc=null,uc=!1;function hc(e,t,n){for(n=n.child;null!==n;)pc(e,t,n),n=n.sibling}function pc(e,t,n){if(ot&&"function"===typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(rt,n)}catch(s){}switch(n.tag){case 5:Ys||Zs(n,t);case 6:var i=dc,r=uc;dc=null,hc(e,t,n),uc=r,null!==(dc=i)&&(uc?(e=dc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):dc.removeChild(n.stateNode));break;case 18:null!==dc&&(uc?(e=dc,n=n.stateNode,8===e.nodeType?cr(e.parentNode,n):1===e.nodeType&&cr(e,n),qt(e)):cr(dc,n.stateNode));break;case 4:i=dc,r=uc,dc=n.stateNode.containerInfo,uc=!0,hc(e,t,n),dc=i,uc=r;break;case 0:case 11:case 14:case 15:if(!Ys&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var o=r,a=o.destroy;o=o.tag,void 0!==a&&(0!==(2&o)||0!==(4&o))&&ec(n,t,a),r=r.next}while(r!==i)}hc(e,t,n);break;case 1:if(!Ys&&(Zs(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(s){El(n,t,s)}hc(e,t,n);break;case 21:hc(e,t,n);break;case 22:1&n.mode?(Ys=(i=Ys)||null!==n.memoizedState,hc(e,t,n),Ys=i):hc(e,t,n);break;default:hc(e,t,n)}}function mc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new $s),t.forEach((function(t){var i=Il.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function fc(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var a=e,s=t,c=s;e:for(;null!==c;){switch(c.tag){case 5:dc=c.stateNode,uc=!1;break e;case 3:case 4:dc=c.stateNode.containerInfo,uc=!0;break e}c=c.return}if(null===dc)throw Error(o(160));pc(a,s,r),dc=null,uc=!1;var l=r.alternate;null!==l&&(l.return=null),r.return=null}catch(d){El(r,t,d)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gc(t,e),t=t.sibling}function gc(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(fc(t,e),vc(e),4&i){try{nc(3,e,e.return),ic(3,e)}catch(g){El(e,e.return,g)}try{nc(5,e,e.return)}catch(g){El(e,e.return,g)}}break;case 1:fc(t,e),vc(e),512&i&&null!==n&&Zs(n,n.return);break;case 5:if(fc(t,e),vc(e),512&i&&null!==n&&Zs(n,n.return),32&e.flags){var r=e.stateNode;try{he(r,"")}catch(g){El(e,e.return,g)}}if(4&i&&null!=(r=e.stateNode)){var a=e.memoizedProps,s=null!==n?n.memoizedProps:a,c=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===c&&"radio"===a.type&&null!=a.name&&$(r,a),ye(c,s);var d=ye(c,a);for(s=0;s<l.length;s+=2){var u=l[s],h=l[s+1];"style"===u?ge(r,h):"dangerouslySetInnerHTML"===u?ue(r,h):"children"===u?he(r,h):y(r,u,h,d)}switch(c){case"input":X(r,a);break;case"textarea":oe(r,a);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var m=a.value;null!=m?ne(r,!!a.multiple,m,!1):p!==!!a.multiple&&(null!=a.defaultValue?ne(r,!!a.multiple,a.defaultValue,!0):ne(r,!!a.multiple,a.multiple?[]:"",!1))}r[pr]=a}catch(g){El(e,e.return,g)}}break;case 6:if(fc(t,e),vc(e),4&i){if(null===e.stateNode)throw Error(o(162));r=e.stateNode,a=e.memoizedProps;try{r.nodeValue=a}catch(g){El(e,e.return,g)}}break;case 3:if(fc(t,e),vc(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{qt(t.containerInfo)}catch(g){El(e,e.return,g)}break;case 4:default:fc(t,e),vc(e);break;case 13:fc(t,e),vc(e),8192&(r=e.child).flags&&(a=null!==r.memoizedState,r.stateNode.isHidden=a,!a||null!==r.alternate&&null!==r.alternate.memoizedState||(Vc=$e())),4&i&&mc(e);break;case 22:if(u=null!==n&&null!==n.memoizedState,1&e.mode?(Ys=(d=Ys)||u,fc(t,e),Ys=d):fc(t,e),vc(e),8192&i){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for(Xs=e,u=e.child;null!==u;){for(h=Xs=u;null!==Xs;){switch(m=(p=Xs).child,p.tag){case 0:case 11:case 14:case 15:nc(4,p,p.return);break;case 1:Zs(p,p.return);var f=p.stateNode;if("function"===typeof f.componentWillUnmount){i=p,n=p.return;try{t=i,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(g){El(i,n,g)}}break;case 5:Zs(p,p.return);break;case 22:if(null!==p.memoizedState){Tc(h);continue}}null!==m?(m.return=p,Xs=m):Tc(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{r=h.stateNode,d?"function"===typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none":(c=h.stateNode,s=void 0!==(l=h.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,c.style.display=fe("display",s))}catch(g){El(e,e.return,g)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(g){El(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:fc(t,e),vc(e),4&i&&mc(e);case 21:}}function vc(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ac(n)){var i=n;break e}n=n.return}throw Error(o(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(he(r,""),i.flags&=-33),lc(e,sc(e),r);break;case 3:case 4:var a=i.stateNode.containerInfo;cc(e,sc(e),a);break;default:throw Error(o(161))}}catch(s){El(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bc(e,t,n){Xs=e,yc(e,t,n)}function yc(e,t,n){for(var i=0!==(1&e.mode);null!==Xs;){var r=Xs,o=r.child;if(22===r.tag&&i){var a=null!==r.memoizedState||Js;if(!a){var s=r.alternate,c=null!==s&&null!==s.memoizedState||Ys;s=Js;var l=Ys;if(Js=a,(Ys=c)&&!l)for(Xs=r;null!==Xs;)c=(a=Xs).child,22===a.tag&&null!==a.memoizedState?Sc(r):null!==c?(c.return=a,Xs=c):Sc(r);for(;null!==o;)Xs=o,yc(o,t,n),o=o.sibling;Xs=r,Js=s,Ys=l}kc(e)}else 0!==(8772&r.subtreeFlags)&&null!==o?(o.return=r,Xs=o):kc(e)}}function kc(e){for(;null!==Xs;){var t=Xs;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ys||ic(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Ys)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:ns(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Wo(t,a,i);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Wo(t,s,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&qt(h)}}}break;default:throw Error(o(163))}Ys||512&t.flags&&rc(t)}catch(p){El(t,t.return,p)}}if(t===e){Xs=null;break}if(null!==(n=t.sibling)){n.return=t.return,Xs=n;break}Xs=t.return}}function Tc(e){for(;null!==Xs;){var t=Xs;if(t===e){Xs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Xs=n;break}Xs=t.return}}function Sc(e){for(;null!==Xs;){var t=Xs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ic(4,t)}catch(c){El(t,n,c)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(c){El(t,r,c)}}var o=t.return;try{rc(t)}catch(c){El(t,o,c)}break;case 5:var a=t.return;try{rc(t)}catch(c){El(t,a,c)}}}catch(c){El(t,t.return,c)}if(t===e){Xs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Xs=s;break}Xs=t.return}}var Cc,Ec=Math.ceil,wc=k.ReactCurrentDispatcher,Pc=k.ReactCurrentOwner,Rc=k.ReactCurrentBatchConfig,Ic=0,Oc=null,xc=null,_c=0,Nc=0,Mc=Er(0),Dc=0,Ac=null,Lc=0,Uc=0,jc=0,Fc=null,Bc=null,Vc=0,qc=1/0,zc=null,Wc=!1,Kc=null,Hc=null,Gc=!1,Qc=null,Jc=0,Yc=0,$c=null,Xc=-1,Zc=0;function el(){return 0!==(6&Ic)?$e():-1!==Xc?Xc:Xc=$e()}function tl(e){return 0===(1&e.mode)?1:0!==(2&Ic)&&0!==_c?_c&-_c:null!==go.transition?(0===Zc&&(Zc=ft()),Zc):0!==(e=yt)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function nl(e,t,n,i){if(50<Yc)throw Yc=0,$c=null,Error(o(185));vt(e,n,i),0!==(2&Ic)&&e===Oc||(e===Oc&&(0===(2&Ic)&&(Uc|=n),4===Dc&&sl(e,_c)),il(e,i),1===n&&0===Ic&&0===(1&t.mode)&&(qc=$e()+500,Fr&&qr()))}function il(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var a=31-at(o),s=1<<a,c=r[a];-1===c?0!==(s&n)&&0===(s&i)||(r[a]=pt(s,t)):c<=t&&(e.expiredLanes|=s),o&=~s}}(e,t);var i=ht(e,e===Oc?_c:0);if(0===i)null!==n&&Qe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Qe(n),1===t)0===e.tag?function(e){Fr=!0,Vr(e)}(cl.bind(null,e)):Vr(cl.bind(null,e)),ar((function(){0===(6&Ic)&&qr()})),n=null;else{switch(kt(i)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Ol(n,rl.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rl(e,t){if(Xc=-1,Zc=0,0!==(6&Ic))throw Error(o(327));var n=e.callbackNode;if(Sl()&&e.callbackNode!==n)return null;var i=ht(e,e===Oc?_c:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=gl(e,i);else{t=i;var r=Ic;Ic|=2;var a=ml();for(Oc===e&&_c===t||(zc=null,qc=$e()+500,hl(e,t));;)try{bl();break}catch(c){pl(e,c)}Ro(),wc.current=a,Ic=r,null!==xc?t=0:(Oc=null,_c=0,t=Dc)}if(0!==t){if(2===t&&(0!==(r=mt(e))&&(i=r,t=ol(e,r))),1===t)throw n=Ac,hl(e,0),sl(e,i),il(e,$e()),n;if(6===t)sl(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!si(o(),r))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=gl(e,i))&&(0!==(a=mt(e))&&(i=a,t=ol(e,a))),1===t))throw n=Ac,hl(e,0),sl(e,i),il(e,$e()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(o(345));case 2:case 5:Tl(e,Bc,zc);break;case 3:if(sl(e,i),(130023424&i)===i&&10<(t=Vc+500-$e())){if(0!==ht(e,0))break;if(((r=e.suspendedLanes)&i)!==i){el(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ir(Tl.bind(null,e,Bc,zc),t);break}Tl(e,Bc,zc);break;case 4:if(sl(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var s=31-at(i);a=1<<s,(s=t[s])>r&&(r=s),i&=~a}if(i=r,10<(i=(120>(i=$e()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ec(i/1960))-i)){e.timeoutHandle=ir(Tl.bind(null,e,Bc,zc),i);break}Tl(e,Bc,zc);break;default:throw Error(o(329))}}}return il(e,$e()),e.callbackNode===n?rl.bind(null,e):null}function ol(e,t){var n=Fc;return e.current.memoizedState.isDehydrated&&(hl(e,t).flags|=256),2!==(e=gl(e,t))&&(t=Bc,Bc=n,null!==t&&al(t)),e}function al(e){null===Bc?Bc=e:Bc.push.apply(Bc,e)}function sl(e,t){for(t&=~jc,t&=~Uc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),i=1<<n;e[n]=-1,t&=~i}}function cl(e){if(0!==(6&Ic))throw Error(o(327));Sl();var t=ht(e,0);if(0===(1&t))return il(e,$e()),null;var n=gl(e,t);if(0!==e.tag&&2===n){var i=mt(e);0!==i&&(t=i,n=ol(e,i))}if(1===n)throw n=Ac,hl(e,0),sl(e,t),il(e,$e()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Tl(e,Bc,zc),il(e,$e()),null}function ll(e,t){var n=Ic;Ic|=1;try{return e(t)}finally{0===(Ic=n)&&(qc=$e()+500,Fr&&qr())}}function dl(e){null!==Qc&&0===Qc.tag&&0===(6&Ic)&&Sl();var t=Ic;Ic|=1;var n=Rc.transition,i=yt;try{if(Rc.transition=null,yt=1,e)return e()}finally{yt=i,Rc.transition=n,0===(6&(Ic=t))&&qr()}}function ul(){Nc=Mc.current,wr(Mc)}function hl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==xc)for(n=xc.return;null!==n;){var i=n;switch(to(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Mr();break;case 3:$o(),wr(Or),wr(Ir),ia();break;case 5:Zo(i);break;case 4:$o();break;case 13:case 19:wr(ea);break;case 10:Io(i.type._context);break;case 22:case 23:ul()}n=n.return}if(Oc=e,xc=e=Ml(e.current,null),_c=Nc=t,Dc=0,Ac=null,jc=Uc=Lc=0,Bc=Fc=null,null!==No){for(t=0;t<No.length;t++)if(null!==(i=(n=No[t]).interleaved)){n.interleaved=null;var r=i.next,o=n.pending;if(null!==o){var a=o.next;o.next=r,i.next=a}n.pending=i}No=null}return e}function pl(e,t){for(;;){var n=xc;try{if(Ro(),ra.current=Xa,da){for(var i=sa.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}da=!1}if(aa=0,la=ca=sa=null,ua=!1,ha=0,Pc.current=null,null===n||null===n.return){Dc=1,Ac=t,xc=null;break}e:{var a=e,s=n.return,c=n,l=t;if(t=_c,c.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var d=l,u=c,h=u.tag;if(0===(1&u.mode)&&(0===h||11===h||15===h)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=gs(s);if(null!==m){m.flags&=-257,vs(m,s,c,0,t),1&m.mode&&fs(a,d,t),l=d;var f=(t=m).updateQueue;if(null===f){var g=new Set;g.add(l),t.updateQueue=g}else f.add(l);break e}if(0===(1&t)){fs(a,d,t),fl();break e}l=Error(o(426))}else if(ro&&1&c.mode){var v=gs(s);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vs(v,s,c,0,t),fo(ls(l,c));break e}}a=l=ls(l,c),4!==Dc&&(Dc=2),null===Fc?Fc=[a]:Fc.push(a),a=s;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,qo(a,ps(0,l,t));break e;case 1:c=l;var b=a.type,y=a.stateNode;if(0===(128&a.flags)&&("function"===typeof b.getDerivedStateFromError||null!==y&&"function"===typeof y.componentDidCatch&&(null===Hc||!Hc.has(y)))){a.flags|=65536,t&=-t,a.lanes|=t,qo(a,ms(a,c,t));break e}}a=a.return}while(null!==a)}kl(n)}catch(k){t=k,xc===n&&null!==n&&(xc=n=n.return);continue}break}}function ml(){var e=wc.current;return wc.current=Xa,null===e?Xa:e}function fl(){0!==Dc&&3!==Dc&&2!==Dc||(Dc=4),null===Oc||0===(268435455&Lc)&&0===(268435455&Uc)||sl(Oc,_c)}function gl(e,t){var n=Ic;Ic|=2;var i=ml();for(Oc===e&&_c===t||(zc=null,hl(e,t));;)try{vl();break}catch(r){pl(e,r)}if(Ro(),Ic=n,wc.current=i,null!==xc)throw Error(o(261));return Oc=null,_c=0,Dc}function vl(){for(;null!==xc;)yl(xc)}function bl(){for(;null!==xc&&!Je();)yl(xc)}function yl(e){var t=Cc(e.alternate,e,Nc);e.memoizedProps=e.pendingProps,null===t?kl(e):xc=t,Pc.current=null}function kl(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Gs(n,t,Nc)))return void(xc=n)}else{if(null!==(n=Qs(n,t)))return n.flags&=32767,void(xc=n);if(null===e)return Dc=6,void(xc=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(xc=t);xc=t=e}while(null!==t);0===Dc&&(Dc=5)}function Tl(e,t,n){var i=yt,r=Rc.transition;try{Rc.transition=null,yt=1,function(e,t,n,i){do{Sl()}while(null!==Qc);if(0!==(6&Ic))throw Error(o(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-at(n),o=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~o}}(e,a),e===Oc&&(xc=Oc=null,_c=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Gc||(Gc=!0,Ol(tt,(function(){return Sl(),null}))),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=Rc.transition,Rc.transition=null;var s=yt;yt=1;var c=Ic;Ic|=4,Pc.current=null,function(e,t){if(er=Wt,pi(e=hi())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{n.nodeType,a.nodeType}catch(T){n=null;break e}var s=0,c=-1,l=-1,d=0,u=0,h=e,p=null;t:for(;;){for(var m;h!==n||0!==r&&3!==h.nodeType||(c=s+r),h!==a||0!==i&&3!==h.nodeType||(l=s+i),3===h.nodeType&&(s+=h.nodeValue.length),null!==(m=h.firstChild);)p=h,h=m;for(;;){if(h===e)break t;if(p===n&&++d===r&&(c=s),p===a&&++u===i&&(l=s),null!==(m=h.nextSibling))break;p=(h=p).parentNode}h=m}n=-1===c||-1===l?null:{start:c,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},Wt=!1,Xs=t;null!==Xs;)if(e=(t=Xs).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Xs=e;else for(;null!==Xs;){t=Xs;try{var f=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var g=f.memoizedProps,v=f.memoizedState,b=t.stateNode,y=b.getSnapshotBeforeUpdate(t.elementType===t.type?g:ns(t.type,g),v);b.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var k=t.stateNode.containerInfo;1===k.nodeType?k.textContent="":9===k.nodeType&&k.documentElement&&k.removeChild(k.documentElement);break;default:throw Error(o(163))}}catch(T){El(t,t.return,T)}if(null!==(e=t.sibling)){e.return=t.return,Xs=e;break}Xs=t.return}f=tc,tc=!1}(e,n),gc(n,e),mi(tr),Wt=!!er,tr=er=null,e.current=n,bc(n,e,r),Ye(),Ic=c,yt=s,Rc.transition=a}else e.current=n;if(Gc&&(Gc=!1,Qc=e,Jc=r),a=e.pendingLanes,0===a&&(Hc=null),function(e){if(ot&&"function"===typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),il(e,$e()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Wc)throw Wc=!1,e=Kc,Kc=null,e;0!==(1&Jc)&&0!==e.tag&&Sl(),a=e.pendingLanes,0!==(1&a)?e===$c?Yc++:(Yc=0,$c=e):Yc=0,qr()}(e,t,n,i)}finally{Rc.transition=r,yt=i}return null}function Sl(){if(null!==Qc){var e=kt(Jc),t=Rc.transition,n=yt;try{if(Rc.transition=null,yt=16>e?16:e,null===Qc)var i=!1;else{if(e=Qc,Qc=null,Jc=0,0!==(6&Ic))throw Error(o(331));var r=Ic;for(Ic|=4,Xs=e.current;null!==Xs;){var a=Xs,s=a.child;if(0!==(16&Xs.flags)){var c=a.deletions;if(null!==c){for(var l=0;l<c.length;l++){var d=c[l];for(Xs=d;null!==Xs;){var u=Xs;switch(u.tag){case 0:case 11:case 15:nc(8,u,a)}var h=u.child;if(null!==h)h.return=u,Xs=h;else for(;null!==Xs;){var p=(u=Xs).sibling,m=u.return;if(oc(u),u===d){Xs=null;break}if(null!==p){p.return=m,Xs=p;break}Xs=m}}}var f=a.alternate;if(null!==f){var g=f.child;if(null!==g){f.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Xs=a}}if(0!==(2064&a.subtreeFlags)&&null!==s)s.return=a,Xs=s;else e:for(;null!==Xs;){if(0!==(2048&(a=Xs).flags))switch(a.tag){case 0:case 11:case 15:nc(9,a,a.return)}var b=a.sibling;if(null!==b){b.return=a.return,Xs=b;break e}Xs=a.return}}var y=e.current;for(Xs=y;null!==Xs;){var k=(s=Xs).child;if(0!==(2064&s.subtreeFlags)&&null!==k)k.return=s,Xs=k;else e:for(s=y;null!==Xs;){if(0!==(2048&(c=Xs).flags))try{switch(c.tag){case 0:case 11:case 15:ic(9,c)}}catch(S){El(c,c.return,S)}if(c===s){Xs=null;break e}var T=c.sibling;if(null!==T){T.return=c.return,Xs=T;break e}Xs=c.return}}if(Ic=r,qr(),ot&&"function"===typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(rt,e)}catch(S){}i=!0}return i}finally{yt=n,Rc.transition=t}}return!1}function Cl(e,t,n){e=Bo(e,t=ps(0,t=ls(n,t),1),1),t=el(),null!==e&&(vt(e,1,t),il(e,t))}function El(e,t,n){if(3===e.tag)Cl(e,e,n);else for(;null!==t;){if(3===t.tag){Cl(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Hc||!Hc.has(i))){t=Bo(t,e=ms(t,e=ls(n,e),1),1),e=el(),null!==t&&(vt(t,1,e),il(t,e));break}}t=t.return}}function wl(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=el(),e.pingedLanes|=e.suspendedLanes&n,Oc===e&&(_c&n)===n&&(4===Dc||3===Dc&&(130023424&_c)===_c&&500>$e()-Vc?hl(e,0):jc|=n),il(e,t)}function Pl(e,t){0===t&&(0===(1&e.mode)?t=1:(t=dt,0===(130023424&(dt<<=1))&&(dt=4194304)));var n=el();null!==(e=Ao(e,t))&&(vt(e,t,n),il(e,n))}function Rl(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Pl(e,n)}function Il(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(o(314))}null!==i&&i.delete(t),Pl(e,n)}function Ol(e,t){return Ge(e,t)}function xl(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _l(e,t,n,i){return new xl(e,t,n,i)}function Nl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ml(e,t){var n=e.alternate;return null===n?((n=_l(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Dl(e,t,n,i,r,a){var s=2;if(i=e,"function"===typeof e)Nl(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case C:return Al(n.children,r,a,t);case E:s=8,r|=8;break;case w:return(e=_l(12,n,t,2|r)).elementType=w,e.lanes=a,e;case O:return(e=_l(13,n,t,r)).elementType=O,e.lanes=a,e;case x:return(e=_l(19,n,t,r)).elementType=x,e.lanes=a,e;case M:return Ll(n,r,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case P:s=10;break e;case R:s=9;break e;case I:s=11;break e;case _:s=14;break e;case N:s=16,i=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=_l(s,n,t,r)).elementType=e,t.type=i,t.lanes=a,t}function Al(e,t,n,i){return(e=_l(7,e,i,t)).lanes=n,e}function Ll(e,t,n,i){return(e=_l(22,e,i,t)).elementType=M,e.lanes=n,e.stateNode={isHidden:!1},e}function Ul(e,t,n){return(e=_l(6,e,null,t)).lanes=n,e}function jl(e,t,n){return(t=_l(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Fl(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Bl(e,t,n,i,r,o,a,s,c){return e=new Fl(e,t,n,s,c),1===t?(t=1,!0===o&&(t|=8)):t=0,o=_l(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Uo(o),e}function Vl(e){if(!e)return Rr;e:{if(qe(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Nr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(Nr(n))return Ar(e,n,t)}return t}function ql(e,t,n,i,r,o,a,s,c){return(e=Bl(n,i,!0,e,0,o,0,s,c)).context=Vl(null),n=e.current,(o=Fo(i=el(),r=tl(n))).callback=void 0!==t&&null!==t?t:null,Bo(n,o,r),e.current.lanes=r,vt(e,r,i),il(e,i),e}function zl(e,t,n,i){var r=t.current,o=el(),a=tl(r);return n=Vl(n),null===t.context?t.context=n:t.pendingContext=n,(t=Fo(o,a)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Bo(r,t,a))&&(nl(e,r,a,o),Vo(e,r,a)),a}function Wl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Kl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Hl(e,t){Kl(e,t),(e=e.alternate)&&Kl(e,t)}Cc=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Or.current)ys=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return ys=!1,function(e,t,n){switch(t.tag){case 3:Os(t),mo();break;case 5:Xo(t);break;case 1:Nr(t.type)&&Lr(t);break;case 4:Yo(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;Pr(Co,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Pr(ea,1&ea.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Us(e,t,n):(Pr(ea,1&ea.current),null!==(e=Ws(e,t,n))?e.sibling:null);Pr(ea,1&ea.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return qs(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Pr(ea,ea.current),i)break;return null;case 22:case 23:return t.lanes=0,Es(e,t,n)}return Ws(e,t,n)}(e,t,n);ys=0!==(131072&e.flags)}else ys=!1,ro&&0!==(1048576&t.flags)&&Zr(t,Hr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;zs(e,t),e=t.pendingProps;var r=_r(t,Ir.current);xo(t,n),r=ga(null,t,i,e,r,n);var a=va();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Nr(i)?(a=!0,Lr(t)):a=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Uo(t),r.updater=rs,t.stateNode=r,r._reactInternals=t,cs(t,i,e,n),t=Is(null,t,i,!0,a,n)):(t.tag=0,ro&&a&&eo(t),ks(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(zs(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return Nl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===I)return 11;if(e===_)return 14}return 2}(i),e=ns(i,e),r){case 0:t=Ps(null,t,i,e,n);break e;case 1:t=Rs(null,t,i,e,n);break e;case 11:t=Ts(null,t,i,e,n);break e;case 14:t=Ss(null,t,i,ns(i.type,e),n);break e}throw Error(o(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Ps(e,t,i,r=t.elementType===i?r:ns(i,r),n);case 1:return i=t.type,r=t.pendingProps,Rs(e,t,i,r=t.elementType===i?r:ns(i,r),n);case 3:e:{if(Os(t),null===e)throw Error(o(387));i=t.pendingProps,r=(a=t.memoizedState).element,jo(e,t),zo(t,i,null,n);var s=t.memoizedState;if(i=s.element,a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=xs(e,t,i,n,r=ls(Error(o(423)),t));break e}if(i!==r){t=xs(e,t,i,n,r=ls(Error(o(424)),t));break e}for(io=lr(t.stateNode.containerInfo.firstChild),no=t,ro=!0,oo=null,n=So(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(mo(),i===r){t=Ws(e,t,n);break e}ks(e,t,i,n)}t=t.child}return t;case 5:return Xo(t),null===e&&lo(t),i=t.type,r=t.pendingProps,a=null!==e?e.memoizedProps:null,s=r.children,nr(i,r)?s=null:null!==a&&nr(i,a)&&(t.flags|=32),ws(e,t),ks(e,t,s,n),t.child;case 6:return null===e&&lo(t),null;case 13:return Us(e,t,n);case 4:return Yo(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=To(t,null,i,n):ks(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,Ts(e,t,i,r=t.elementType===i?r:ns(i,r),n);case 7:return ks(e,t,t.pendingProps,n),t.child;case 8:case 12:return ks(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,a=t.memoizedProps,s=r.value,Pr(Co,i._currentValue),i._currentValue=s,null!==a)if(si(a.value,s)){if(a.children===r.children&&!Or.current){t=Ws(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var c=a.dependencies;if(null!==c){s=a.child;for(var l=c.firstContext;null!==l;){if(l.context===i){if(1===a.tag){(l=Fo(-1,n&-n)).tag=2;var d=a.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?l.next=l:(l.next=u.next,u.next=l),d.pending=l}}a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),Oo(a.return,n,t),c.lanes|=n;break}l=l.next}}else if(10===a.tag)s=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(o(341));s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),Oo(s,n,t),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===t){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}ks(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,xo(t,n),i=i(r=_o(r)),t.flags|=1,ks(e,t,i,n),t.child;case 14:return r=ns(i=t.type,t.pendingProps),Ss(e,t,i,r=ns(i.type,r),n);case 15:return Cs(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:ns(i,r),zs(e,t),t.tag=1,Nr(i)?(e=!0,Lr(t)):e=!1,xo(t,n),as(t,i,r),cs(t,i,r,n),Is(null,t,i,!0,e,n);case 19:return qs(e,t,n);case 22:return Es(e,t,n)}throw Error(o(156,t.tag))};var Gl="function"===typeof reportError?reportError:function(e){console.error(e)};function Ql(e){this._internalRoot=e}function Jl(e){this._internalRoot=e}function Yl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function $l(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Xl(){}function Zl(e,t,n,i,r){var o=n._reactRootContainer;if(o){var a=o;if("function"===typeof r){var s=r;r=function(){var e=Wl(a);s.call(e)}}zl(t,a,e,r)}else a=function(e,t,n,i,r){if(r){if("function"===typeof i){var o=i;i=function(){var e=Wl(a);o.call(e)}}var a=ql(t,i,e,0,null,!1,0,"",Xl);return e._reactRootContainer=a,e[mr]=a.current,qi(8===e.nodeType?e.parentNode:e),dl(),a}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof i){var s=i;i=function(){var e=Wl(c);s.call(e)}}var c=Bl(e,0,!1,null,0,!1,0,"",Xl);return e._reactRootContainer=c,e[mr]=c.current,qi(8===e.nodeType?e.parentNode:e),dl((function(){zl(t,c,n,i)})),c}(n,t,e,r,i);return Wl(a)}Jl.prototype.render=Ql.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));zl(e,t,null,null)},Jl.prototype.unmount=Ql.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dl((function(){zl(null,e,null,null)})),t[mr]=null}},Jl.prototype.unstable_scheduleHydration=function(e){if(e){var t=Et();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Mt.length&&0!==t&&t<Mt[n].priority;n++);Mt.splice(n,0,e),0===n&&Ut(e)}},Tt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ut(t.pendingLanes);0!==n&&(bt(t,1|n),il(t,$e()),0===(6&Ic)&&(qc=$e()+500,qr()))}break;case 13:dl((function(){var t=Ao(e,1);if(null!==t){var n=el();nl(t,e,1,n)}})),Hl(e,1)}},St=function(e){if(13===e.tag){var t=Ao(e,134217728);if(null!==t)nl(t,e,134217728,el());Hl(e,134217728)}},Ct=function(e){if(13===e.tag){var t=tl(e),n=Ao(e,t);if(null!==n)nl(n,e,t,el());Hl(e,t)}},Et=function(){return yt},wt=function(e,t){var n=yt;try{return yt=e,t()}finally{yt=n}},Se=function(e,t,n){switch(t){case"input":if(X(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=Tr(i);if(!r)throw Error(o(90));G(i),X(i,r)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ie=ll,Oe=dl;var ed={usingClientEntryPoint:!1,Events:[yr,kr,Tr,Pe,Re,ll]},td={findFiberByHostInstance:br,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nd={bundleType:td.bundleType,version:td.version,rendererPackageName:td.rendererPackageName,rendererConfig:td.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:k.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ke(e))?null:e.stateNode},findFiberByHostInstance:td.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var id=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!id.isDisabled&&id.supportsFiber)try{rt=id.inject(nd),ot=id}catch(de){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ed,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yl(t))throw Error(o(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Yl(e))throw Error(o(299));var n=!1,i="",r=Gl;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Bl(e,1,!1,null,0,n,0,i,r),e[mr]=t.current,qi(8===e.nodeType?e.parentNode:e),new Ql(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=Ke(t))?null:e.stateNode},t.flushSync=function(e){return dl(e)},t.hydrate=function(e,t,n){if(!$l(t))throw Error(o(200));return Zl(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Yl(e))throw Error(o(405));var i=null!=n&&n.hydratedSources||null,r=!1,a="",s=Gl;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=ql(t,null,e,1,null!=n?n:null,r,0,a,s),e[mr]=t.current,qi(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Jl(t)},t.render=function(e,t,n){if(!$l(t))throw Error(o(200));return Zl(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!$l(e))throw Error(o(40));return!!e._reactRootContainer&&(dl((function(){Zl(null,null,e,!1,(function(){e._reactRootContainer=null,e[mr]=null}))})),!0)},t.unstable_batchedUpdates=ll,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!$l(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return Zl(e,t,n,!1,i)},t.version="18.3.1-next-f1338f8080-20240426"},391:(e,t,n)=>{"use strict";var i=n(950);t.H=i.createRoot,i.hydrateRoot},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)},153:(e,t,n)=>{"use strict";var i=n(43),r=Symbol.for("react.element"),o=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var i,o={},l=null,d=null;for(i in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,i)&&!c.hasOwnProperty(i)&&(o[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===o[i]&&(o[i]=t[i]);return{$$typeof:r,type:e,key:l,ref:d,props:o,_owner:s.current}}t.Fragment=o,t.jsx=l,t.jsxs=l},202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}function b(){}function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=v.prototype;var k=y.prototype=new b;k.constructor=y,f(k,v.prototype),k.isPureReactComponent=!0;var T=Array.isArray,S=Object.prototype.hasOwnProperty,C={current:null},E={key:!0,ref:!0,__self:!0,__source:!0};function w(e,t,i){var r,o={},a=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)S.call(t,r)&&!E.hasOwnProperty(r)&&(o[r]=t[r]);var c=arguments.length-2;if(1===c)o.children=i;else if(1<c){for(var l=Array(c),d=0;d<c;d++)l[d]=arguments[d+2];o.children=l}if(e&&e.defaultProps)for(r in c=e.defaultProps)void 0===o[r]&&(o[r]=c[r]);return{$$typeof:n,type:e,key:a,ref:s,props:o,_owner:C.current}}function P(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var R=/\/+/g;function I(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function O(e,t,r,o,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c=!1;if(null===e)c=!0;else switch(s){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case i:c=!0}}if(c)return a=a(c=e),e=""===o?"."+I(c,0):o,T(a)?(r="",null!=e&&(r=e.replace(R,"$&/")+"/"),O(a,t,r,"",(function(e){return e}))):null!=a&&(P(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,r+(!a.key||c&&c.key===a.key?"":(""+a.key).replace(R,"$&/")+"/")+e)),t.push(a)),1;if(c=0,o=""===o?".":o+":",T(e))for(var l=0;l<e.length;l++){var d=o+I(s=e[l],l);c+=O(s,t,r,d,a)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),l=0;!(s=e.next()).done;)c+=O(s=s.value,t,r,d=o+I(s,l++),a);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function x(e,t,n){if(null==e)return e;var i=[],r=0;return O(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function _(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var N={current:null},M={transition:null},D={ReactCurrentDispatcher:N,ReactCurrentBatchConfig:M,ReactCurrentOwner:C};function A(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:x,forEach:function(e,t,n){x(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return x(e,(function(){t++})),t},toArray:function(e){return x(e,(function(e){return e}))||[]},only:function(e){if(!P(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=r,t.Profiler=a,t.PureComponent=y,t.StrictMode=o,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,t.act=A,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=f({},e.props),o=e.key,a=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,s=C.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)S.call(t,l)&&!E.hasOwnProperty(l)&&(r[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)r.children=i;else if(1<l){c=Array(l);for(var d=0;d<l;d++)c[d]=arguments[d+2];r.children=c}return{$$typeof:n,type:e.type,key:o,ref:a,props:r,_owner:s}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=w,t.createFactory=function(e){var t=w.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=P,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:_}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=M.transition;M.transition={};try{e()}finally{M.transition=t}},t.unstable_act=A,t.useCallback=function(e,t){return N.current.useCallback(e,t)},t.useContext=function(e){return N.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return N.current.useDeferredValue(e)},t.useEffect=function(e,t){return N.current.useEffect(e,t)},t.useId=function(){return N.current.useId()},t.useImperativeHandle=function(e,t,n){return N.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return N.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return N.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return N.current.useMemo(e,t)},t.useReducer=function(e,t,n){return N.current.useReducer(e,t,n)},t.useRef=function(e){return N.current.useRef(e)},t.useState=function(e){return N.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return N.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return N.current.useTransition()},t.version="18.3.1"},43:(e,t,n)=>{"use strict";e.exports=n(202)},579:(e,t,n)=>{"use strict";e.exports=n(153)},234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<o(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,a=r>>>1;i<a;){var s=2*(i+1)-1,c=e[s],l=s+1,d=e[l];if(0>o(c,n))l<r&&0>o(d,c)?(e[i]=d,e[l]=n,i=l):(e[i]=c,e[s]=n,i=s);else{if(!(l<r&&0>o(d,n)))break e;e[i]=d,e[l]=n,i=l}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,c=s.now();t.unstable_now=function(){return s.now()-c}}var l=[],d=[],u=1,h=null,p=3,m=!1,f=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,b="function"===typeof clearTimeout?clearTimeout:null,y="undefined"!==typeof setImmediate?setImmediate:null;function k(e){for(var t=i(d);null!==t;){if(null===t.callback)r(d);else{if(!(t.startTime<=e))break;r(d),t.sortIndex=t.expirationTime,n(l,t)}t=i(d)}}function T(e){if(g=!1,k(e),!f)if(null!==i(l))f=!0,M(S);else{var t=i(d);null!==t&&D(T,t.startTime-e)}}function S(e,n){f=!1,g&&(g=!1,b(P),P=-1),m=!0;var o=p;try{for(k(n),h=i(l);null!==h&&(!(h.expirationTime>n)||e&&!O());){var a=h.callback;if("function"===typeof a){h.callback=null,p=h.priorityLevel;var s=a(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?h.callback=s:h===i(l)&&r(l),k(n)}else r(l);h=i(l)}if(null!==h)var c=!0;else{var u=i(d);null!==u&&D(T,u.startTime-n),c=!1}return c}finally{h=null,p=o,m=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var C,E=!1,w=null,P=-1,R=5,I=-1;function O(){return!(t.unstable_now()-I<R)}function x(){if(null!==w){var e=t.unstable_now();I=e;var n=!0;try{n=w(!0,e)}finally{n?C():(E=!1,w=null)}}else E=!1}if("function"===typeof y)C=function(){y(x)};else if("undefined"!==typeof MessageChannel){var _=new MessageChannel,N=_.port2;_.port1.onmessage=x,C=function(){N.postMessage(null)}}else C=function(){v(x,0)};function M(e){w=e,E||(E=!0,C())}function D(e,n){P=v((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||m||(f=!0,M(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,o){var a=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?a+o:a:o=a,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:u++,callback:r,priorityLevel:e,startTime:o,expirationTime:s=o+s,sortIndex:-1},o>a?(e.sortIndex=o,n(d,e),null===i(l)&&e===i(d)&&(g?(b(P),P=-1):g=!0,D(T,o-a))):(e.sortIndex=s,n(l,e),f||m||(f=!0,M(S))),e},t.unstable_shouldYield=O,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},853:(e,t,n)=>{"use strict";e.exports=n(234)}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),(()=>{"use strict";var e=n(43),t=n(391),i=n(278);function r(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(t.includes(i))continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=o(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}function s(e,t,n){return(t=a(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t){return t.forEach((function(t){t&&"string"!==typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var u=Object.defineProperty,h=(e,t,n)=>((e,t,n)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class p{constructor(){h(this,"_locking"),h(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){let e;this._locks+=1;const t=new Promise((t=>e=()=>{this._locks-=1,t()})),n=this._locking.then((()=>e));return this._locking=this._locking.then((()=>t)),n}}function m(e,t){if(!e)throw new Error(t)}function f(e){if("number"!==typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>2147483647||e<-2147483648)throw new Error("invalid int 32: "+e)}function g(e){if("number"!==typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>4294967295||e<0)throw new Error("invalid uint 32: "+e)}function v(e){if("number"!==typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw new Error("invalid float 32: "+e)}const b=Symbol("@bufbuild/protobuf/enum-type");function y(e){const t=e[b];return m(t,"missing enum type on enum object"),t}function k(e,t,n,i){e[b]=T(t,n.map((t=>({no:t.no,name:t.name,localName:e[t.no]}))))}function T(e,t,n){const i=Object.create(null),r=Object.create(null),o=[];for(const a of t){const e=C(a);o.push(e),i[a.name]=e,r[a.no]=e}return{typeName:e,values:o,findName:e=>i[e],findNumber:e=>r[e]}}function S(e,t,n){const i={};for(const r of t){const e=C(r);i[e.localName]=e.no,i[e.no]=e.localName}return k(i,e,t),i}function C(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}class E{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const n=this.getType().runtime.bin,i=n.makeReadOptions(t);return n.readMessage(this,i.readerFactory(e),e.byteLength,i),this}fromJson(e,t){const n=this.getType(),i=n.runtime.json,r=i.makeReadOptions(t);return i.readMessage(n,e,r,this),this}fromJsonString(e,t){let n;try{n=JSON.parse(e)}catch(i){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(i instanceof Error?i.message:String(i)))}return this.fromJson(n,t)}toBinary(e){const t=this.getType().runtime.bin,n=t.makeWriteOptions(e),i=n.writerFactory();return t.writeMessage(this,i,n),i.finish()}toJson(e){const t=this.getType().runtime.json,n=t.makeWriteOptions(e);return t.writeMessage(this,n)}toJsonString(e){var t;const n=this.toJson(e);return JSON.stringify(n,null,null!==(t=null===e||void 0===e?void 0:e.prettySpaces)&&void 0!==t?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function w(){let e=0,t=0;for(let i=0;i<28;i+=7){let n=this.buf[this.pos++];if(e|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(15&n)<<28,t=(112&n)>>4,0==(128&n))return this.assertBounds(),[e,t];for(let i=3;i<=31;i+=7){let n=this.buf[this.pos++];if(t|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function P(e,t,n){for(let o=0;o<28;o+=7){const i=e>>>o,r=!(i>>>7==0&&0==t),a=255&(r?128|i:i);if(n.push(a),!r)return}const i=e>>>28&15|(7&t)<<4,r=!(t>>3==0);if(n.push(255&(r?128|i:i)),r){for(let e=3;e<31;e+=7){const i=t>>>e,r=!(i>>>7==0),o=255&(r?128|i:i);if(n.push(o),!r)return}n.push(t>>>31&1)}}const R=4294967296;function I(e){const t="-"===e[0];t&&(e=e.slice(1));const n=1e6;let i=0,r=0;function o(t,o){const a=Number(e.slice(t,o));r*=n,i=i*n+a,i>=R&&(r+=i/R|0,i%=R)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),t?_(i,r):x(i,r)}function O(e,t){if(({lo:e,hi:t}=function(e,t){return{lo:e>>>0,hi:t>>>0}}(e,t)),t<=2097151)return String(R*t+e);const n=16777215&(e>>>24|t<<8),i=t>>16&65535;let r=(16777215&e)+6777216*n+6710656*i,o=n+8147497*i,a=2*i;const s=1e7;return r>=s&&(o+=Math.floor(r/s),r%=s),o>=s&&(a+=Math.floor(o/s),o%=s),a.toString()+N(o)+N(r)}function x(e,t){return{lo:0|e,hi:0|t}}function _(e,t){return t=~t,e?e=1+~e:t+=1,x(e,t)}const N=e=>{const t=String(e);return"0000000".slice(t.length)+t};function M(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function D(){let e=this.buf[this.pos++],t=127&e;if(0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,0==(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let n=5;0!==(128&e)&&n<10;n++)e=this.buf[this.pos++];if(0!=(128&e))throw new Error("invalid varint");return this.assertBounds(),t>>>0}const A=function(){const e=new DataView(new ArrayBuffer(8));if("function"===typeof BigInt&&"function"===typeof e.getBigInt64&&"function"===typeof e.getBigUint64&&"function"===typeof e.setBigInt64&&"function"===typeof e.setBigUint64&&("object"!=typeof process||"1"!=={NODE_ENV:"production",PUBLIC_URL:"/livekit-egress-template",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.BUF_BIGINT_DISABLE)){const t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),i=BigInt("0"),r=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){const i="bigint"==typeof e?e:BigInt(e);if(i>n||i<t)throw new Error("int64 invalid: ".concat(e));return i},uParse(e){const t="bigint"==typeof e?e:BigInt(e);if(t>r||t<i)throw new Error("uint64 invalid: ".concat(e));return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)),uDec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0))}}const t=e=>m(/^-?[0-9]+$/.test(e),"int64 invalid: ".concat(e)),n=e=>m(/^[0-9]+$/.test(e),"uint64 invalid: ".concat(e));return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),t(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),n(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),t(e),I(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),n(e),I(e)),dec:(e,t)=>function(e,t){let n=x(e,t);const i=2147483648&n.hi;i&&(n=_(n.lo,n.hi));const r=O(n.lo,n.hi);return i?"-"+r:r}(e,t),uDec:(e,t)=>O(e,t)}}();var L,U,j;function F(e,t,n){if(t===n)return!0;if(e==L.BYTES){if(!(t instanceof Uint8Array)||!(n instanceof Uint8Array))return!1;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}switch(e){case L.UINT64:case L.FIXED64:case L.INT64:case L.SFIXED64:case L.SINT64:return t==n}return!1}function B(e,t){switch(e){case L.BOOL:return!1;case L.UINT64:case L.FIXED64:case L.INT64:case L.SFIXED64:case L.SINT64:return 0==t?A.zero:"0";case L.DOUBLE:case L.FLOAT:return 0;case L.BYTES:return new Uint8Array(0);case L.STRING:return"";default:return 0}}function V(e,t){switch(e){case L.BOOL:return!1===t;case L.STRING:return""===t;case L.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return 0==t}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(L||(L={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING"}(U||(U={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(j||(j={}));class q{constructor(e){this.stack=[],this.textEncoder=null!==e&&void 0!==e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let t=new Uint8Array(e),n=0;for(let i=0;i<this.chunks.length;i++)t.set(this.chunks[i],n),n+=this.chunks[i].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(g(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return f(e),M(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){v(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){g(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){f(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return f(e),M(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=A.enc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=A.uEnc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=A.enc(e);return P(t.lo,t.hi,this.buf),this}sint64(e){let t=A.enc(e),n=t.hi>>31;return P(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}uint64(e){let t=A.uEnc(e);return P(t.lo,t.hi,this.buf),this}}class z{constructor(e,t){this.varint64=w,this.uint32=D,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!==t&&void 0!==t?t:new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e,t){let n=this.pos;switch(e){case j.Varint:for(;128&this.buf[this.pos++];);break;case j.Bit64:this.pos+=4;case j.Bit32:this.pos+=4;break;case j.LengthDelimited:let n=this.uint32();this.pos+=n;break;case j.StartGroup:for(;;){const[e,n]=this.tag();if(n===j.EndGroup){if(void 0!==t&&e!==t)throw new Error("invalid end group tag");break}this.skip(n,e)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return A.dec(...this.varint64())}uint64(){return A.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(1&e);return e=(e>>>1|(1&t)<<31)^n,t=t>>>1^n,A.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return A.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return A.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function W(e){const t=e.field.localName,n=Object.create(null);return n[t]=function(e){const t=e.field;if(t.repeated)return[];if(void 0!==t.default)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return B(t.T,t.L);case"message":const e=t.T,n=new e;return e.fieldWrapper?e.fieldWrapper.unwrapField(n):n;case"map":throw"map fields are not allowed to be extensions"}}(e),[n,()=>n[t]]}let K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),H=[];for(let n=0;n<K.length;n++)H[K[n].charCodeAt(0)]=n;H["-".charCodeAt(0)]=K.indexOf("+"),H["_".charCodeAt(0)]=K.indexOf("/");const G={dec(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let n,i=new Uint8Array(t),r=0,o=0,a=0;for(let s=0;s<e.length;s++){if(n=H[e.charCodeAt(s)],void 0===n)switch(e[s]){case"=":o=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(o){case 0:a=n,o=1;break;case 1:i[r++]=a<<2|(48&n)>>4,a=n,o=2;break;case 2:i[r++]=(15&a)<<4|(60&n)>>2,a=n,o=3;break;case 3:i[r++]=(3&a)<<6|n,o=0}}if(1==o)throw Error("invalid base64 string.");return i.subarray(0,r)},enc(e){let t,n="",i=0,r=0;for(let o=0;o<e.length;o++)switch(t=e[o],i){case 0:n+=K[t>>2],r=(3&t)<<4,i=1;break;case 1:n+=K[r|t>>4],r=(15&t)<<2,i=2;break;case 2:n+=K[r|t>>6],n+=K[63&t],i=0}return i&&(n+=K[r],n+="=",1==i&&(n+="=")),n}};function Q(e,t,n){$(t,e);const i=t.runtime.bin.makeReadOptions(n),r=function(e,t){if(!t.repeated&&("enum"==t.kind||"scalar"==t.kind)){for(let n=e.length-1;n>=0;--n)if(e[n].no==t.no)return[e[n]];return[]}return e.filter((e=>e.no===t.no))}(e.getType().runtime.bin.listUnknownFields(e),t.field),[o,a]=W(t);for(const s of r)t.runtime.bin.readField(o,i.readerFactory(s.data),t.field,s.wireType,i);return a()}function J(e,t,n,i){$(t,e);const r=t.runtime.bin.makeReadOptions(i),o=t.runtime.bin.makeWriteOptions(i);if(Y(e,t)){const n=e.getType().runtime.bin.listUnknownFields(e).filter((e=>e.no!=t.field.no));e.getType().runtime.bin.discardUnknownFields(e);for(const t of n)e.getType().runtime.bin.onUnknownField(e,t.no,t.wireType,t.data)}const a=o.writerFactory();let s=t.field;s.opt||s.repeated||"enum"!=s.kind&&"scalar"!=s.kind||(s=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(s,n,a,o);const c=r.readerFactory(a.finish());for(;c.pos<c.len;){const[t,n]=c.tag(),i=c.skip(n,t);e.getType().runtime.bin.onUnknownField(e,t,n,i)}}function Y(e,t){const n=e.getType();return t.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(e).find((e=>e.no==t.field.no))}function $(e,t){m(e.extendee.typeName==t.getType().typeName,"extension ".concat(e.typeName," can only be applied to message ").concat(e.extendee.typeName))}function X(e,t){const n=e.localName;if(e.repeated)return t[n].length>0;if(e.oneof)return t[e.oneof.localName].case===n;switch(e.kind){case"enum":case"scalar":return e.opt||e.req?void 0!==t[n]:"enum"==e.kind?t[n]!==e.T.values[0].no:!V(e.T,t[n]);case"message":return void 0!==t[n];case"map":return Object.keys(t[n]).length>0}}function Z(e,t){const n=e.localName,i=!e.opt&&!e.req;if(e.repeated)t[n]=[];else if(e.oneof)t[e.oneof.localName]={case:void 0};else switch(e.kind){case"map":t[n]={};break;case"enum":t[n]=i?e.T.values[0].no:void 0;break;case"scalar":t[n]=i?B(e.T,e.L):void 0;break;case"message":t[n]=void 0}}function ee(e,t){if(null===e||"object"!=typeof e)return!1;if(!Object.getOwnPropertyNames(E.prototype).every((t=>t in e&&"function"==typeof e[t])))return!1;const n=e.getType();return null!==n&&"function"==typeof n&&"typeName"in n&&"string"==typeof n.typeName&&(void 0===t||n.typeName==t.typeName)}function te(e,t){return ee(t)||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}L.DOUBLE,L.FLOAT,L.INT64,L.UINT64,L.INT32,L.UINT32,L.BOOL,L.STRING,L.BYTES;const ne={ignoreUnknownFields:!1},ie={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function re(e){return e?Object.assign(Object.assign({},ne),e):ne}function oe(e){return e?Object.assign(Object.assign({},ie),e):ie}const ae=Symbol(),se=Symbol();function ce(e){if(null===e)return"null";switch(typeof e){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":'"'.concat(e.split('"').join('\\"'),'"');default:return String(e)}}function le(e,t,n,i,r){let o=n.localName;if(n.repeated){if(m("map"!=n.kind),null===t)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ce(t)));const s=e[o];for(const e of t){if(null===e)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ce(e)));switch(n.kind){case"message":s.push(n.T.fromJson(e,i));break;case"enum":const t=he(n.T,e,i.ignoreUnknownFields,!0);t!==se&&s.push(t);break;case"scalar":try{s.push(ue(n.T,e,n.L,!0))}catch(a){let t="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ce(e));throw a instanceof Error&&a.message.length>0&&(t+=": ".concat(a.message)),new Error(t)}}}}else if("map"==n.kind){if(null===t)return;if("object"!=typeof t||Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ce(t)));const s=e[o];for(const[e,o]of Object.entries(t)){if(null===o)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let c;try{c=de(n.K,e)}catch(a){let e="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ce(t));throw a instanceof Error&&a.message.length>0&&(e+=": ".concat(a.message)),new Error(e)}switch(n.V.kind){case"message":s[c]=n.V.T.fromJson(o,i);break;case"enum":const e=he(n.V.T,o,i.ignoreUnknownFields,!0);e!==se&&(s[c]=e);break;case"scalar":try{s[c]=ue(n.V.T,o,U.BIGINT,!0)}catch(a){let e="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ce(t));throw a instanceof Error&&a.message.length>0&&(e+=": ".concat(a.message)),new Error(e)}}}}else switch(n.oneof&&(e=e[n.oneof.localName]={case:o},o="value"),n.kind){case"message":const s=n.T;if(null===t&&"google.protobuf.Value"!=s.typeName)return;let c=e[o];ee(c)?c.fromJson(t,i):(e[o]=c=s.fromJson(t,i),s.fieldWrapper&&!n.oneof&&(e[o]=s.fieldWrapper.unwrapField(c)));break;case"enum":const l=he(n.T,t,i.ignoreUnknownFields,!1);switch(l){case ae:Z(n,e);break;case se:break;default:e[o]=l}break;case"scalar":try{const i=ue(n.T,t,n.L,!1);if(i===ae)Z(n,e);else e[o]=i}catch(a){let e="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ce(t));throw a instanceof Error&&a.message.length>0&&(e+=": ".concat(a.message)),new Error(e)}}}function de(e,t){if(e===L.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1}return ue(e,t,U.BIGINT,!0).toString()}function ue(e,t,n,i){if(null===t)return i?B(e,n):ae;switch(e){case L.DOUBLE:case L.FLOAT:if("NaN"===t)return Number.NaN;if("Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(""===t)break;if("string"==typeof t&&t.trim().length!==t.length)break;if("string"!=typeof t&&"number"!=typeof t)break;const i=Number(t);if(Number.isNaN(i))break;if(!Number.isFinite(i))break;return e==L.FLOAT&&v(i),i;case L.INT32:case L.FIXED32:case L.SFIXED32:case L.SINT32:case L.UINT32:let o;if("number"==typeof t?o=t:"string"==typeof t&&t.length>0&&t.trim().length===t.length&&(o=Number(t)),void 0===o)break;return e==L.UINT32||e==L.FIXED32?g(o):f(o),o;case L.INT64:case L.SFIXED64:case L.SINT64:if("number"!=typeof t&&"string"!=typeof t)break;const a=A.parse(t);return n?a.toString():a;case L.FIXED64:case L.UINT64:if("number"!=typeof t&&"string"!=typeof t)break;const s=A.uParse(t);return n?s.toString():s;case L.BOOL:if("boolean"!==typeof t)break;return t;case L.STRING:if("string"!==typeof t)break;try{encodeURIComponent(t)}catch(r){throw new Error("invalid UTF8")}return t;case L.BYTES:if(""===t)return new Uint8Array(0);if("string"!==typeof t)break;return G.dec(t)}throw new Error}function he(e,t,n,i){if(null===t)return"google.protobuf.NullValue"==e.typeName?0:i?e.values[0].no:ae;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const i=e.findName(t);if(void 0!==i)return i.no;if(n)return se}throw new Error("cannot decode enum ".concat(e.typeName," from JSON: ").concat(ce(t)))}function pe(e){return!(!e.repeated&&"map"!=e.kind)||!e.oneof&&("message"!=e.kind&&(!e.opt&&!e.req))}function me(e,t,n){if("map"==e.kind){m("object"==typeof t&&null!=t);const i={},r=Object.entries(t);switch(e.V.kind){case"scalar":for(const[n,o]of r)i[n.toString()]=ge(e.V.T,o);break;case"message":for(const[e,o]of r)i[e.toString()]=o.toJson(n);break;case"enum":const t=e.V.T;for(const[e,o]of r)i[e.toString()]=fe(t,o,n.enumAsInteger)}return n.emitDefaultValues||r.length>0?i:void 0}if(e.repeated){m(Array.isArray(t));const i=[];switch(e.kind){case"scalar":for(let n=0;n<t.length;n++)i.push(ge(e.T,t[n]));break;case"enum":for(let r=0;r<t.length;r++)i.push(fe(e.T,t[r],n.enumAsInteger));break;case"message":for(let e=0;e<t.length;e++)i.push(t[e].toJson(n))}return n.emitDefaultValues||i.length>0?i:void 0}switch(e.kind){case"scalar":return ge(e.T,t);case"enum":return fe(e.T,t,n.enumAsInteger);case"message":return te(e.T,t).toJson(n)}}function fe(e,t,n){var i;if(m("number"==typeof t),"google.protobuf.NullValue"==e.typeName)return null;if(n)return t;const r=e.findNumber(t);return null!==(i=null===r||void 0===r?void 0:r.name)&&void 0!==i?i:t}function ge(e,t){switch(e){case L.INT32:case L.SFIXED32:case L.SINT32:case L.FIXED32:case L.UINT32:return m("number"==typeof t),t;case L.FLOAT:case L.DOUBLE:return m("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case L.STRING:return m("string"==typeof t),t;case L.BOOL:return m("boolean"==typeof t),t;case L.UINT64:case L.FIXED64:case L.INT64:case L.SFIXED64:case L.SINT64:return m("bigint"==typeof t||"string"==typeof t||"number"==typeof t),t.toString();case L.BYTES:return m(t instanceof Uint8Array),G.enc(t)}}const ve=Symbol("@bufbuild/protobuf/unknown-fields"),be={readUnknownFields:!0,readerFactory:e=>new z(e)},ye={writeUnknownFields:!0,writerFactory:()=>new q};function ke(e){return e?Object.assign(Object.assign({},be),e):be}function Te(e){return e?Object.assign(Object.assign({},ye),e):ye}function Se(e,t,n,i,r){let{repeated:o,localName:a}=n;switch(n.oneof&&((e=e[n.oneof.localName]).case!=a&&delete e.value,e.case=a,a="value"),n.kind){case"scalar":case"enum":const s="enum"==n.kind?L.INT32:n.T;let c=we;if("scalar"==n.kind&&n.L>0&&(c=Ee),o){let n=e[a];if(i==j.LengthDelimited&&s!=L.STRING&&s!=L.BYTES){let e=t.uint32()+t.pos;for(;t.pos<e;)n.push(c(t,s))}else n.push(c(t,s))}else e[a]=c(t,s);break;case"message":const l=n.T;o?e[a].push(Ce(t,new l,r,n)):ee(e[a])?Ce(t,e[a],r,n):(e[a]=Ce(t,new l,r,n),!l.fieldWrapper||n.oneof||n.repeated||(e[a]=l.fieldWrapper.unwrapField(e[a])));break;case"map":let[d,u]=function(e,t,n){const i=t.uint32(),r=t.pos+i;let o,a;for(;t.pos<r;){const[i]=t.tag();switch(i){case 1:o=we(t,e.K);break;case 2:switch(e.V.kind){case"scalar":a=we(t,e.V.T);break;case"enum":a=t.int32();break;case"message":a=Ce(t,new e.V.T,n,void 0)}}}void 0===o&&(o=B(e.K,U.BIGINT));"string"!=typeof o&&"number"!=typeof o&&(o=o.toString());if(void 0===a)switch(e.V.kind){case"scalar":a=B(e.V.T,U.BIGINT);break;case"enum":a=e.V.T.values[0].no;break;case"message":a=new e.V.T}return[o,a]}(n,t,r);e[a][d]=u}}function Ce(e,t,n,i){const r=t.getType().runtime.bin,o=null===i||void 0===i?void 0:i.delimited;return r.readMessage(t,e,o?i.no:e.uint32(),n,o),t}function Ee(e,t){const n=we(e,t);return"bigint"==typeof n?n.toString():n}function we(e,t){switch(t){case L.STRING:return e.string();case L.BOOL:return e.bool();case L.DOUBLE:return e.double();case L.FLOAT:return e.float();case L.INT32:return e.int32();case L.INT64:return e.int64();case L.UINT64:return e.uint64();case L.FIXED64:return e.fixed64();case L.BYTES:return e.bytes();case L.FIXED32:return e.fixed32();case L.SFIXED32:return e.sfixed32();case L.SFIXED64:return e.sfixed64();case L.SINT64:return e.sint64();case L.UINT32:return e.uint32();case L.SINT32:return e.sint32()}}function Pe(e,t,n,i){m(void 0!==t);const r=e.repeated;switch(e.kind){case"scalar":case"enum":let o="enum"==e.kind?L.INT32:e.T;if(r)if(m(Array.isArray(t)),e.packed)!function(e,t,n,i){if(!i.length)return;e.tag(n,j.LengthDelimited).fork();let[,r]=xe(t);for(let o=0;o<i.length;o++)e[r](i[o]);e.join()}(n,o,e.no,t);else for(const i of t)Oe(n,o,e.no,i);else Oe(n,o,e.no,t);break;case"message":if(r){m(Array.isArray(t));for(const r of t)Ie(n,i,e,r)}else Ie(n,i,e,t);break;case"map":m("object"==typeof t&&null!=t);for(const[r,a]of Object.entries(t))Re(n,i,e,r,a)}}function Re(e,t,n,i,r){e.tag(n.no,j.LengthDelimited),e.fork();let o=i;switch(n.K){case L.INT32:case L.FIXED32:case L.UINT32:case L.SFIXED32:case L.SINT32:o=Number.parseInt(i);break;case L.BOOL:m("true"==i||"false"==i),o="true"==i}switch(Oe(e,n.K,1,o),n.V.kind){case"scalar":Oe(e,n.V.T,2,r);break;case"enum":Oe(e,L.INT32,2,r);break;case"message":m(void 0!==r),e.tag(2,j.LengthDelimited).bytes(r.toBinary(t))}e.join()}function Ie(e,t,n,i){const r=te(n.T,i);n.delimited?e.tag(n.no,j.StartGroup).raw(r.toBinary(t)).tag(n.no,j.EndGroup):e.tag(n.no,j.LengthDelimited).bytes(r.toBinary(t))}function Oe(e,t,n,i){m(void 0!==i);let[r,o]=xe(t);e.tag(n,r)[o](i)}function xe(e){let t=j.Varint;switch(e){case L.BYTES:case L.STRING:t=j.LengthDelimited;break;case L.DOUBLE:case L.FIXED64:case L.SFIXED64:t=j.Bit64;break;case L.FIXED32:case L.SFIXED32:case L.FLOAT:t=j.Bit32}return[t,L[e].toLowerCase()]}function _e(e){if(void 0===e)return e;if(ee(e))return e.clone();if(e instanceof Uint8Array){const t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function Ne(e){return e instanceof Uint8Array?e:new Uint8Array(e)}class Me{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const e={};for(const t of this.list())e[t.jsonName]=e[t.name]=t;this.jsonNames=e}return this.jsonNames[e]}find(e){if(!this.numbers){const e={};for(const t of this.list())e[t.no]=t;this.numbers=e}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort(((e,t)=>e.no-t.no))),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const n of this.list())n.oneof?n.oneof!==t&&(t=n.oneof,e.push(t)):e.push(n)}return this.members}}function De(e,t){const n=Le(e);return t?n:Ve(Be(n))}const Ae=Le;function Le(e){let t=!1;const n=[];for(let i=0;i<e.length;i++){let r=e.charAt(i);switch(r){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),t=!1;break;default:t&&(t=!1,r=r.toUpperCase()),n.push(r)}}return n.join("")}const Ue=new Set(["constructor","toString","toJSON","valueOf"]),je=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Fe=e=>"".concat(e,"$"),Be=e=>je.has(e)?Fe(e):e,Ve=e=>Ue.has(e)?Fe(e):e;class qe{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=De(e,!1)}addField(e){m(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[e]}}const ze=(We=e=>new Me(e,(e=>function(e){var t,n,i,r,o,a;const s=[];let c;for(const l of"function"==typeof e?e():e){const e=l;if(e.localName=De(l.name,void 0!==l.oneof),e.jsonName=null!==(t=l.jsonName)&&void 0!==t?t:Ae(l.name),e.repeated=null!==(n=l.repeated)&&void 0!==n&&n,"scalar"==l.kind&&(e.L=null!==(i=l.L)&&void 0!==i?i:U.BIGINT),e.delimited=null!==(r=l.delimited)&&void 0!==r&&r,e.req=null!==(o=l.req)&&void 0!==o&&o,e.opt=null!==(a=l.opt)&&void 0!==a&&a,void 0===l.packed&&(e.packed="enum"==l.kind||"scalar"==l.kind&&l.T!=L.BYTES&&l.T!=L.STRING),void 0!==l.oneof){const t="string"==typeof l.oneof?l.oneof:l.oneof.name;c&&c.name==t||(c=new qe(t)),e.oneof=c,c.addField(e)}s.push(e)}return s}(e))),Ke=e=>{for(const t of e.getType().fields.byMember()){if(t.opt)continue;const n=t.localName,i=e;if(t.repeated)i[n]=[];else switch(t.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=B(t.T,t.L)}}},{syntax:"proto3",json:{makeReadOptions:re,makeWriteOptions:oe,readMessage(e,t,n,i){if(null==t||Array.isArray(t)||"object"!=typeof t)throw new Error("cannot decode message ".concat(e.typeName," from JSON: ").concat(ce(t)));i=null!==i&&void 0!==i?i:new e;const r=new Map,o=n.typeRegistry;for(const[a,s]of Object.entries(t)){const t=e.fields.findJsonName(a);if(t){if(t.oneof){if(null===s&&"scalar"==t.kind)continue;const n=r.get(t.oneof);if(void 0!==n)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: multiple keys for oneof "').concat(t.oneof.name,'" present: "').concat(n,'", "').concat(a,'"'));r.set(t.oneof,a)}le(i,s,t,n,e)}else{let t=!1;if((null===o||void 0===o?void 0:o.findExtension)&&a.startsWith("[")&&a.endsWith("]")){const r=o.findExtension(a.substring(1,a.length-1));if(r&&r.extendee.typeName==e.typeName){t=!0;const[e,o]=W(r);le(e,s,r.field,n,r),J(i,r,o(),n)}}if(!t&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: key "').concat(a,'" is unknown'))}}return i},writeMessage(e,t){const n=e.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!X(r,e)){if(r.req)throw"required field not set";if(!t.emitDefaultValues)continue;if(!pe(r))continue}const n=me(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t);void 0!==n&&(i[t.useProtoFieldName?r.name:r.jsonName]=n)}const o=t.typeRegistry;if(null===o||void 0===o?void 0:o.findExtensionFor)for(const r of n.runtime.bin.listUnknownFields(e)){const a=o.findExtensionFor(n.typeName,r.no);if(a&&Y(e,a)){const n=Q(e,a,t),r=me(a.field,n,t);void 0!==r&&(i[a.field.jsonName]=r)}}}catch(o){const e=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),t=o instanceof Error?o.message:String(o);throw new Error(e+(t.length>0?": ".concat(t):""))}return i},readScalar:(e,t,n)=>ue(e,t,null!==n&&void 0!==n?n:U.BIGINT,!0),writeScalar(e,t,n){if(void 0!==t)return n||V(e,t)?ge(e,t):void 0},debug:ce},bin:{makeReadOptions:ke,makeWriteOptions:Te,listUnknownFields(e){var t;return null!==(t=e[ve])&&void 0!==t?t:[]},discardUnknownFields(e){delete e[ve]},writeUnknownFields(e,t){const n=e[ve];if(n)for(const i of n)t.tag(i.no,i.wireType).raw(i.data)},onUnknownField(e,t,n,i){const r=e;Array.isArray(r[ve])||(r[ve]=[]),r[ve].push({no:t,wireType:n,data:i})},readMessage(e,t,n,i,r){const o=e.getType(),a=r?t.len:t.pos+n;let s,c;for(;t.pos<a&&([s,c]=t.tag(),!0!==r||c!=j.EndGroup);){const n=o.fields.find(s);if(n)Se(e,t,n,c,i);else{const n=t.skip(c,s);i.readUnknownFields&&this.onUnknownField(e,s,c,n)}}if(r&&(c!=j.EndGroup||s!==n))throw new Error("invalid end group tag")},readField:Se,writeMessage(e,t,n){const i=e.getType();for(const r of i.fields.byNumber())if(X(r,e))Pe(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t,n);else if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));return n.writeUnknownFields&&this.writeUnknownFields(e,t),t},writeField(e,t,n,i){void 0!==t&&Pe(e,t,n,i)}},util:Object.assign(Object.assign({},{setEnumType:k,initPartial(e,t){if(void 0===e)return;const n=t.getType();for(const i of n.fields.byMember()){const n=i.localName,r=t,o=e;if(null!=o[n])switch(i.kind){case"oneof":const e=o[n].case;if(void 0===e)continue;const t=i.findField(e);let a=o[n].value;t&&"message"==t.kind&&!ee(a,t.T)?a=new t.T(a):t&&"scalar"===t.kind&&t.T===L.BYTES&&(a=Ne(a)),r[n]={case:e,value:a};break;case"scalar":case"enum":let s=o[n];i.T===L.BYTES&&(s=i.repeated?s.map(Ne):Ne(s)),r[n]=s;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===L.BYTES)for(const[t,i]of Object.entries(o[n]))r[n][t]=Ne(i);else Object.assign(r[n],o[n]);break;case"message":const e=i.V.T;for(const t of Object.keys(o[n])){let i=o[n][t];e.fieldWrapper||(i=new e(i)),r[n][t]=i}}break;case"message":const c=i.T;if(i.repeated)r[n]=o[n].map((e=>ee(e,c)?e:new c(e)));else{const e=o[n];c.fieldWrapper?"google.protobuf.BytesValue"===c.typeName?r[n]=Ne(e):r[n]=e:r[n]=ee(e,c)?e:new c(e)}}}},equals:(e,t,n)=>t===n||!(!t||!n)&&e.fields.byMember().every((e=>{const i=t[e.localName],r=n[e.localName];if(e.repeated){if(i.length!==r.length)return!1;switch(e.kind){case"message":return i.every(((t,n)=>e.T.equals(t,r[n])));case"scalar":return i.every(((t,n)=>F(e.T,t,r[n])));case"enum":return i.every(((e,t)=>F(L.INT32,e,r[t])))}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":return e.T.equals(i,r);case"enum":return F(L.INT32,i,r);case"scalar":return F(e.T,i,r);case"oneof":if(i.case!==r.case)return!1;const t=e.findField(i.case);if(void 0===t)return!0;switch(t.kind){case"message":return t.T.equals(i.value,r.value);case"enum":return F(L.INT32,i.value,r.value);case"scalar":return F(t.T,i.value,r.value)}throw new Error("oneof cannot contain ".concat(t.kind));case"map":const n=Object.keys(i).concat(Object.keys(r));switch(e.V.kind){case"message":const t=e.V.T;return n.every((e=>t.equals(i[e],r[e])));case"enum":return n.every((e=>F(L.INT32,i[e],r[e])));case"scalar":const o=e.V.T;return n.every((e=>F(o,i[e],r[e])))}}})),clone(e){const t=e.getType(),n=new t,i=n;for(const r of t.fields.byMember()){const t=e[r.localName];let n;if(r.repeated)n=t.map(_e);else if("map"==r.kind){n=i[r.localName];for(const[e,i]of Object.entries(t))n[e]=_e(i)}else n="oneof"==r.kind?r.findField(t.case)?{case:t.case,value:_e(t.value)}:{case:void 0}:_e(t);i[r.localName]=n}for(const r of t.runtime.bin.listUnknownFields(e))t.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}),{newFieldList:We,initFields:Ke}),makeMessageType(e,t,n){return function(e,t,n,i){var r;const o=null!==(r=null===i||void 0===i?void 0:i.localName)&&void 0!==r?r:t.substring(t.lastIndexOf(".")+1),a={[o]:function(t){e.util.initFields(this),e.util.initPartial(t,this)}}[o];return Object.setPrototypeOf(a.prototype,new E),Object.assign(a,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary:(e,t)=>(new a).fromBinary(e,t),fromJson:(e,t)=>(new a).fromJson(e,t),fromJsonString:(e,t)=>(new a).fromJsonString(e,t),equals:(t,n)=>e.util.equals(a,t,n)}),a}(this,e,t,n)},makeEnum:S,makeEnumType:T,getEnumType:y,makeExtension(e,t,n){return function(e,t,n,i){let r;return{typeName:t,extendee:n,get field(){if(!r){const n="function"==typeof i?i():i;n.name=t.split(".").pop(),n.jsonName="[".concat(t,"]"),r=e.util.newFieldList([n]).list()[0]}return r},runtime:e}}(this,e,t,n)}});var We,Ke;class He extends E{constructor(e){super(),this.seconds=A.zero,this.nanos=0,ze.util.initPartial(e,this)}fromJson(e,t){if("string"!==typeof e)throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(ze.json.debug(e)));const n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=A.parse(i/1e3),this.nanos=0,n[7]&&(this.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),this}toJson(e){const t=1e3*Number(this.seconds);if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let n="Z";if(this.nanos>0){const e=(this.nanos+1e9).toString().substring(1);n="000000"===e.substring(3)?"."+e.substring(0,3)+"Z":"000"===e.substring(6)?"."+e.substring(0,6)+"Z":"."+e+"Z"}return new Date(t).toISOString().replace(".000Z",n)}toDate(){return new Date(1e3*Number(this.seconds)+Math.ceil(this.nanos/1e6))}static now(){return He.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new He({seconds:A.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return(new He).fromBinary(e,t)}static fromJson(e,t){return(new He).fromJson(e,t)}static fromJsonString(e,t){return(new He).fromJsonString(e,t)}static equals(e,t){return ze.util.equals(He,e,t)}}He.runtime=ze,He.typeName="google.protobuf.Timestamp",He.fields=ze.util.newFieldList((()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]));const Ge=ze.makeMessageType("livekit.MetricsBatch",(()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:He},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:Qe,repeated:!0},{no:5,name:"events",kind:"message",T:Ye,repeated:!0}])),Qe=ze.makeMessageType("livekit.TimeSeriesMetric",(()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:Je,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}])),Je=ze.makeMessageType("livekit.MetricSample",(()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:He},{no:3,name:"value",kind:"scalar",T:2}])),Ye=ze.makeMessageType("livekit.EventMetric",(()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:He},{no:7,name:"normalized_end_timestamp",kind:"message",T:He,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}])),$e=ze.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Xe=ze.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Ze=ze.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),et=ze.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),tt=ze.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),nt=ze.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"}]),it=ze.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),rt=ze.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),ot=ze.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),at=ze.makeMessageType("livekit.Room",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:st,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Ut}])),st=ze.makeMessageType("livekit.Codec",(()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}])),ct=ze.makeMessageType("livekit.ParticipantPermission",(()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:ze.getEnumType(Xe),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}])),lt=ze.makeMessageType("livekit.ParticipantInfo",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:ze.getEnumType(dt)},{no:4,name:"tracks",kind:"message",T:mt,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:ct},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:ze.getEnumType(ut)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:ze.getEnumType(nt)}])),dt=ze.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),ut=ze.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),ht=ze.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),pt=ze.makeMessageType("livekit.SimulcastCodecInfo",(()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ft,repeated:!0}])),mt=ze.makeMessageType("livekit.TrackInfo",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:ze.getEnumType($e)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:ze.getEnumType(Xe)},{no:10,name:"layers",kind:"message",T:ft,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:pt,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:ze.getEnumType(ht)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Ut},{no:19,name:"audio_features",kind:"enum",T:ze.getEnumType(ot),repeated:!0}])),ft=ze.makeMessageType("livekit.VideoLayer",(()=>[{no:1,name:"quality",kind:"enum",T:ze.getEnumType(Ze)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}])),gt=ze.makeMessageType("livekit.DataPacket",(()=>[{no:1,name:"kind",kind:"enum",T:ze.getEnumType(vt)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:kt,oneof:"value"},{no:3,name:"speaker",kind:"message",T:bt,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:Tt,oneof:"value"},{no:7,name:"transcription",kind:"message",T:St,oneof:"value"},{no:8,name:"metrics",kind:"message",T:Ge,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Et,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:wt,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Pt,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Rt,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Vt,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:qt,oneof:"value"}])),vt=ze.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),bt=ze.makeMessageType("livekit.ActiveSpeakerUpdate",(()=>[{no:1,name:"speakers",kind:"message",T:yt,repeated:!0}])),yt=ze.makeMessageType("livekit.SpeakerInfo",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}])),kt=ze.makeMessageType("livekit.UserPacket",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0}])),Tt=ze.makeMessageType("livekit.SipDTMF",(()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}])),St=ze.makeMessageType("livekit.Transcription",(()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:Ct,repeated:!0}])),Ct=ze.makeMessageType("livekit.TranscriptionSegment",(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}])),Et=ze.makeMessageType("livekit.ChatMessage",(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}])),wt=ze.makeMessageType("livekit.RpcRequest",(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}])),Pt=ze.makeMessageType("livekit.RpcAck",(()=>[{no:1,name:"request_id",kind:"scalar",T:9}])),Rt=ze.makeMessageType("livekit.RpcResponse",(()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:It,oneof:"value"}])),It=ze.makeMessageType("livekit.RpcError",(()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}])),Ot=ze.makeMessageType("livekit.ParticipantTracks",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}])),xt=ze.makeMessageType("livekit.ServerInfo",(()=>[{no:1,name:"edition",kind:"enum",T:ze.getEnumType(_t)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}])),_t=ze.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),Nt=ze.makeMessageType("livekit.ClientInfo",(()=>[{no:1,name:"sdk",kind:"enum",T:ze.getEnumType(Mt)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}])),Mt=ze.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"}]),Dt=ze.makeMessageType("livekit.ClientConfiguration",(()=>[{no:1,name:"video",kind:"message",T:At},{no:2,name:"screen",kind:"message",T:At},{no:3,name:"resume_connection",kind:"enum",T:ze.getEnumType(tt)},{no:4,name:"disabled_codecs",kind:"message",T:Lt},{no:5,name:"force_relay",kind:"enum",T:ze.getEnumType(tt)}])),At=ze.makeMessageType("livekit.VideoConfiguration",(()=>[{no:1,name:"hardware_encoder",kind:"enum",T:ze.getEnumType(tt)}])),Lt=ze.makeMessageType("livekit.DisabledCodecs",(()=>[{no:1,name:"codecs",kind:"message",T:st,repeated:!0},{no:2,name:"publish",kind:"message",T:st,repeated:!0}])),Ut=ze.makeMessageType("livekit.TimedVersion",(()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}])),jt=ze.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),Ft=ze.makeMessageType("livekit.DataStream.TextHeader",(()=>[{no:1,name:"operation_type",kind:"enum",T:ze.getEnumType(jt)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}]),{localName:"DataStream_TextHeader"}),Bt=ze.makeMessageType("livekit.DataStream.FileHeader",(()=>[{no:1,name:"file_name",kind:"scalar",T:9}]),{localName:"DataStream_FileHeader"}),Vt=ze.makeMessageType("livekit.DataStream.Header",(()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:6,name:"total_chunks",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:ze.getEnumType(ht)},{no:8,name:"extensions",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Ft,oneof:"content_header"},{no:10,name:"file_header",kind:"message",T:Bt,oneof:"content_header"}]),{localName:"DataStream_Header"}),qt=ze.makeMessageType("livekit.DataStream.Chunk",(()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"complete",kind:"scalar",T:8},{no:5,name:"version",kind:"scalar",T:5},{no:6,name:"iv",kind:"scalar",T:12,opt:!0}]),{localName:"DataStream_Chunk"}),zt=ze.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Wt=ze.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),Kt=ze.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),Ht=ze.makeMessageType("livekit.SignalRequest",(()=>[{no:1,name:"offer",kind:"message",T:nn,oneof:"message"},{no:2,name:"answer",kind:"message",T:nn,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Yt,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Jt,oneof:"message"},{no:5,name:"mute",kind:"message",T:$t,oneof:"message"},{no:6,name:"subscription",kind:"message",T:on,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:an,oneof:"message"},{no:8,name:"leave",kind:"message",T:ln,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:un,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:En,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Pn,oneof:"message"},{no:13,name:"simulate",kind:"message",T:In,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:hn,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:On,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:sn,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:cn,oneof:"message"}])),Gt=ze.makeMessageType("livekit.SignalResponse",(()=>[{no:1,name:"join",kind:"message",T:Xt,oneof:"message"},{no:2,name:"answer",kind:"message",T:nn,oneof:"message"},{no:3,name:"offer",kind:"message",T:nn,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Yt,oneof:"message"},{no:5,name:"update",kind:"message",T:rn,oneof:"message"},{no:6,name:"track_published",kind:"message",T:en,oneof:"message"},{no:8,name:"leave",kind:"message",T:ln,oneof:"message"},{no:9,name:"mute",kind:"message",T:$t,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:mn,oneof:"message"},{no:11,name:"room_update",kind:"message",T:fn,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:vn,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:yn,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:Sn,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:wn,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:tn,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:Zt,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:xn,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:Mn,oneof:"message"},{no:22,name:"request_response",kind:"message",T:Dn,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:Ln,oneof:"message"}])),Qt=ze.makeMessageType("livekit.SimulcastCodec",(()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}])),Jt=ze.makeMessageType("livekit.AddTrackRequest",(()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:ze.getEnumType($e)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:ze.getEnumType(Xe)},{no:9,name:"layers",kind:"message",T:ft,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Qt,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:ze.getEnumType(ht)},{no:15,name:"stream",kind:"scalar",T:9}])),Yt=ze.makeMessageType("livekit.TrickleRequest",(()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:ze.getEnumType(zt)},{no:3,name:"final",kind:"scalar",T:8}])),$t=ze.makeMessageType("livekit.MuteTrackRequest",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}])),Xt=ze.makeMessageType("livekit.JoinResponse",(()=>[{no:1,name:"room",kind:"message",T:at},{no:2,name:"participant",kind:"message",T:lt},{no:3,name:"other_participants",kind:"message",T:lt,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:pn,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Dt},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:xt},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:st,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}])),Zt=ze.makeMessageType("livekit.ReconnectResponse",(()=>[{no:1,name:"ice_servers",kind:"message",T:pn,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Dt}])),en=ze.makeMessageType("livekit.TrackPublishedResponse",(()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:mt}])),tn=ze.makeMessageType("livekit.TrackUnpublishedResponse",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9}])),nn=ze.makeMessageType("livekit.SessionDescription",(()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}])),rn=ze.makeMessageType("livekit.ParticipantUpdate",(()=>[{no:1,name:"participants",kind:"message",T:lt,repeated:!0}])),on=ze.makeMessageType("livekit.UpdateSubscription",(()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:Ot,repeated:!0}])),an=ze.makeMessageType("livekit.UpdateTrackSettings",(()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:ze.getEnumType(Ze)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}])),sn=ze.makeMessageType("livekit.UpdateLocalAudioTrack",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:ze.getEnumType(ot),repeated:!0}])),cn=ze.makeMessageType("livekit.UpdateLocalVideoTrack",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}])),ln=ze.makeMessageType("livekit.LeaveRequest",(()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:ze.getEnumType(nt)},{no:3,name:"action",kind:"enum",T:ze.getEnumType(dn)},{no:4,name:"regions",kind:"message",T:_n}])),dn=ze.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),un=ze.makeMessageType("livekit.UpdateVideoLayers",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:ft,repeated:!0}])),hn=ze.makeMessageType("livekit.UpdateParticipantMetadata",(()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}])),pn=ze.makeMessageType("livekit.ICEServer",(()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}])),mn=ze.makeMessageType("livekit.SpeakersChanged",(()=>[{no:1,name:"speakers",kind:"message",T:yt,repeated:!0}])),fn=ze.makeMessageType("livekit.RoomUpdate",(()=>[{no:1,name:"room",kind:"message",T:at}])),gn=ze.makeMessageType("livekit.ConnectionQualityInfo",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:ze.getEnumType(et)},{no:3,name:"score",kind:"scalar",T:2}])),vn=ze.makeMessageType("livekit.ConnectionQualityUpdate",(()=>[{no:1,name:"updates",kind:"message",T:gn,repeated:!0}])),bn=ze.makeMessageType("livekit.StreamStateInfo",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:ze.getEnumType(Wt)}])),yn=ze.makeMessageType("livekit.StreamStateUpdate",(()=>[{no:1,name:"stream_states",kind:"message",T:bn,repeated:!0}])),kn=ze.makeMessageType("livekit.SubscribedQuality",(()=>[{no:1,name:"quality",kind:"enum",T:ze.getEnumType(Ze)},{no:2,name:"enabled",kind:"scalar",T:8}])),Tn=ze.makeMessageType("livekit.SubscribedCodec",(()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:kn,repeated:!0}])),Sn=ze.makeMessageType("livekit.SubscribedQualityUpdate",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:kn,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:Tn,repeated:!0}])),Cn=ze.makeMessageType("livekit.TrackPermission",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}])),En=ze.makeMessageType("livekit.SubscriptionPermission",(()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Cn,repeated:!0}])),wn=ze.makeMessageType("livekit.SubscriptionPermissionUpdate",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}])),Pn=ze.makeMessageType("livekit.SyncState",(()=>[{no:1,name:"answer",kind:"message",T:nn},{no:2,name:"subscription",kind:"message",T:on},{no:3,name:"publish_tracks",kind:"message",T:en,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Rn,repeated:!0},{no:5,name:"offer",kind:"message",T:nn},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0}])),Rn=ze.makeMessageType("livekit.DataChannelInfo",(()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:ze.getEnumType(zt)}])),In=ze.makeMessageType("livekit.SimulateScenario",(()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:ze.getEnumType(Kt),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}])),On=ze.makeMessageType("livekit.Ping",(()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}])),xn=ze.makeMessageType("livekit.Pong",(()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}])),_n=ze.makeMessageType("livekit.RegionSettings",(()=>[{no:1,name:"regions",kind:"message",T:Nn,repeated:!0}])),Nn=ze.makeMessageType("livekit.RegionInfo",(()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}])),Mn=ze.makeMessageType("livekit.SubscriptionResponse",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:ze.getEnumType(rt)}])),Dn=ze.makeMessageType("livekit.RequestResponse",(()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:ze.getEnumType(An)},{no:3,name:"message",kind:"scalar",T:9}])),An=ze.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),Ln=ze.makeMessageType("livekit.TrackSubscribed",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]));function Un(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var jn,Fn={exports:{}},Bn=Fn.exports;var Vn,qn,zn=function(){return jn||(jn=1,e=Fn,function(t,n){e.exports?e.exports=n():t.log=n()}(Bn,(function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],r={},o=null;function a(e,t){var n=e[t];if("function"===typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(i){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var n=this.getLevel(),r=0;r<i.length;r++){var o=i[r];this[o]=r<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function l(e){return function(){typeof console!==t&&(c.call(this),this[e].apply(this,arguments))}}function d(i,r,o){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?s:void 0!==console[i]?a(console,i):void 0!==console.log?a(console,"log"):e)}(i)||l.apply(this,arguments)}function u(e,n){var a,s,l,u=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch(o){}if(typeof e===t)try{var n=window.document.cookie,i=encodeURIComponent(h),r=n.indexOf(i+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r+i.length+1))[1])}catch(o){}return void 0===u.levels[e]&&(e=void 0),e}}function m(e){var t=e;if("string"===typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),"number"===typeof t&&t>=0&&t<=u.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"===typeof e?h+=":"+e:"symbol"===typeof e&&(h=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=n||d,u.getLevel=function(){return null!=l?l:null!=s?s:a},u.setLevel=function(e,n){return l=m(e),!1!==n&&function(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch(r){}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch(r){}}}(l),c.call(u)},u.setDefaultLevel=function(e){s=m(e),p()||u.setLevel(e,!1)},u.resetLevel=function(){l=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),c.call(u)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)},u.rebuild=function(){if(o!==u&&(a=m(o.getLevel())),c.call(u),o===u)for(var e in r)r[e].rebuild()},a=m(o?o.getLevel():"WARN");var f=p();null!=f&&(l=m(f)),c.call(u)}(o=new u).getLogger=function(e){if("symbol"!==typeof e&&"string"!==typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=r[e];return t||(t=r[e]=new u(e,o.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=h),o},o.getLoggers=function(){return r},o.default=o,o}))),Fn.exports;var e}();!function(e){e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error",e[e.silent=5]="silent"}(Vn||(Vn={})),function(e){e.Default="livekit",e.Room="livekit-room",e.Participant="livekit-participant",e.Track="livekit-track",e.Publication="livekit-track-publication",e.Engine="livekit-engine",e.Signal="livekit-signal",e.PCManager="livekit-pc-manager",e.PCTransport="livekit-pc-transport",e.E2EE="lk-e2ee"}(qn||(qn={}));let Wn=zn.getLogger("livekit");Object.values(qn).map((e=>zn.getLogger(e)));function Kn(e){const t=zn.getLogger(e);return t.setDefaultLevel(Wn.getLevel()),t}Wn.setDefaultLevel(Vn.info);const Hn=zn.getLogger("lk-e2ee"),Gn=7e3,Qn=[0,300,1200,2700,4800,Gn,Gn,Gn,Gn,Gn];function Jn(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))}function Yn(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function $n(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Yn(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,r){(function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)})(i,r,(t=e[n](t)).done,t.value)}))}}}"function"===typeof SuppressedError&&SuppressedError;var Xn,Zn={exports:{}};var ei=function(){if(Xn)return Zn.exports;Xn=1;var e,t="object"===typeof Reflect?Reflect:null,n=t&&"function"===typeof t.apply?t.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};e=t&&"function"===typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!==e};function r(){r.init.call(this)}Zn.exports=r,Zn.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,o),i(n)}function o(){"function"===typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}m(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"===typeof e.on&&m(e,"error",t,n)}(e,r,{once:!0})}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function s(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var r,o,c,l;if(a(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),c=o[t]),void 0===c)c=o[t]=n,++e._eventsCount;else if("function"===typeof c?c=o[t]=i?[n,c]:[c,n]:i?c.unshift(n):c.push(n),(r=s(e))>0&&c.length>r&&!c.warned){c.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=c.length,l=d,console&&console.warn&&console.warn(l)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=l.bind(i);return r.listener=n,i.wrapFn=r,r}function u(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"===typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):p(r,r.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function m(e,t,n,i){if("function"===typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(o){i.once&&e.removeEventListener(t,r),n(o)}))}}return Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!==typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return s(this)},r.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=o[e];if(void 0===c)return!1;if("function"===typeof c)n(c,this,t);else{var l=c.length,d=p(c,l);for(i=0;i<l;++i)n(d[i],this,t)}return!0},r.prototype.addListener=function(e,t){return c(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return c(this,e,t,!0)},r.prototype.once=function(e,t){return a(t),this.on(e,d(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,d(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,i,r,o,s;if(a(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},r.prototype.listeners=function(e){return u(this,e,!0)},r.prototype.rawListeners=function(e){return u(this,e,!1)},r.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},r.prototype.listenerCount=h,r.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]},Zn.exports}();let ti=!0,ni=!0;function ii(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function ri(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);const o=e=>{const t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,o),r.apply(this,[e,o])};const o=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function oi(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(ti=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function ai(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(ni=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function si(){if("object"===typeof window){if(ti)return;"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)}}function ci(e,t){ni&&console.warn(e+" is deprecated, please use "+t+" instead.")}function li(e){return"[object Object]"===Object.prototype.toString.call(e)}function di(e){return li(e)?Object.keys(e).reduce((function(t,n){const i=li(e[n]),r=i?di(e[n]):e[n],o=i&&!Object.keys(r).length;return void 0===r||o?t:Object.assign(t,{[n]:r})}),{}):e}function ui(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((i=>{i.endsWith("Id")?ui(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach((t=>{ui(e,e.get(t),n)}))})))}function hi(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===i&&n.trackId===t.id&&ui(e,n,r)}))})),r}const pi=si;function mi(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(e){if("object"!==typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"===typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"===typeof i.exact&&(i.min=i.max=i.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"===typeof i.ideal?(e[r("min",n)]=i.ideal,t.optional.push(e),e={},e[r("max",n)]=i.ideal,t.optional.push(e)):(e[r("",n)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!==typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach((e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"===typeof e.video){let o=e.video.facingMode;o=o&&("object"===typeof o?o:{ideal:o});const a=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let a=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!a&&n.length&&t.includes("back")&&(a=n[n.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=i(e.video),pi("chrome: "+JSON.stringify(e)),r(e)}))}e.video=i(e.video)}return pi("chrome: "+JSON.stringify(e)),r(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){r(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{i&&i(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return r(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(o(e))))))}}}function fi(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function gi(e){if("object"===typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const r=new Event("track");r.track=n.track,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)})),t.stream.getTracks().forEach((n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const r=new Event("track");r.track=n,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else ri(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function vi(e){if("object"===typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"===typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function bi(e){if(!("object"===typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>hi(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),ri(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>hi(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,i;return this.getSenders().forEach((n=>{n.track===e&&(t?i=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?i=!0:n=t),t.track===e))),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function yi(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),r.apply(this,arguments)}}function ki(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return yi(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[n.id];if(r)r.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"===typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=i[t]}));const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=s.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Ti(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}))}function Si(e,t){ri(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var Ci=Object.freeze({__proto__:null,fixNegotiationNeeded:Si,shimAddTrackRemoveTrack:ki,shimAddTrackRemoveTrackWithNative:yi,shimGetSendersWithDtmf:vi,shimGetUserMedia:mi,shimMediaStream:fi,shimOnTrack:gi,shimPeerConnection:Ti,shimSenderReceiverGetStats:bi});function Ei(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){ci("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"===typeof n&&"object"===typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"===typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function wi(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Pi(e,t){if("object"!==typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,o]=arguments;return i.apply(this,[e||null]).then((e=>{if(t.version<53&&!r)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(i){if("TypeError"!==i.name)throw i;e.forEach(((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(r,o)}}function Ri(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Ii(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),ri(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Oi(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){ci("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function xi(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function _i(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const i=t.apply(this,arguments);if(n){const{sender:t}=i,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return i})}function Ni(e){if("object"!==typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function Mi(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function Di(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var Ai=Object.freeze({__proto__:null,shimAddTransceiver:_i,shimCreateAnswer:Di,shimCreateOffer:Mi,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:Ni,shimGetUserMedia:Ei,shimOnTrack:wi,shimPeerConnection:Pi,shimRTCDataChannel:xi,shimReceiverGetStats:Ii,shimRemoveStream:Oi,shimSenderGetStats:Ri});function Li(e){if("object"===typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i&&i.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function Ui(e){if("object"===typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function ji(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};let s=function(e,t,n){const i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=s,s=function(e,t,n){const i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=s,s=function(e,t,n){const i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=s}function Fi(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(Bi(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function Bi(e){return e&&void 0!==e.video?Object.assign({},e,{video:di(e.video)}):e}function Vi(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];void 0===i.urls&&i.url?(ci("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function qi(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function zi(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){"undefined"!==typeof e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),"undefined"!==typeof e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Wi(e){"object"!==typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Ki,Hi=Object.freeze({__proto__:null,shimAudioContext:Wi,shimCallbacksAPI:ji,shimConstraints:Bi,shimCreateOfferLegacy:zi,shimGetUserMedia:Fi,shimLocalStreamsAPI:Li,shimRTCIceServerUrls:Vi,shimRemoteStreamsAPI:Ui,shimTrackEventTransceiver:qi}),Gi={exports:{}};var Qi=(Ki||(Ki=1,function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:void 0===n[t[i]]&&(n[t[i]]=t[i+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const i=e.substring(e.indexOf(" ")+1).split(";");for(let r=0;r<i.length;r++)n=i[r].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substring(t+1,i),n.value=e.substring(i+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],r=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");n.profile=i[2];for(let o=3;o<i.length;o++){const r=i[o],a=t.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(a){const i=t.parseRtpMap(a),o=t.matchPrefix(e,"a=fmtp:"+r+" ");switch(i.parameters=o.length?t.parseFmtp(o[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(t.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));const r=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{r.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)}));let r=0;return n.codecs.forEach((e=>{e.maxptime>r&&(r=e.maxptime)})),r>0&&(i+="a=maxptime:"+r+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{i+=t.writeExtmap(e)})),i},t.parseRtpEncodingParameters=function(e){const n=[],i=t.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),s=a.length>0&&a[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));l.length>0&&l[0].length>1&&l[0][0]===s&&(c=l[0][1]),i.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(t.rtx={ssrc:c}),n.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:o?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&s&&n.push({ssrc:s});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=d}))),n},t.parseRtcpParameters=function(e){const n={},i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};const r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return r.length>0?(n=r[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substring(19),10)),isNaN(r)&&(r=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:r};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,i){let r;const o=void 0!==n?n:2;return r=e||t.generateSessionId(),"v=0\r\no="+(i||"thisisadapterortc")+" "+r+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const i=t.splitLines(e);for(let t=0;t<i.length;t++)switch(i[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!==typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}(Gi)),Gi.exports),Ji=Un(Qi),Yi=d({__proto__:null,default:Ji},[Qi]);function $i(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),i=Ji.parseCandidate(e.candidate);for(const e in i)e in n||Object.defineProperty(n,e,{value:i[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,ri(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function Xi(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||ri(e,"icecandidate",(e=>{if(e.candidate){const t=Ji.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function Zi(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=Ji.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Ji.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!==n?-1:n}(arguments[0]),n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),i=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const r=Ji.matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i}(arguments[0],e);let r;r=0===n&&0===i?Number.POSITIVE_INFINITY:0===n||0===i?Math.max(n,i):Math.min(n,i);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>r}),this._sctp=o}return n.apply(this,arguments)}}function er(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},ri(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function tr(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function nr(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function ir(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function rr(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!==typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return n.apply(this,[e]);return("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}var or=Object.freeze({__proto__:null,removeExtmapAllowMixed:nr,shimAddIceCandidateNullOrEmpty:ir,shimConnectionState:tr,shimMaxMessageSize:Zi,shimParameterlessSetLocalDescription:rr,shimRTCIceCandidate:$i,shimRTCIceCandidateRelayProtocol:Xi,shimSendThrowTypeError:er});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=si,i=function(e){const t={browser:null,version:null};if("undefined"===typeof e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.userAgentData&&n.userAgentData.brands){const e=n.userAgentData.brands.find((e=>"Chromium"===e.brand));if(e)return{browser:"chrome",version:parseInt(e.version,10)}}if(n.mozGetUserMedia)t.browser="firefox",t.version=ii(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=ii(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=ii(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),r={browserDetails:i,commonShim:or,extractVersion:ii,disableLog:oi,disableWarnings:ai,sdp:Yi};switch(i.browser){case"chrome":if(!Ci||!Ti||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=Ci,ir(e,i),rr(e),mi(e,i),fi(e),Ti(e,i),gi(e),ki(e,i),vi(e),bi(e),Si(e,i),$i(e),Xi(e),tr(e),Zi(e,i),er(e),nr(e,i);break;case"firefox":if(!Ai||!Pi||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Ai,ir(e,i),rr(e),Ei(e,i),Pi(e,i),wi(e),Oi(e),Ri(e),Ii(e),xi(e),_i(e),Ni(e),Mi(e),Di(e),$i(e),tr(e),Zi(e,i),er(e);break;case"safari":if(!Hi||!t.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Hi,ir(e,i),rr(e),Vi(e),zi(e),ji(e),Li(e),Ui(e),qi(e),Fi(e),Wi(e),$i(e),Xi(e),Zi(e,i),er(e),nr(e,i);break;default:n("Unsupported browser!")}}({window:"undefined"===typeof window?void 0:window});const ar="lk_e2ee";var sr,cr,lr,dr;function ur(){return"undefined"!==typeof window.RTCRtpSender&&"undefined"!==typeof window.RTCRtpSender.prototype.createEncodedStreams||hr()}function hr(){return"undefined"!==typeof window.RTCRtpScriptTransform}!function(e){e.SetKey="setKey",e.RatchetRequest="ratchetRequest",e.KeyRatcheted="keyRatcheted"}(sr||(sr={})),function(e){e.KeyRatcheted="keyRatcheted"}(cr||(cr={})),function(e){e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError"}(lr||(lr={})),function(e){e.Error="cryptorError"}(dr||(dr={}));ei.EventEmitter;class pr extends Error{constructor(e,t){super(t||"an error has occured"),this.code=e}}var mr,fr,gr,vr,br,yr,kr;!function(e){e[e.NotAllowed=0]="NotAllowed",e[e.ServerUnreachable=1]="ServerUnreachable",e[e.InternalError=2]="InternalError",e[e.Cancelled=3]="Cancelled",e[e.LeaveRequest=4]="LeaveRequest"}(mr||(mr={}));class Tr extends pr{constructor(e,t,n,i){super(1,e),this.status=n,this.reason=t,this.context=i}}class Sr extends pr{constructor(e){super(21,null!==e&&void 0!==e?e:"device is unsupported")}}class Cr extends pr{constructor(e){super(20,null!==e&&void 0!==e?e:"track is invalid")}}class Er extends pr{constructor(e){super(10,null!==e&&void 0!==e?e:"unsupported server")}}class wr extends pr{constructor(e){super(12,null!==e&&void 0!==e?e:"unexpected connection state")}}class Pr extends pr{constructor(e){super(13,null!==e&&void 0!==e?e:"unable to negotiate")}}class Rr extends pr{constructor(e,t){super(15,e),this.reason=t}}!function(e){e.PermissionDenied="PermissionDenied",e.NotFound="NotFound",e.DeviceInUse="DeviceInUse",e.Other="Other"}(fr||(fr={})),function(e){e.getFailure=function(t){if(t&&"name"in t)return"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?e.NotFound:"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?e.PermissionDenied:"NotReadableError"===t.name||"TrackStartError"===t.name?e.DeviceInUse:e.Other}}(fr||(fr={})),function(e){e[e.InvalidKey=0]="InvalidKey",e[e.MissingKey=1]="MissingKey",e[e.InternalError=2]="InternalError"}(gr||(gr={}));function Ir(e,t,n){var i,r,o;void 0===t&&(t=50),void 0===n&&(n={});var a=null!=(i=n.isImmediate)&&i,s=null!=(r=n.callback)&&r,c=n.maxWait,l=Date.now(),d=[];function u(){if(void 0!==c){var e=Date.now()-l;if(e+t>=c)return c-e}return t}var h=function(){var t=[].slice.call(arguments),n=this;return new Promise((function(i,r){var c=a&&void 0===o;if(void 0!==o&&clearTimeout(o),o=setTimeout((function(){if(o=void 0,l=Date.now(),!a){var i=e.apply(n,t);s&&s(i),d.forEach((function(e){return(0,e.resolve)(i)})),d=[]}}),u()),c){var h=e.apply(n,t);return s&&s(h),i(h)}d.push({resolve:i,reject:r})}))};return h.cancel=function(e){void 0!==o&&clearTimeout(o),d.forEach((function(t){return(0,t.reject)(e)})),d=[]},h}!function(e){e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting",e.Reconnected="reconnected",e.Disconnected="disconnected",e.ConnectionStateChanged="connectionStateChanged",e.MediaDevicesChanged="mediaDevicesChanged",e.ParticipantConnected="participantConnected",e.ParticipantDisconnected="participantDisconnected",e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalAudioSilenceDetected="localAudioSilenceDetected",e.ActiveSpeakersChanged="activeSpeakersChanged",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.ParticipantAttributesChanged="participantAttributesChanged",e.RoomMetadataChanged="roomMetadataChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.AudioPlaybackStatusChanged="audioPlaybackChanged",e.VideoPlaybackStatusChanged="videoPlaybackChanged",e.MediaDevicesError="mediaDevicesError",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.SignalConnected="signalConnected",e.RecordingStatusChanged="recordingStatusChanged",e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ActiveDeviceChanged="activeDeviceChanged",e.ChatMessage="chatMessage",e.LocalTrackSubscribed="localTrackSubscribed",e.MetricsReceived="metricsReceived"}(vr||(vr={})),function(e){e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.IsSpeakingChanged="isSpeakingChanged",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.MediaDevicesError="mediaDevicesError",e.AudioStreamAcquired="audioStreamAcquired",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.PCTrackAdded="pcTrackAdded",e.AttributesChanged="attributesChanged",e.LocalTrackSubscribed="localTrackSubscribed",e.ChatMessage="chatMessage"}(br||(br={})),function(e){e.TransportsCreated="transportsCreated",e.Connected="connected",e.Disconnected="disconnected",e.Resuming="resuming",e.Resumed="resumed",e.Restarting="restarting",e.Restarted="restarted",e.SignalResumed="signalResumed",e.SignalRestarted="signalRestarted",e.Closing="closing",e.MediaTrackAdded="mediaTrackAdded",e.ActiveSpeakersUpdate="activeSpeakersUpdate",e.DataPacketReceived="dataPacketReceived",e.RTPVideoMapUpdate="rtpVideoMapUpdate",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ParticipantUpdate="participantUpdate",e.RoomUpdate="roomUpdate",e.SpeakersChanged="speakersChanged",e.StreamStateChanged="streamStateChanged",e.ConnectionQualityUpdate="connectionQualityUpdate",e.SubscriptionError="subscriptionError",e.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",e.RemoteMute="remoteMute",e.SubscribedQualityUpdate="subscribedQualityUpdate",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackSubscribed="localTrackSubscribed",e.Offline="offline",e.SignalRequestResponse="signalRequestResponse"}(yr||(yr={})),function(e){e.Message="message",e.Muted="muted",e.Unmuted="unmuted",e.Restarted="restarted",e.Ended="ended",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed",e.UpdateSettings="updateSettings",e.UpdateSubscription="updateSubscription",e.AudioPlaybackStarted="audioPlaybackStarted",e.AudioPlaybackFailed="audioPlaybackFailed",e.AudioSilenceDetected="audioSilenceDetected",e.VisibilityChanged="visibilityChanged",e.VideoDimensionsChanged="videoDimensionsChanged",e.VideoPlaybackStarted="videoPlaybackStarted",e.VideoPlaybackFailed="videoPlaybackFailed",e.ElementAttached="elementAttached",e.ElementDetached="elementDetached",e.UpstreamPaused="upstreamPaused",e.UpstreamResumed="upstreamResumed",e.SubscriptionPermissionChanged="subscriptionPermissionChanged",e.SubscriptionStatusChanged="subscriptionStatusChanged",e.SubscriptionFailed="subscriptionFailed",e.TrackProcessorUpdate="trackProcessorUpdate",e.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",e.TranscriptionReceived="transcriptionReceived",e.TimeSyncUpdate="timeSyncUpdate"}(kr||(kr={}));const Or=/version\/(\d+(\.?_?\d+)+)/i;let xr;function _r(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("undefined"===typeof e&&"undefined"===typeof navigator)return;const n=(null!==e&&void 0!==e?e:navigator.userAgent).toLowerCase();if(void 0===xr||t){const e=Nr.find((e=>{let{test:t}=e;return t.test(n)}));xr=null===e||void 0===e?void 0:e.describe(n)}return xr}const Nr=[{test:/firefox|iceweasel|fxios/i,describe:e=>({name:"Firefox",version:Mr(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Dr(e)})},{test:/chrom|crios|crmo/i,describe:e=>({name:"Chrome",version:Mr(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Dr(e)})},{test:/safari|applewebkit/i,describe:e=>({name:"Safari",version:Mr(Or,e),os:e.includes("mobile/")?"iOS":"macOS",osVersion:Dr(e)})}];function Mr(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=t.match(e);return i&&i.length>=n&&i[n]||""}function Dr(e){return e.includes("mac os")?Mr(/\(.+?(\d+_\d+(:?_\d+)?)/,e,1).replace(/_/g,"."):void 0}class Ar{}Ar.setTimeout=function(){return setTimeout(...arguments)},Ar.setInterval=function(){return setInterval(...arguments)},Ar.clearTimeout=function(){return clearTimeout(...arguments)},Ar.clearInterval=function(){return clearInterval(...arguments)};class Lr{constructor(e,t,n,i,r){if("object"===typeof e)this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else{if(void 0===t||void 0===n)throw new TypeError("Unsupported options: provide at least width, height and maxBitrate");this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:n,maxFramerate:i,priority:r}}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const Ur=["vp8","h264"],jr=["vp8","h264","vp9","av1"];function Fr(e){return!!Ur.find((t=>t===e))}var Br;!function(e){e.telephone={maxBitrate:12e3},e.speech={maxBitrate:24e3},e.music={maxBitrate:48e3},e.musicStereo={maxBitrate:64e3},e.musicHighQuality={maxBitrate:96e3},e.musicHighQualityStereo={maxBitrate:128e3}}(Br||(Br={}));const Vr={h90:new Lr(160,90,9e4,20),h180:new Lr(320,180,16e4,20),h216:new Lr(384,216,18e4,20),h360:new Lr(640,360,45e4,20),h540:new Lr(960,540,8e5,25),h720:new Lr(1280,720,17e5,30),h1080:new Lr(1920,1080,3e6,30),h1440:new Lr(2560,1440,5e6,30),h2160:new Lr(3840,2160,8e6,30)},qr={h120:new Lr(160,120,7e4,20),h180:new Lr(240,180,125e3,20),h240:new Lr(320,240,14e4,20),h360:new Lr(480,360,33e4,20),h480:new Lr(640,480,5e5,20),h540:new Lr(720,540,6e5,25),h720:new Lr(960,720,13e5,30),h1080:new Lr(1440,1080,23e5,30),h1440:new Lr(1920,1440,38e5,30)},zr={h360fps3:new Lr(640,360,2e5,3,"medium"),h360fps15:new Lr(640,360,4e5,15,"medium"),h720fps5:new Lr(1280,720,8e5,5,"medium"),h720fps15:new Lr(1280,720,15e5,15,"medium"),h720fps30:new Lr(1280,720,2e6,30,"medium"),h1080fps15:new Lr(1920,1080,25e5,15,"medium"),h1080fps30:new Lr(1920,1080,5e6,30,"medium"),original:new Lr(0,0,7e6,30,"medium")};const Wr=[];var Kr;!function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH"}(Kr||(Kr={}));class Hr extends ei.EventEmitter{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=Hr.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Wn,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),"hidden"===document.visibilityState?this.backgroundTimeout=setTimeout((()=>this.handleAppVisibilityChanged()),5e3):this.handleAppVisibilityChanged()},this.log=Kn(null!==(i=n.loggerName)&&void 0!==i?i:qn.Track),this.loggerContextCb=n.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=Hr.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),io(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===Hr.Kind.Video&&(t="video"),0===this.attachedElements.length&&this.kind===Hr.Kind.Video&&this.addAppVisibilityListener(),e||("audio"===t&&(Wr.forEach((t=>{null!==t.parentElement||e||(e=t)})),e&&Wr.splice(Wr.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),Gr(this.mediaStreamTrack,e);const n=e.srcObject.getTracks(),i=n.some((e=>"audio"===e.kind));return e.play().then((()=>{this.emit(i?kr.AudioPlaybackStarted:kr.VideoPlaybackStarted)})).catch((t=>{"NotAllowedError"===t.name?this.emit(i?kr.AudioPlaybackFailed:kr.VideoPlaybackFailed,t):"AbortError"===t.name?Wn.debug("".concat(i?"audio":"video"," playback aborted, likely due to new play request")):Wn.warn("could not playback ".concat(i?"audio":"video"),t),i&&e&&n.some((e=>"video"===e.kind))&&"NotAllowedError"===t.name&&(e.muted=!0,e.play().catch((()=>{})))})),this.emit(kr.ElementAttached,e),e}detach(e){try{if(e){Qr(this.mediaStreamTrack,e);const t=this.attachedElements.indexOf(e);return t>=0&&(this.attachedElements.splice(t,1),this.recycleElement(e),this.emit(kr.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach((e=>{Qr(this.mediaStreamTrack,e),t.push(e),this.recycleElement(e),this.emit(kr.ElementDetached,e)})),this.attachedElements=[],t}finally{0===this.attachedElements.length&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Kn(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),Wr.forEach((e=>{e.parentElement||(t=!1)})),t&&Wr.push(e)}}handleAppVisibilityChanged(){return Jn(this,void 0,void 0,(function*(){this.isInBackground="hidden"===document.visibilityState,this.isInBackground||this.kind!==Hr.Kind.Video||setTimeout((()=>this.attachedElements.forEach((e=>e.play().catch((()=>{}))))),0)}))}addAppVisibilityListener(){go()?(this.isInBackground="hidden"===document.visibilityState,document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){go()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Gr(e,t){let n,i;n=t.srcObject instanceof MediaStream?t.srcObject:new MediaStream,i="audio"===e.kind?n.getAudioTracks():n.getVideoTracks(),i.includes(e)||(i.forEach((e=>{n.removeTrack(e)})),n.addTrack(e)),po()&&t instanceof HTMLVideoElement||(t.autoplay=!0),t.muted=0===n.getAudioTracks().length,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==n&&(t.srcObject=n,(po()||ho())&&t instanceof HTMLVideoElement&&setTimeout((()=>{t.srcObject=n,t.play().catch((()=>{}))}),0))}function Qr(e,t){if(t.srcObject instanceof MediaStream){const n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}function Jr(e,t,n){var i;const{optionsWithoutProcessor:r,audioProcessor:o,videoProcessor:a}=ro(null!==e&&void 0!==e?e:{}),s=null!==(i=function(e){if("undefined"!==typeof e)return"function"===typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}(r))&&void 0!==i?i:{};return!0===s.audio&&(s.audio={}),!0===s.video&&(s.video={}),s.audio&&(Yr(s.audio,t),o&&(s.audio.processor=o)),s.video&&(Yr(s.video,n),a&&(s.video.processor=a)),s}function Yr(e,t){return Object.keys(t).forEach((n=>{void 0===e[n]&&(e[n]=t[n])})),e}function $r(e){const t={};if(e.video)if("object"===typeof e.video){const n={},i=n,r=e.video;Object.keys(r).forEach((e=>{if("resolution"===e)Yr(i,r.resolution);else i[e]=r[e]})),t.video=n}else t.video=e.video;else t.video=!1;return e.audio?"object"===typeof e.audio?t.audio=e.audio:t.audio=!0:t.audio=!1,t}function Xr(){const e="undefined"!==typeof window&&(window.AudioContext||window.webkitAudioContext);if(e)return new e({latencyHint:"interactive"})}function Zr(e){return e===Hr.Source.Microphone?"audioinput":e===Hr.Source.Camera?"videoinput":void 0}function eo(e){var t,n;let i=null===(t=e.video)||void 0===t||t;return e.resolution&&e.resolution.width>0&&e.resolution.height>0&&(i="boolean"===typeof i?{}:i,i=po()?Object.assign(Object.assign({},i),{width:{max:e.resolution.width},height:{max:e.resolution.height},frameRate:e.resolution.frameRate}):Object.assign(Object.assign({},i),{width:{ideal:e.resolution.width},height:{ideal:e.resolution.height},frameRate:e.resolution.frameRate})),{audio:null!==(n=e.audio)&&void 0!==n&&n,video:i,controller:e.controller,selfBrowserSurface:e.selfBrowserSurface,surfaceSwitching:e.surfaceSwitching,systemAudio:e.systemAudio,preferCurrentTab:e.preferCurrentTab}}function to(e){return e.split("/")[1].toLowerCase()}function no(e){const t=[];return e.forEach((e=>{void 0!==e.track&&t.push(new en({cid:e.track.mediaStreamID,track:e.trackInfo}))})),t}function io(e){return e instanceof Hr?{trackID:e.sid,source:e.source,muted:e.isMuted,enabled:e.mediaStreamTrack.enabled,kind:e.kind,streamID:e.mediaStreamID,streamTrackID:e.mediaStreamTrack.id}:{trackID:e.trackSid,enabled:e.isEnabled,muted:e.isMuted,trackInfo:Object.assign({mimeType:e.mimeType,name:e.trackName,encrypted:e.isEncrypted,kind:e.kind,source:e.source},e.track?io(e.track):{})}}function ro(e){const t=Object.assign({},e);let n,i;return"object"===typeof t.audio&&t.audio.processor&&(n=t.audio.processor,t.audio=Object.assign(Object.assign({},t.audio),{processor:void 0})),"object"===typeof t.video&&t.video.processor&&(i=t.video.processor,t.video=Object.assign(Object.assign({},t.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:t}}!function(e){let t,n,i;!function(e){e.Audio="audio",e.Video="video",e.Unknown="unknown"}(t=e.Kind||(e.Kind={})),function(e){e.Camera="camera",e.Microphone="microphone",e.ScreenShare="screen_share",e.ScreenShareAudio="screen_share_audio",e.Unknown="unknown"}(n=e.Source||(e.Source={})),function(e){e.Active="active",e.Paused="paused",e.Unknown="unknown"}(i=e.StreamState||(e.StreamState={})),e.kindToProto=function(e){switch(e){case t.Audio:return $e.AUDIO;case t.Video:return $e.VIDEO;default:return $e.DATA}},e.kindFromProto=function(e){switch(e){case $e.AUDIO:return t.Audio;case $e.VIDEO:return t.Video;default:return t.Unknown}},e.sourceToProto=function(e){switch(e){case n.Camera:return Xe.CAMERA;case n.Microphone:return Xe.MICROPHONE;case n.ScreenShare:return Xe.SCREEN_SHARE;case n.ScreenShareAudio:return Xe.SCREEN_SHARE_AUDIO;default:return Xe.UNKNOWN}},e.sourceFromProto=function(e){switch(e){case Xe.CAMERA:return n.Camera;case Xe.MICROPHONE:return n.Microphone;case Xe.SCREEN_SHARE:return n.ScreenShare;case Xe.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}},e.streamStateFromProto=function(e){switch(e){case Wt.ACTIVE:return i.Active;case Wt.PAUSED:return i.Paused;default:return i.Unknown}}}(Hr||(Hr={}));const oo="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function ao(e){return Jn(this,void 0,void 0,(function*(){return new Promise((t=>Ar.setTimeout(t,e)))}))}function so(){return"addTransceiver"in RTCPeerConnection.prototype}function co(){return"addTrack"in RTCPeerConnection.prototype}function lo(e){return"av1"===e||"vp9"===e}function uo(e){return!!document&&(e||(e=document.createElement("audio")),"setSinkId"in e)}function ho(){var e;return"Firefox"===(null===(e=_r())||void 0===e?void 0:e.name)}function po(){var e;return"Safari"===(null===(e=_r())||void 0===e?void 0:e.name)}function mo(){const e=_r();return"Safari"===(null===e||void 0===e?void 0:e.name)&&e.version.startsWith("17.")}function fo(){var e,t;return!!go()&&(null!==(t=null===(e=navigator.userAgentData)||void 0===e?void 0:e.mobile)&&void 0!==t?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent))}function go(){return"undefined"!==typeof document}function vo(){return"ReactNative"==navigator.product}function bo(e){return e.hostname.endsWith(".livekit.cloud")||e.hostname.endsWith(".livekit.run")}function yo(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function ko(){if(!vo())return;let e=yo();return e?e.platform:void 0}function To(){if(go())return window.devicePixelRatio;if(vo()){let e=yo();if(e)return e.devicePixelRatio}return 1}function So(e,t){const n=e.split("."),i=t.split("."),r=Math.min(n.length,i.length);for(let o=0;o<r;++o){const e=parseInt(n[o],10),t=parseInt(i[o],10);if(e>t)return 1;if(e<t)return-1;if(o===r-1&&e===t)return 0}return""===e&&""!==t?-1:""===t?1:n.length==i.length?0:n.length<i.length?-1:1}function Co(e){for(const t of e)t.target.handleResize(t)}function Eo(e){for(const t of e)t.target.handleVisibilityChanged(t)}let wo=null;const Po=()=>(wo||(wo=new ResizeObserver(Co)),wo);let Ro=null;const Io=()=>(Ro||(Ro=new IntersectionObserver(Eo,{root:null,rootMargin:"0px"})),Ro);let Oo;function xo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=document.createElement("canvas");r.width=e,r.height=t;const o=r.getContext("2d");null===o||void 0===o||o.fillRect(0,0,r.width,r.height),i&&o&&(o.beginPath(),o.arc(e/2,t/2,50,0,2*Math.PI,!0),o.closePath(),o.fillStyle="grey",o.fill());const a=r.captureStream(),[s]=a.getTracks();if(!s)throw Error("Could not get empty media stream video track");return s.enabled=n,s}function _o(){if(!Oo){const e=new AudioContext,t=e.createOscillator(),n=e.createGain();n.gain.setValueAtTime(0,0);const i=e.createMediaStreamDestination();if(t.connect(n),n.connect(i),t.start(),[Oo]=i.stream.getAudioTracks(),!Oo)throw Error("Could not get empty media stream audio track");Oo.enabled=!1}return Oo.clone()}class No{constructor(e,t){this.onFinally=t,this.promise=new Promise(((t,n)=>Jn(this,void 0,void 0,(function*(){this.resolve=t,this.reject=n,e&&(yield e(t,n))})))).finally((()=>{var e;return null===(e=this.onFinally)||void 0===e?void 0:e.call(this)}))}}function Mo(e){if("string"===typeof e||"number"===typeof e)return e;if(Array.isArray(e))return e[0];if(e.exact)return Array.isArray(e.exact)?e.exact[0]:e.exact;if(e.ideal)return Array.isArray(e.ideal)?e.ideal[0]:e.ideal;throw Error("could not unwrap constraint")}function Do(e){return e.startsWith("ws")?e.replace(/^(ws)/,"http"):e}function Ao(e){switch(e.reason){case mr.LeaveRequest:return e.context;case mr.Cancelled:return nt.CLIENT_INITIATED;case mr.NotAllowed:return nt.USER_REJECTED;case mr.ServerUnreachable:return nt.JOIN_FAILURE;default:return nt.UNKNOWN_REASON}}const Lo="default";class Uo{static getInstance(){return void 0===this.instance&&(this.instance=new Uo),this.instance}getDevices(e){return Jn(this,arguments,void 0,(function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var i;if((null===(i=Uo.userMediaPromiseMap)||void 0===i?void 0:i.size)>0){Wn.debug("awaiting getUserMedia promise");try{e?yield Uo.userMediaPromiseMap.get(e):yield Promise.all(Uo.userMediaPromiseMap.values())}catch(o){Wn.warn("error waiting for media permissons")}}let r=yield navigator.mediaDevices.enumerateDevices();if(n&&(!po()||!t.hasDeviceInUse(e))){if(0===r.filter((t=>t.kind===e)).length||r.some((t=>{const n=""===t.label,i=!e||t.kind===e;return n&&i}))){const t={video:"audioinput"!==e&&"audiooutput"!==e,audio:"videoinput"!==e},n=yield navigator.mediaDevices.getUserMedia(t);r=yield navigator.mediaDevices.enumerateDevices(),n.getTracks().forEach((e=>{e.stop()}))}}return e&&(r=r.filter((t=>t.kind===e))),r}()}))}normalizeDeviceId(e,t,n){return Jn(this,void 0,void 0,(function*(){if(t!==Lo)return t;const i=yield this.getDevices(e),r=i.find((e=>e.deviceId===Lo));if(!r)return void Wn.warn("could not reliably determine default device");const o=i.find((e=>e.deviceId!==Lo&&e.groupId===(null!==n&&void 0!==n?n:r.groupId)));if(o)return null===o||void 0===o?void 0:o.deviceId;Wn.warn("could not reliably determine default device")}))}hasDeviceInUse(e){return e?Uo.userMediaPromiseMap.has(e):Uo.userMediaPromiseMap.size>0}}Uo.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],Uo.userMediaPromiseMap=new Map;class jo extends Hr{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(e,t,arguments.length>4?arguments[4]:void 0),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch((()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext))),this.debouncedTrackMuteHandler=Ir((()=>Jn(this,void 0,void 0,(function*(){yield this.pauseUpstream()}))),5e3),this.handleTrackUnmuteEvent=()=>Jn(this,void 0,void 0,(function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()})),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(kr.Ended,this)},this.reacquireTrack=!1,this.providedByUser=i,this.muteLock=new p,this.pauseUpstreamLock=new p,this.processorLock=new p,this.restartLock=new p,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),n&&(this._constraints=n)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==Hr.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();return e&&t?{width:e,height:t}:void 0}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return null!==(t=null===(e=this.processor)||void 0===e?void 0:e.processedTrack)&&void 0!==t?t:this._mediaStreamTrack}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,t){return Jn(this,void 0,void 0,(function*(){if(e===this._mediaStreamTrack&&!t)return;let n;if(this._mediaStreamTrack&&(this.attachedElements.forEach((e=>{Qr(this._mediaStreamTrack,e)})),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints()),this.processor&&e){const t=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),"unknown"===this.kind)throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Gr(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),n=this.processor.processedTrack}finally{t()}}this.sender&&(yield this.sender.replaceTrack(null!==n&&void 0!==n?n:e)),this.providedByUser||this._mediaStreamTrack===e||this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach((t=>{Gr(null!==n&&void 0!==n?n:e,t)})))}))}waitForDimensions(){return Jn(this,arguments,void 0,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return function*(){var n;if(e.kind===Hr.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");"iOS"===(null===(n=_r())||void 0===n?void 0:n.os)&&(yield ao(10));const i=Date.now();for(;Date.now()-i<t;){const t=e.dimensions;if(t)return t;yield ao(50)}throw new Cr("unable to get track dimensions after timeout")}()}))}getDeviceId(){return Jn(this,arguments,void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){if(e.source===Hr.Source.ScreenShare)return;const{deviceId:n,groupId:i}=e._mediaStreamTrack.getSettings(),r=e.kind===Hr.Kind.Audio?"audioinput":"videoinput";return t?Uo.getInstance().normalizeDeviceId(r,n,i):n}()}))}mute(){return Jn(this,void 0,void 0,(function*(){return this.setTrackMuted(!0),this}))}unmute(){return Jn(this,void 0,void 0,(function*(){return this.setTrackMuted(!1),this}))}replaceTrack(e,t){return Jn(this,void 0,void 0,(function*(){if(!this.sender)throw new Cr("unable to replace an unpublished track");let n,i;return"boolean"===typeof t?n=t:void 0!==t&&(n=t.userProvidedTrack,i=t.stopProcessor),this.providedByUser=null===n||void 0===n||n,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),i&&this.processor&&(yield this.stopProcessor()),this}))}restart(e){return Jn(this,void 0,void 0,(function*(){this.manuallyStopped=!1;const t=yield this.restartLock.lock();try{e||(e=this._constraints),this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const t={audio:!1,video:!1};this.kind===Hr.Kind.Video?t.video=e:t.audio=e,this.attachedElements.forEach((e=>{Qr(this.mediaStreamTrack,e)})),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const n=(yield navigator.mediaDevices.getUserMedia(t)).getTracks()[0];return n.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(n),this._constraints=e,this.emit(kr.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{t()}}))}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),this.isMuted===e&&this._mediaStreamTrack.enabled!==e||(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?kr.Muted:kr.Unmuted,this))}get needsReAcquisition(){return"live"!==this._mediaStreamTrack.readyState||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Jn(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),fo()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),this.isInBackground||!this.needsReAcquisition||this.isUserProvided||this.isMuted||(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))}))}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),null===(e=this.processor)||void 0===e||e.destroy(),this.processor=void 0}pauseUpstream(){return Jn(this,void 0,void 0,(function*(){const e=yield this.pauseUpstreamLock.lock();try{if(!0===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to pause upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!0,this.emit(kr.UpstreamPaused,this);const e=_r();if("Safari"===(null===e||void 0===e?void 0:e.name)&&So(e.version,"12.0")<0)throw new Sr("pauseUpstream is not supported on Safari < 12.");yield this.sender.replaceTrack(null)}finally{e()}}))}resumeUpstream(){return Jn(this,void 0,void 0,(function*(){const e=yield this.pauseUpstreamLock.lock();try{if(!1===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to resume upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!1,this.emit(kr.UpstreamResumed,this),yield this.sender.replaceTrack(this.mediaStreamTrack)}finally{e()}}))}getRTCStatsReport(){return Jn(this,void 0,void 0,(function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return;return yield this.sender.getStats()}))}setProcessor(e){return Jn(this,arguments,void 0,(function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var i;const r=yield t.processorLock.lock();try{t.log.debug("setting up processor",t.logContext);const r=document.createElement(t.kind),o={kind:t.kind,track:t._mediaStreamTrack,element:r,audioContext:t.audioContext};if(yield e.init(o),t.log.debug("processor initialized",t.logContext),t.processor&&(yield t.stopProcessor()),"unknown"===t.kind)throw TypeError("cannot set processor on track of unknown kind");if(Gr(t._mediaStreamTrack,r),r.muted=!0,r.play().catch((e=>t.log.error("failed to play processor element",Object.assign(Object.assign({},t.logContext),{error:e})))),t.processor=e,t.processorElement=r,t.processor.processedTrack){for(const e of t.attachedElements)e!==t.processorElement&&n&&(Qr(t._mediaStreamTrack,e),Gr(t.processor.processedTrack,e));yield null===(i=t.sender)||void 0===i?void 0:i.replaceTrack(t.processor.processedTrack)}t.emit(kr.TrackProcessorUpdate,t.processor)}finally{r()}}()}))}getProcessor(){return this.processor}stopProcessor(){return Jn(this,arguments,void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var n,i;e.processor&&(e.log.debug("stopping processor",e.logContext),null===(n=e.processor.processedTrack)||void 0===n||n.stop(),yield e.processor.destroy(),e.processor=void 0,t||(null===(i=e.processorElement)||void 0===i||i.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(kr.TrackProcessorUpdate))}()}))}}class Fo extends ei.EventEmitter{constructor(e){super(),this.onWorkerMessage=e=>{var t,n;const{kind:i,data:r}=e.data;switch(i){case"error":Wn.error(r.error.message),this.emit(lr.EncryptionError,r.error);break;case"initAck":r.enabled&&this.keyProvider.getKeys().forEach((e=>{this.postKey(e)}));break;case"enable":if(r.enabled&&this.keyProvider.getKeys().forEach((e=>{this.postKey(e)})),this.encryptionEnabled!==r.enabled&&r.participantIdentity===(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))this.emit(lr.ParticipantEncryptionStatusChanged,r.enabled,this.room.localParticipant),this.encryptionEnabled=r.enabled;else if(r.participantIdentity){const e=null===(n=this.room)||void 0===n?void 0:n.getParticipantByIdentity(r.participantIdentity);if(!e)throw TypeError("couldn't set encryption status, participant not found".concat(r.participantIdentity));this.emit(lr.ParticipantEncryptionStatusChanged,r.enabled,e)}break;case"ratchetKey":this.keyProvider.emit(sr.KeyRatcheted,r.material,r.keyIndex)}},this.onWorkerError=e=>{Wn.error("e2ee worker encountered an error:",{error:e.error}),this.emit(lr.EncryptionError,e.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!ur())throw new Sr("tried to setup end-to-end encryption on an unsupported browser");if(Wn.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:Hn.getLevel()}};this.worker&&(Wn.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){Wn.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){e&&0!==e.length?this.postSifTrailer(e):Wn.warn("ignoring server sent trailer as it's empty")}setupEngine(e){e.on(yr.RTPVideoMapUpdate,(e=>{this.postRTPMap(e)}))}setupEventListeners(e,t){e.on(vr.TrackPublished,((e,t)=>this.setParticipantCryptorEnabled(e.trackInfo.encryption!==ht.NONE,t.identity))),e.on(vr.ConnectionStateChanged,(t=>{t===ns.Connected&&e.remoteParticipants.forEach((e=>{e.trackPublications.forEach((t=>{this.setParticipantCryptorEnabled(t.trackInfo.encryption!==ht.NONE,e.identity)}))}))})).on(vr.TrackUnsubscribed,((e,t,n)=>{var i;const r={kind:"removeTransform",data:{participantIdentity:n.identity,trackId:e.mediaStreamID}};null===(i=this.worker)||void 0===i||i.postMessage(r)})).on(vr.TrackSubscribed,((e,t,n)=>{this.setupE2EEReceiver(e,n.identity,t.trackInfo)})).on(vr.SignalConnected,(()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");t.getKeys().forEach((e=>{this.postKey(e)})),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)})),e.localParticipant.on(br.LocalTrackPublished,(e=>Jn(this,void 0,void 0,(function*(){this.setupE2EESender(e.track,e.track.sender)})))),t.on(sr.SetKey,(e=>this.postKey(e))).on(sr.RatchetRequest,((e,t)=>this.postRatchetRequest(e,t)))}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const n={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(n)}postKey(e){let{key:t,participantIdentity:n,keyIndex:i}=e;var r;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:n,isPublisher:n===(null===(r=this.room)||void 0===r?void 0:r.localParticipant.identity),key:t,keyIndex:i}};this.worker.postMessage(o)}postEnable(e,t){if(!this.worker)throw new ReferenceError("failed to enable e2ee, worker is not ready");{const n={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(n)}}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const n={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(n)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,n){if(e.receiver){if(!(null===n||void 0===n?void 0:n.mimeType)||""===n.mimeType)throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,"video"===e.kind?to(n.mimeType):void 0)}}setupE2EESender(e,t){e instanceof jo&&t?this.handleSender(t,e.mediaStreamID,void 0):t||Wn.warn("early return because sender is not ready")}handleReceiver(e,t,n,i){return Jn(this,void 0,void 0,(function*(){if(this.worker){if(hr()){const r={kind:"decode",participantIdentity:n,trackId:t,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,r)}else{if(ar in e&&i){const e={kind:"updateCodec",data:{trackId:t,codec:i,participantIdentity:n}};return void this.worker.postMessage(e)}let r=e.writableStream,o=e.readableStream;if(!r||!o){const t=e.createEncodedStreams();e.writableStream=t.writable,r=t.writable,e.readableStream=t.readable,o=t.readable}const a={kind:"decode",data:{readableStream:o,writableStream:r,trackId:t,codec:i,participantIdentity:n}};this.worker.postMessage(a,[o,r])}e[ar]=!0}}))}handleSender(e,t,n){var i;if(!(ar in e)&&this.worker){if(!(null===(i=this.room)||void 0===i?void 0:i.localParticipant.identity)||""===this.room.localParticipant.identity)throw TypeError("local identity needs to be known in order to set up encrypted sender");if(hr()){Wn.info("initialize script transform");const i={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:n};e.transform=new RTCRtpScriptTransform(this.worker,i)}else{Wn.info("initialize encoded streams");const i=e.createEncodedStreams(),r={kind:"encode",data:{readableStream:i.readable,writableStream:i.writable,codec:n,trackId:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r,[i.readable,i.writable])}e[ar]=!0}}}var Bo;!function(e){e[e.WAITING=0]="WAITING",e[e.RUNNING=1]="RUNNING",e[e.COMPLETED=2]="COMPLETED"}(Bo||(Bo={}));class Vo{constructor(){this.pendingTasks=new Map,this.taskMutex=new p,this.nextTaskIndex=0}run(e){return Jn(this,void 0,void 0,(function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Bo.WAITING};this.pendingTasks.set(t.id,t);const n=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=Bo.RUNNING,yield e()}finally{t.status=Bo.COMPLETED,this.pendingTasks.delete(t.id),n()}}))}flush(){return Jn(this,void 0,void 0,(function*(){return this.run((()=>Jn(this,void 0,void 0,(function*(){}))))}))}snapshot(){return Array.from(this.pendingTasks.values())}}const qo=["syncState","trickle","offer","answer","simulate","leave"];var zo;!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.RECONNECTING=2]="RECONNECTING",e[e.DISCONNECTING=3]="DISCONNECTING",e[e.DISCONNECTED=4]="DISCONNECTED"}(zo||(zo={}));class Wo{get currentState(){return this.state}get isDisconnected(){return this.state===zo.DISCONNECTING||this.state===zo.DISCONNECTED}get isEstablishingConnection(){return this.state===zo.CONNECTING||this.state===zo.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;this.rtt=0,this.state=zo.DISCONNECTED,this.log=Wn,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=Kn(null!==(n=t.loggerName)&&void 0!==n?n:qn.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new Vo,this.queuedRequests=[],this.closingLock=new p,this.connectionLock=new p,this.state=zo.DISCONNECTED}get logContext(){var e,t;return null!==(t=null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this))&&void 0!==t?t:{}}join(e,t,n,i){return Jn(this,void 0,void 0,(function*(){this.state=zo.CONNECTING,this.options=n;return yield this.connect(e,t,n,i)}))}reconnect(e,t,n,i){return Jn(this,void 0,void 0,(function*(){if(!this.options)return void this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);this.state=zo.RECONNECTING,this.clearPingInterval();return yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:n,reconnectReason:i}))}))}connect(e,t,n,i){this.connectOptions=n,e=(e=function(e){return e.startsWith("http")?e.replace(/^(http)/,"ws"):e}(e)).replace(/\/$/,""),e+="/rtc";const r=function(e,t,n){var i;const r=new URLSearchParams;r.set("access_token",e),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid));r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",vo()?"reactnative":"js"),r.set("version",t.version),r.set("protocol",t.protocol.toString()),t.deviceModel&&r.set("device_model",t.deviceModel);t.os&&r.set("os",t.os);t.osVersion&&r.set("os_version",t.osVersion);t.browser&&r.set("browser",t.browser);t.browserVersion&&r.set("browser_version",t.browserVersion);n.adaptiveStream&&r.set("adaptive_stream","1");n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString());(null===(i=navigator.connection)||void 0===i?void 0:i.type)&&r.set("network",navigator.connection.type);return"?".concat(r.toString())}(t,function(){var e;const t=new Nt({sdk:Mt.JS,protocol:15,version:"2.7.3"});return vo()&&(t.os=null!==(e=ko())&&void 0!==e?e:""),t}(),n);return new Promise(((t,o)=>Jn(this,void 0,void 0,(function*(){const a=yield this.connectionLock.lock();try{const a=()=>Jn(this,void 0,void 0,(function*(){this.close(),clearTimeout(s),o(new Tr("room connection has been cancelled (signal)",mr.Cancelled))})),s=setTimeout((()=>{this.close(),o(new Tr("room connection has timed out (signal)",mr.ServerUnreachable))}),n.websocketTimeout);(null===i||void 0===i?void 0:i.aborted)&&a(),null===i||void 0===i||i.addEventListener("abort",a),this.log.debug("connecting to ".concat(e+r),this.logContext),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(e+r),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(s)},this.ws.onerror=t=>Jn(this,void 0,void 0,(function*(){if(this.state===zo.CONNECTED)this.handleWSError(t);else{this.state=zo.DISCONNECTED,clearTimeout(s);try{const t=yield fetch("http".concat(e.substring(2),"/validate").concat(r));if(t.status.toFixed(0).startsWith("4")){const e=yield t.text();o(new Tr(e,mr.NotAllowed,t.status))}else o(new Tr("Internal error",mr.InternalError,t.status))}catch(n){o(new Tr("server was not reachable",mr.ServerUnreachable))}}})),this.ws.onmessage=e=>Jn(this,void 0,void 0,(function*(){var r,s,c;let l;if("string"===typeof e.data){const t=JSON.parse(e.data);l=Gt.fromJson(t,{ignoreUnknownFields:!0})}else{if(!(e.data instanceof ArrayBuffer))return void this.log.error("could not decode websocket message: ".concat(typeof e.data),this.logContext);l=Gt.fromBinary(new Uint8Array(e.data))}if(this.state!==zo.CONNECTED){let e=!1;if("join"===(null===(r=l.message)||void 0===r?void 0:r.case)?(this.state=zo.CONNECTED,null===i||void 0===i||i.removeEventListener("abort",a),this.pingTimeoutDuration=l.message.value.pingTimeout,this.pingIntervalDuration=l.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),t(l.message.value)):this.state===zo.RECONNECTING&&"leave"!==l.message.case?(this.state=zo.CONNECTED,null===i||void 0===i||i.removeEventListener("abort",a),this.startPingInterval(),"reconnect"===(null===(s=l.message)||void 0===s?void 0:s.case)?t(l.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),t(void 0),e=!0)):this.isEstablishingConnection&&"leave"===l.message.case?o(new Tr("Received leave request while trying to (re)connect",mr.LeaveRequest,void 0,l.message.value.reason)):n.reconnect||o(new Tr("did not receive join response, got ".concat(null===(c=l.message)||void 0===c?void 0:c.case," instead"),mr.InternalError)),!e)return}this.signalLatency&&(yield ao(this.signalLatency)),this.handleSignalResponse(l)})),this.ws.onclose=e=>{this.isEstablishingConnection&&o(new Tr("Websocket got closed during a (re)connection attempt",mr.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:e.reason,code:e.code,wasClean:e.wasClean,state:this.state})),this.handleOnClose(e.reason)}}finally{a()}}))))}close(){return Jn(this,arguments,void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){const n=yield e.closingLock.lock();try{if(e.clearPingInterval(),t&&(e.state=zo.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const t=new Promise((t=>{e.ws?e.ws.onclose=()=>{t()}:t()}));e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([t,ao(250)])),e.ws=void 0}}finally{t&&(e.state=zo.DISCONNECTED),n()}}()}))}sendOffer(e){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Ho(e)})}sendAnswer(e){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Ho(e)})}sendIceCandidate(e,t){return this.log.trace("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Yt({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new $t({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return Jn(this,arguments,void 0,(function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function*(){const r=n.getNextRequestId();return yield n.sendRequest({case:"updateMetadata",value:new hn({requestId:r,metadata:e,name:t,attributes:i})}),r}()}))}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new un({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new En({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:A.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new On({timestamp:A.parse(Date.now()),rtt:A.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,t){return this.sendRequest({case:"updateAudioTrack",value:new sn({trackSid:e,features:t})})}sendLeave(){return this.sendRequest({case:"leave",value:new ln({reason:nt.CLIENT_INITIATED,action:dn.DISCONNECT})})}sendRequest(e){return Jn(this,arguments,void 0,(function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function*(){const i=!n&&!function(e){const t=qo.indexOf(e.case)>=0;return Wn.trace("request allowed to bypass queue:",{canPass:t,req:e}),t}(e);if(i&&t.state===zo.RECONNECTING)return void t.queuedRequests.push((()=>Jn(t,void 0,void 0,(function*(){yield this.sendRequest(e,!0)}))));if(n||(yield t.requestQueue.flush()),t.signalLatency&&(yield ao(t.signalLatency)),!t.ws||t.ws.readyState!==t.ws.OPEN)return void t.log.error("cannot send signal request before connected, type: ".concat(null===e||void 0===e?void 0:e.case),t.logContext);const r=new Ht({message:e});try{t.useJSON?t.ws.send(r.toJsonString()):t.ws.send(r.toBinary())}catch(o){t.log.error("error sending signal message",Object.assign(Object.assign({},t.logContext),{error:o}))}}()}))}handleSignalResponse(e){var t,n;const i=e.message;if(void 0==i)return void this.log.debug("received unsupported message",this.logContext);let r=!1;if("answer"===i.case){const e=Ko(i.value);this.onAnswer&&this.onAnswer(e)}else if("offer"===i.case){const e=Ko(i.value);this.onOffer&&this.onOffer(e)}else if("trickle"===i.case){const e=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(e,i.value.target)}else"update"===i.case?this.onParticipantUpdate&&this.onParticipantUpdate(null!==(t=i.value.participants)&&void 0!==t?t:[]):"trackPublished"===i.case?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):"speakersChanged"===i.case?this.onSpeakersChanged&&this.onSpeakersChanged(null!==(n=i.value.speakers)&&void 0!==n?n:[]):"leave"===i.case?this.onLeave&&this.onLeave(i.value):"mute"===i.case?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):"roomUpdate"===i.case?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):"connectionQuality"===i.case?this.onConnectionQuality&&this.onConnectionQuality(i.value):"streamStateUpdate"===i.case?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):"subscribedQualityUpdate"===i.case?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):"subscriptionPermissionUpdate"===i.case?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):"refreshToken"===i.case?this.onTokenRefresh&&this.onTokenRefresh(i.value):"trackUnpublished"===i.case?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):"subscriptionResponse"===i.case?this.onSubscriptionError&&this.onSubscriptionError(i.value):"pong"===i.case||("pongResp"===i.case?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),r=!0):"requestResponse"===i.case?this.onRequestResponse&&this.onRequestResponse(i.value):"trackSubscribed"===i.case?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(i.value.trackSid):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));r||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return Jn(this,void 0,void 0,(function*(){if(this.state===zo.DISCONNECTED)return;const t=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)}))}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){this.clearPingTimeout(),this.pingTimeoutDuration?this.pingTimeout=Ar.setTimeout((()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-1e3*this.pingTimeoutDuration).toUTCString()),this.logContext),this.handleOnClose("ping timeout")}),1e3*this.pingTimeoutDuration):this.log.warn("ping timeout duration not set",this.logContext)}clearPingTimeout(){this.pingTimeout&&Ar.clearTimeout(this.pingTimeout)}startPingInterval(){this.clearPingInterval(),this.resetPingTimeout(),this.pingIntervalDuration?(this.log.debug("start ping interval",this.logContext),this.pingInterval=Ar.setInterval((()=>{this.sendPing()}),1e3*this.pingIntervalDuration)):this.log.warn("ping interval duration not set",this.logContext)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Ar.clearInterval(this.pingInterval)}}function Ko(e){const t={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=e.type}return t}function Ho(e){return new nn({sdp:e.sdp,type:e.type})}var Go,Qo,Jo,Yo,$o,Xo={},Zo={},ea={exports:{}};function ta(){if(Go)return ea.exports;Go=1;var e=ea.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(e).forEach((function(t){e[t].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))})),ea.exports}function na(){return Qo||(Qo=1,function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,i){var r=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:r&&!n[e.name]&&(n[e.name]={});var o=e.push?{}:r?n[e.name]:n;!function(e,n,i,r){if(r&&!i)n[r]=t(e[1]);else for(var o=0;o<i.length;o+=1)null!=e[o+1]&&(n[i[o]]=t(e[o+1]))}(i.match(e.reg),o,e.names,e.name),e.push&&n[e.push].push(o)},i=ta(),r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},o=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach((function(e){var t=e[0],r=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),a=o[o.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var c=i[t][s];if(c.reg.test(r))return n(c,a,r)}})),t.media=o,t};var o=function(e,n){var i=n.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&n.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],i=e.split(" ").map(t),r=0;r<i.length;r+=3)n.push({component:i[r],ip:i[r+1],port:i[r+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var n,i=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),i=!0),{scid:n,paused:i}}))}))}}(Zo)),Zo}function ia(){if(Yo)return Jo;Yo=1;var e=ta(),t=/%[sdv%]/g,n=function(e){var n=1,i=arguments,r=i.length;return e.replace(t,(function(e){if(n>=r)return e;var t=i[n];switch(n+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}}))},i=function(e,t,i){var r=[e+"="+(t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var a=t.names[o];t.name?r.push(i[t.name][a]):r.push(i[t.names[o]])}else r.push(i[t.name]);return n.apply(null,r)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return Jo=function(t,n){n=n||{},null==t.version&&(t.version=0),null==t.name&&(t.name=" "),t.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var a=n.outerOrder||r,s=n.innerOrder||o,c=[];return a.forEach((function(n){e[n].forEach((function(e){e.name in t&&null!=t[e.name]?c.push(i(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach((function(t){c.push(i(n,e,t))}))}))})),t.media.forEach((function(t){c.push(i("m",e.m[0],t)),s.forEach((function(n){e[n].forEach((function(e){e.name in t&&null!=t[e.name]?c.push(i(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach((function(t){c.push(i(n,e,t))}))}))}))})),c.join("\r\n")+"\r\n"},Jo}var ra=function(){if($o)return Xo;$o=1;var e=na(),t=ia();return Xo.write=t,Xo.parse=e.parse,Xo.parseParams=e.parseParams,Xo.parseFmtpConfig=e.parseFmtpConfig,Xo.parsePayloads=e.parsePayloads,Xo.parseRemoteCandidates=e.parseRemoteCandidates,Xo.parseImageAttributes=e.parseImageAttributes,Xo.parseSimulcastStreamList=e.parseSimulcastStreamList,Xo}();const oa="negotiationStarted",aa="negotiationComplete",sa="rtpVideoPayloadTypes";class ca extends ei.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;super(),this.log=Wn,this.ddExtID=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Ir((e=>Jn(this,void 0,void 0,(function*(){this.emit(oa);try{yield this.createAndSendOffer()}catch(t){if(!e)throw t;e(t)}}))),20),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Kn(null!==(n=t.loggerName)&&void 0!==n?n:qn.PCTransport),this.loggerOptions=t,this.config=e,this._pc=this.createPC()}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=e=>{var t;e.candidate&&(null===(t=this.onIceCandidate)||void 0===t||t.call(this,e.candidate))},e.onicecandidateerror=e=>{var t;null===(t=this.onIceCandidateError)||void 0===t||t.call(this,e)},e.oniceconnectionstatechange=()=>{var t;null===(t=this.onIceConnectionStateChange)||void 0===t||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;null===(t=this.onSignalingStatechange)||void 0===t||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,e.connectionState)},e.ondatachannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},e.ontrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},e}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}get isICEConnected(){return null!==this._pc&&("connected"===this.pc.iceConnectionState||"completed"===this.pc.iceConnectionState)}addIceCandidate(e){return Jn(this,void 0,void 0,(function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)}))}setRemoteDescription(e){return Jn(this,void 0,void 0,(function*(){var t;let n;if("offer"===e.type){let{stereoMids:t,nackMids:n}=function(e){var t;const n=[],i=[],r=ra.parse(null!==(t=e.sdp)&&void 0!==t?t:"");let o=0;return r.media.forEach((e=>{var t;"audio"===e.type&&(e.rtp.some((e=>"opus"===e.codec&&(o=e.payload,!0))),(null===(t=e.rtcpFb)||void 0===t?void 0:t.some((e=>e.payload===o&&"nack"===e.type)))&&i.push(e.mid),e.fmtp.some((t=>t.payload===o&&(t.config.includes("sprop-stereo=1")&&n.push(e.mid),!0))))})),{stereoMids:n,nackMids:i}}(e);this.remoteStereoMids=t,this.remoteNackMids=n}else if("answer"===e.type){const i=ra.parse(null!==(t=e.sdp)&&void 0!==t?t:"");i.media.forEach((e=>{"audio"===e.type&&this.trackBitrates.some((t=>{if(!t.transceiver||e.mid!=t.transceiver.mid)return!1;let n=0;if(e.rtp.some((e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0))),0===n)return!0;let i=!1;for(const r of e.fmtp)if(r.payload===n){r.config=r.config.split(";").filter((e=>!e.includes("maxaveragebitrate"))).join(";"),t.maxbr>0&&(r.config+=";maxaveragebitrate=".concat(1e3*t.maxbr)),i=!0;break}return i||t.maxbr>0&&e.fmtp.push({payload:n,config:"maxaveragebitrate=".concat(1e3*t.maxbr)}),!0}))})),n=ra.write(i)}if(yield this.setMungedSDP(e,n,!0),this.pendingCandidates.forEach((e=>{this.pc.addIceCandidate(e)})),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate)this.renegotiate=!1,yield this.createAndSendOffer();else if("answer"===e.type&&(this.emit(aa),e.sdp)){ra.parse(e.sdp).media.forEach((e=>{"video"===e.type&&this.emit(sa,e.rtp)}))}}))}createAndSendOffer(e){return Jn(this,void 0,void 0,(function*(){var t;if(void 0===this.onOffer)return;if((null===e||void 0===e?void 0:e.iceRestart)&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&"have-local-offer"===this._pc.signalingState){const t=this._pc.remoteDescription;if(!(null===e||void 0===e?void 0:e.iceRestart)||!t)return void(this.renegotiate=!0);yield this._pc.setRemoteDescription(t)}else if(!this._pc||"closed"===this._pc.signalingState)return void this.log.warn("could not createOffer with closed peer connection",this.logContext);this.log.debug("starting to negotiate",this.logContext);const n=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:n.sdp},this.logContext));const i=ra.parse(null!==(t=n.sdp)&&void 0!==t?t:"");i.media.forEach((e=>{"audio"===e.type?la(e,[],[]):"video"===e.type&&this.trackBitrates.some((t=>{if(!e.msid||!t.cid||!e.msid.includes(t.cid))return!1;let n=0;if(e.rtp.some((e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0))),0===n)return!0;if(lo(t.codec)&&this.ensureVideoDDExtensionForSVC(e,i),"av1"!==t.codec)return!0;const r=Math.round(.7*t.maxbr);for(const i of e.fmtp)if(i.payload===n){i.config.includes("x-google-start-bitrate")||(i.config+=";x-google-start-bitrate=".concat(r));break}return!0}))})),yield this.setMungedSDP(n,ra.write(i)),this.onOffer(n)}))}createAndSetAnswer(){return Jn(this,void 0,void 0,(function*(){var e;const t=yield this.pc.createAnswer(),n=ra.parse(null!==(e=t.sdp)&&void 0!==e?e:"");return n.media.forEach((e=>{"audio"===e.type&&la(e,this.remoteStereoMids,this.remoteNackMids)})),yield this.setMungedSDP(t,ra.write(n)),t}))}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new wr("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new wr("PC closed, cannot configure");return null===(t=this._pc)||void 0===t?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(null===(e=this._pc)||void 0===e?void 0:e.removeTrack)}removeTrack(e){var t;return null===(t=this._pc)||void 0===t?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.connectionState)&&void 0!==t?t:"closed"}getICEConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.iceConnectionState)&&void 0!==t?t:"closed"}getSignallingState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.signalingState)&&void 0!==t?t:"closed"}getTransceivers(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getTransceivers())&&void 0!==t?t:[]}getSenders(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getSenders())&&void 0!==t?t:[]}getLocalDescription(){var e;return null===(e=this._pc)||void 0===e?void 0:e.localDescription}getRemoteDescription(){var e;return null===(e=this.pc)||void 0===e?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return Jn(this,void 0,void 0,(function*(){var e;if(!this._pc)return;let t="";const n=new Map,i=new Map;if((yield this._pc.getStats()).forEach((e=>{switch(e.type){case"transport":t=e.selectedCandidatePairId;break;case"candidate-pair":""===t&&e.selected&&(t=e.id),n.set(e.id,e);break;case"remote-candidate":i.set(e.id,"".concat(e.address,":").concat(e.port))}})),""===t)return;const r=null===(e=n.get(t))||void 0===e?void 0:e.remoteCandidateId;return void 0!==r?i.get(r):void 0}))}setMungedSDP(e,t,n){return Jn(this,void 0,void 0,(function*(){if(t){const r=e.sdp;e.sdp=t;try{return this.log.debug("setting munged ".concat(n?"remote":"local"," description"),this.logContext),void(n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e))}catch(i){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:i,sdp:t})),e.sdp=r}}try{n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(i){let t="unknown error";i instanceof Error?t=i.message:"string"===typeof i&&(t=i);const r={error:t,sdp:e.sdp};throw!n&&this.pc.remoteDescription&&(r.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:r})),new Pr(t)}}))}ensureVideoDDExtensionForSVC(e,t){var n,i;if(!(null===(n=e.ext)||void 0===n?void 0:n.some((e=>e.uri===oo)))){if(0===this.ddExtID){let e=0;t.media.forEach((t=>{var n;"video"===t.type&&(null===(n=t.ext)||void 0===n||n.forEach((t=>{t.value>e&&(e=t.value)})))})),this.ddExtID=e+1}null===(i=e.ext)||void 0===i||i.push({value:this.ddExtID,uri:oo})}}}function la(e,t,n){let i=0;e.rtp.some((e=>"opus"===e.codec&&(i=e.payload,!0))),i>0&&(e.rtcpFb||(e.rtcpFb=[]),n.includes(e.mid)&&!e.rtcpFb.some((e=>e.payload===i&&"nack"===e.type))&&e.rtcpFb.push({payload:i,type:"nack"}),t.includes(e.mid)&&e.fmtp.some((e=>e.payload===i&&(e.config.includes("stereo=1")||(e.config+=";stereo=1"),!0))))}const da="vp8",ua={audioPreset:Br.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:zr.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:da,backupCodec:!0},ha={autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},pa={resolution:Vr.h720.resolution},ma={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new class{constructor(e){this._retryDelays=void 0!==e?[...e]:Qn}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+1e3*Math.random()}},disconnectOnPageLeave:!0,webAudioMix:!1},fa={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var ga;!function(e){e[e.NEW=0]="NEW",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.FAILED=3]="FAILED",e[e.CLOSING=4]="CLOSING",e[e.CLOSED=5]="CLOSED"}(ga||(ga={}));class va{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,t,n){var i;this.peerConnectionTimeout=fa.peerConnectionTimeout,this.log=Wn,this.updateState=()=>{var e;const t=this.state,n=this.requiredTransports.map((e=>e.getConnectionState()));n.every((e=>"connected"===e))?this.state=ga.CONNECTED:n.some((e=>"failed"===e))?this.state=ga.FAILED:n.some((e=>"connecting"===e))?this.state=ga.CONNECTING:n.every((e=>"closed"===e))?this.state=ga.CLOSED:n.some((e=>"closed"===e))?this.state=ga.CLOSING:n.every((e=>"new"===e))&&(this.state=ga.NEW),t!==this.state&&(this.log.debug("pc state change: from ".concat(ga[t]," to ").concat(ga[this.state]),this.logContext),null===(e=this.onStateChange)||void 0===e||e.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=Kn(null!==(i=n.loggerName)&&void 0!==i?i:qn.PCManager),this.loggerOptions=n,this.isPublisherConnectionRequired=!t,this.isSubscriberConnectionRequired=t,this.publisher=new ca(e,n),this.subscriber=new ca(e,n),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,zt.PUBLISHER)},this.subscriber.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,zt.SUBSCRIBER)},this.subscriber.onDataChannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},this.subscriber.onTrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},this.publisher.onOffer=e=>{var t;null===(t=this.onPublisherOffer)||void 0===t||t.call(this,e)},this.state=ga.NEW,this.connectionLock=new p,this.remoteOfferLock=new p}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}requirePublisher(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e){return this.publisher.setRemoteDescription(e)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return Jn(this,void 0,void 0,(function*(){if(this.publisher&&"closed"!==this.publisher.getSignallingState()){const t=this.publisher;for(const n of t.getSenders())try{t.canRemoveTrack()&&t.removeTrack(n)}catch(e){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:e}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()}))}triggerIceRestart(){return Jn(this,void 0,void 0,(function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))}))}addIceCandidate(e,t){return Jn(this,void 0,void 0,(function*(){t===zt.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)}))}createSubscriberAnswerFromOffer(e){return Jn(this,void 0,void 0,(function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const t=yield this.remoteOfferLock.lock();try{yield this.subscriber.setRemoteDescription(e);return yield this.subscriber.createAndSetAnswer()}finally{t()}}))}updateConfiguration(e,t){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){return Jn(this,void 0,void 0,(function*(){var n;const i=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&"connected"!==this.publisher.getConnectionState()&&"connecting"!==this.publisher.getConnectionState()&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all(null===(n=this.requiredTransports)||void 0===n?void 0:n.map((n=>this.ensureTransportConnected(n,e,t))))}finally{i()}}))}negotiate(e){return Jn(this,void 0,void 0,(function*(){return new Promise(((t,n)=>Jn(this,void 0,void 0,(function*(){const i=setTimeout((()=>{n("negotiation timed out")}),this.peerConnectionTimeout);e.signal.addEventListener("abort",(()=>{clearTimeout(i),n("negotiation aborted")})),this.publisher.once(oa,(()=>{e.signal.aborted||this.publisher.once(aa,(()=>{clearTimeout(i),t()}))})),yield this.publisher.negotiate((e=>{clearTimeout(i),n(e)}))}))))}))}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===zt.PUBLISHER||e===zt.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,t){return Jn(this,arguments,void 0,(function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.peerConnectionTimeout;return function*(){if("connected"!==e.getConnectionState())return new Promise(((e,r)=>Jn(n,void 0,void 0,(function*(){const n=()=>{this.log.warn("abort transport connection",this.logContext),Ar.clearTimeout(o),r(new Tr("room connection has been cancelled",mr.Cancelled))};(null===t||void 0===t?void 0:t.signal.aborted)&&n(),null===t||void 0===t||t.signal.addEventListener("abort",n);const o=Ar.setTimeout((()=>{null===t||void 0===t||t.signal.removeEventListener("abort",n),r(new Tr("could not establish pc connection",mr.InternalError))}),i);for(;this.state!==ga.CONNECTED;)if(yield ao(50),null===t||void 0===t?void 0:t.signal.aborted)return void r(new Tr("room connection has been cancelled",mr.Cancelled));Ar.clearTimeout(o),null===t||void 0===t||t.signal.removeEventListener("abort",n),e()}))))}()}))}}const ba=2e3;function ya(e,t){if(!t)return 0;let n,i;return"bytesReceived"in e?(n=e.bytesReceived,i=t.bytesReceived):"bytesSent"in e&&(n=e.bytesSent,i=t.bytesSent),void 0===n||void 0===i||void 0===e.timestamp||void 0===t.timestamp?0:8*(n-i)*1e3/(e.timestamp-t.timestamp)}class ka extends jo{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;super(e,Hr.Kind.Audio,t,n,r),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>Jn(this,void 0,void 0,(function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(t){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:t}))}e&&this.prevStats&&(this._currentBitrate=ya(e,this.prevStats)),this.prevStats=e})),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(kr.AudioTrackFeatureUpdate,this,ot.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(kr.AudioTrackFeatureUpdate,this,ot.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=i,this.checkForSilence()}setDeviceId(e){return Jn(this,void 0,void 0,(function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Mo(e)||(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||Mo(e)===this._mediaStreamTrack.getSettings().deviceId)}))}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return Jn(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===Hr.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}}))}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return Jn(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const t=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Mo(this._constraints.deviceId);return this.source!==Hr.Source.Microphone||!this.stopOnMute&&"ended"!==this._mediaStreamTrack.readyState&&!t||this.isUserProvided||(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}}))}restartTrack(e){return Jn(this,void 0,void 0,(function*(){let t;if(e){const n=$r({audio:e});"boolean"!==typeof n.audio&&(t=n.audio)}yield this.restart(t)}))}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return Jn(this,void 0,void 0,(function*(){const n=yield t.restart.call(this,e);return this.checkForSilence(),n}))}startMonitor(){go()&&(this.monitorInterval||(this.monitorInterval=setInterval((()=>{this.monitorSender()}),ba)))}setProcessor(e){return Jn(this,void 0,void 0,(function*(){var t;const n=yield this.processorLock.lock();try{if(!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const n={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(n),this.processor=e,this.processor.processedTrack&&(yield null===(t=this.sender)||void 0===t?void 0:t.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(kr.TrackProcessorUpdate,this.processor)}finally{n()}}))}setAudioContext(e){this.audioContext=e}getSenderStats(){return Jn(this,void 0,void 0,(function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return;let t;return(yield this.sender.getStats()).forEach((e=>{"outbound-rtp"===e.type&&(t={type:"audio",streamId:e.id,packetsSent:e.packetsSent,packetsLost:e.packetsLost,bytesSent:e.bytesSent,timestamp:e.timestamp,roundTripTime:e.roundTripTime,jitter:e.jitter})})),t}))}checkForSilence(){return Jn(this,void 0,void 0,(function*(){const e=yield function(e){return Jn(this,arguments,void 0,(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return function*(){const n=Xr();if(n){const i=n.createAnalyser();i.fftSize=2048;const r=i.frequencyBinCount,o=new Uint8Array(r);n.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),yield ao(t),i.getByteTimeDomainData(o);const a=o.some((e=>128!==e&&0!==e));return n.close(),!a}return!1}()}))}(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(kr.AudioSilenceDetected)),e}))}}function Ta(e,t,n){switch(e.kind){case"audio":return new ka(e,t,!1,void 0,n);case"video":return new Ma(e,t,!1,n);default:throw new Cr("unsupported track type: ".concat(e.kind))}}const Sa=Object.values(Vr),Ca=Object.values(qr),Ea=Object.values(zr),wa=[Vr.h180,Vr.h360],Pa=[qr.h180,qr.h360],Ra=["q","h","f"];function Ia(e,t,n,i){var r,o;let a=null===i||void 0===i?void 0:i.videoEncoding;e&&(a=null===i||void 0===i?void 0:i.screenShareEncoding);const s=null===i||void 0===i?void 0:i.simulcast,c=null===i||void 0===i?void 0:i.scalabilityMode,l=null===i||void 0===i?void 0:i.videoCodec;if(!a&&!s&&!c||!t||!n)return[{}];a||(a=function(e,t,n,i){const r=function(e,t,n){if(e)return Ea;const i=t>n?t/n:n/t;if(Math.abs(i-16/9)<Math.abs(i-4/3))return Sa;return Ca}(e,t,n);let{encoding:o}=r[0];const a=Math.max(t,n);for(let s=0;s<r.length;s+=1){const e=r[s];if(o=e.encoding,e.width>=a)break}if(i)switch(i){case"av1":o=Object.assign({},o),o.maxBitrate=.7*o.maxBitrate;break;case"vp9":o=Object.assign({},o),o.maxBitrate=.85*o.maxBitrate}return o}(e,t,n,l),Wn.debug("using video encoding",a));const d=new Lr(t,n,a.maxBitrate,a.maxFramerate,a.priority);if(c&&lo(l)){const e=new Na(c),t=[];if(e.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const n=_r();if(po()||vo()||"Chrome"===(null===n||void 0===n?void 0:n.name)&&So(null===n||void 0===n?void 0:n.version,"113")<0){const n="h"==e.suffix?2:3;for(let i=0;i<e.spatial;i+=1)t.push({rid:Ra[2-i],maxBitrate:a.maxBitrate/Math.pow(n,i),maxFramerate:d.encoding.maxFramerate});t[0].scalabilityMode=c}else t.push({maxBitrate:a.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:c});return d.encoding.priority&&(t[0].priority=d.encoding.priority,t[0].networkPriority=d.encoding.priority),Wn.debug("using svc encoding",{encodings:t}),t}if(!s)return[a];let u,h=[];if(h=e?null!==(r=_a(null===i||void 0===i?void 0:i.screenShareSimulcastLayers))&&void 0!==r?r:Oa(e,d):null!==(o=_a(null===i||void 0===i?void 0:i.videoSimulcastLayers))&&void 0!==o?o:Oa(e,d),h.length>0){const e=h[0];h.length>1&&([,u]=h);const i=Math.max(t,n);if(i>=960&&u)return xa(t,n,[e,u,d]);if(i>=480)return xa(t,n,[e,d])}return xa(t,n,[d])}function Oa(e,t){if(e)return[{scaleResolutionDownBy:2,fps:(n=t).encoding.maxFramerate}].map((e=>{var t,i;return new Lr(Math.floor(n.width/e.scaleResolutionDownBy),Math.floor(n.height/e.scaleResolutionDownBy),Math.max(15e4,Math.floor(n.encoding.maxBitrate/(Math.pow(e.scaleResolutionDownBy,2)*((null!==(t=n.encoding.maxFramerate)&&void 0!==t?t:30)/(null!==(i=e.fps)&&void 0!==i?i:30))))),e.fps,n.encoding.priority)}));var n;const{width:i,height:r}=t,o=i>r?i/r:r/i;return Math.abs(o-16/9)<Math.abs(o-4/3)?wa:Pa}function xa(e,t,n){const i=[];if(n.forEach(((n,r)=>{if(r>=Ra.length)return;const o=Math.min(e,t),a={rid:Ra[r],scaleResolutionDownBy:Math.max(1,o/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate};n.encoding.maxFramerate&&(a.maxFramerate=n.encoding.maxFramerate);const s=ho()||0===r;n.encoding.priority&&s&&(a.priority=n.encoding.priority,a.networkPriority=n.encoding.priority),i.push(a)})),vo()&&"ios"===ko()){let e;i.forEach((t=>{e?t.maxFramerate&&t.maxFramerate>e&&(e=t.maxFramerate):e=t.maxFramerate}));let t=!0;i.forEach((n=>{var i;n.maxFramerate!=e&&(t&&(t=!1,Wn.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Wn.info('Setting framerate of encoding "'.concat(null!==(i=n.rid)&&void 0!==i?i:"",'" to ').concat(e)),n.maxFramerate=e)}))}return i}function _a(e){if(e)return e.sort(((e,t)=>{const{encoding:n}=e,{encoding:i}=t;return n.maxBitrate>i.maxBitrate?1:n.maxBitrate<i.maxBitrate?-1:n.maxBitrate===i.maxBitrate&&n.maxFramerate&&i.maxFramerate?n.maxFramerate>i.maxFramerate?1:-1:0}))}class Na{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat(null!==(e=this.suffix)&&void 0!==e?e:"")}}class Ma extends jo{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0;super(e,Hr.Kind.Video,t,n,i),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.monitorSender=()=>Jn(this,void 0,void 0,(function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(n){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:n}))}const t=new Map(e.map((e=>[e.rid,e])));if(this.prevStats){let e=0;t.forEach(((t,n)=>{var i;const r=null===(i=this.prevStats)||void 0===i?void 0:i.get(n);e+=ya(t,r)})),this._currentBitrate=e}this.prevStats=t})),this.senderLock=new p}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!go())return;const n=null===(t=this.sender)||void 0===t?void 0:t.getParameters();n&&(this.encodings=n.encodings),this.monitorInterval||(this.monitorInterval=setInterval((()=>{this.monitorSender()}),ba))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach((e=>{e.mediaStreamTrack.stop()})),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return Jn(this,void 0,void 0,(function*(){var t,n,i,r,o;yield e.pauseUpstream.call(this);try{for(var a,s=!0,c=$n(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);s=!0){r=a.value,s=!1;const e=r;yield null===(o=e.sender)||void 0===o?void 0:o.replaceTrack(null)}}catch(l){n={error:l}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}}))}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return Jn(this,void 0,void 0,(function*(){var t,n,i,r,o;yield e.resumeUpstream.call(this);try{for(var a,s=!0,c=$n(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);s=!0){r=a.value,s=!1;const e=r;yield null===(o=e.sender)||void 0===o?void 0:o.replaceTrack(e.mediaStreamTrack)}}catch(l){n={error:l}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}}))}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return Jn(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source!==Hr.Source.Camera||this.isUserProvided||(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}}))}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return Jn(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.source!==Hr.Source.Camera||this.isUserProvided||(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{t()}}))}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){return Jn(this,void 0,void 0,(function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return[];const t=[],n=yield this.sender.getStats();return n.forEach((e=>{var i;if("outbound-rtp"===e.type){const r={type:"video",streamId:e.id,frameHeight:e.frameHeight,frameWidth:e.frameWidth,framesPerSecond:e.framesPerSecond,framesSent:e.framesSent,firCount:e.firCount,pliCount:e.pliCount,nackCount:e.nackCount,packetsSent:e.packetsSent,bytesSent:e.bytesSent,qualityLimitationReason:e.qualityLimitationReason,qualityLimitationDurations:e.qualityLimitationDurations,qualityLimitationResolutionChanges:e.qualityLimitationResolutionChanges,rid:null!==(i=e.rid)&&void 0!==i?i:e.id,retransmittedPacketsSent:e.retransmittedPacketsSent,targetBitrate:e.targetBitrate,timestamp:e.timestamp},o=n.get(e.remoteId);o&&(r.jitter=o.jitter,r.packetsLost=o.packetsLost,r.roundTripTime=o.roundTripTime),t.push(r)}})),t.sort(((e,t)=>{var n,i;return(null!==(n=t.frameWidth)&&void 0!==n?n:0)-(null!==(i=e.frameWidth)&&void 0!==i?i:0)})),t}))}setPublishingQuality(e){const t=[];for(let n=Kr.LOW;n<=Kr.HIGH;n+=1)t.push(new kn({quality:n,enabled:n<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(t)}setDeviceId(e){return Jn(this,void 0,void 0,(function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Mo(e)||(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||Mo(e)===this._mediaStreamTrack.getSettings().deviceId)}))}restartTrack(e){return Jn(this,void 0,void 0,(function*(){var t,n,i,r;let o;if(e){const t=$r({video:e});"boolean"!==typeof t.video&&(o=t.video)}yield this.restart(o);try{for(var a,s=!0,c=$n(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);s=!0){r=a.value,s=!1;const e=r;e.sender&&(e.mediaStreamTrack=this.mediaStreamTrack.clone(),yield e.sender.replaceTrack(e.mediaStreamTrack))}}catch(l){n={error:l}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}}))}setProcessor(e){const t=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return Jn(this,arguments,void 0,(function(e){var n=this;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var r,o,a,s,c,l;if(yield t.setProcessor.call(n,e,i),null===(c=n.processor)||void 0===c?void 0:c.processedTrack)try{for(var d,u=!0,h=$n(n.simulcastCodecs.values());!(r=(d=yield h.next()).done);u=!0){s=d.value,u=!1;const e=s;yield null===(l=e.sender)||void 0===l?void 0:l.replaceTrack(n.processor.processedTrack)}}catch(p){o={error:p}}finally{try{u||r||!(a=h.return)||(yield a.call(h))}finally{if(o)throw o.error}}}()}))}setDegradationPreference(e){return Jn(this,void 0,void 0,(function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const t=this.sender.getParameters();t.degradationPreference=e,this.sender.setParameters(t)}catch(t){this.log.warn("failed to set degradationPreference",Object.assign({error:t},this.logContext))}}))}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e))return void this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);const n={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,n),n}setSimulcastTrackSender(e,t){const n=this.simulcastCodecs.get(e);n&&(n.sender=t,setTimeout((()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)}),5e3))}setPublishingCodecs(e){return Jn(this,void 0,void 0,(function*(){var t,n,i,r,o,a,s;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(t=!0,n=$n(e);!(r=(i=yield n.next()).done);t=!0){s=i.value,t=!1;const e=s;if(this.codec&&this.codec!==e.codec){const t=this.simulcastCodecs.get(e.codec);if(this.log.debug("try setPublishingCodec for ".concat(e.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:t})),t&&t.sender)t.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(e.codec),this.logContext),yield Da(t.sender,t.encodings,e.qualities,this.senderLock,this.log,this.logContext));else for(const n of e.qualities)if(n.enabled){c.push(e.codec);break}}else yield this.setPublishingLayers(e.qualities)}}catch(l){o={error:l}}finally{try{t||r||!(a=n.return)||(yield a.call(n))}finally{if(o)throw o.error}}return c}))}setPublishingLayers(e){return Jn(this,void 0,void 0,(function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:e})),this.sender&&this.encodings&&(yield Da(this.sender,this.encodings,e,this.senderLock,this.log,this.logContext))}))}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Jn(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),fo()&&this.isInBackground&&this.source===Hr.Source.Camera&&(this._mediaStreamTrack.enabled=!1)}))}}function Da(e,t,n,i,r,o){return Jn(this,void 0,void 0,(function*(){const a=yield i.lock();r.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:e,qualities:n,senderEncodings:t}));try{const i=e.getParameters(),{encodings:a}=i;if(!a)return;if(a.length!==t.length)return void r.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:a,senderEncodings:t}));let s=!1;!1&&a[0].scalabilityMode||a.forEach(((e,i)=>{var a;let c=null!==(a=e.rid)&&void 0!==a?a:"";""===c&&(c="q");const l=Aa(c),d=n.find((e=>e.quality===l));d&&e.active!==d.enabled&&(s=!0,e.active=d.enabled,r.debug("setting layer ".concat(d.quality," to ").concat(e.active?"enabled":"disabled"),o),ho()&&(d.enabled?(e.scaleResolutionDownBy=t[i].scaleResolutionDownBy,e.maxBitrate=t[i].maxBitrate,e.maxFrameRate=t[i].maxFrameRate):(e.scaleResolutionDownBy=4,e.maxBitrate=10,e.maxFrameRate=2)))})),s&&(i.encodings=a,r.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:i.encodings})),yield e.setParameters(i))}finally{a()}}))}function Aa(e){switch(e){case"f":default:return Kr.HIGH;case"h":return Kr.MEDIUM;case"q":return Kr.LOW}}function La(e,t,n,i){if(!n)return[new ft({quality:Kr.HIGH,width:e,height:t,bitrate:0,ssrc:0})];if(i){const i=n[0].scalabilityMode,r=new Na(i),o=[],a="h"==r.suffix?1.5:2,s="h"==r.suffix?2:3;for(let c=0;c<r.spatial;c+=1)o.push(new ft({quality:Math.min(Kr.HIGH,r.spatial-1)-c,width:Math.ceil(e/Math.pow(a,c)),height:Math.ceil(t/Math.pow(a,c)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(s,c)):0,ssrc:0}));return o}return n.map((n=>{var i,r,o;const a=null!==(i=n.scaleResolutionDownBy)&&void 0!==i?i:1;let s=Aa(null!==(r=n.rid)&&void 0!==r?r:"");return new ft({quality:s,width:Math.ceil(e/a),height:Math.ceil(t/a),bitrate:null!==(o=n.maxBitrate)&&void 0!==o?o:0,ssrc:0})}))}const Ua="_lossy",ja="_reliable",Fa="leave-reconnect";var Ba;!function(e){e[e.New=0]="New",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected",e[e.Reconnecting=3]="Reconnecting",e[e.Closed=4]="Closed"}(Ba||(Ba={}));class Va extends ei.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=fa.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=Ba.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Wn,this.handleDataChannel=e=>Jn(this,[e],void 0,(function(e){var t=this;let{channel:n}=e;return function*(){if(n){if(n.label===ja)t.reliableDCSub=n;else{if(n.label!==Ua)return;t.lossyDCSub=n}t.log.debug("on data channel ".concat(n.id,", ").concat(n.label),t.logContext),n.onmessage=t.handleDataMessage}}()})),this.handleDataMessage=e=>Jn(this,void 0,void 0,(function*(){var t,n;const i=yield this.dataProcessLock.lock();try{let i;if(e.data instanceof ArrayBuffer)i=e.data;else{if(!(e.data instanceof Blob))return void this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:e.data}));i=yield e.data.arrayBuffer()}const r=gt.fromBinary(new Uint8Array(i));"speaker"===(null===(t=r.value)||void 0===t?void 0:t.case)?this.emit(yr.ActiveSpeakersUpdate,r.value.value.speakers):("user"===(null===(n=r.value)||void 0===n?void 0:n.case)&&function(e,t){const n=e.participantIdentity?e.participantIdentity:t.participantIdentity;e.participantIdentity=n,t.participantIdentity=n;const i=0!==e.destinationIdentities.length?e.destinationIdentities:t.destinationIdentities;e.destinationIdentities=i,t.destinationIdentities=i}(r,r.value.value),this.emit(yr.DataPacketReceived,r))}finally{i()}})),this.handleDataError=e=>{const t=0===e.currentTarget.maxRetransmits?"lossy":"reliable";if(e instanceof ErrorEvent&&e.error){const{error:n}=e.error;this.log.error("DataChannel error on ".concat(t,": ").concat(e.message),Object.assign(Object.assign({},this.logContext),{error:n}))}else this.log.error("Unknown DataChannel error on ".concat(t),Object.assign(Object.assign({},this.logContext),{event:e}))},this.handleBufferedAmountLow=e=>{const t=0===e.currentTarget.maxRetransmits?vt.LOSSY:vt.RELIABLE;this.updateAndEmitDCBufferStatus(t)},this.handleDisconnect=(e,t)=>{if(this._isClosed)return;this.log.warn("".concat(e," disconnected"),this.logContext),0===this.reconnectAttempts&&(this.reconnectStart=Date.now());const n=e=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(e,"ms. giving up"),this.logContext),this.emit(yr.Disconnected),this.close()},i=Date.now()-this.reconnectStart;let r=this.getNextRetryDelay({elapsedMs:i,retryCount:this.reconnectAttempts});null!==r?(e===Fa&&(r=0),this.log.debug("reconnecting in ".concat(r,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Ar.setTimeout((()=>this.attemptReconnect(t).finally((()=>this.reconnectTimeout=void 0))),r)):n(i)},this.waitForRestarted=()=>new Promise(((e,t)=>{this.pcState===Ba.Connected&&e();const n=()=>{this.off(yr.Disconnected,i),e()},i=()=>{this.off(yr.Restarted,n),t()};this.once(yr.Restarted,n),this.once(yr.Disconnected,i)})),this.updateAndEmitDCBufferStatus=e=>{const t=this.isBufferStatusLow(e);"undefined"!==typeof t&&t!==this.dcBufferStatus.get(e)&&(this.dcBufferStatus.set(e,t),this.emit(yr.DCBufferStatusChanged,t,e))},this.isBufferStatusLow=e=>{const t=this.dataChannelForKind(e);if(t)return t.bufferedAmount<=t.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===zo.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(it.RR_SIGNAL_DISCONNECTED))},this.log=Kn(null!==(t=e.loggerName)&&void 0!==t?t:qn.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new Wo(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new p,this.dataProcessLock=new p,this.dcBufferStatus=new Map([[vt.LOSSY,!0],[vt.RELIABLE,!0]]),this.client.onParticipantUpdate=e=>this.emit(yr.ParticipantUpdate,e),this.client.onConnectionQuality=e=>this.emit(yr.ConnectionQualityUpdate,e),this.client.onRoomUpdate=e=>this.emit(yr.RoomUpdate,e),this.client.onSubscriptionError=e=>this.emit(yr.SubscriptionError,e),this.client.onSubscriptionPermissionUpdate=e=>this.emit(yr.SubscriptionPermissionUpdate,e),this.client.onSpeakersChanged=e=>this.emit(yr.SpeakersChanged,e),this.client.onStreamStateUpdate=e=>this.emit(yr.StreamStateChanged,e),this.client.onRequestResponse=e=>this.emit(yr.SignalRequestResponse,e)}get logContext(){var e,t,n,i,r,o,a,s;return{room:null===(t=null===(e=this.latestJoinResponse)||void 0===e?void 0:e.room)||void 0===t?void 0:t.name,roomID:null===(i=null===(n=this.latestJoinResponse)||void 0===n?void 0:n.room)||void 0===i?void 0:i.sid,participant:null===(o=null===(r=this.latestJoinResponse)||void 0===r?void 0:r.participant)||void 0===o?void 0:o.identity,pID:null===(s=null===(a=this.latestJoinResponse)||void 0===a?void 0:a.participant)||void 0===s?void 0:s.sid}}join(e,t,n,i){return Jn(this,void 0,void 0,(function*(){this.url=e,this.token=t,this.signalOpts=n,this.maxJoinAttempts=n.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const r=yield this.client.join(e,t,n,i);return this._isClosed=!1,this.latestJoinResponse=r,this.subscriberPrimary=r.subscriberPrimary,this.pcManager||(yield this.configure(r)),this.subscriberPrimary&&!r.fastPublish||this.negotiate(),this.clientConfiguration=r.clientConfiguration,r}catch(r){if(r instanceof Tr&&r.reason===mr.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,t,n,i);throw r}}))}close(){return Jn(this,void 0,void 0,(function*(){const e=yield this.closingLock.lock();if(this.isClosed)e();else try{this._isClosed=!0,this.joinAttempts=0,this.emit(yr.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}}))}cleanupPeerConnections(){return Jn(this,void 0,void 0,(function*(){var e;yield null===(e=this.pcManager)||void 0===e?void 0:e.close(),this.pcManager=void 0;const t=e=>{e&&(e.close(),e.onbufferedamountlow=null,e.onclose=null,e.onclosing=null,e.onerror=null,e.onmessage=null,e.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0}))}cleanupClient(){return Jn(this,void 0,void 0,(function*(){yield this.client.close(),this.client.resetCallbacks()}))}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Cr("a track with the same ID has already been published");return new Promise(((t,n)=>{const i=setTimeout((()=>{delete this.pendingTrackResolvers[e.cid],n(new Tr("publication of local track timed out, no response from server",mr.InternalError))}),1e4);this.pendingTrackResolvers[e.cid]={resolve:e=>{clearTimeout(i),t(e)},reject:()=>{clearTimeout(i),n(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)}))}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(t){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:t}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return null===(e=this.reliableDCSub)||void 0===e?void 0:e.readyState}getConnectedServerAddress(){return Jn(this,void 0,void 0,(function*(){var e;return null===(e=this.pcManager)||void 0===e?void 0:e.getConnectedAddress()}))}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return Jn(this,void 0,void 0,(function*(){var t,n;if(this.pcManager&&this.pcManager.currentState!==ga.NEW)return;this.participantSid=null===(t=e.participant)||void 0===t?void 0:t.sid;const i=this.makeRTCConfiguration(e);var r;this.pcManager=new va(i,e.subscriberPrimary,this.loggerOptions),this.emit(yr.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(e,t)=>{this.client.sendIceCandidate(e,t)},this.pcManager.onPublisherOffer=e=>{this.client.sendOffer(e)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(t,n,i)=>Jn(this,void 0,void 0,(function*(){if(this.log.debug("primary PC state changed ".concat(t),this.logContext),["closed","disconnected","failed"].includes(n)&&(this.publisherConnectionPromise=void 0),t===ga.CONNECTED){const t=this.pcState===Ba.New;this.pcState=Ba.Connected,t&&this.emit(yr.Connected,e)}else t===ga.FAILED&&this.pcState===Ba.Connected&&(this.pcState=Ba.Disconnected,this.handleDisconnect("peerconnection failed","failed"===i?it.RR_SUBSCRIBER_FAILED:it.RR_PUBLISHER_FAILED));const r=this.client.isDisconnected||this.client.currentState===zo.RECONNECTING,o=[ga.FAILED,ga.CLOSING,ga.CLOSED].includes(t);r&&o&&!this._isClosed&&this.emit(yr.Offline)})),this.pcManager.onTrack=e=>{this.emit(yr.MediaTrackAdded,e.track,e.streams[0],e.receiver)},void 0!==(r=null===(n=e.serverInfo)||void 0===n?void 0:n.protocol)&&r>13||this.createDataChannels()}))}setupSignalClientCallbacks(){this.client.onAnswer=e=>Jn(this,void 0,void 0,(function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e))})),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.trace("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=e=>Jn(this,void 0,void 0,(function*(){if(!this.pcManager)return;const t=yield this.pcManager.createSubscriberAnswerFromOffer(e);this.client.sendAnswer(t)})),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:null===(t=e.track)||void 0===t?void 0:t.sid})),!this.pendingTrackResolvers[e.cid])return void this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));const{resolve:n}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],n(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(yr.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(yr.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(yr.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(yr.SubscribedQualityUpdate,e)},this.client.onClose=()=>{this.handleDisconnect("signal",it.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:null===e||void 0===e?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case dn.DISCONNECT:this.emit(yr.Disconnected,null===e||void 0===e?void 0:e.reason),this.close();break;case dn.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Fa);break;case dn.RESUME:this.handleDisconnect(Fa)}}}makeRTCConfiguration(e){var t;const n=Object.assign({},this.rtcConfig);if((null===(t=this.signalOpts)||void 0===t?void 0:t.e2eeEnabled)&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),n.encodedInsertableStreams=!0),e.iceServers&&!n.iceServers){const t=[];e.iceServers.forEach((e=>{const n={urls:e.urls};e.username&&(n.username=e.username),e.credential&&(n.credential=e.credential),t.push(n)})),n.iceServers=t}return e.clientConfiguration&&e.clientConfiguration.forceRelay===tt.ENABLED&&(n.iceTransportPolicy="relay"),n.sdpSemantics="unified-plan",n.continualGatheringPolicy="gather_continually",n}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Ua,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(ja,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,t,n){return Jn(this,void 0,void 0,(function*(){if(so()){return yield this.createTransceiverRTCRtpSender(e,t,n)}if(co()){this.log.warn("using add-track fallback",this.logContext);return yield this.createRTCRtpSender(e.mediaStreamTrack)}throw new wr("Required webRTC APIs not supported on this device")}))}createSimulcastSender(e,t,n,i){return Jn(this,void 0,void 0,(function*(){if(so())return this.createSimulcastTransceiverSender(e,t,n,i);if(co())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new wr("Cannot stream on this device")}))}createTransceiverRTCRtpSender(e,t,n){return Jn(this,void 0,void 0,(function*(){if(!this.pcManager)throw new wr("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream),e instanceof Ma&&(e.codec=t.videoCodec);const r={direction:"sendonly",streams:i};n&&(r.sendEncodings=n);return(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,r)).sender}))}createSimulcastTransceiverSender(e,t,n,i){return Jn(this,void 0,void 0,(function*(){if(!this.pcManager)throw new wr("publisher is closed");const r={direction:"sendonly"};i&&(r.sendEncodings=i);const o=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,r);if(n.videoCodec)return e.setSimulcastTrackSender(n.videoCodec,o.sender),o.sender}))}createRTCRtpSender(e){return Jn(this,void 0,void 0,(function*(){if(!this.pcManager)throw new wr("publisher is closed");return this.pcManager.addPublisherTrack(e)}))}attemptReconnect(e){return Jn(this,void 0,void 0,(function*(){var t,n,i;if(!this._isClosed)if(this.attemptingReconnect)Wn.warn("already attempting reconnect, returning early",this.logContext);else{(null===(t=this.clientConfiguration)||void 0===t?void 0:t.resumeConnection)!==tt.DISABLED&&(null!==(i=null===(n=this.pcManager)||void 0===n?void 0:n.currentState)&&void 0!==i?i:ga.NEW)!==ga.NEW||(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(r){this.reconnectAttempts+=1;let e=!0;r instanceof wr?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:r})),e=!1):r instanceof qa||(this.fullReconnectOnNext=!0),e?this.handleDisconnect("reconnect",it.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(yr.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}}))}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(t){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:t}))}return null}restartConnection(e){return Jn(this,void 0,void 0,(function*(){var t,n,i;try{if(!this.url||!this.token)throw new wr("could not reconnect, url or token not saved");let n;this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(yr.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new qa;n=yield this.join(null!==e&&void 0!==e?e:this.url,this.token,this.signalOpts)}catch(r){if(r instanceof Tr&&r.reason===mr.NotAllowed)throw new wr("could not reconnect, token might be expired");throw new qa}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(yr.SignalRestarted,n),yield this.waitForPCReconnected(),this.client.currentState!==zo.CONNECTED)throw new qa("Signal connection got severed during reconnect");null===(t=this.regionUrlProvider)||void 0===t||t.resetAttempts(),this.emit(yr.Restarted)}catch(o){const e=yield null===(n=this.regionUrlProvider)||void 0===n?void 0:n.getNextBestRegionUrl();if(e)return void(yield this.restartConnection(e));throw null===(i=this.regionUrlProvider)||void 0===i||i.resetAttempts(),o}}))}resumeConnection(e){return Jn(this,void 0,void 0,(function*(){var t;if(!this.url||!this.token)throw new wr("could not reconnect, url or token not saved");if(!this.pcManager)throw new wr("publisher and subscriber connections unset");let n;this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(yr.Resuming);try{this.setupSignalClientCallbacks(),n=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(i){let e="";if(i instanceof Error&&(e=i.message,this.log.error(i.message,Object.assign(Object.assign({},this.logContext),{error:i}))),i instanceof Tr&&i.reason===mr.NotAllowed)throw new wr("could not reconnect, token might be expired");if(i instanceof Tr&&i.reason===mr.LeaveRequest)throw i;throw new qa(e)}if(this.emit(yr.SignalResumed),n){const e=this.makeRTCConfiguration(n);this.pcManager.updateConfiguration(e)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==zo.CONNECTED)throw new qa("Signal connection got severed during reconnect");this.client.setReconnected(),"open"===(null===(t=this.reliableDC)||void 0===t?void 0:t.readyState)&&null===this.reliableDC.id&&this.createDataChannels(),this.emit(yr.Resumed)}))}waitForPCInitialConnection(e,t){return Jn(this,void 0,void 0,(function*(){if(!this.pcManager)throw new wr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)}))}waitForPCReconnected(){return Jn(this,void 0,void 0,(function*(){this.pcState=Ba.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield ao(2e3),!this.pcManager)throw new wr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Ba.Connected}catch(e){throw this.pcState=Ba.Disconnected,new Tr("could not establish PC connection, ".concat(e.message),mr.InternalError)}}))}sendDataPacket(e,t){return Jn(this,void 0,void 0,(function*(){const n=e.toBinary();yield this.ensurePublisherConnected(t);const i=this.dataChannelForKind(t);i&&i.send(n),this.updateAndEmitDCBufferStatus(t)}))}ensureDataTransportConnected(e){return Jn(this,arguments,void 0,(function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.subscriberPrimary;return function*(){var i;if(!t.pcManager)throw new wr("PC manager is closed");const r=n?t.pcManager.subscriber:t.pcManager.publisher,o=n?"Subscriber":"Publisher";if(!r)throw new Tr("".concat(o," connection not set"),mr.InternalError);let a=!1;n||t.dataChannelForKind(e,n)||(t.createDataChannels(),a=!0),a||n||t.pcManager.publisher.isICEConnected||"checking"===t.pcManager.publisher.getICEConnectionState()||(a=!0),a&&t.negotiate();const s=t.dataChannelForKind(e,n);if("open"===(null===s||void 0===s?void 0:s.readyState))return;const c=(new Date).getTime()+t.peerConnectionTimeout;for(;(new Date).getTime()<c;){if(r.isICEConnected&&"open"===(null===(i=t.dataChannelForKind(e,n))||void 0===i?void 0:i.readyState))return;yield ao(50)}throw new Tr("could not establish ".concat(o," connection, state: ").concat(r.getICEConnectionState()),mr.InternalError)}()}))}ensurePublisherConnected(e){return Jn(this,void 0,void 0,(function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise}))}verifyTransport(){return!!this.pcManager&&(this.pcManager.currentState===ga.CONNECTED&&!(!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED))}negotiate(){return Jn(this,void 0,void 0,(function*(){return new Promise(((e,t)=>Jn(this,void 0,void 0,(function*(){if(!this.pcManager)return void t(new Pr("PC manager is closed"));this.pcManager.requirePublisher(),0!=this.pcManager.publisher.getTransceivers().length||this.lossyDC||this.reliableDC||this.createDataChannels();const n=new AbortController,i=()=>{n.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t("cannot negotiate on closed engine"),this.on(yr.Closing,i),this.pcManager.publisher.once(sa,(e=>{const t=new Map;e.forEach((e=>{const n=e.codec.toLowerCase();var i;i=n,jr.includes(i)&&t.set(e.payload,n)})),this.emit(yr.RTPVideoMapUpdate,t)}));try{yield this.pcManager.negotiate(n),e()}catch(r){r instanceof Pr&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",it.RR_UNKNOWN),t(r)}finally{this.off(yr.Closing,i)}}))))}))}dataChannelForKind(e,t){if(t){if(e===vt.LOSSY)return this.lossyDCSub;if(e===vt.RELIABLE)return this.reliableDCSub}else{if(e===vt.LOSSY)return this.lossyDC;if(e===vt.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var n,i;if(!this.pcManager)return void this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);const r=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),a=null===(i=null===(n=this.signalOpts)||void 0===n?void 0:n.autoSubscribe)||void 0===i||i,s=new Array,c=new Array;e.forEach((e=>{e.isDesired!==a&&s.push(e.trackSid),e.isEnabled||c.push(e.trackSid)})),this.client.sendSyncState(new Pn({answer:r?Ho({sdp:r.sdp,type:r.type}):void 0,offer:o?Ho({sdp:o.sdp,type:o.type}):void 0,subscription:new on({trackSids:s,subscribe:!a,participantTracks:[]}),publishTracks:no(t),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:c}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(t,n)=>{void 0!==(null===t||void 0===t?void 0:t.id)&&null!==t.id&&e.push(new Rn({label:t.label,id:t.id,target:n}))};return t(this.dataChannelForKind(vt.LOSSY),zt.PUBLISHER),t(this.dataChannelForKind(vt.RELIABLE),zt.PUBLISHER),t(this.dataChannelForKind(vt.LOSSY,!0),zt.SUBSCRIBER),t(this.dataChannelForKind(vt.RELIABLE,!0),zt.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Ar.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){go()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){go()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class qa extends Error{}class za{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return bo(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return Jn(this,void 0,void 0,(function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter((e=>!this.attemptedRegions.find((t=>t.url===e.url))));if(t.length>0){const e=t[0];return this.attemptedRegions.push(e),Wn.debug("next region: ".concat(e.region)),e.url}return null}))}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return Jn(this,void 0,void 0,(function*(){const t=yield fetch("".concat((n=this.serverUrl,"".concat(n.protocol.replace("ws","http"),"//").concat(n.host,"/settings")),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});var n;if(t.ok){const e=yield t.json();return this.lastUpdateAt=Date.now(),e}throw new Tr("Could not fetch region settings: ".concat(t.statusText),401===t.status?mr.NotAllowed:mr.InternalError,t.status)}))}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}class Wa extends Error{constructor(e,t,n){super(t),this.code=e,this.message=Ha(t,Wa.MAX_MESSAGE_BYTES),this.data=n?Ha(n,Wa.MAX_DATA_BYTES):void 0}static fromProto(e){return new Wa(e.code,e.message,e.data)}toProto(){return new It({code:this.code,message:this.message,data:this.data})}static builtIn(e,t){return new Wa(Wa.ErrorCode[e],Wa.ErrorMessage[e],t)}}Wa.MAX_MESSAGE_BYTES=256,Wa.MAX_DATA_BYTES=15360,Wa.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404},Wa.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};function Ka(e){return(new TextEncoder).encode(e).length}function Ha(e,t){if(Ka(e)<=t)return e;let n=0,i=e.length;const r=new TextEncoder;for(;n<i;){const o=Math.floor((n+i+1)/2);r.encode(e.slice(0,o)).length<=t?n=o:i=o-1}return e.slice(0,n)}class Ga extends Hr{constructor(e,t,n,i,r){super(e,n,r),this.sid=t,this.receiver=i}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?kr.Muted:kr.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=n=>{n.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(kr.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return Jn(this,void 0,void 0,(function*(){var e;if(!(null===(e=this.receiver)||void 0===e?void 0:e.getStats))return;return yield this.receiver.getStats()}))}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval((()=>this.monitorReceiver()),ba)),"undefined"!==typeof RTCRtpReceiver&&"getSynchronizationSources"in RTCRtpReceiver&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var t;this.timeSyncHandle=requestAnimationFrame((()=>e()));const n=null===(t=this.receiver)||void 0===t?void 0:t.getSynchronizationSources()[0];if(n){const{timestamp:e,rtpTimestamp:t}=n;t&&this.rtpTimestamp!==t&&(this.emit(kr.TimeSyncUpdate,{timestamp:e,rtpTimestamp:t}),this.rtpTimestamp=t)}};e()}}class Qa extends Ga{constructor(e,t,n,i,r,o){super(e,t,Hr.Kind.Audio,n,o),this.monitorReceiver=()=>Jn(this,void 0,void 0,(function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=ya(e,this.prevStats)),this.prevStats=e})),this.audioContext=i,this.webAudioPluginNodes=[],r&&(this.sinkId=r.deviceId)}setVolume(e){var t;for(const n of this.attachedElements)this.audioContext?null===(t=this.gainNode)||void 0===t||t.gain.setTargetAtTime(e,0,.1):n.volume=e;vo()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(vo())return 1;let e=0;return this.attachedElements.forEach((t=>{t.volume>e&&(e=t.volume)})),e}setSinkId(e){return Jn(this,void 0,void 0,(function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map((t=>{if(uo(t))return t.setSinkId(e)})))}))}attach(e){const t=0===this.attachedElements.length;return e?super.attach(e):e=super.attach(),this.sinkId&&uo(e)&&e.setSinkId(this.sinkId),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let n=this.sourceNode;this.webAudioPluginNodes.forEach((e=>{n.connect(e),n=e})),this.gainNode=e.createGain(),n.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),"running"!==e.state&&e.resume().then((()=>{"running"!==e.state&&this.emit(kr.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))})).catch((e=>{this.emit(kr.AudioPlaybackFailed,e)}))}disconnectWebAudio(){var e,t;null===(e=this.gainNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return Jn(this,void 0,void 0,(function*(){if(!this.receiver||!this.receiver.getStats)return;let e;return(yield this.receiver.getStats()).forEach((t=>{"inbound-rtp"===t.type&&(e={type:"audio",timestamp:t.timestamp,jitter:t.jitter,bytesReceived:t.bytesReceived,concealedSamples:t.concealedSamples,concealmentEvents:t.concealmentEvents,silentConcealedSamples:t.silentConcealedSamples,silentConcealmentEvents:t.silentConcealmentEvents,totalAudioEnergy:t.totalAudioEnergy,totalSamplesDuration:t.totalSamplesDuration})})),e}))}}class Ja extends Ga{constructor(e,t,n,i,r){super(e,t,Hr.Kind.Video,n,r),this.elementInfos=[],this.monitorReceiver=()=>Jn(this,void 0,void 0,(function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=ya(e,this.prevStats)),this.prevStats=e})),this.debouncedHandleResize=Ir((()=>{this.updateDimensions()}),100),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return void 0!==this.adaptiveStreamSettings}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach((t=>{e?Qr(this._mediaStreamTrack,t):Gr(this._mediaStreamTrack,t)}))}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&void 0===this.elementInfos.find((t=>t.element===e))){const t=new Ya(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&void 0===this.elementInfos.find((t=>t===e))?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream)return void this.log.warn("stopObservingElementInfo ignored",this.logContext);const t=this.elementInfos.filter((t=>t===e));for(const n of t)n.stopObserving();this.elementInfos=this.elementInfos.filter((t=>t!==e)),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const n of t)this.stopObservingElement(n);return t}getDecoderImplementation(){var e;return null===(e=this.prevStats)||void 0===e?void 0:e.decoderImplementation}getReceiverStats(){return Jn(this,void 0,void 0,(function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,n="",i=new Map;return e.forEach((e=>{"inbound-rtp"===e.type?(n=e.codecId,t={type:"video",framesDecoded:e.framesDecoded,framesDropped:e.framesDropped,framesReceived:e.framesReceived,packetsReceived:e.packetsReceived,packetsLost:e.packetsLost,frameWidth:e.frameWidth,frameHeight:e.frameHeight,pliCount:e.pliCount,firCount:e.firCount,nackCount:e.nackCount,jitter:e.jitter,timestamp:e.timestamp,bytesReceived:e.bytesReceived,decoderImplementation:e.decoderImplementation}):"codec"===e.type&&i.set(e.id,e)})),t&&""!==n&&i.get(n)&&(t.mimeType=i.get(n).mimeType),t}))}stopObservingElement(e){const t=this.elementInfos.filter((t=>t.element===e));for(const n of t)this.stopObservingElementInfo(n)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Jn(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()}))}updateVisibility(){var e,t;const n=this.elementInfos.reduce(((e,t)=>Math.max(e,t.visibilityChangedAt||0)),0),i=!(null!==(t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pauseVideoInBackground)&&void 0!==t&&!t)&&this.isInBackground,r=this.elementInfos.some((e=>e.pictureInPicture)),o=this.elementInfos.some((e=>e.visible))&&!i||r;this.lastVisible!==o&&(!o&&Date.now()-n<100?Ar.setTimeout((()=>{this.updateVisibility()}),100):(this.lastVisible=o,this.emit(kr.VisibilityChanged,o,this)))}updateDimensions(){var e,t;let n=0,i=0;const r=this.getPixelDensity();for(const o of this.elementInfos){const e=o.width()*r,t=o.height()*r;e+t>n+i&&(n=e,i=t)}(null===(e=this.lastDimensions)||void 0===e?void 0:e.width)===n&&(null===(t=this.lastDimensions)||void 0===t?void 0:t.height)===i||(this.lastDimensions={width:n,height:i},this.emit(kr.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pixelDensity;if("screen"===t)return To();if(!t){return To()>2?2:1}return t}}class Ya{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=e=>{var t;const{target:n,isIntersecting:i}=e;n===this.element&&(this.isIntersecting=i,this.isPiP=$a(this.element),this.visibilityChangedAt=Date.now(),null===(t=this.handleVisibilityChanged)||void 0===t||t.call(this))},this.onEnterPiP=()=>{var e,t,n;null===(t=null===(e=window.documentPictureInPicture)||void 0===e?void 0:e.window)||void 0===t||t.addEventListener("pagehide",this.onLeavePiP),this.isPiP=$a(this.element),null===(n=this.handleVisibilityChanged)||void 0===n||n.call(this)},this.onLeavePiP=()=>{var e;this.isPiP=$a(this.element),null===(e=this.handleVisibilityChanged)||void 0===e||e.call(this)},this.element=e,this.isIntersecting=null!==t&&void 0!==t?t:Xa(e),this.isPiP=go()&&$a(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,t,n;this.isIntersecting=Xa(this.element),this.isPiP=$a(this.element),this.element.handleResize=()=>{var e;null===(e=this.handleResize)||void 0===e||e.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Io().observe(this.element),Po().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),null===(e=window.documentPictureInPicture)||void 0===e||e.addEventListener("enter",this.onEnterPiP),null===(n=null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)||void 0===n||n.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,t,n,i,r;null===(e=Io())||void 0===e||e.unobserve(this.element),null===(t=Po())||void 0===t||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),null===(n=window.documentPictureInPicture)||void 0===n||n.removeEventListener("enter",this.onEnterPiP),null===(r=null===(i=window.documentPictureInPicture)||void 0===i?void 0:i.window)||void 0===r||r.removeEventListener("pagehide",this.onLeavePiP)}}function $a(e){var t,n;return document.pictureInPictureElement===e||!!(null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)&&Xa(e,null===(n=window.documentPictureInPicture)||void 0===n?void 0:n.window)}function Xa(e,t){const n=t||window;let i=e.offsetTop,r=e.offsetLeft;const o=e.offsetWidth,a=e.offsetHeight,{hidden:s}=e,{display:c}=getComputedStyle(e);for(;e.offsetParent;)i+=(e=e.offsetParent).offsetTop,r+=e.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+a>n.pageYOffset&&r+o>n.pageXOffset&&!s&&"none"!==c}class Za extends ei.EventEmitter{constructor(e,t,n,i){var r;super(),this.metadataMuted=!1,this.encryption=ht.NONE,this.log=Wn,this.handleMuted=()=>{this.emit(kr.Muted)},this.handleUnmuted=()=>{this.emit(kr.Unmuted)},this.log=Kn(null!==(r=null===i||void 0===i?void 0:i.loggerName)&&void 0!==r?r:qn.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=n,this.source=Hr.Source.Unknown}setTrack(e){this.track&&(this.track.off(kr.Muted,this.handleMuted),this.track.off(kr.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(kr.Muted,this.handleMuted),e.on(kr.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),io(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return void 0!==this.track}get isEncrypted(){return this.encryption!==ht.NONE}get audioTrack(){if(this.track instanceof ka||this.track instanceof Qa)return this.track}get videoTrack(){if(this.track instanceof Ma||this.track instanceof Ja)return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=Hr.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===Hr.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}!function(e){var t,n;(t=e.SubscriptionStatus||(e.SubscriptionStatus={})).Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",(n=e.PermissionStatus||(e.PermissionStatus={})).Allowed="allowed",n.NotAllowed="not_allowed"}(Za||(Za={}));class es extends Za{get isUpstreamPaused(){var e;return null===(e=this.track)||void 0===e?void 0:e.isUpstreamPaused}constructor(e,t,n,i){super(e,t.sid,t.name,i),this.track=void 0,this.handleTrackEnded=()=>{this.emit(kr.Ended)},this.updateInfo(t),this.setTrack(n)}setTrack(e){this.track&&this.track.off(kr.Ended,this.handleTrackEnded),super.setTrack(e),e&&e.on(kr.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}mute(){return Jn(this,void 0,void 0,(function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.mute()}))}unmute(){return Jn(this,void 0,void 0,(function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.unmute()}))}pauseUpstream(){return Jn(this,void 0,void 0,(function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.pauseUpstream()}))}resumeUpstream(){return Jn(this,void 0,void 0,(function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.resumeUpstream()}))}getTrackFeatures(){var e;if(this.track instanceof ka){const t=this.track.getSourceTrackSettings(),n=new Set;return t.autoGainControl&&n.add(ot.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&n.add(ot.TF_ECHO_CANCELLATION),t.noiseSuppression&&n.add(ot.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&n.add(ot.TF_STEREO),(null===(e=this.options)||void 0===e?void 0:e.dtx)||n.add(ot.TF_NO_DTX),this.track.enhancedNoiseCancellation&&n.add(ot.TF_ENHANCED_NOISE_CANCELLATION),Array.from(n.values())}return[]}}var ts,ns;!function(e){e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Lost="lost",e.Unknown="unknown"}(ts||(ts={}));class is extends ei.EventEmitter{get logContext(){var e,t;return Object.assign({},null===(t=null===(e=this.loggerOptions)||void 0===e?void 0:e.loggerContextCb)||void 0===t?void 0:t.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every((e=>e.isEncrypted))}get isAgent(){var e;return(null===(e=this.permissions)||void 0===e?void 0:e.agent)||this.kind===ut.AGENT}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ut.STANDARD;var a;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=ts.Unknown,this.log=Wn,this.log=Kn(null!==(a=null===r||void 0===r?void 0:r.loggerName)&&void 0!==a?a:qn.Participant),this.loggerOptions=r,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=n,this.metadata=i,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=o,this._attributes={}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,t]of this.trackPublications)if(t.source===e)return t}getTrackPublicationByName(e){for(const[,t]of this.trackPublications)if(t.trackName===e)return t}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrackPublication(Hr.Source.Camera);return!(null===(e=null===t||void 0===t?void 0:t.isMuted)||void 0===e||e)}get isMicrophoneEnabled(){var e;const t=this.getTrackPublication(Hr.Source.Microphone);return!(null===(e=null===t||void 0===t?void 0:t.isMuted)||void 0===e||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(Hr.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(1e3*Number.parseInt(this.participantInfo.joinedAt.toString())):new Date}updateInfo(e){return!(this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version)&&(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:e})),!0)}_setMetadata(e){const t=this.metadata!==e,n=this.metadata;this.metadata=e,t&&this.emit(br.ParticipantMetadataChanged,n)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(br.ParticipantNameChanged,e)}_setAttributes(e){const t=function(e,t){var n;void 0===e&&(e={}),void 0===t&&(t={});const i=[...Object.keys(t),...Object.keys(e)],r={};for(const o of i)e[o]!==t[o]&&(r[o]=null!==(n=t[o])&&void 0!==n?n:"");return r}(this.attributes,e);this._attributes=e,Object.keys(t).length>0&&this.emit(br.AttributesChanged,t)}setPermissions(e){var t,n,i,r,o,a;const s=this.permissions,c=e.canPublish!==(null===(t=this.permissions)||void 0===t?void 0:t.canPublish)||e.canSubscribe!==(null===(n=this.permissions)||void 0===n?void 0:n.canSubscribe)||e.canPublishData!==(null===(i=this.permissions)||void 0===i?void 0:i.canPublishData)||e.hidden!==(null===(r=this.permissions)||void 0===r?void 0:r.hidden)||e.recorder!==(null===(o=this.permissions)||void 0===o?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some(((e,t)=>{var n;return e!==(null===(n=this.permissions)||void 0===n?void 0:n.canPublishSources[t])}))||e.canSubscribeMetrics!==(null===(a=this.permissions)||void 0===a?void 0:a.canSubscribeMetrics);return this.permissions=e,c&&this.emit(br.ParticipantPermissionsChanged,s),c}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(br.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=function(e){switch(e){case et.EXCELLENT:return ts.Excellent;case et.GOOD:return ts.Good;case et.POOR:return ts.Poor;case et.LOST:return ts.Lost;default:return ts.Unknown}}(e),t!==this._connectionQuality&&this.emit(br.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach((t=>(t.track instanceof Qa||t.track instanceof ka)&&t.track.setAudioContext(e)))}addTrackPublication(e){e.on(kr.Muted,(()=>{this.emit(br.TrackMuted,e)})),e.on(kr.Unmuted,(()=>{this.emit(br.TrackUnmuted,e)}));const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case Hr.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case Hr.Kind.Video:this.videoTrackPublications.set(e.trackSid,e)}}}class rs extends is{constructor(e,t,n,i){super(e,t,void 0,void 0,{loggerName:i.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=ht.NONE,this.enabledPublishVideoCodecs=[],this.rpcHandlers=new Map,this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new No)},this.handleReconnected=()=>{var e,t;null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var e,t;this.reconnectFuture&&(this.reconnectFuture.promise.catch((e=>this.log.warn(e.message,this.logContext))),null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.reject)||void 0===t||t.call(e,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.handleSignalRequestResponse=e=>{const{requestId:t,reason:n,message:i}=e,r=this.pendingSignalRequests.get(t);r&&(n!==An.OK&&r.reject(new Rr(i,n)),this.pendingSignalRequests.delete(t))},this.handleDataPacket=e=>{switch(e.value.case){case"rpcRequest":let t=e.value.value;this.handleIncomingRpcRequest(e.participantIdentity,t.id,t.method,t.payload,t.responseTimeoutMs,t.version);break;case"rpcResponse":let n=e.value.value,i=null,r=null;"payload"===n.value.case?i=n.value.value:"error"===n.value.case&&(r=Wa.fromProto(n.value.value)),this.handleIncomingRpcResponse(n.requestId,i,r);break;case"rpcAck":let o=e.value.value;this.handleIncomingRpcAck(o.requestId)}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map((e=>function(e){var t,n,i;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Cn({participantIdentity:null!==(t=e.participantIdentity)&&void 0!==t?t:"",participantSid:null!==(n=e.participantSid)&&void 0!==n?n:"",allTracks:null!==(i=e.allowAll)&&void 0!==i&&i,trackSids:e.allowedTrackSids||[]})}(e))))},this.onTrackUnmuted=e=>{this.onTrackMuted(e,e.isUpstreamPaused)},this.onTrackMuted=(e,t)=>{void 0===t&&(t=!0),e.sid?this.engine.updateMuteStatus(e.sid,t):this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),io(e)))},this.onTrackUpstreamPaused=e=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),io(e))),this.onTrackMuted(e,!0)},this.onTrackUpstreamResumed=e=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),io(e))),this.onTrackMuted(e,e.isMuted)},this.onTrackFeatureUpdate=e=>{const t=this.audioTrackPublications.get(e.sid);t?this.engine.client.sendUpdateLocalAudioTrack(t.trackSid,t.getTrackFeatures()):this.log.warn("Could not update local audio track settings, missing publication for track ".concat(e.sid),this.logContext)},this.handleSubscribedQualityUpdate=e=>Jn(this,void 0,void 0,(function*(){var t,n,i,r,o,a;if(!(null===(o=this.roomOptions)||void 0===o?void 0:o.dynacast))return;const s=this.videoTrackPublications.get(e.trackSid);if(s)if(e.subscribedCodecs.length>0){if(!s.videoTrack)return;const o=yield s.videoTrack.setPublishingCodecs(e.subscribedCodecs);try{for(var c,l=!0,d=$n(o);!(t=(c=yield d.next()).done);l=!0){r=c.value,l=!1;const e=r;Fr(e)&&(this.log.debug("publish ".concat(e," for ").concat(s.videoTrack.sid),Object.assign(Object.assign({},this.logContext),io(s))),yield this.publishAdditionalCodecForTrack(s.videoTrack,e,s.options))}}catch(u){n={error:u}}finally{try{l||t||!(i=d.return)||(yield i.call(d))}finally{if(n)throw n.error}}}else e.subscribedQualities.length>0&&(yield null===(a=s.videoTrack)||void 0===a?void 0:a.setPublishingLayers(e.subscribedQualities));else this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))})),this.handleLocalTrackUnpublished=e=>{const t=this.trackPublications.get(e.trackSid);t?this.unpublishTrack(t.track):this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))},this.handleTrackEnded=e=>Jn(this,void 0,void 0,(function*(){if(e.source===Hr.Source.ScreenShare||e.source===Hr.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),io(e))),this.unpublishTrack(e);else if(e.isUserProvided)yield e.mute();else if(e instanceof ka||e instanceof Ma)try{if(go())try{const t=yield null===navigator||void 0===navigator?void 0:navigator.permissions.query({name:e.source===Hr.Source.Camera?"camera":"microphone"});if(t&&"denied"===t.state)throw this.log.warn("user has revoked access to ".concat(e.source),Object.assign(Object.assign({},this.logContext),io(e))),t.onchange=()=>{"denied"!==t.state&&(e.isMuted||e.restartTrack(),t.onchange=null)},new Error("GetUserMedia Permission denied")}catch(t){}e.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),io(e))),e instanceof ka?yield e.restartTrack({deviceId:"default"}):yield e.restartTrack())}catch(t){this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),io(e))),yield e.mute()}})),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=n,this.roomOptions=i,this.setupEngine(n),this.activeDeviceMap=new Map,this.pendingSignalRequests=new Map}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==ht.NONE}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setupEngine(e){this.engine=e,this.engine.on(yr.RemoteMute,((e,t)=>{const n=this.trackPublications.get(e);n&&n.track&&(t?n.mute():n.unmute())})),this.engine.on(yr.Connected,this.handleReconnected).on(yr.SignalRestarted,this.handleReconnected).on(yr.SignalResumed,this.handleReconnected).on(yr.Restarting,this.handleReconnecting).on(yr.Resuming,this.handleReconnecting).on(yr.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(yr.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(yr.Disconnected,this.handleDisconnected).on(yr.SignalRequestResponse,this.handleSignalRequestResponse).on(yr.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return Jn(this,void 0,void 0,(function*(){yield this.requestMetadataUpdate({metadata:e})}))}setName(e){return Jn(this,void 0,void 0,(function*(){yield this.requestMetadataUpdate({name:e})}))}setAttributes(e){return Jn(this,void 0,void 0,(function*(){yield this.requestMetadataUpdate({attributes:e})}))}requestMetadataUpdate(e){return Jn(this,arguments,void 0,(function(e){var t=this;let{metadata:n,name:i,attributes:r}=e;return function*(){return new Promise(((e,o)=>Jn(t,void 0,void 0,(function*(){var t,a;try{let s=!1;const c=yield this.engine.client.sendUpdateLocalMetadata(null!==(t=null!==n&&void 0!==n?n:this.metadata)&&void 0!==t?t:"",null!==(a=null!==i&&void 0!==i?i:this.name)&&void 0!==a?a:"",r),l=performance.now();for(this.pendingSignalRequests.set(c,{resolve:e,reject:e=>{o(e),s=!0},values:{name:i,metadata:n,attributes:r}});performance.now()-l<5e3&&!s;){if((!i||this.name===i)&&(!n||this.metadata===n)&&(!r||Object.entries(r).every((e=>{let[t,n]=e;return this.attributes[t]===n||""===n&&!this.attributes[t]}))))return this.pendingSignalRequests.delete(c),void e();yield ao(50)}o(new Rr("Request to update local metadata timed out","TimeoutError"))}catch(s){s instanceof Error&&o(s)}}))))}()}))}setCameraEnabled(e,t,n){return this.setTrackEnabled(Hr.Source.Camera,e,t,n)}setMicrophoneEnabled(e,t,n){return this.setTrackEnabled(Hr.Source.Microphone,e,t,n)}setScreenShareEnabled(e,t,n){return this.setTrackEnabled(Hr.Source.ScreenShare,e,t,n)}setPermissions(e){const t=this.permissions,n=super.setPermissions(e);return n&&t&&this.emit(br.ParticipantPermissionsChanged,t),n}setE2EEEnabled(e){return Jn(this,void 0,void 0,(function*(){this.encryptionType=e?ht.GCM:ht.NONE,yield this.republishAllTracks(void 0,!1)}))}setTrackEnabled(e,t,n,i){return Jn(this,void 0,void 0,(function*(){var r,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(t)if(a)yield a.unmute();else{let t;if(this.pendingPublishing.has(e)){const t=yield this.waitForPendingPublicationOfSource(e);return t||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield null===t||void 0===t?void 0:t.unmute(),t}this.pendingPublishing.add(e);try{switch(e){case Hr.Source.Camera:t=yield this.createTracks({video:null===(r=n)||void 0===r||r});break;case Hr.Source.Microphone:t=yield this.createTracks({audio:null===(o=n)||void 0===o||o});break;case Hr.Source.ScreenShare:t=yield this.createScreenTracks(Object.assign({},n));break;default:throw new Cr(e)}const s=[];for(const e of t)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),io(e))),s.push(this.publishTrack(e,i));const c=yield Promise.all(s);[a]=c}catch(s){throw null===t||void 0===t||t.forEach((e=>{e.stop()})),s instanceof Error&&!(s instanceof Cr)&&this.emit(br.MediaDevicesError,s),s}finally{this.pendingPublishing.delete(e)}}else if(!(null===a||void 0===a?void 0:a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===Hr.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const e=this.getTrackPublication(Hr.Source.ScreenShareAudio);e&&e.track&&this.unpublishTrack(e.track)}else yield a.mute();return a}))}enableCameraAndMicrophone(){return Jn(this,void 0,void 0,(function*(){if(!this.pendingPublishing.has(Hr.Source.Camera)&&!this.pendingPublishing.has(Hr.Source.Microphone)){this.pendingPublishing.add(Hr.Source.Camera),this.pendingPublishing.add(Hr.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map((e=>this.publishTrack(e))))}finally{this.pendingPublishing.delete(Hr.Source.Camera),this.pendingPublishing.delete(Hr.Source.Microphone)}}}))}createTracks(e){return Jn(this,void 0,void 0,(function*(){var t,n;null!==e&&void 0!==e||(e={});const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:o}=ro(e),a=Jr(o,null===(t=this.roomOptions)||void 0===t?void 0:t.audioCaptureDefaults,null===(n=this.roomOptions)||void 0===n?void 0:n.videoCaptureDefaults),s=$r(a);let c;try{c=yield navigator.mediaDevices.getUserMedia(s)}catch(l){throw l instanceof Error&&(s.audio&&(this.microphoneError=l),s.video&&(this.cameraError=l)),l}return s.audio&&(this.microphoneError=void 0,this.emit(br.AudioStreamAcquired)),s.video&&(this.cameraError=void 0),Promise.all(c.getTracks().map((e=>Jn(this,void 0,void 0,(function*(){const t="audio"===e.kind;let n;t?a.audio:a.video;const o=t?s.audio:s.video;"boolean"!==typeof o&&(n=o);const l=Ta(e,n,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return l.kind===Hr.Kind.Video?l.source=Hr.Source.Camera:l.kind===Hr.Kind.Audio&&(l.source=Hr.Source.Microphone,l.setAudioContext(this.audioContext)),l.mediaStream=c,l instanceof ka&&i?yield l.setProcessor(i):l instanceof Ma&&r&&(yield l.setProcessor(r)),l})))))}))}createScreenTracks(e){return Jn(this,void 0,void 0,(function*(){if(void 0===e&&(e={}),void 0===navigator.mediaDevices.getDisplayMedia)throw new Sr("getDisplayMedia not supported");void 0!==e.resolution||mo()||(e.resolution=zr.h1080fps30.resolution);const t=eo(e),n=yield navigator.mediaDevices.getDisplayMedia(t),i=n.getVideoTracks();if(0===i.length)throw new Cr("no video track found");const r=new Ma(i[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});r.source=Hr.Source.ScreenShare,e.contentHint&&(r.mediaStreamTrack.contentHint=e.contentHint);const o=[r];if(n.getAudioTracks().length>0){this.emit(br.AudioStreamAcquired);const e=new ka(n.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});e.source=Hr.Source.ScreenShareAudio,o.push(e)}return o}))}publishTrack(e,t){return Jn(this,void 0,void 0,(function*(){return this.publishOrRepublishTrack(e,t)}))}publishOrRepublishTrack(e,t){return Jn(this,arguments,void 0,(function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function*(){var r,o,a,s;let c,l;if(e instanceof ka&&e.setAudioContext(n.audioContext),yield null===(r=n.reconnectFuture)||void 0===r?void 0:r.promise,n.republishPromise&&!i&&(yield n.republishPromise),e instanceof jo&&n.pendingPublishPromises.has(e)&&(yield n.pendingPublishPromises.get(e)),e instanceof MediaStreamTrack)c=e.getConstraints();else{let t;switch(c=e.constraints,e.source){case Hr.Source.Microphone:t="audioinput";break;case Hr.Source.Camera:t="videoinput"}t&&n.activeDeviceMap.has(t)&&(c=Object.assign(Object.assign({},c),{deviceId:n.activeDeviceMap.get(t)}))}if(e instanceof MediaStreamTrack)switch(e.kind){case"audio":e=new ka(e,c,!0,n.audioContext,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;case"video":e=new Ma(e,c,!0,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;default:throw new Cr("unsupported MediaStreamTrack kind ".concat(e.kind))}else e.updateLoggerOptions({loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});if(n.trackPublications.forEach((t=>{t.track&&t.track===e&&(l=t)})),l)return n.log.warn("track has already been published, skipping",Object.assign(Object.assign({},n.logContext),io(l))),l;const d="channelCount"in e.mediaStreamTrack.getSettings()&&2===e.mediaStreamTrack.getSettings().channelCount||2===e.mediaStreamTrack.getConstraints().channelCount,u=null!==(o=null===t||void 0===t?void 0:t.forceStereo)&&void 0!==o?o:d;u&&(t||(t={}),void 0===t.dtx&&n.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},n.logContext),io(e))),void 0===t.red&&n.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),null!==(a=t.dtx)&&void 0!==a||(t.dtx=!1),null!==(s=t.red)&&void 0!==s||(t.red=!1));const h=Object.assign(Object.assign({},n.roomOptions.publishDefaults),t);!function(){const e=_r(),t="17.2";if(e)return"Safari"!==e.name&&"iOS"!==e.os||!!("iOS"===e.os&&e.osVersion&&So(t,e.osVersion)>=0)||"Safari"===e.name&&So(t,e.version)>=0}()&&n.roomOptions.e2ee&&(n.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},n.logContext)),h.simulcast=!1),h.source&&(e.source=h.source);const p=n.publish(e,h,u);n.pendingPublishPromises.set(e,p);try{return yield p}catch(m){throw m}finally{n.pendingPublishPromises.delete(e)}}()}))}publish(e,t,n){return Jn(this,void 0,void 0,(function*(){var i,r,o,a,s,c,l,d,u,h;Array.from(this.trackPublications.values()).find((t=>e instanceof jo&&t.source===e.source))&&e.source!==Hr.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),io(e))),t.stopMicTrackOnMute&&e instanceof ka&&(e.stopOnMute=!0),e.source===Hr.Source.ScreenShare&&ho()&&(t.simulcast=!1),"av1"!==t.videoCodec||function(){if(!("getCapabilities"in RTCRtpSender))return!1;if(po())return!1;const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/AV1"===n.mimeType){t=!0;break}return t}()||(t.videoCodec=void 0),"vp9"!==t.videoCodec||function(){if(!("getCapabilities"in RTCRtpSender))return!1;if(ho())return!1;if(po()){const e=_r();if((null===e||void 0===e?void 0:e.version)&&So(e.version,"16")<0)return!1}const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/VP9"===n.mimeType){t=!0;break}return t}()||(t.videoCodec=void 0),void 0===t.videoCodec&&(t.videoCodec=da),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some((e=>t.videoCodec===to(e.mime)))||(t.videoCodec=to(this.enabledPublishVideoCodecs[0].mime)));const p=t.videoCodec;e.on(kr.Muted,this.onTrackMuted),e.on(kr.Unmuted,this.onTrackUnmuted),e.on(kr.Ended,this.handleTrackEnded),e.on(kr.UpstreamPaused,this.onTrackUpstreamPaused),e.on(kr.UpstreamResumed,this.onTrackUpstreamResumed),e.on(kr.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const m=new Jt({cid:e.mediaStreamTrack.id,name:t.name,type:Hr.kindToProto(e.kind),muted:e.isMuted,source:Hr.sourceToProto(e.source),disableDtx:!(null===(i=t.dtx)||void 0===i||i),encryption:this.encryptionType,stereo:n,disableRed:this.isE2EEEnabled||!(null===(r=t.red)||void 0===r||r),stream:null===t||void 0===t?void 0:t.stream});let f;if(e.kind===Hr.Kind.Video){let n={width:0,height:0};try{n=yield e.waitForDimensions()}catch(y){const t=null!==(a=null===(o=this.roomOptions.videoCaptureDefaults)||void 0===o?void 0:o.resolution)&&void 0!==a?a:Vr.h720.resolution;n={width:t.width,height:t.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),io(e)),{dims:n}))}m.width=n.width,m.height=n.height,e instanceof Ma&&(lo(p)&&(e.source===Hr.Source.ScreenShare&&(t.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),io(e))))),t.scalabilityMode=null!==(s=t.scalabilityMode)&&void 0!==s?s:"L3T3_KEY"),m.simulcastCodecs=[new Qt({codec:p,cid:e.mediaStreamTrack.id})],!0===t.backupCodec&&(t.backupCodec={codec:da}),t.backupCodec&&p!==t.backupCodec.codec&&m.encryption===ht.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),m.simulcastCodecs.push(new Qt({codec:t.backupCodec.codec,cid:""})))),f=Ia(e.source===Hr.Source.ScreenShare,m.width,m.height,t),m.layers=La(m.width,m.height,f,lo(t.videoCodec))}else e.kind===Hr.Kind.Audio&&(f=[{maxBitrate:null===(c=t.audioPreset)||void 0===c?void 0:c.maxBitrate,priority:null!==(d=null===(l=t.audioPreset)||void 0===l?void 0:l.priority)&&void 0!==d?d:"high",networkPriority:null!==(h=null===(u=t.audioPreset)||void 0===u?void 0:u.priority)&&void 0!==h?h:"high"}]);if(!this.engine||this.engine.isClosed)throw new wr("cannot publish track when not connected");const g=()=>Jn(this,void 0,void 0,(function*(){var n,i,r;if(!this.engine.pcManager)throw new wr("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,t,f),e instanceof Ma&&(null!==(n=t.degradationPreference)&&void 0!==n||(t.degradationPreference=function(e){return e.source===Hr.Source.ScreenShare||e.constraints.height&&Mo(e.constraints.height)>=1080?"maintain-resolution":"balanced"}(e)),e.setDegradationPreference(t.degradationPreference)),f)if(ho()&&e.kind===Hr.Kind.Audio){let t;for(const n of this.engine.pcManager.publisher.getTransceivers())if(n.sender===e.sender){t=n;break}t&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:t,codec:"opus",maxbr:(null===(i=f[0])||void 0===i?void 0:i.maxBitrate)?f[0].maxBitrate/1e3:0})}else e.codec&&lo(e.codec)&&(null===(r=f[0])||void 0===r?void 0:r.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:m.cid,codec:e.codec,maxbr:f[0].maxBitrate/1e3});yield this.engine.negotiate()}));let v;if(this.enabledPublishVideoCodecs.length>0){v=(yield Promise.all([this.engine.addTrack(m),g()]))[0]}else{let n;if(v=yield this.engine.addTrack(m),v.codecs.forEach((e=>{void 0===n&&(n=e.mimeType)})),n&&e.kind===Hr.Kind.Video){const i=to(n);i!==p&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),io(e)),{codec:i})),t.videoCodec=i,f=Ia(e.source===Hr.Source.ScreenShare,m.width,m.height,t))}yield g()}const b=new es(e.kind,v,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return b.options=t,e.sid=v.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:f,trackInfo:v})),e instanceof Ma?e.startMonitor(this.engine.client):e instanceof ka&&e.startMonitor(),this.addTrackPublication(b),this.emit(br.LocalTrackPublished,b),b}))}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,n){return Jn(this,void 0,void 0,(function*(){var i;if(this.encryptionType!==ht.NONE)return;let r;if(this.trackPublications.forEach((t=>{t.track&&t.track===e&&(r=t)})),!r)throw new Cr("track is not published");if(!(e instanceof Ma))throw new Cr("track is not a video track");const o=Object.assign(Object.assign({},null===(i=this.roomOptions)||void 0===i?void 0:i.publishDefaults),n),a=function(e,t,n){var i,r,o,a;if(!n.backupCodec||!0===n.backupCodec||n.backupCodec.codec===n.videoCodec)return;t!==n.backupCodec.codec&&Wn.warn("requested a different codec than specified as backup",{serverRequested:t,backup:n.backupCodec.codec}),n.videoCodec=t,n.videoEncoding=n.backupCodec.encoding;const s=e.mediaStreamTrack.getSettings(),c=null!==(i=s.width)&&void 0!==i?i:null===(r=e.dimensions)||void 0===r?void 0:r.width,l=null!==(o=s.height)&&void 0!==o?o:null===(a=e.dimensions)||void 0===a?void 0:a.height;return Ia(e.source===Hr.Source.ScreenShare,c,l,n)}(e,t,o);if(!a)return void this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),io(e)));const s=e.addSimulcastTrack(t,a);if(!s)return;const c=new Jt({cid:s.mediaStreamTrack.id,type:Hr.kindToProto(e.kind),muted:e.isMuted,source:Hr.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:s.mediaStreamTrack.id}]});if(c.layers=La(c.width,c.height,a),!this.engine||this.engine.isClosed)throw new wr("cannot publish track when not connected");const l=(yield Promise.all([this.engine.addTrack(c),(()=>Jn(this,void 0,void 0,(function*(){yield this.engine.createSimulcastSender(e,s,o,a),yield this.engine.negotiate()})))()]))[0];this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:l}))}))}unpublishTrack(e,t){return Jn(this,void 0,void 0,(function*(){var n,i;if(e instanceof jo){const t=this.pendingPublishPromises.get(e);t&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),io(e))),yield t)}const r=this.getPublicationForTrack(e),o=r?io(r):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!r||!r.track)return void this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));(e=r.track).off(kr.Muted,this.onTrackMuted),e.off(kr.Unmuted,this.onTrackUnmuted),e.off(kr.Ended,this.handleTrackEnded),e.off(kr.UpstreamPaused,this.onTrackUpstreamPaused),e.off(kr.UpstreamResumed,this.onTrackUpstreamResumed),e.off(kr.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),void 0===t&&(t=null===(i=null===(n=this.roomOptions)||void 0===n?void 0:n.stopLocalTrackOnUnpublish)||void 0===i||i),t&&e.stop();let a=!1;const s=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<ga.FAILED&&s)try{for(const e of this.engine.pcManager.publisher.getTransceivers())e.sender===s&&(e.direction="inactive",a=!0);if(this.engine.removeTrack(s)&&(a=!0),e instanceof Ma){for(const[,t]of e.simulcastCodecs)t.sender&&(this.engine.removeTrack(t.sender)&&(a=!0),t.sender=void 0);e.simulcastCodecs.clear()}}catch(c){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:c}))}switch(this.trackPublications.delete(r.trackSid),r.kind){case Hr.Kind.Audio:this.audioTrackPublications.delete(r.trackSid);break;case Hr.Kind.Video:this.videoTrackPublications.delete(r.trackSid)}return this.emit(br.LocalTrackUnpublished,r),r.setTrack(void 0),a&&(yield this.engine.negotiate()),r}))}unpublishTracks(e){return Jn(this,void 0,void 0,(function*(){return(yield Promise.all(e.map((e=>this.unpublishTrack(e))))).filter((e=>e instanceof es))}))}republishAllTracks(e){return Jn(this,arguments,void 0,(function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){t.republishPromise&&(yield t.republishPromise),t.republishPromise=new Promise(((i,r)=>Jn(t,void 0,void 0,(function*(){try{const t=[];this.trackPublications.forEach((n=>{n.track&&(e&&(n.options=Object.assign(Object.assign({},n.options),e)),t.push(n))})),yield Promise.all(t.map((e=>Jn(this,void 0,void 0,(function*(){const t=e.track;yield this.unpublishTrack(t,!1),n&&!t.isMuted&&t.source!==Hr.Source.ScreenShare&&t.source!==Hr.Source.ScreenShareAudio&&(t instanceof ka||t instanceof Ma)&&!t.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:e.trackSid})),yield t.restartTrack()),yield this.publishOrRepublishTrack(t,e.options,!0)}))))),i()}catch(t){r(t)}finally{this.republishPromise=void 0}})))),yield t.republishPromise}()}))}publishData(e){return Jn(this,arguments,void 0,(function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){const i=n.reliable?vt.RELIABLE:vt.LOSSY,r=n.destinationIdentities,o=n.topic,a=new gt({kind:i,value:{case:"user",value:new kt({participantIdentity:t.identity,payload:e,destinationIdentities:r,topic:o})}});yield t.engine.sendDataPacket(a,i)}()}))}publishDtmf(e,t){return Jn(this,void 0,void 0,(function*(){const n=new gt({kind:vt.RELIABLE,value:{case:"sipDtmf",value:new Tt({code:e,digit:t})}});yield this.engine.sendDataPacket(n,vt.RELIABLE)}))}sendChatMessage(e){return Jn(this,void 0,void 0,(function*(){const t={id:crypto.randomUUID(),message:e,timestamp:Date.now()},n=new gt({value:{case:"chatMessage",value:new Et(Object.assign(Object.assign({},t),{timestamp:A.parse(t.timestamp)}))}});return yield this.engine.sendDataPacket(n,vt.RELIABLE),this.emit(br.ChatMessage,t),t}))}editChatMessage(e,t){return Jn(this,void 0,void 0,(function*(){const n=Object.assign(Object.assign({},t),{message:e,editTimestamp:Date.now()}),i=new gt({value:{case:"chatMessage",value:new Et(Object.assign(Object.assign({},n),{timestamp:A.parse(n.timestamp),editTimestamp:A.parse(n.editTimestamp)}))}});return yield this.engine.sendDataPacket(i,vt.RELIABLE),this.emit(br.ChatMessage,n),n}))}performRpc(e){return Jn(this,arguments,void 0,(function(e){var t=this;let{destinationIdentity:n,method:i,payload:r,responseTimeout:o=1e4}=e;return function*(){return new Promise(((e,a)=>Jn(t,void 0,void 0,(function*(){var t,s,c,l;if(Ka(r)>15360)return void a(Wa.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));if((null===(s=null===(t=this.engine.latestJoinResponse)||void 0===t?void 0:t.serverInfo)||void 0===s?void 0:s.version)&&So(null===(l=null===(c=this.engine.latestJoinResponse)||void 0===c?void 0:c.serverInfo)||void 0===l?void 0:l.version,"1.8.0")<0)return void a(Wa.builtIn("UNSUPPORTED_SERVER"));const d=crypto.randomUUID();yield this.publishRpcRequest(n,d,i,r,o-2e3);const u=setTimeout((()=>{this.pendingAcks.delete(d),a(Wa.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(d),clearTimeout(h)}),2e3);this.pendingAcks.set(d,{resolve:()=>{clearTimeout(u)},participantIdentity:n});const h=setTimeout((()=>{this.pendingResponses.delete(d),a(Wa.builtIn("RESPONSE_TIMEOUT"))}),o);this.pendingResponses.set(d,{resolve:(t,n)=>{clearTimeout(h),this.pendingAcks.has(d)&&(console.warn("RPC response received before ack",d),this.pendingAcks.delete(d),clearTimeout(u)),n?a(n):e(null!==t&&void 0!==t?t:"")},participantIdentity:n})}))))}()}))}registerRpcMethod(e,t){this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const t=this.pendingAcks.get(e);t?(t.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,t,n){const i=this.pendingResponses.get(e);i?(i.resolve(t,n),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}handleIncomingRpcRequest(e,t,n,i,r,o){return Jn(this,void 0,void 0,(function*(){if(yield this.publishRpcAck(e,t),1!==o)return void(yield this.publishRpcResponse(e,t,null,Wa.builtIn("UNSUPPORTED_VERSION")));const a=this.rpcHandlers.get(n);if(!a)return void(yield this.publishRpcResponse(e,t,null,Wa.builtIn("UNSUPPORTED_METHOD")));let s=null,c=null;try{const o=yield a({requestId:t,callerIdentity:e,payload:i,responseTimeout:r});Ka(o)>15360?(s=Wa.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(n))):c=o}catch(l){l instanceof Wa?s=l:(console.warn("Uncaught error returned by RPC handler for ".concat(n,". Returning APPLICATION_ERROR instead."),l),s=Wa.builtIn("APPLICATION_ERROR"))}yield this.publishRpcResponse(e,t,c,s)}))}publishRpcRequest(e,t,n,i,r){return Jn(this,void 0,void 0,(function*(){const o=new gt({destinationIdentities:[e],kind:vt.RELIABLE,value:{case:"rpcRequest",value:new wt({id:t,method:n,payload:i,responseTimeoutMs:r,version:1})}});yield this.engine.sendDataPacket(o,vt.RELIABLE)}))}publishRpcResponse(e,t,n,i){return Jn(this,void 0,void 0,(function*(){const r=new gt({destinationIdentities:[e],kind:vt.RELIABLE,value:{case:"rpcResponse",value:new Rt({requestId:t,value:i?{case:"error",value:i.toProto()}:{case:"payload",value:null!==n&&void 0!==n?n:""}})}});yield this.engine.sendDataPacket(r,vt.RELIABLE)}))}publishRpcAck(e,t){return Jn(this,void 0,void 0,(function*(){const n=new gt({destinationIdentities:[e],kind:vt.RELIABLE,value:{case:"rpcAck",value:new Pt({requestId:t})}});yield this.engine.sendDataPacket(n,vt.RELIABLE)}))}handleParticipantDisconnected(e){for(const[t,{participantIdentity:n}]of this.pendingAcks)n===e&&this.pendingAcks.delete(t);for(const[t,{participantIdentity:n,resolve:i}]of this.pendingResponses)n===e&&(i(null,Wa.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(t))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter((e=>"video"===e.mime.split("/")[0].toLowerCase()))}updateInfo(e){return e.sid===this.sid&&(!!super.updateInfo(e)&&(e.tracks.forEach((e=>{var t,n;const i=this.trackPublications.get(e.sid);if(i){const r=i.isMuted||null!==(n=null===(t=i.track)||void 0===t?void 0:t.isUpstreamPaused)&&void 0!==n&&n;r!==e.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),io(i)),{mutedOnServer:r})),this.engine.client.sendMuteTrack(e.sid,r))}})),!0))}getPublicationForTrack(e){let t;return this.trackPublications.forEach((n=>{const i=n.track;i&&(e instanceof MediaStreamTrack?(i instanceof ka||i instanceof Ma)&&i.mediaStreamTrack===e&&(t=n):e===i&&(t=n))})),t}waitForPendingPublicationOfSource(e){return Jn(this,void 0,void 0,(function*(){const t=Date.now();for(;Date.now()<t+1e4;){const t=Array.from(this.pendingPublishPromises.entries()).find((t=>{let[n]=t;return n.source===e}));if(t)return t[1];yield ao(20)}}))}}class os extends Za{constructor(e,t,n,i){super(e,t.sid,t.name,i),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=Kr.HIGH,this.handleEnded=e=>{this.setTrack(void 0),this.emit(kr.Ended,e)},this.handleVisibilityChange=e=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(e),this.logContext),this.disabled=!e,this.emitTrackUpdate()},this.handleVideoDimensionsChange=e=>{this.log.debug("adaptivestream video dimensions ".concat(e.width,"x").concat(e.height),this.logContext),this.videoDimensions=e,this.emitTrackUpdate()},this.subscribed=n,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const i=new on({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new Ot({participantSid:"",trackSids:[this.trackSid]})]});this.emit(kr.UpdateSubscription,i),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(n)}get subscriptionStatus(){return!1===this.subscribed?Za.SubscriptionStatus.Unsubscribed:super.isSubscribed?Za.SubscriptionStatus.Subscribed:Za.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Za.PermissionStatus.Allowed:Za.PermissionStatus.NotAllowed}get isSubscribed(){return!1!==this.subscribed&&super.isSubscribed}get isDesired(){return!1!==this.subscribed}get isEnabled(){return!this.disabled}setEnabled(e){this.isManualOperationAllowed()&&this.disabled!==!e&&(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){this.isManualOperationAllowed()&&this.currentVideoQuality!==e&&(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,n;this.isManualOperationAllowed()&&((null===(t=this.videoDimensions)||void 0===t?void 0:t.width)===e.width&&(null===(n=this.videoDimensions)||void 0===n?void 0:n.height)===e.height||(this.track instanceof Ja&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&this.track instanceof Ja&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(e){const t=this.subscriptionStatus,n=this.permissionStatus,i=this.track;i!==e&&(i&&(i.off(kr.VideoDimensionsChanged,this.handleVideoDimensionsChange),i.off(kr.VisibilityChanged,this.handleVisibilityChange),i.off(kr.Ended,this.handleEnded),i.detach(),i.stopMonitor(),this.emit(kr.Unsubscribed,i)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(kr.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(kr.VisibilityChanged,this.handleVisibilityChange),e.on(kr.Ended,this.handleEnded),this.emit(kr.Subscribed,e)),this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(kr.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?kr.Muted:kr.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(kr.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(kr.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.kind===Hr.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):!!this.isDesired||(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return this.track instanceof Ja&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new an({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):void 0!==this.currentVideoQuality?e.quality=this.currentVideoQuality:e.quality=Kr.HIGH,this.emit(kr.UpdateSettings,e)}}class as extends is{static fromParticipantInfo(e,t,n){return new as(e,t.sid,t.identity,t.name,t.metadata,n,t.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,t,n,i,r,o){super(t,n||"",i,r,o,arguments.length>6&&void 0!==arguments[6]?arguments[6]:ut.STANDARD),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(kr.UpdateSettings,(t=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),io(e))),this.signalClient.sendUpdateTrackSettings(t)})),e.on(kr.UpdateSubscription,(e=>{e.participantTracks.forEach((e=>{e.participantSid=this.sid})),this.signalClient.sendUpdateSubscription(e)})),e.on(kr.SubscriptionPermissionChanged,(t=>{this.emit(br.TrackSubscriptionPermissionChanged,e,t)})),e.on(kr.SubscriptionStatusChanged,(t=>{this.emit(br.TrackSubscriptionStatusChanged,e,t)})),e.on(kr.Subscribed,(t=>{this.emit(br.TrackSubscribed,t,e)})),e.on(kr.Unsubscribed,(t=>{this.emit(br.TrackUnsubscribed,t,e)})),e.on(kr.SubscriptionFailed,(t=>{this.emit(br.TrackSubscriptionFailed,e.trackSid,t)}))}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Hr.Source.Microphone;this.volumeMap.set(t,e);const n=this.getTrackPublication(t);n&&n.track&&n.track.setVolume(e)}getVolume(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Hr.Source.Microphone;const t=this.getTrackPublication(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,n,i,r,o){let a=this.getTrackPublicationBySid(t);if(a||t.startsWith("TR")||this.trackPublications.forEach((t=>{a||e.kind!==t.kind.toString()||(a=t)})),!a)return 0===o?(this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),void this.emit(br.TrackSubscriptionFailed,t)):(void 0===o&&(o=20),void setTimeout((()=>{this.addSubscribedMediaTrack(e,t,n,i,r,o-1)}),150));if("ended"===e.readyState)return this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),io(a))),void this.emit(br.TrackSubscriptionFailed,t);let s;return s="video"===e.kind?new Ja(e,t,i,r):new Qa(e,t,i,this.audioContext,this.audioOutput),s.source=a.source,s.isMuted=a.isMuted,s.setMediaStream(n),s.start(),a.setTrack(s),this.volumeMap.has(a.source)&&s instanceof Qa&&s.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,n=new Map;return e.tracks.forEach((e=>{var i,r;let o=this.getTrackPublicationBySid(e.sid);if(o)o.updateInfo(e);else{const t=Hr.kindFromProto(e.type);if(!t)return;o=new os(t,e,null===(i=this.signalClient.connectOptions)||void 0===i?void 0:i.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:null===(r=this.loggerOptions)||void 0===r?void 0:r.loggerName}),o.updateInfo(e),n.set(e.sid,o);const a=Array.from(this.trackPublications.values()).find((e=>e.source===(null===o||void 0===o?void 0:o.source)));a&&o.source!==Hr.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(o.source),Object.assign(Object.assign({},this.logContext),{oldTrack:io(a),newTrack:io(o)})),this.addTrackPublication(o)}t.set(e.sid,o)})),this.trackPublications.forEach((e=>{t.has(e.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),io(e))),this.unpublishTrack(e.trackSid,!0))})),n.forEach((e=>{this.emit(br.TrackPublished,e)})),!0}unpublishTrack(e,t){const n=this.trackPublications.get(e);if(!n)return;const{track:i}=n;switch(i&&(i.stop(),n.setTrack(void 0)),this.trackPublications.delete(e),n.kind){case Hr.Kind.Audio:this.audioTrackPublications.delete(e);break;case Hr.Kind.Video:this.videoTrackPublications.delete(e)}t&&this.emit(br.TrackUnpublished,n)}setAudioOutput(e){return Jn(this,void 0,void 0,(function*(){this.audioOutput=e;const t=[];this.audioTrackPublications.forEach((n=>{var i;n.track instanceof Qa&&t.push(n.track.setSinkId(null!==(i=e.deviceId)&&void 0!==i?i:"default"))})),yield Promise.all(t)}))}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:n})),super.emit(e,...n)}}!function(e){e.Disconnected="disconnected",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting"}(ns||(ns={}));class ss extends ei.EventEmitter{constructor(e){var t,n,i;super(),t=this,this.state=ns.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Wn,this.bufferedEvents=[],this.isResuming=!1,this.connect=(e,t,n)=>Jn(this,void 0,void 0,(function*(){var i;if("undefined"===typeof RTCPeerConnection||!so()&&!co())throw vo()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const r=yield this.disconnectLock.lock();if(this.state===ns.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),r(),Promise.resolve();if(this.connectFuture)return r(),this.connectFuture.promise;this.setAndEmitConnectionState(ns.Connecting),(null===(i=this.regionUrlProvider)||void 0===i?void 0:i.getServerUrl().toString())!==e&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),bo(new URL(e))&&(void 0===this.regionUrlProvider?this.regionUrlProvider=new za(e,t):this.regionUrlProvider.updateToken(t),this.regionUrlProvider.fetchRegionSettings().then((e=>{var t;null===(t=this.regionUrlProvider)||void 0===t||t.setServerReportedRegions(e)})).catch((e=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:e}))})));const o=(i,a,s)=>Jn(this,void 0,void 0,(function*(){var c,l;this.abortController&&this.abortController.abort();const d=new AbortController;this.abortController=d,null===r||void 0===r||r();try{yield this.attemptConnection(null!==s&&void 0!==s?s:e,t,n,d),this.abortController=void 0,i()}catch(u){if(this.regionUrlProvider&&u instanceof Tr&&u.reason!==mr.Cancelled&&u.reason!==mr.NotAllowed){let e=null;try{e=yield this.regionUrlProvider.getNextBestRegionUrl(null===(c=this.abortController)||void 0===c?void 0:c.signal)}catch(h){if(h instanceof Tr&&(401===h.status||h.reason===mr.Cancelled))return this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),void a(h)}e&&!(null===(l=this.abortController)||void 0===l?void 0:l.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(u.message,". Retrying with another region: ").concat(e),this.logContext),this.recreateEngine(),yield o(i,a,e)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Ao(u)),a(u))}else{let e=nt.UNKNOWN_REASON;u instanceof Tr&&(e=Ao(u)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e),a(u)}}})),a=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new No(((e,t)=>{o(e,t,a)}),(()=>{this.clearConnectionFutures()})),this.connectFuture.promise})),this.connectSignal=(e,t,n,i,r,o)=>Jn(this,void 0,void 0,(function*(){var a,s,c;const l=yield n.join(e,t,{autoSubscribe:i.autoSubscribe,adaptiveStream:"object"===typeof r.adaptiveStream||r.adaptiveStream,maxRetries:i.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:i.websocketTimeout},o.signal);let d=l.serverInfo;if(d||(d={version:l.serverVersion,region:l.serverRegion}),this.serverInfo=d,this.log.debug("connected to Livekit Server ".concat(Object.entries(d).map((e=>{let[t,n]=e;return"".concat(t,": ").concat(n)})).join(", ")),{room:null===(a=l.room)||void 0===a?void 0:a.name,roomSid:null===(s=l.room)||void 0===s?void 0:s.sid,identity:null===(c=l.participant)||void 0===c?void 0:c.identity}),!d.version)throw new Er("unknown server version");return"0.15.1"===d.version&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),r.dynacast=!1),l})),this.applyJoinResponse=e=>{const t=e.participant;if(this.localParticipant.sid=t.sid,this.localParticipant.identity=t.identity,this.localParticipant.setEnabledPublishCodecs(e.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(e.sifTrailer)}catch(n){this.log.error(n instanceof Error?n.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:n}))}this.handleParticipantUpdates([t,...e.otherParticipants]),e.room&&this.handleRoomUpdate(e.room)},this.attemptConnection=(e,t,n,i)=>Jn(this,void 0,void 0,(function*(){var r,o,a;this.state===ns.Reconnecting||this.isResuming||(null===(r=this.engine)||void 0===r?void 0:r.pendingReconnect)?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),(null===(o=this.regionUrlProvider)||void 0===o?void 0:o.isCloud())&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},fa),n),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const n=yield this.connectSignal(e,t,this.engine,this.connOptions,this.options,i);this.applyJoinResponse(n),this.setupLocalParticipantEvents(),this.emit(vr.SignalConnected)}catch(s){yield this.engine.close(),this.recreateEngine();const e=new Tr("could not establish signal connection",mr.ServerUnreachable);throw s instanceof Error&&(e.message="".concat(e.message,": ").concat(s.message)),s instanceof Tr&&(e.reason=s.reason,e.status=s.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:s})),e}if(i.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new Tr("Connection attempt aborted",mr.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,i)}catch(c){throw yield this.engine.close(),this.recreateEngine(),c}go()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),go()&&(document.addEventListener("freeze",this.onPageLeave),null===(a=navigator.mediaDevices)||void 0===a||a.addEventListener("devicechange",this.handleDeviceChange)),this.setAndEmitConnectionState(ns.Connected),this.emit(vr.Connected),this.registerConnectionReconcile()})),this.disconnect=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return Jn(t,[...n],void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var n,i,r,o;const a=yield e.disconnectLock.lock();try{if(e.state===ns.Disconnected)return void e.log.debug("already disconnected",e.logContext);e.log.info("disconnect from room",Object.assign({},e.logContext)),(e.state===ns.Connecting||e.state===ns.Reconnecting||e.isResuming)&&(e.log.warn("abort connection attempt",e.logContext),null===(n=e.abortController)||void 0===n||n.abort(),null===(r=null===(i=e.connectFuture)||void 0===i?void 0:i.reject)||void 0===r||r.call(i,new Tr("Client initiated disconnect",mr.Cancelled)),e.connectFuture=void 0),(null===(o=e.engine)||void 0===o?void 0:o.client.isDisconnected)||(yield e.engine.client.sendLeave()),e.engine&&(yield e.engine.close()),e.handleDisconnect(t,nt.CLIENT_INITIATED),e.engine=void 0}finally{a()}}()}))},this.onPageLeave=()=>Jn(this,void 0,void 0,(function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()})),this.startAudio=()=>Jn(this,void 0,void 0,(function*(){const e=[],t=_r();if(t&&"iOS"===t.os){const t="livekit-dummy-audio-el";let n=document.getElementById(t);if(!n){n=document.createElement("audio"),n.id=t,n.autoplay=!0,n.hidden=!0;const e=_o();e.enabled=!0;const i=new MediaStream([e]);n.srcObject=i,document.addEventListener("visibilitychange",(()=>{n&&(n.srcObject=document.hidden?null:i,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))})),document.body.append(n),this.once(vr.Disconnected,(()=>{null===n||void 0===n||n.remove(),n=null}))}e.push(n)}this.remoteParticipants.forEach((t=>{t.audioTrackPublications.forEach((t=>{t.track&&t.track.attachedElements.forEach((t=>{e.push(t)}))}))}));try{yield Promise.all([this.acquireAudioContext(),...e.map((e=>(e.muted=!1,e.play())))]),this.handleAudioPlaybackStarted()}catch(n){throw this.handleAudioPlaybackFailed(n),n}})),this.startVideo=()=>Jn(this,void 0,void 0,(function*(){const e=[];for(const t of this.remoteParticipants.values())t.videoTrackPublications.forEach((t=>{var n;null===(n=t.track)||void 0===n||n.attachedElements.forEach((t=>{e.includes(t)||e.push(t)}))}));yield Promise.all(e.map((e=>e.play()))).then((()=>{this.handleVideoPlaybackStarted()})).catch((e=>{"NotAllowedError"===e.name?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)}))})),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const e of this.remoteParticipants.values())this.handleParticipantDisconnected(e.identity,e);this.setAndEmitConnectionState(ns.Reconnecting)&&this.emit(vr.Reconnecting)},this.handleSignalRestarted=e=>Jn(this,void 0,void 0,(function*(){this.log.debug("signal reconnected to server, region ".concat(e.serverRegion),Object.assign(Object.assign({},this.logContext),{region:e.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(e);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(t){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:t}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:e.serverRegion}))}catch(n){return}this.setAndEmitConnectionState(ns.Connected),this.emit(vr.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()})),this.handleParticipantUpdates=e=>{e.forEach((e=>{var t;if(e.identity===this.localParticipant.identity)return void this.localParticipant.updateInfo(e);""===e.identity&&(e.identity=null!==(t=this.sidToIdentity.get(e.sid))&&void 0!==t?t:"");let n=this.remoteParticipants.get(e.identity);e.state===dt.DISCONNECTED?this.handleParticipantDisconnected(e.identity,n):n=this.getOrCreateParticipant(e.identity,e)}))},this.handleActiveSpeakersUpdate=e=>{const t=[],n={};e.forEach((e=>{if(n[e.sid]=!0,e.sid===this.localParticipant.sid)this.localParticipant.audioLevel=e.level,this.localParticipant.setIsSpeaking(!0),t.push(this.localParticipant);else{const n=this.getRemoteParticipantBySid(e.sid);n&&(n.audioLevel=e.level,n.setIsSpeaking(!0),t.push(n))}})),n[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach((e=>{n[e.sid]||(e.audioLevel=0,e.setIsSpeaking(!1))})),this.activeSpeakers=t,this.emitWhenConnected(vr.ActiveSpeakersChanged,t)},this.handleSpeakersChanged=e=>{const t=new Map;this.activeSpeakers.forEach((e=>{const n=this.remoteParticipants.get(e.identity);n&&n.sid!==e.sid||t.set(e.sid,e)})),e.forEach((e=>{let n=this.getRemoteParticipantBySid(e.sid);e.sid===this.localParticipant.sid&&(n=this.localParticipant),n&&(n.audioLevel=e.level,n.setIsSpeaking(e.active),e.active?t.set(e.sid,n):t.delete(e.sid))}));const n=Array.from(t.values());n.sort(((e,t)=>t.audioLevel-e.audioLevel)),this.activeSpeakers=n,this.emitWhenConnected(vr.ActiveSpeakersChanged,n)},this.handleStreamStateUpdate=e=>{e.streamStates.forEach((e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);if(!n||!n.track)return;const i=Hr.streamStateFromProto(e.state);i!==n.track.streamState&&(n.track.streamState=i,t.emit(br.TrackStreamStateChanged,n,n.track.streamState),this.emitWhenConnected(vr.TrackStreamStateChanged,n,n.track.streamState,t))}))},this.handleSubscriptionPermissionUpdate=e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setAllowed(e.allowed)},this.handleSubscriptionError=e=>{const t=Array.from(this.remoteParticipants.values()).find((t=>t.trackPublications.has(e.trackSid)));if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setSubscriptionError(e.err)},this.handleDataPacket=e=>{const t=this.remoteParticipants.get(e.participantIdentity);"user"===e.value.case?this.handleUserPacket(t,e.value.value,e.kind):"transcription"===e.value.case?this.handleTranscription(t,e.value.value):"sipDtmf"===e.value.case?this.handleSipDtmf(t,e.value.value):"chatMessage"===e.value.case?this.handleChatMessage(t,e.value.value):"metrics"===e.value.case&&this.handleMetrics(e.value.value,t)},this.handleUserPacket=(e,t,n)=>{this.emit(vr.DataReceived,t.payload,e,n,t.topic),null===e||void 0===e||e.emit(br.DataReceived,t.payload,n)},this.handleSipDtmf=(e,t)=>{this.emit(vr.SipDTMFReceived,t,e),null===e||void 0===e||e.emit(br.SipDTMFReceived,t)},this.bufferedSegments=new Map,this.handleTranscription=(e,t)=>{const n=t.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(t.transcribedParticipantIdentity),i=null===n||void 0===n?void 0:n.trackPublications.get(t.trackId),r=function(e,t){return e.segments.map((e=>{let{id:n,text:i,language:r,startTime:o,endTime:a,final:s}=e;var c;const l=null!==(c=t.get(n))&&void 0!==c?c:Date.now(),d=Date.now();return s?t.delete(n):t.set(n,l),{id:n,text:i,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:s,language:r,firstReceivedTime:l,lastReceivedTime:d}}))}(t,this.transcriptionReceivedTimes);null===i||void 0===i||i.emit(kr.TranscriptionReceived,r),null===n||void 0===n||n.emit(br.TranscriptionReceived,r,i),this.emit(vr.TranscriptionReceived,r,n,i)},this.handleChatMessage=(e,t)=>{const n=function(e){const{id:t,timestamp:n,message:i,editTimestamp:r}=e;return{id:t,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}(t);this.emit(vr.ChatMessage,n,e)},this.handleMetrics=(e,t)=>{this.emit(vr.MetricsReceived,e,t)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(vr.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=e=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:e})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(vr.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(vr.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(vr.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>Jn(this,void 0,void 0,(function*(){const e=yield Uo.getInstance().getDevices(void 0,!1),t=["audiooutput"];for(let n of t){const t=e.filter((e=>e.kind===n));t.length>0&&!t.find((e=>e.deviceId===this.getActiveDevice(n)))&&(yield this.switchActiveDevice(n,t[0].deviceId))}this.emit(vr.MediaDevicesChanged)})),this.handleRoomUpdate=e=>{const t=this.roomInfo;this.roomInfo=e,t&&t.metadata!==e.metadata&&this.emitWhenConnected(vr.RoomMetadataChanged,e.metadata),(null===t||void 0===t?void 0:t.activeRecording)!==e.activeRecording&&this.emitWhenConnected(vr.RecordingStatusChanged,e.activeRecording)},this.handleConnectionQualityUpdate=e=>{e.updates.forEach((e=>{if(e.participantSid===this.localParticipant.sid)return void this.localParticipant.setConnectionQuality(e.quality);const t=this.getRemoteParticipantBySid(e.participantSid);t&&t.setConnectionQuality(e.quality)}))},this.onLocalParticipantMetadataChanged=e=>{this.emit(vr.ParticipantMetadataChanged,e,this.localParticipant)},this.onLocalParticipantNameChanged=e=>{this.emit(vr.ParticipantNameChanged,e,this.localParticipant)},this.onLocalAttributesChanged=e=>{this.emit(vr.ParticipantAttributesChanged,e,this.localParticipant)},this.onLocalTrackMuted=e=>{this.emit(vr.TrackMuted,e,this.localParticipant)},this.onLocalTrackUnmuted=e=>{this.emit(vr.TrackUnmuted,e,this.localParticipant)},this.onTrackProcessorUpdate=e=>{var t;null===(t=null===e||void 0===e?void 0:e.onPublish)||void 0===t||t.call(e,this)},this.onLocalTrackPublished=e=>Jn(this,void 0,void 0,(function*(){var t,n,i,r,o,a;if(null===(t=e.track)||void 0===t||t.on(kr.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(n=e.track)||void 0===n||n.on(kr.Restarted,this.onLocalTrackRestarted),null===(o=null===(r=null===(i=e.track)||void 0===i?void 0:i.getProcessor())||void 0===r?void 0:r.onPublish)||void 0===o||o.call(r,this),this.emit(vr.LocalTrackPublished,e,this.localParticipant),e.track instanceof ka){(yield e.track.checkForSilence())&&this.emit(vr.LocalAudioSilenceDetected,e)}const s=yield null===(a=e.track)||void 0===a?void 0:a.getDeviceId(),c=Zr(e.source);c&&s&&s!==this.localParticipant.activeDeviceMap.get(c)&&(this.localParticipant.activeDeviceMap.set(c,s),this.emit(vr.ActiveDeviceChanged,c,s))})),this.onLocalTrackUnpublished=e=>{var t,n;null===(t=e.track)||void 0===t||t.off(kr.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(n=e.track)||void 0===n||n.off(kr.Restarted,this.onLocalTrackRestarted),this.emit(vr.LocalTrackUnpublished,e,this.localParticipant)},this.onLocalTrackRestarted=e=>Jn(this,void 0,void 0,(function*(){const t=yield e.getDeviceId(!1),n=Zr(e.source);n&&t&&t!==this.localParticipant.activeDeviceMap.get(n)&&(this.log.debug("local track restarted, setting ".concat(n," ").concat(t," active"),this.logContext),this.localParticipant.activeDeviceMap.set(n,t),this.emit(vr.ActiveDeviceChanged,n,t))})),this.onLocalConnectionQualityChanged=e=>{this.emit(vr.ConnectionQualityChanged,e,this.localParticipant)},this.onMediaDevicesError=e=>{this.emit(vr.MediaDevicesError,e)},this.onLocalParticipantPermissionsChanged=e=>{this.emit(vr.ParticipantPermissionsChanged,e,this.localParticipant)},this.onLocalChatMessageSent=e=>{this.emit(vr.ChatMessage,e,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},ma),e),this.log=Kn(null!==(n=this.options.loggerName)&&void 0!==n?n:qn.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},ha),null===e||void 0===e?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},pa),null===e||void 0===e?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},ua),null===e||void 0===e?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new p,this.localParticipant=new rs("","",this.engine,this.options),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Mo(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Mo(this.options.audioCaptureDefaults.deviceId)),(null===(i=this.options.audioOutput)||void 0===i?void 0:i.deviceId)&&this.switchActiveDevice("audiooutput",Mo(this.options.audioOutput.deviceId)).catch((e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext))),this.options.e2ee&&this.setupE2EE()}setE2EEEnabled(e){return Jn(this,void 0,void 0,(function*(){if(!this.e2eeManager)throw Error("e2ee not configured, please set e2ee settings within the room options");yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),""!==this.localParticipant.identity&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity)}))}setupE2EE(){var e;this.options.e2ee&&(this.e2eeManager=new Fo(this.options.e2ee),this.e2eeManager.on(lr.ParticipantEncryptionStatusChanged,((e,t)=>{t instanceof rs&&(this.isE2EEEnabled=e),this.emit(vr.ParticipantEncryptionStatusChanged,e,t)})),this.e2eeManager.on(lr.EncryptionError,(e=>this.emit(vr.EncryptionError,e))),null===(e=this.e2eeManager)||void 0===e||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:null===(e=this.roomInfo)||void 0===e?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.activeRecording)&&void 0!==t&&t}getSid(){return Jn(this,void 0,void 0,(function*(){return this.state===ns.Disconnected?"":this.roomInfo&&""!==this.roomInfo.sid?this.roomInfo.sid:new Promise(((e,t)=>{const n=t=>{""!==t.sid&&(this.engine.off(yr.RoomUpdate,n),e(t.sid))};this.engine.on(yr.RoomUpdate,n),this.once(vr.Disconnected,(()=>{this.engine.off(yr.RoomUpdate,n),t("Room disconnected before room server id was available")}))}))}))}get name(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.name)&&void 0!==t?t:""}get metadata(){var e;return null===(e=this.roomInfo)||void 0===e?void 0:e.metadata}get numParticipants(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numParticipants)&&void 0!==t?t:0}get numPublishers(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numPublishers)&&void 0!==t?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new Va(this.options),this.engine.on(yr.ParticipantUpdate,this.handleParticipantUpdates).on(yr.RoomUpdate,this.handleRoomUpdate).on(yr.SpeakersChanged,this.handleSpeakersChanged).on(yr.StreamStateChanged,this.handleStreamStateUpdate).on(yr.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(yr.SubscriptionError,this.handleSubscriptionError).on(yr.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(yr.MediaTrackAdded,((e,t,n)=>{this.onTrackAdded(e,t,n)})).on(yr.Disconnected,(e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)})).on(yr.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(yr.DataPacketReceived,this.handleDataPacket).on(yr.Resuming,(()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(ns.SignalReconnecting)&&this.emit(vr.SignalReconnecting)})).on(yr.Resumed,(()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(ns.Connected)&&this.emit(vr.Reconnected)})).on(yr.SignalResumed,(()=>{this.bufferedEvents=[],(this.state===ns.Reconnecting||this.isResuming)&&this.sendSyncState()})).on(yr.Restarting,this.handleRestarting).on(yr.SignalRestarted,this.handleSignalRestarted).on(yr.Offline,(()=>{this.setAndEmitConnectionState(ns.Reconnecting)&&this.emit(vr.Reconnecting)})).on(yr.DCBufferStatusChanged,((e,t)=>{this.emit(vr.DCBufferStatusChanged,e,t)})).on(yr.LocalTrackSubscribed,(e=>{const t=this.localParticipant.getTrackPublications().find((t=>{let{trackSid:n}=t;return n===e}));t?(this.localParticipant.emit(br.LocalTrackSubscribed,t),this.emitWhenConnected(vr.LocalTrackSubscribed,t,this.localParticipant)):this.log.warn("could not find local track subscription for subscribed event",this.logContext)})),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Uo.getInstance().getDevices(e,t)}prepareConnection(e,t){return Jn(this,void 0,void 0,(function*(){if(this.state===ns.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(bo(new URL(e))&&t){this.regionUrlProvider=new za(e,t);const n=yield this.regionUrlProvider.getNextBestRegionUrl();n&&this.state===ns.Disconnected&&(this.regionUrl=n,yield fetch(Do(n),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(n),this.logContext))}else yield fetch(Do(e),{method:"HEAD"})}catch(n){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:n}))}}}))}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return Jn(this,void 0,void 0,(function*(){let n,i=()=>{};switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":n=new In({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":n=new In({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":n=new In({scenario:{case:"serverLeave",value:!0}});break;case"migration":n=new In({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>Jn(this,void 0,void 0,(function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")})),n=new In({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>Jn(this,void 0,void 0,(function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")})),n=new In({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":n=new In({scenario:{case:"switchCandidateProtocol",value:"force-tls"===e?2:1}}),i=()=>Jn(this,void 0,void 0,(function*(){const e=this.engine.client.onLeave;e&&e(new ln({reason:nt.CLIENT_INITIATED,action:dn.RECONNECT}))}));break;case"subscriber-bandwidth":if(void 0===t||"number"!==typeof t)throw new Error("subscriber-bandwidth requires a number as argument");n=new In({scenario:{case:"subscriberBandwidth",value:BigInt(t)}});break;case"leave-full-reconnect":n=new In({scenario:{case:"leaveRequestFullReconnect",value:!0}})}n&&(yield this.engine.client.sendSimulateScenario(n),yield i())}))}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){return Jn(this,arguments,void 0,(function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function*(){var r,o,a,s,c,l,d;let u=!1,h=!0;const p=i?{exact:t}:t;if("audioinput"===e){const t=null!==(r=n.getActiveDevice(e))&&void 0!==r?r:n.options.audioCaptureDefaults.deviceId;n.options.audioCaptureDefaults.deviceId=p,u=t!==p;const i=Array.from(n.localParticipant.audioTrackPublications.values()).filter((e=>e.source===Hr.Source.Microphone));try{h=(yield Promise.all(i.map((e=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.setDeviceId(p)})))).every((e=>!0===e))}catch(m){throw n.options.audioCaptureDefaults.deviceId=t,m}}else if("videoinput"===e){const t=null!==(o=n.getActiveDevice(e))&&void 0!==o?o:n.options.videoCaptureDefaults.deviceId;n.options.videoCaptureDefaults.deviceId=p,u=t!==p;const i=Array.from(n.localParticipant.videoTrackPublications.values()).filter((e=>e.source===Hr.Source.Camera));try{h=(yield Promise.all(i.map((e=>{var t;return null===(t=e.videoTrack)||void 0===t?void 0:t.setDeviceId(p)})))).every((e=>!0===e))}catch(m){throw n.options.videoCaptureDefaults.deviceId=t,m}}else if("audiooutput"===e){if(!uo()&&!n.options.webAudioMix||n.options.webAudioMix&&n.audioContext&&!("setSinkId"in n.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");n.options.webAudioMix&&(t=null!==(a=yield Uo.getInstance().normalizeDeviceId("audiooutput",t))&&void 0!==a?a:""),null!==(s=(d=n.options).audioOutput)&&void 0!==s||(d.audioOutput={});const i=null!==(c=n.getActiveDevice(e))&&void 0!==c?c:n.options.audioOutput.deviceId;n.options.audioOutput.deviceId=t,u=i!==p;try{n.options.webAudioMix&&(null===(l=n.audioContext)||void 0===l||l.setSinkId(t)),yield Promise.all(Array.from(n.remoteParticipants.values()).map((e=>e.setAudioOutput({deviceId:t}))))}catch(m){throw n.options.audioOutput.deviceId=i,m}}return u&&h&&(n.localParticipant.activeDeviceMap.set(e,t),n.emit(vr.ActiveDeviceChanged,e,t)),h}()}))}setupLocalParticipantEvents(){this.localParticipant.on(br.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(br.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(br.AttributesChanged,this.onLocalAttributesChanged).on(br.TrackMuted,this.onLocalTrackMuted).on(br.TrackUnmuted,this.onLocalTrackUnmuted).on(br.LocalTrackPublished,this.onLocalTrackPublished).on(br.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(br.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(br.MediaDevicesError,this.onMediaDevicesError).on(br.AudioStreamAcquired,this.startAudio).on(br.ChatMessage,this.onLocalChatMessageSent).on(br.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;null===(e=this.engine)||void 0===e||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,t,n){if(this.state===ns.Connecting||this.state===ns.Reconnecting){const i=()=>{this.onTrackAdded(e,t,n),r()},r=()=>{this.off(vr.Reconnected,i),this.off(vr.Connected,i),this.off(vr.Disconnected,r)};return this.once(vr.Reconnected,i),this.once(vr.Connected,i),void this.once(vr.Disconnected,r)}if(this.state===ns.Disconnected)return void this.log.warn("skipping incoming track after Room disconnected",this.logContext);const i=function(e){const t=e.split("|");return t.length>1?[t[0],e.substr(t[0].length+1)]:[e,""]}(t.id),r=i[0];let o=i[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),r===this.localParticipant.sid)return void this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);const s=Array.from(this.remoteParticipants.values()).find((e=>e.sid===r));if(!s)return void this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(r),this.logContext);let c;this.options.adaptiveStream&&(c="object"===typeof this.options.adaptiveStream?this.options.adaptiveStream:{}),s.addSubscribedMediaTrack(e,a,t,n,c)}handleDisconnect(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;var n;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==ns.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach((e=>{e.trackPublications.forEach((t=>{e.unpublishTrack(t.trackSid)}))})),this.localParticipant.trackPublications.forEach((t=>{var n,i;t.track&&this.localParticipant.unpublishTrack(t.track,e),e&&(null===(n=t.track)||void 0===n||n.detach(),null===(i=t.track)||void 0===i||i.stop())})),this.localParticipant.off(br.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(br.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(br.AttributesChanged,this.onLocalAttributesChanged).off(br.TrackMuted,this.onLocalTrackMuted).off(br.TrackUnmuted,this.onLocalTrackUnmuted).off(br.LocalTrackPublished,this.onLocalTrackPublished).off(br.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(br.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(br.MediaDevicesError,this.onMediaDevicesError).off(br.AudioStreamAcquired,this.startAudio).off(br.ChatMessage,this.onLocalChatMessageSent).off(br.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&"boolean"===typeof this.options.webAudioMix&&(this.audioContext.close(),this.audioContext=void 0),go()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),null===(n=navigator.mediaDevices)||void 0===n||n.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(ns.Disconnected),this.emit(vr.Disconnected,t)}}}handleParticipantDisconnected(e,t){var n;this.remoteParticipants.delete(e),t&&(t.trackPublications.forEach((e=>{t.unpublishTrack(e.trackSid,!0)})),this.emit(vr.ParticipantDisconnected,t),null===(n=this.localParticipant)||void 0===n||n.handleParticipantDisconnected(t.identity))}acquireAudioContext(){return Jn(this,void 0,void 0,(function*(){var e,t;if("boolean"!==typeof this.options.webAudioMix&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:this.audioContext&&"closed"!==this.audioContext.state||(this.audioContext=null!==(e=Xr())&&void 0!==e?e:void 0),this.audioContext&&"suspended"===this.audioContext.state)try{yield this.audioContext.resume()}catch(i){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:i}))}this.options.webAudioMix&&this.remoteParticipants.forEach((e=>e.setAudioContext(this.audioContext))),this.localParticipant.setAudioContext(this.audioContext);const n="running"===(null===(t=this.audioContext)||void 0===t?void 0:t.state);n!==this.canPlaybackAudio&&(this.audioEnabled=n,this.emit(vr.AudioPlaybackStatusChanged,n))}))}createParticipant(e,t){var n;let i;return i=t?as.fromParticipantInfo(this.engine.client,t,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):new as(this.engine.client,"",e,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&i.setAudioContext(this.audioContext),(null===(n=this.options.audioOutput)||void 0===n?void 0:n.deviceId)&&i.setAudioOutput(this.options.audioOutput).catch((e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext))),i}getOrCreateParticipant(e,t){if(this.remoteParticipants.has(e)){const n=this.remoteParticipants.get(e);if(t){n.updateInfo(t)&&this.sidToIdentity.set(t.sid,t.identity)}return n}const n=this.createParticipant(e,t);return this.remoteParticipants.set(e,n),this.sidToIdentity.set(t.sid,t.identity),this.emitWhenConnected(vr.ParticipantConnected,n),n.on(br.TrackPublished,(e=>{this.emitWhenConnected(vr.TrackPublished,e,n)})).on(br.TrackSubscribed,((e,t)=>{e.kind===Hr.Kind.Audio?(e.on(kr.AudioPlaybackStarted,this.handleAudioPlaybackStarted),e.on(kr.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):e.kind===Hr.Kind.Video&&(e.on(kr.VideoPlaybackFailed,this.handleVideoPlaybackFailed),e.on(kr.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(vr.TrackSubscribed,e,t,n)})).on(br.TrackUnpublished,(e=>{this.emit(vr.TrackUnpublished,e,n)})).on(br.TrackUnsubscribed,((e,t)=>{this.emit(vr.TrackUnsubscribed,e,t,n)})).on(br.TrackSubscriptionFailed,(e=>{this.emit(vr.TrackSubscriptionFailed,e,n)})).on(br.TrackMuted,(e=>{this.emitWhenConnected(vr.TrackMuted,e,n)})).on(br.TrackUnmuted,(e=>{this.emitWhenConnected(vr.TrackUnmuted,e,n)})).on(br.ParticipantMetadataChanged,(e=>{this.emitWhenConnected(vr.ParticipantMetadataChanged,e,n)})).on(br.ParticipantNameChanged,(e=>{this.emitWhenConnected(vr.ParticipantNameChanged,e,n)})).on(br.AttributesChanged,(e=>{this.emitWhenConnected(vr.ParticipantAttributesChanged,e,n)})).on(br.ConnectionQualityChanged,(e=>{this.emitWhenConnected(vr.ConnectionQualityChanged,e,n)})).on(br.ParticipantPermissionsChanged,(e=>{this.emitWhenConnected(vr.ParticipantPermissionsChanged,e,n)})).on(br.TrackSubscriptionStatusChanged,((e,t)=>{this.emitWhenConnected(vr.TrackSubscriptionStatusChanged,e,t,n)})).on(br.TrackSubscriptionFailed,((e,t)=>{this.emit(vr.TrackSubscriptionFailed,e,n,t)})).on(br.TrackSubscriptionPermissionChanged,((e,t)=>{this.emitWhenConnected(vr.TrackSubscriptionPermissionChanged,e,t,n)})),t&&n.updateInfo(t),n}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce(((e,t)=>(e.push(...t.getTrackPublications()),e)),[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const t of e.videoTrackPublications.values())t.isSubscribed&&t instanceof os&&t.emitTrackUpdate()}getRemoteParticipantBySid(e){const t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Ar.setInterval((()=>{this.engine&&!this.engine.isClosed&&this.engine.verifyTransport()?e=0:(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,nt.STATE_MISMATCH)))}),4e3)}clearConnectionReconcile(){this.connectionReconcileInterval&&Ar.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e!==this.state&&(this.state=e,this.emit(vr.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach((e=>{let[t,n]=e;this.emit(t,...n)})),this.bufferedEvents=[]}emitWhenConnected(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(this.state===ns.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,n]);else if(this.state===ns.Connected)return this.emit(e,...n);return!1}simulateParticipants(e){return Jn(this,void 0,void 0,(function*(){var t,n;const i=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),r=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new at({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:A.parse((new Date).getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new lt({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(vr.SignalConnected),this.emit(vr.Connected),this.setAndEmitConnectionState(ns.Connected),i.video){const e=new es(Hr.Kind.Video,new mt({source:Xe.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:$e.AUDIO,name:"video-dummy"}),new Ma(i.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:xo(160*(null!==(t=r.aspectRatios[0])&&void 0!==t?t:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(br.LocalTrackPublished,e)}if(i.audio){const e=new es(Hr.Kind.Audio,new mt({source:Xe.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:$e.AUDIO}),new ka(i.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:_o(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(br.LocalTrackPublished,e)}for(let e=0;e<r.count-1;e+=1){let t=new lt({sid:Math.floor(1e4*Math.random()).toString(),identity:"simulated-".concat(e),state:dt.ACTIVE,tracks:[],joinedAt:A.parse(Date.now())});const i=this.getOrCreateParticipant(t.identity,t);if(r.video){const o=xo(160*(null!==(n=r.aspectRatios[e%r.aspectRatios.length])&&void 0!==n?n:1),160,!1,!0),a=new mt({source:Xe.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:$e.AUDIO});i.addSubscribedMediaTrack(o,a.sid,new MediaStream([o]),new RTCRtpReceiver),t.tracks=[...t.tracks,a]}if(r.audio){const e=_o(),n=new mt({source:Xe.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:$e.AUDIO});i.addSubscribedMediaTrack(e,n.sid,new MediaStream([e]),new RTCRtpReceiver),t.tracks=[...t.tracks,n]}i.updateInfo(t)}}))}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(e!==vr.ActiveSpeakersChanged){const t=cs(n).filter((e=>void 0!==e));this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:t}))}return super.emit(e,...n)}}function cs(e){return e.map((e=>{if(e)return Array.isArray(e)?cs(e):"object"===typeof e?"logContext"in e&&e.logContext:e}))}var ls;!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.SKIPPED=2]="SKIPPED",e[e.SUCCESS=3]="SUCCESS",e[e.FAILED=4]="FAILED"}(ls||(ls={}));ei.EventEmitter;ei.EventEmitter;function ds(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;const i=e instanceof jo?e.mediaStreamTrack:e,r=i.getSettings();let o={facingMode:null!==(n=t.defaultFacingMode)&&void 0!==n?n:"user",confidence:"low"};if("facingMode"in r){const e=r.facingMode;Wn.trace("rawFacingMode",{rawFacingMode:e}),e&&"string"===typeof e&&function(e){const t=["user","environment","left","right"];return void 0===e||t.includes(e)}(e)&&(o={facingMode:e,confidence:"high"})}if(["low","medium"].includes(o.confidence)){Wn.trace("Try to get facing mode from device label: (".concat(i.label,")"));const e=function(e){var t;const n=e.trim().toLowerCase();if(""===n)return;if(us.has(n))return us.get(n);return null===(t=Array.from(hs.entries()).find((e=>{let[t]=e;return n.includes(t)})))||void 0===t?void 0:t[1]}(i.label);void 0!==e&&(o=e)}return o}const us=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),hs=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);Math.min,Math.max,Math.round;var ps=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ms(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var fs={exports:{}};!function(e){!function(t,n){e.exports?e.exports=n():t.log=n()}(ps,(function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],r={},o=null;function a(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(i){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var n=this.getLevel(),r=0;r<i.length;r++){var o=i[r];this[o]=r<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function l(e){return function(){typeof console!==t&&(c.call(this),this[e].apply(this,arguments))}}function d(i,r,o){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?s:void 0!==console[i]?a(console,i):void 0!==console.log?a(console,"log"):e)}(i)||l.apply(this,arguments)}function u(e,n){var a,s,l,u=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch(o){}if(typeof e===t)try{var n=window.document.cookie,i=encodeURIComponent(h),r=n.indexOf(i+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r+i.length+1))[1])}catch(a){}return void 0===u.levels[e]&&(e=void 0),e}}function m(e){var t=e;if("string"==typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=u.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=n||d,u.getLevel=function(){var e,t;return null!==(e=null!==(t=l)&&void 0!==t?t:s)&&void 0!==e?e:a},u.setLevel=function(e,n){return l=m(e),!1!==n&&function(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch(r){}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch(o){}}}(l),c.call(u)},u.setDefaultLevel=function(e){s=m(e),p()||u.setLevel(e,!1)},u.resetLevel=function(){l=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(n){}}}(),c.call(u)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)},u.rebuild=function(){if(o!==u&&(a=m(o.getLevel())),c.call(u),o===u)for(var e in r)r[e].rebuild()},a=m(o?o.getLevel():"WARN");var f=p();null!=f&&(l=m(f)),c.call(u)}(o=new u).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=r[e];return t||(t=r[e]=new u(e,o.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=h),o},o.getLoggers=function(){return r},o.default=o,o}))}(fs);const gs=ms(fs.exports);var vs=function(e,t){return vs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},vs(e,t)};function bs(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}vs(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function ys(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}c((i=i.apply(e,t||[])).next())}))}function ks(e,t){var n,i,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(c){s=[6,c],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}function Ts(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ss(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(s){r={error:s}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a}function Cs(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)(i||!(r in t))&&(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}function Es(e){return this instanceof Es?(this.v=e,this):new Es(e)}function ws(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(e,t||[]),o=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",(function(e){return function(t){return Promise.resolve(t).then(e,l)}})),i[Symbol.asyncIterator]=function(){return this},i;function a(e,t){r[e]&&(i[e]=function(t){return new Promise((function(n,i){o.push([e,t,n,i])>1||s(e,t)}))},t&&(i[e]=t(i[e])))}function s(e,t){try{!function(e){e.value instanceof Es?Promise.resolve(e.value.v).then(c,l):d(o[0][2],e)}(r[e](t))}catch(n){d(o[0][3],n)}}function c(e){s("next",e)}function l(e){s("throw",e)}function d(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function Ps(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Ts(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,r){(function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)})(i,r,(t=e[n](t)).done,t.value)}))}}}function Rs(e){return"function"==typeof e}function Is(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Os=Is((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function xs(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var _s=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,i,r;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Ts(o),s=a.next();!s.done;s=a.next()){s.value.remove(this)}}catch(m){e={error:m}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else o.remove(this);var c=this.initialTeardown;if(Rs(c))try{c()}catch(m){r=m instanceof Os?m.errors:[m]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var d=Ts(l),u=d.next();!u.done;u=d.next()){var h=u.value;try{Ds(h)}catch(m){var p;r=null!==(p=r)&&void 0!==p?p:[],m instanceof Os?r=Cs(Cs([],Ss(r)),Ss(m.errors)):r.push(m)}}}catch(m){n={error:m}}finally{try{u&&!u.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}}if(r)throw new Os(r)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)Ds(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&xs(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&xs(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),Ns=_s.EMPTY;function Ms(e){return e instanceof _s||e&&"closed"in e&&Rs(e.remove)&&Rs(e.add)&&Rs(e.unsubscribe)}function Ds(e){Rs(e)?e():e.unsubscribe()}var As=void 0,Ls=!1,Us={setTimeout:function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setTimeout.apply(void 0,Cs([e,t],Ss(n)))},clearTimeout:function(e){var t=Us.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function js(e){Us.setTimeout((function(){throw e}))}function Fs(){}function Bs(e){e()}var Vs=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,Ms(t)&&t.add(n)):n.destination=Gs,n}return bs(t,e),t.create=function(e,t,n){return new Ks(e,t,n)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(_s),qs=Function.prototype.bind;function zs(e,t){return qs.call(e,t)}var Ws=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){Hs(n)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){Hs(n)}else Hs(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){Hs(t)}},e}(),Ks=function(e){function t(t,n,i){var r,o,a=e.call(this)||this;Rs(t)||!t?r={next:null!==t&&void 0!==t?t:void 0,error:null!==n&&void 0!==n?n:void 0,complete:null!==i&&void 0!==i?i:void 0}:a&&Ls?((o=Object.create(t)).unsubscribe=function(){return a.unsubscribe()},r={next:t.next&&zs(t.next,o),error:t.error&&zs(t.error,o),complete:t.complete&&zs(t.complete,o)}):r=t;return a.destination=new Ws(r),a}return bs(t,e),t}(Vs);function Hs(e){js(e)}var Gs={closed:!0,next:Fs,error:function(e){throw e},complete:Fs},Qs="function"==typeof Symbol&&Symbol.observable||"@@observable";function Js(e){return e}var Ys=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var i=this,r=function(e){return e&&e instanceof Vs||function(e){return e&&Rs(e.next)&&Rs(e.error)&&Rs(e.complete)}(e)&&Ms(e)}(e)?e:new Ks(e,t,n);return Bs((function(){var e=i,t=e.operator,n=e.source;r.add(t?t.call(r,n):n?i._subscribe(r):i._trySubscribe(r))})),r},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=$s(t))((function(t,i){var r=new Ks({next:function(t){try{e(t)}catch(n){i(n),r.unsubscribe()}},error:i,complete:t});n.subscribe(r)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Qs]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(e){return 0===e.length?Js:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=$s(e))((function(e,n){var i;t.subscribe((function(e){return i=e}),(function(e){return n(e)}),(function(){return e(i)}))}))},e.create=function(t){return new e(t)},e}();function $s(e){var t;return null!==(t=null!==e&&void 0!==e?e:As)&&void 0!==t?t:Promise}function Xs(e){return function(t){if(function(e){return Rs(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(n){this.error(n)}}));throw new TypeError("Unable to lift unknown Observable type")}}function Zs(e,t,n,i,r){return new ec(e,t,n,i,r)}var ec=function(e){function t(t,n,i,r,o,a){var s=e.call(this,t)||this;return s.onFinalize=o,s.shouldUnsubscribe=a,s._next=n?function(e){try{n(e)}catch(h){t.error(h)}}:e.prototype._next,s._error=r?function(e){try{r(e)}catch(h){t.error(h)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=i?function(){try{i()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return bs(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Vs),tc=Is((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),nc=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return bs(t,e),t.prototype.lift=function(e){var t=new ic(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new tc},t.prototype.next=function(e){var t=this;Bs((function(){var n,i;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var r=Ts(t.currentObservers),o=r.next();!o.done;o=r.next()){o.value.next(e)}}catch(a){n={error:a}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;Bs((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;Bs((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,i=n.hasError,r=n.isStopped,o=n.observers;return i||r?Ns:(this.currentObservers=null,o.push(e),new _s((function(){t.currentObservers=null,xs(o,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,i=t.thrownError,r=t.isStopped;n?e.error(i):r&&e.complete()},t.prototype.asObservable=function(){var e=new Ys;return e.source=this,e},t.create=function(e,t){return new ic(e,t)},t}(Ys),ic=function(e){function t(t,n){var i=e.call(this)||this;return i.destination=t,i.source=n,i}return bs(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:Ns},t}(nc),rc=(function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}bs(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,i=e._value;if(t)throw n;return this._throwIfClosed(),i},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)}}(nc),function(){return Date.now()}),oc=function(e){function t(t,n){return e.call(this)||this}return bs(t,e),t.prototype.schedule=function(e,t){return this},t}(_s),ac=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setInterval.apply(void 0,Cs([e,t],Ss(n)))},sc=function(e){return clearInterval(e)},cc=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.pending=!1,i}return bs(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var i=this.id,r=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(r,i,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),ac(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&sc(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,i=!1;try{this.work(e)}catch(r){i=!0,n=r||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,i=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,xs(i,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(oc),lc=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=rc,e}(),dc=function(e){function t(t,n){void 0===n&&(n=lc.now);var i=e.call(this,t,n)||this;return i.actions=[],i._active=!1,i}return bs(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(lc),uc=new dc(cc);new Ys((function(e){return e.complete()}));function hc(e){return e[e.length-1]}function pc(e){return function(e){return e&&Rs(e.schedule)}(hc(e))?e.pop():void 0}var mc=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function fc(e){return Rs(null==e?void 0:e.then)}function gc(e){return Rs(e[Qs])}function vc(e){return Symbol.asyncIterator&&Rs(null==e?void 0:e[Symbol.asyncIterator])}function bc(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var yc="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function kc(e){return Rs(null==e?void 0:e[yc])}function Tc(e){return ws(this,arguments,(function(){var t,n,i;return ks(this,(function(r){switch(r.label){case 0:t=e.getReader(),r.label=1;case 1:r.trys.push([1,,9,10]),r.label=2;case 2:return[4,Es(t.read())];case 3:return n=r.sent(),i=n.value,n.done?[4,Es(void 0)]:[3,5];case 4:return[2,r.sent()];case 5:return[4,Es(i)];case 6:return[4,r.sent()];case 7:return r.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function Sc(e){return Rs(null==e?void 0:e.getReader)}function Cc(e){if(e instanceof Ys)return e;if(null!=e){if(gc(e))return function(e){return new Ys((function(t){var n=e[Qs]();if(Rs(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}))}(e);if(mc(e))return function(e){return new Ys((function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()}))}(e);if(fc(e))return function(e){return new Ys((function(t){e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,js)}))}(e);if(vc(e))return Ec(e);if(kc(e))return function(e){return new Ys((function(t){var n,i;try{for(var r=Ts(e),o=r.next();!o.done;o=r.next()){var a=o.value;if(t.next(a),t.closed)return}}catch(s){n={error:s}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}t.complete()}))}(e);if(Sc(e))return function(e){return Ec(Tc(e))}(e)}throw bc(e)}function Ec(e){return new Ys((function(t){(function(e,t){var n,i,r,o;return ys(this,void 0,void 0,(function(){var a,s;return ks(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=Ps(e),c.label=1;case 1:return[4,n.next()];case 2:if((i=c.sent()).done)return[3,4];if(a=i.value,t.next(a),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=c.sent(),r={error:s},[3,11];case 6:return c.trys.push([6,,9,10]),i&&!i.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function wc(e,t,n,i,r){void 0===i&&(i=0),void 0===r&&(r=!1);var o=t.schedule((function(){n(),r?e.add(this.schedule(null,i)):this.unsubscribe()}),i);if(e.add(o),!r)return o}function Pc(e,t){return void 0===t&&(t=0),Xs((function(n,i){n.subscribe(Zs(i,(function(n){return wc(i,e,(function(){return i.next(n)}),t)}),(function(){return wc(i,e,(function(){return i.complete()}),t)}),(function(n){return wc(i,e,(function(){return i.error(n)}),t)})))}))}function Rc(e,t){return void 0===t&&(t=0),Xs((function(n,i){i.add(e.schedule((function(){return n.subscribe(i)}),t))}))}function Ic(e,t){if(!e)throw new Error("Iterable cannot be null");return new Ys((function(n){wc(n,t,(function(){var i=e[Symbol.asyncIterator]();wc(n,t,(function(){i.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function Oc(e,t){if(null!=e){if(gc(e))return function(e,t){return Cc(e).pipe(Rc(t),Pc(t))}(e,t);if(mc(e))return function(e,t){return new Ys((function(n){var i=0;return t.schedule((function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||this.schedule())}))}))}(e,t);if(fc(e))return function(e,t){return Cc(e).pipe(Rc(t),Pc(t))}(e,t);if(vc(e))return Ic(e,t);if(kc(e))return function(e,t){return new Ys((function(n){var i;return wc(n,t,(function(){i=e[yc](),wc(n,t,(function(){var e,t,r;try{t=(e=i.next()).value,r=e.done}catch(o){return void n.error(o)}r?n.complete():n.next(t)}),0,!0)})),function(){return Rs(null==i?void 0:i.return)&&i.return()}}))}(e,t);if(Sc(e))return function(e,t){return Ic(Tc(e),t)}(e,t)}throw bc(e)}function xc(e,t){return t?Oc(e,t):Cc(e)}function _c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return xc(e,pc(e))}var Nc=Is((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}}));function Mc(e,t){var n=function(e){return e instanceof Date&&!isNaN(e)}(e)?{first:e}:"number"==typeof e?{each:e}:e,i=n.first,r=n.each,o=n.with,a=void 0===o?Dc:o,s=n.scheduler,c=void 0===s?uc:s,l=n.meta,d=void 0===l?null:l;if(null==i&&null==r)throw new TypeError("No timeout provided.");return Xs((function(e,t){var n,o,s=null,l=0,u=function(e){o=wc(t,c,(function(){try{n.unsubscribe(),Cc(a({meta:d,lastValue:s,seen:l})).subscribe(t)}catch(e){t.error(e)}}),e)};n=e.subscribe(Zs(t,(function(e){null==o||o.unsubscribe(),l++,t.next(s=e),r>0&&u(r)}),void 0,void 0,(function(){null!=o&&o.closed||null==o||o.unsubscribe(),s=null}))),!l&&u(null!=i?"number"==typeof i?i:+i-c.now():r)}))}function Dc(e){throw new Nc(e)}function Ac(e,t){return Xs((function(n,i){var r=0;n.subscribe(Zs(i,(function(n){i.next(e.call(t,n,r++))})))}))}var Lc=Array.isArray;function Uc(e){return Ac((function(t){return function(e,t){return Lc(t)?e.apply(void 0,Cs([],Ss(t))):e(t)}(e,t)}))}function jc(e,t,n){return void 0===n&&(n=1/0),Rs(t)?jc((function(n,i){return Ac((function(e,r){return t(n,e,i,r)}))(Cc(e(n,i)))}),n):("number"==typeof t&&(n=t),Xs((function(t,i){return function(e,t,n,i,r,o,a){var s=[],c=0,l=0,d=!1,u=function(){d&&!s.length&&!c&&t.complete()},h=function(e){c++;var r=!1;Cc(n(e,l++)).subscribe(Zs(t,(function(e){t.next(e)}),(function(){r=!0}),void 0,(function(){if(r)try{c--;for(var e=function(){var e=s.shift();a||h(e)};s.length&&c<i;)e();u()}catch(n){t.error(n)}})))};return e.subscribe(Zs(t,(function(e){return c<i?h(e):s.push(e)}),(function(){d=!0,u()}))),function(){}}(t,i,e,n)})))}function Fc(e){return void 0===e&&(e=1/0),jc(Js,e)}function Bc(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Fc(1)(xc(e,pc(e)))}var Vc=["addListener","removeListener"],qc=["addEventListener","removeEventListener"],zc=["on","off"];function Wc(e,t,n,i){if(Rs(n)&&(i=n,n=void 0),i)return Wc(e,t,n).pipe(Uc(i));var r=Ss(function(e){return Rs(e.addEventListener)&&Rs(e.removeEventListener)}(e)?qc.map((function(i){return function(r){return e[i](t,r,n)}})):function(e){return Rs(e.addListener)&&Rs(e.removeListener)}(e)?Vc.map(Kc(e,t)):function(e){return Rs(e.on)&&Rs(e.off)}(e)?zc.map(Kc(e,t)):[],2),o=r[0],a=r[1];if(!o&&mc(e))return jc((function(e){return Wc(e,t,n)}))(Cc(e));if(!o)throw new TypeError("Invalid event target");return new Ys((function(e){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1<t.length?t:t[0])};return o(t),function(){return a(t)}}))}function Kc(e,t){return function(n){return function(i){return e[n](t,i)}}}function Hc(e,t){return Xs((function(n,i){var r=0;n.subscribe(Zs(i,(function(n){return e.call(t,n,r++)&&i.next(n)})))}))}function Gc(e,t){return e===t}function Qc(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=pc(e);return Xs((function(t,i){(n?Bc(e,t,n):Bc(e,t)).subscribe(i)}))}Object.defineProperty,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;function Jc(e){return!(typeof e>"u")&&(function(e){var t;return!!e&&(e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&e.hasOwnProperty("track")&&typeof(null==(t=e.publication)?void 0:t.track)<"u")}(e)||function(e){return!!e&&(e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&e.hasOwnProperty("publication")&&typeof e.publication<"u")}(e))}function Yc(e){return!!e&&(e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&typeof e.publication>"u")}function $c(e){if("string"==typeof e||"number"==typeof e)return"".concat(e);if(Yc(e))return"".concat(e.participant.identity,"_").concat(e.source,"_placeholder");if(Jc(e))return"".concat(e.participant.identity,"_").concat(e.publication.source,"_").concat(e.publication.trackSid);throw new Error("Can't generate a id for the given track reference: ".concat(e))}function Xc(e,t){return!(typeof t>"u")&&(Jc(e)?t.some((t=>t.participant.identity===e.participant.identity&&Jc(t)&&t.publication.trackSid===e.publication.trackSid)):!!Yc(e)&&t.some((t=>t.participant.identity===e.participant.identity&&Yc(t)&&t.source===e.source)))}function Zc(e){return e instanceof rs}var el=[...[vr.ConnectionStateChanged,vr.RoomMetadataChanged,vr.ActiveSpeakersChanged,vr.ConnectionQualityChanged,vr.ParticipantConnected,vr.ParticipantDisconnected,vr.ParticipantPermissionsChanged,vr.ParticipantMetadataChanged,vr.ParticipantNameChanged,vr.ParticipantAttributesChanged,vr.TrackMuted,vr.TrackUnmuted,vr.TrackPublished,vr.TrackUnpublished,vr.TrackStreamStateChanged,vr.TrackSubscriptionFailed,vr.TrackSubscriptionPermissionChanged,vr.TrackSubscriptionStatusChanged],vr.LocalTrackPublished,vr.LocalTrackUnpublished],tl=(br.TrackPublished,br.TrackUnpublished,br.TrackMuted,br.TrackUnmuted,br.TrackStreamStateChanged,br.TrackSubscribed,br.TrackUnsubscribed,br.TrackSubscriptionPermissionChanged,br.TrackSubscriptionFailed,br.LocalTrackPublished,br.LocalTrackUnpublished,br.ConnectionQualityChanged,br.IsSpeakingChanged,br.ParticipantMetadataChanged,br.ParticipantPermissionsChanged,br.TrackMuted,br.TrackUnmuted,br.TrackPublished,br.TrackUnpublished,br.TrackStreamStateChanged,br.TrackSubscriptionFailed,br.TrackSubscriptionPermissionChanged,br.TrackSubscriptionStatusChanged,br.LocalTrackPublished,br.LocalTrackUnpublished,gs.getLogger("lk-components-js"));tl.setDefaultLevel("WARN");var nl=[{columns:1,rows:1},{columns:1,rows:2,orientation:"portrait"},{columns:2,rows:1,orientation:"landscape"},{columns:2,rows:2,minWidth:560},{columns:3,rows:3,minWidth:700},{columns:4,rows:4,minWidth:960},{columns:5,rows:5,minWidth:1100}];function il(e,t,n,i){if(e.length<1)throw new Error("At least one grid layout definition must be provided.");const r=function(e){return[...e].map((e=>{var t,n;return{name:"".concat(e.columns,"x").concat(e.rows),columns:e.columns,rows:e.rows,maxTiles:e.columns*e.rows,minWidth:null!=(t=e.minWidth)?t:0,minHeight:null!=(n=e.minHeight)?n:0,orientation:e.orientation}})).sort(((e,t)=>e.maxTiles!==t.maxTiles?e.maxTiles-t.maxTiles:0!==e.minWidth||0!==t.minWidth?e.minWidth-t.minWidth:0!==e.minHeight||0!==t.minHeight?e.minHeight-t.minHeight:0))}(e);if(n<=0||i<=0)return r[0];let o=0;const a=n/i>1?"landscape":"portrait";let s=r.find(((e,n,i)=>{o=n;const r=-1!==i.findIndex(((t,i)=>{const r=!t.orientation||t.orientation===a,o=i>n,s=t.maxTiles===e.maxTiles;return o&&s&&r}));return e.maxTiles>=t&&!r}));if(void 0===s){if(s=r[r.length-1],!s)throw new Error("No layout or fallback layout found.");tl.warn("No layout found for: participantCount: ".concat(t,", width/height: ").concat(n,"/").concat(i," fallback to biggest available layout (").concat(s,")."))}if((n<s.minWidth||i<s.minHeight)&&o>0){const e=r[o-1];s=il(r.slice(0,o),e.maxTiles,n,i)}return s}function rl(e){return"object"==typeof e}function ol(e){return Array.isArray(e)&&e.filter(rl).length>0}function al(e,t){return t.audioLevel-e.audioLevel}function sl(e,t){return e.isSpeaking===t.isSpeaking?0:e.isSpeaking?-1:1}function cl(e,t){var n,i,r,o;return void 0!==e.lastSpokeAt||void 0!==t.lastSpokeAt?(null!=(i=null==(n=t.lastSpokeAt)?void 0:n.getTime())?i:0)-(null!=(o=null==(r=e.lastSpokeAt)?void 0:r.getTime())?o:0):0}function ll(e,t){var n,i,r,o;return(null!=(i=null==(n=e.joinedAt)?void 0:n.getTime())?i:0)-(null!=(o=null==(r=t.joinedAt)?void 0:r.getTime())?o:0)}function dl(e){const t=[],n=[],i=[],r=[];e.forEach((e=>{e.participant.isLocal&&e.source===Hr.Source.Camera?t.push(e):e.source===Hr.Source.ScreenShare?n.push(e):e.source===Hr.Source.Camera?i.push(e):r.push(e)}));const o=function(e){const t=[],n=[];return e.forEach((e=>{e.participant.isLocal?t.push(e):n.push(e)})),t.sort(((e,t)=>ll(e.participant,t.participant))),n.sort(((e,t)=>ll(e.participant,t.participant))),[...n,...t]}(n),a=function(e){const t=[],n=[];return e.forEach((e=>{e.participant.isLocal?t.push(e):n.push(e)})),n.sort(((e,t)=>e.participant.isSpeaking&&t.participant.isSpeaking?al(e.participant,t.participant):e.participant.isSpeaking!==t.participant.isSpeaking?sl(e.participant,t.participant):e.participant.lastSpokeAt!==t.participant.lastSpokeAt?cl(e.participant,t.participant):Jc(e)!==Jc(t)?function(e,t){return Jc(e)?Jc(t)?0:-1:Jc(t)?1:0}(e,t):e.participant.isCameraEnabled!==t.participant.isCameraEnabled?function(e,t){const n=e.participant.isCameraEnabled;return n!==t.participant.isCameraEnabled?n?-1:1:0}(e,t):ll(e.participant,t.participant))),[...t,...n]}(i);return[...t,...o,...a,...r]}function ul(e,t){const n=Math.max(e.length,t.length);return new Array(n).fill([]).map(((n,i)=>[e[i],t[i]]))}function hl(e,t,n){return e.filter((e=>!t.map((e=>n(e))).includes(n(e))))}function pl(e){return e.map((e=>"string"==typeof e||"number"==typeof e?"".concat(e):$c(e)))}function ml(e,t){const n=t.findIndex((t=>$c(t)===$c(e)));if(-1===n)throw new Error("Element not part of the array: ".concat($c(e)," not in ").concat(pl(t)));return n}function fl(e,t){return function(e,t){return e.reduce(((e,n,i)=>i%t===0?[...e,[n]]:[...e.slice(0,-1),[...e.slice(-1)[0],n]]),[])}(e,t)}function gl(e,t,n){let i=function(e,t){return e.map((e=>{const n=t.find((t=>$c(e)===$c(t)||"number"!=typeof e&&Yc(e)&&Jc(t)&&function(e,t){return Yc(e)&&Jc(t)&&t.participant.identity===e.participant.identity&&t.source===e.source}(e,t)));return null!==n&&void 0!==n?n:e}))}(e,t);if(i.length<t.length){const e=hl(t,i,$c);i=[...i,...e]}if(ul(fl(i,n),fl(t,n)).forEach(((e,t)=>{let[r,o]=e;if(r&&o){const e=function(e,t){return{dropped:hl(e,t,$c),added:hl(t,e,$c)}}(fl(i,n)[t],o);(function(e){return 0!==e.added.length||0!==e.dropped.length})(e)&&(tl.debug("Detected visual changes on page: ".concat(t,", current: ").concat(pl(r),", next: ").concat(pl(o)),{changes:e}),e.added.length===e.dropped.length&&ul(e.added,e.dropped).forEach((e=>{let[t,n]=e;if(!t||!n)throw new Error("For a swap action we need a addition and a removal one is missing: ".concat(t,", ").concat(n));i=function(e,t,n){const i=ml(e,n),r=ml(t,n);return n.splice(i,1,t),n.splice(r,1,e),n}(t,n,i)})),0===e.added.length&&e.dropped.length>0&&e.dropped.forEach((e=>{i=function(e,t){const n=ml(e,t);return t.splice(n,1),t}(e,i)})),e.added.length>0&&0===e.dropped.length&&e.added.forEach((e=>{i=function(e,t){return[...t,e]}(e,i)})))}})),i.length>t.length){const e=hl(i,t,$c);i=i.filter((t=>!e.map($c).includes($c(t))))}return i}function vl(e){return"".concat("lk","-").concat(e)}function bl(e){if(Jc(e))return e.publication;{const{source:t,name:n,participant:i}=e;if(t&&n)return i.getTrackPublications().find((e=>e.source===t&&e.trackName===n));if(n)return i.getTrackPublicationByName(n);if(t)return i.getTrackPublication(t);throw new Error("At least one of source and name needs to be defined")}}function yl(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return new Ys((t=>{const i=()=>{t.next(e)};return n.forEach((t=>{e.on(t,i)})),()=>{n.forEach((t=>{e.off(t,i)}))}})).pipe(Qc(e))}function kl(e,t){return new Ys((n=>{const i=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.next(t)};return e.on(t,i),()=>{e.off(t,i)}}))}function Tl(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return new Ys((t=>{const i=()=>{t.next(e)};return n.forEach((t=>{e.on(t,i)})),()=>{n.forEach((t=>{e.off(t,i)}))}})).pipe(Qc(e))}function Sl(e){return Tl(e,br.TrackMuted,br.TrackUnmuted,br.ParticipantPermissionsChanged,br.TrackPublished,br.TrackUnpublished,br.LocalTrackPublished,br.LocalTrackUnpublished,br.MediaDevicesError,br.TrackSubscriptionStatusChanged).pipe(Ac((e=>{const{isMicrophoneEnabled:t,isCameraEnabled:n,isScreenShareEnabled:i}=e,r=e.getTrackPublication(Hr.Source.Microphone);return{isCameraEnabled:n,isMicrophoneEnabled:t,isScreenShareEnabled:i,cameraTrack:e.getTrackPublication(Hr.Source.Camera),microphoneTrack:r,participant:e}})))}function Cl(e){return e?Tl(e,br.ParticipantMetadataChanged,br.ParticipantNameChanged).pipe(Ac((e=>{let{name:t,identity:n,metadata:i}=e;return{name:t,identity:n,metadata:i}})),Qc({name:e.name,identity:e.identity,metadata:e.metadata})):void 0}function El(e,t){return new Ys((n=>{const i=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.next(t)};return e.on(t,i),()=>{e.off(t,i)}}))}function wl(e){var t,n,i,r;return Tl(e.participant,br.TrackMuted,br.TrackUnmuted,br.TrackSubscribed,br.TrackUnsubscribed,br.LocalTrackPublished,br.LocalTrackUnpublished).pipe(Ac((t=>{var n,i;const r=null!=(n=e.publication)?n:t.getTrackPublication(e.source);return null==(i=null==r?void 0:r.isMuted)||i})),Qc(null==(r=null!=(i=null==(t=e.publication)?void 0:t.isMuted)?i:null==(n=e.participant.getTrackPublication(e.source))?void 0:n.isMuted)||r))}function Pl(e){const t=vl("connection-quality"),n=function(e){return El(e,br.ConnectionQualityChanged).pipe(Ac((e=>{let[t]=e;return t})),Qc(e.connectionQuality))}(e);return{className:t,connectionQualityObserver:n}}new TextEncoder,new TextDecoder;function Rl(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=[e.localParticipant,...Array.from(e.remoteParticipants.values())],r=[];return i.forEach((e=>{t.forEach((t=>{const i=Array.from(e.trackPublications.values()).filter((e=>e.source===t&&(!n||e.track))).map((t=>({participant:e,publication:t,source:t.source})));r.push(...i)}))})),{trackReferences:r,participants:i}}function Il(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;if(null===e)return _c(!1);const n=Wc(e,"mousemove",{passive:!0}).pipe(Ac((()=>!0))),i=n.pipe(Mc({each:t,with:()=>Bc(_c(!1),i.pipe(function(e){return Xs((function(t,n){var i=!1,r=Zs(n,(function(){null==r||r.unsubscribe(),i=!0}),Fs);Cc(e).subscribe(r),t.subscribe(Zs(n,(function(e){return i&&n.next(e)})))}))}(n)))}),function(e,t){var n;return void 0===t&&(t=Js),e=null!==(n=e)&&void 0!==n?n:Gc,Xs((function(n,i){var r,o=!0;n.subscribe(Zs(i,(function(n){var a=t(n);(o||!e(r,a))&&(o=!1,r=a,i.next(n))})))}))}());return i}var Ol="".concat("lk","-user-choices"),{load:xl,save:_l}=function(e){return{load:()=>function(e){if(typeof localStorage>"u")tl.error("Local storage is not available.");else try{const t=localStorage.getItem(e);return t?JSON.parse(t):void tl.warn("Item with key ".concat(e," does not exist in local storage."))}catch(t){return void tl.error("Error getting item from local storage: ".concat(t))}}(e),save:t=>function(e,t){if(typeof localStorage>"u")tl.error("Local storage is not available.");else try{if(t){const n=Object.fromEntries(Object.entries(t).filter((e=>{let[,t]=e;return""!==t})));localStorage.setItem(e,JSON.stringify(n))}}catch(n){tl.error("Error setting item to local storage: ".concat(n))}}(e,t)}}(Ol);const Nl=e.createContext(void 0);function Ml(){return e.useContext(Nl)}const Dl=e.createContext(void 0);function Al(){return e.useContext(Dl)}function Ll(e){const t=Al(),n=null!==e&&void 0!==e?e:t;if(!n)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return n}const Ul=e.createContext(void 0);function jl(){return e.useContext(Ul)}function Fl(e){var t;const n=jl(),i=Al(),r=null!==(t=null!==e&&void 0!==e?e:n)&&void 0!==t?t:null==i?void 0:i.participant;if(!r)throw new Error("No participant provided, make sure you are inside a participant context or pass the participant explicitly");return r}const Bl=e.createContext(void 0);function Vl(t){const n=e.useContext(Bl),i=null!==t&&void 0!==t?t:n;if(!i)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return i}const ql=e.createContext(void 0);const zl=["token","serverUrl","options","room","connectOptions","connect","audio","video","screen","onConnected","onDisconnected","onError","onMediaDeviceFailure","onEncryptionError","simulateParticipants"];function Wl(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(n=Wl(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}function Kl(){for(var e,t,n=0,i="",r=arguments.length;n<r;n++)(e=arguments[n])&&(t=Wl(e))&&(i&&(i+=" "),i+=t);return i}function Hl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(const n of t)if("function"==typeof n)try{n(...arguments)}catch(e){console.error(e)}}}function Gl(){const e=l({},arguments.length<=0?void 0:arguments[0]);for(let t=1;t<arguments.length;t++){const n=t<0||arguments.length<=t?void 0:arguments[t];for(const t in n){const i=e[t],r=n[t];"function"==typeof i&&"function"==typeof r&&"o"===t[0]&&"n"===t[1]&&t.charCodeAt(2)>=65&&t.charCodeAt(2)<=90?e[t]=Hl(i,r):e[t]="className"!==t&&"UNSAFE_className"!==t||"string"!=typeof i||"string"!=typeof r?void 0!==r?r:i:Kl(i,r)}}return e}const Ql={connect:!0,audio:!1,video:!1};const Jl=e.forwardRef((function(t,n){const{room:i,htmlProps:o}=function(t){const n=l(l({},Ql),t),{token:i,serverUrl:o,options:a,room:s,connectOptions:c,connect:d,audio:u,video:h,screen:p,onConnected:m,onDisconnected:f,onError:g,onMediaDeviceFailure:v,onEncryptionError:b,simulateParticipants:y}=n,k=r(n,zl);a&&s&&tl.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[T,S]=e.useState(),C=e.useRef(d);e.useEffect((()=>{S(null!==s&&void 0!==s?s:new ss(a))}),[s]);const E=e.useMemo((()=>{const{className:e}={className:"lk-room-container"};return Gl(k,{className:e})}),[k]);return e.useEffect((()=>{if(!T)return;const e=()=>{const e=T.localParticipant;tl.debug("trying to publish local tracks"),Promise.all([e.setMicrophoneEnabled(!!u,"boolean"!=typeof u?u:void 0),e.setCameraEnabled(!!h,"boolean"!=typeof h?h:void 0),e.setScreenShareEnabled(!!p,"boolean"!=typeof p?p:void 0)]).catch((e=>{tl.warn(e),null==g||g(e)}))},t=e=>{const t=fr.getFailure(e);null==v||v(t)},n=e=>{null==b||b(e)},i=e=>{null==f||f(e)},r=()=>{null==m||m()};return T.on(vr.SignalConnected,e).on(vr.MediaDevicesError,t).on(vr.EncryptionError,n).on(vr.Disconnected,i).on(vr.Connected,r),()=>{T.off(vr.SignalConnected,e).off(vr.MediaDevicesError,t).off(vr.EncryptionError,n).off(vr.Disconnected,i).off(vr.Connected,r)}}),[T,u,h,p,g,b,v,m,f]),e.useEffect((()=>{if(T){if(y)return void T.simulateParticipants({participants:{count:y},publish:{audio:!0,useRealTracks:!0}});if(d){if(C.current=!0,tl.debug("connecting"),!i)return void tl.debug("no token yet");if(!o)return tl.warn("no livekit url provided"),void(null==g||g(Error("no livekit url provided")));T.connect(o,i,c).catch((e=>{tl.warn(e),!0===C.current&&(null==g||g(e))}))}else tl.debug("disconnecting because connect is false"),C.current=!1,T.disconnect()}}),[d,i,JSON.stringify(c),T,g,o,y]),e.useEffect((()=>{if(T)return()=>{tl.info("disconnecting on onmount"),T.disconnect()}}),[T]),{room:T,htmlProps:E}}(t);return e.createElement("div",l({ref:n},o),i&&e.createElement(Bl.Provider,{value:i},e.createElement(ql.Provider,{value:t.featureFlags},t.children)))}));function Yl(t,n){const i=Xl(),r=(t=>{const n=e.useRef(t);return e.useEffect((()=>{n.current=t})),n})(n);return e.useLayoutEffect((()=>{let e=!1;const n=t.current;if(n)return null==i||i.subscribe(n,o),()=>{e=!0,null==i||i.unsubscribe(n,o)};function o(t,n){e||r.current(t,n)}}),[t.current,i,r]),null==i?void 0:i.observer}let $l;const Xl=()=>$l||($l=function(){let e=!1,t=[];const n=new Map;if(typeof window>"u")return;const i=new ResizeObserver(((i,r)=>{t=t.concat(i),e||window.requestAnimationFrame((()=>{const i=new Set;for(let e=0;e<t.length;e++){if(i.has(t[e].target))continue;i.add(t[e].target);const o=n.get(t[e].target);null==o||o.forEach((n=>n(t[e],r)))}t=[],e=!1})),e=!0}));return{observer:i,subscribe(e,t){var r;i.observe(e);const o=null!==(r=n.get(e))&&void 0!==r?r:[];o.push(t),n.set(e,o)},unsubscribe(e,t){var r;const o=null!==(r=n.get(e))&&void 0!==r?r:[];if(1===o.length)return i.unobserve(e),void n.delete(e);const a=o.indexOf(t);-1!==a&&o.splice(a,1),n.set(e,o)}}}()),Zl=t=>{const[n,i]=e.useState({width:0,height:0});e.useLayoutEffect((()=>{if(t.current){const{width:e,height:n}=t.current.getBoundingClientRect();i({width:e,height:n})}}),[t.current]);const r=e.useCallback((e=>i(e.contentRect)),[]);return Yl(t,r),n};function ed(t,n){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const[r,o]=e.useState(n);return e.useEffect((()=>{if(i&&o(n),typeof window>"u"||!t)return;const e=t.subscribe(o);return()=>e.unsubscribe()}),[t,i]),r}function td(t){const n=Vl(t),i=e.useMemo((()=>function(e){return kl(e,vr.ConnectionStateChanged).pipe(Ac((e=>{let[t]=e;return t})),Qc(e.state))}(n)),[n]);return ed(i,n.state)}function nd(t){let{trackRef:n,props:i}=t;const r=Ll(n),o=Ml(),{className:a}=e.useMemo((()=>({className:[vl("button"),vl("focus-toggle-button")].join(" ")})),[]),s=e.useMemo((()=>Xc(r,null==o?void 0:o.pin.state)),[r,null==o?void 0:o.pin.state]);return{mergedProps:e.useMemo((()=>Gl(i,{className:a,onClick:e=>{var t,n,a,c,l;null==(t=i.onClick)||t.call(i,e),s?null==(a=null==o?void 0:(n=o.pin).dispatch)||a.call(n,{msg:"clear_pin"}):null==(l=null==o?void 0:(c=o.pin).dispatch)||l.call(c,{msg:"set_pin",trackReference:r})}})),[i,a,r,s,null==o?void 0:o.pin]),inFocus:s}}function id(t,n){var i;const r=null!==(i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).gridLayouts)&&void 0!==i?i:nl,{width:o,height:a}=Zl(t),s=il(r,n,o,a);return e.useEffect((()=>{t.current&&s&&(t.current.style.setProperty("--lk-col-count",null==s?void 0:s.columns.toString()),t.current.style.setProperty("--lk-row-count",null==s?void 0:s.rows.toString()))}),[t,s]),{layout:s,containerWidth:o,containerHeight:a}}function rd(t){var n,i;const r=Fl("string"==typeof t?(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).participant:t.participant),o="string"==typeof t?{participant:r,source:t}:t,[a,s]=e.useState(!!(null!=(n=o.publication)&&n.isMuted||null!=(i=r.getTrackPublication(o.source))&&i.isMuted));return e.useEffect((()=>{const e=wl(o).subscribe(s);return()=>e.unsubscribe()}),[$c(o)]),a}function od(t){const n=Fl(t),i=e.useMemo((()=>function(e){return El(e,br.IsSpeakingChanged).pipe(Ac((e=>{let[t]=e;return t})))}(n)),[n]);return ed(i,n.isSpeaking)}function ad(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=e.useRef([]),o=e.useRef(-1),a=n!==o.current,s="function"==typeof i.customSortFunction?i.customSortFunction(t):dl(t);let c=[...s];if(!1===a)try{c=gl(r.current,s,n)}catch(l){tl.error("Error while running updatePages(): ",l)}return r.current=a?s:c,o.current=n,c}function sd(t){let{trackRef:n,onParticipantClick:i,disableSpeakingIndicator:r,htmlProps:o}=t;const a=Ll(n),s=e.useMemo((()=>{const{className:e}={className:vl("participant-tile")};return Gl(o,{className:e,onClick:e=>{var t;if(null==(t=o.onClick)||t.call(o,e),"function"==typeof i){var n;const e=null!==(n=a.publication)&&void 0!==n?n:a.participant.getTrackPublication(a.source);i({participant:a.participant,track:e})}}})}),[o,i,a.publication,a.source,a.participant]),c=a.participant.getTrackPublication(Hr.Source.Microphone),d=e.useMemo((()=>({participant:a.participant,source:Hr.Source.Microphone,publication:c})),[c,a.participant]),u=rd(a),h=rd(d),p=od(a.participant),m=function(e){if(e.publication instanceof es){const t=e.publication.track;if(t){const{facingMode:e}=ds(t);return e}}return"undefined"}(a);return{elementProps:l({"data-lk-audio-muted":h,"data-lk-video-muted":u,"data-lk-speaking":!0!==r&&p,"data-lk-local-participant":a.participant.isLocal,"data-lk-source":a.source,"data-lk-facing-mode":m},s)}}function cd(t){var n,i;const r=Ll(t),{className:o,mediaMutedObserver:a}=e.useMemo((()=>function(e){let t="track-muted-indicator-camera";switch(e.source){case Hr.Source.Camera:t="track-muted-indicator-camera";break;case Hr.Source.Microphone:t="track-muted-indicator-microphone"}return{className:vl(t),mediaMutedObserver:wl(e)}}(r)),[$c(r)]);return{isMuted:ed(a,!!(null!=(n=r.publication)&&n.isMuted||null!=(i=r.participant.getTrackPublication(r.source))&&i.isMuted)),className:o}}function ld(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[Hr.Source.Camera,Hr.Source.Microphone,Hr.Source.ScreenShare,Hr.Source.ScreenShareAudio,Hr.Source.Unknown],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=Vl(n.room),[r,o]=e.useState([]),[a,s]=e.useState([]),c=e.useMemo((()=>t.map((e=>rl(e)?e.source:e))),[JSON.stringify(t)]);return e.useEffect((()=>{const e=function(e,t,n){var i,r;const o=null!=(i=n.additionalRoomEvents)?i:el,a=null==(r=n.onlySubscribed)||r;return yl(e,...Array.from(new Set([vr.ParticipantConnected,vr.ParticipantDisconnected,vr.ConnectionStateChanged,vr.LocalTrackPublished,vr.LocalTrackUnpublished,vr.TrackPublished,vr.TrackUnpublished,vr.TrackSubscriptionStatusChanged,...o]).values())).pipe(Ac((e=>{const n=Rl(e,t,a);return tl.debug("TrackReference[] was updated. (length ".concat(n.trackReferences.length,")"),n),n})),Qc(Rl(e,t,a)))}(i,c,{additionalRoomEvents:n.updateOnlyOn,onlySubscribed:n.onlySubscribed}).subscribe((e=>{let{trackReferences:t,participants:n}=e;tl.debug("setting track bundles",t,n),o(t),s(n)}));return()=>e.unsubscribe()}),[i,JSON.stringify(n.onlySubscribed),JSON.stringify(n.updateOnlyOn),JSON.stringify(t)]),e.useMemo((()=>{if(ol(t)){const e=function(e,t){const n=new Map;if(ol(e)){const i=e.filter((e=>e.withPlaceholder)).map((e=>e.source));t.forEach((e=>{const t=e.getTrackPublications().map((e=>{var t;return null==(t=e.track)?void 0:t.source})).filter((e=>void 0!==e)),r=Array.from(function(e,t){const n=new Set(e);for(const i of t)n.delete(i);return n}(new Set(i),new Set(t)));r.length>0&&n.set(e.identity,r)}))}return n}(t,a),n=Array.from(r);return a.forEach((t=>{var i;e.has(t.identity)&&(null!==(i=e.get(t.identity))&&void 0!==i?i:[]).forEach((e=>{if(r.find((n=>{let{participant:i,publication:r}=n;return t.identity===i.identity&&r.source===e})))return;tl.debug("Add ".concat(e," placeholder for participant ").concat(t.identity,"."));const i={participant:t,source:e};n.push(i)}))})),n}return r}),[r,a,t])}function dd(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=Fl(t),r=Vl(n.room),o=e.useMemo((()=>function(e,t){return kl(e,vr.ParticipantEncryptionStatusChanged).pipe(Hc((n=>{let[,i]=n;return(null==t?void 0:t.identity)===(null==i?void 0:i.identity)||!i&&(null==t?void 0:t.identity)===e.localParticipant.identity})),Ac((e=>{let[t]=e;return t})),Qc(t instanceof rs?t.isE2EEEnabled:!(null==t||!t.isEncrypted)))}(r,i)),[r,i]);return ed(o,i instanceof rs?i.isE2EEEnabled:!(null==i||!i.isEncrypted))}const ud=["trackRef"],hd=["participant"],pd=["trackRef","show"],md=["onTrackClick","onClick","onSubscriptionStatusChanged","trackRef","manageSubscription"],fd=["trackRef","onSubscriptionStatusChanged","volume","muted"],gd=["trackRef","children","onParticipantClick","disableSpeakingIndicator"],vd=["trackRef"],bd=["tracks"],yd=["tracks"],kd=["tracks","orientation"],Td=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},t),e.createElement("path",{d:"M1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708L11 10.293V4.5A1.5 1.5 0 0 0 9.5 3H3.707zM0 4.5a1.5 1.5 0 0 1 .943-1.393l9.532 9.533c-.262.224-.603.36-.975.36h-8A1.5 1.5 0 0 1 0 11.5z"}),e.createElement("path",{d:"m15.2 3.6-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),Sd=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},t),e.createElement("path",{d:"M0 4.5A1.5 1.5 0 0 1 1.5 3h8A1.5 1.5 0 0 1 11 4.5v7A1.5 1.5 0 0 1 9.5 13h-8A1.5 1.5 0 0 1 0 11.5zM15.2 3.6l-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),Cd=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},t),e.createElement("path",{fill:"currentcolor",fillRule:"evenodd",d:"M5.293 2.293a1 1 0 0 1 1.414 0l4.823 4.823a1.25 1.25 0 0 1 0 1.768l-4.823 4.823a1 1 0 0 1-1.414-1.414L9.586 8 5.293 3.707a1 1 0 0 1 0-1.414z",clipRule:"evenodd"})),Ed=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},t),e.createElement("g",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5},e.createElement("path",{d:"M10 1.75h4.25m0 0V6m0-4.25L9 7M6 14.25H1.75m0 0V10m0 4.25L7 9"}))),wd=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},t),e.createElement("path",{fill:"currentcolor",fillRule:"evenodd",d:"M4 6.104V4a4 4 0 1 1 8 0v2.104c1.154.326 2 1.387 2 2.646v4.5A2.75 2.75 0 0 1 11.25 16h-6.5A2.75 2.75 0 0 1 2 13.25v-4.5c0-1.259.846-2.32 2-2.646ZM5.5 4a2.5 2.5 0 0 1 5 0v2h-5V4Z",clipRule:"evenodd"})),Pd=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},t),e.createElement("path",{d:"M12.227 11.52a5.477 5.477 0 0 0 1.246-2.97.5.5 0 0 0-.995-.1 4.478 4.478 0 0 1-.962 2.359l-1.07-1.07C10.794 9.247 11 8.647 11 8V3a3 3 0 0 0-6 0v1.293L1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708zM8 12.5c.683 0 1.33-.152 1.911-.425l.743.743c-.649.359-1.378.59-2.154.66V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .995-.098A4.5 4.5 0 0 0 8 12.5z"}),e.createElement("path",{d:"M8.743 10.907 5 7.164V8a3 3 0 0 0 3.743 2.907z"})),Rd=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},t),e.createElement("path",{fillRule:"evenodd",d:"M2.975 8.002a.5.5 0 0 1 .547.449 4.5 4.5 0 0 0 8.956 0 .5.5 0 1 1 .995.098A5.502 5.502 0 0 1 8.5 13.478V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .448-.547z",clipRule:"evenodd"}),e.createElement("path",{d:"M5 3a3 3 0 1 1 6 0v5a3 3 0 0 1-6 0z"})),Id=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor"},t),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"})),Od=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor"},t),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("g",{opacity:.25},e.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}))),xd=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor"},t),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("g",{opacity:.25},e.createElement("path",{d:"M6 6.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("path",{d:"M6 6.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}))),_d=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},t),e.createElement("g",{opacity:.25},e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-4Zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-9Zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V.5Z"}),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-4Zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-9Zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V.5Z"}))),Nd=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none"},t),e.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M0 2.75A2.75 2.75 0 0 1 2.75 0h14.5A2.75 2.75 0 0 1 20 2.75v10.5A2.75 2.75 0 0 1 17.25 16H2.75A2.75 2.75 0 0 1 0 13.25V2.75ZM2.75 1.5c-.69 0-1.25.56-1.25 1.25v10.5c0 .69.56 1.25 1.25 1.25h14.5c.69 0 1.25-.56 1.25-1.25V2.75c0-.69-.56-1.25-1.25-1.25H2.75Z",clipRule:"evenodd"}),e.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.47 4.22a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1-1.06 1.06l-.97-.97v4.69a.75.75 0 0 1-1.5 0V6.56l-.97.97a.75.75 0 0 1-1.06-1.06l2.25-2.25Z",clipRule:"evenodd"})),Md=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none"},t),e.createElement("g",{fill:"currentColor"},e.createElement("path",{d:"M7.28 4.22a.75.75 0 0 0-1.06 1.06L8.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L10 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L11.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L10 6.94z"}),e.createElement("path",{fillRule:"evenodd",d:"M2.75 0A2.75 2.75 0 0 0 0 2.75v10.5A2.75 2.75 0 0 0 2.75 16h14.5A2.75 2.75 0 0 0 20 13.25V2.75A2.75 2.75 0 0 0 17.25 0zM1.5 2.75c0-.69.56-1.25 1.25-1.25h14.5c.69 0 1.25.56 1.25 1.25v10.5c0 .69-.56 1.25-1.25 1.25H2.75c-.69 0-1.25-.56-1.25-1.25z",clipRule:"evenodd"}))),Dd=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},t),e.createElement("g",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5},e.createElement("path",{d:"M13.25 7H9m0 0V2.75M9 7l5.25-5.25M2.75 9H7m0 0v4.25M7 9l-5.25 5.25"}))),Ad=e.forwardRef((function(t,n){let{trackRef:i}=t,o=r(t,ud);const a=Al(),{mergedProps:s,inFocus:c}=nd({trackRef:null!==i&&void 0!==i?i:a,props:o});return e.createElement(Nl.Consumer,null,(t=>void 0!==t&&e.createElement("button",l({ref:n},s),o.children?o.children:c?e.createElement(Dd,null):e.createElement(Ed,null))))}));function Ld(e){return void 0!==e}function Ud(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Gl(...t.filter(Ld))}function jd(t,n,i){return e.Children.map(t,(r=>{var o;return e.isValidElement(r)&&e.Children.only(t)?(r.props.class&&(null!==(o=n)&&void 0!==o||(n={}),n.class=Kl(r.props.class,n.class),n.style=l(l({},r.props.style),n.style)),e.cloneElement(r,l(l({},n),{},{key:i}))):r}))}function Fd(t,n){switch(t){case Hr.Source.Microphone:return n?e.createElement(Rd,null):e.createElement(Pd,null);case Hr.Source.Camera:return n?e.createElement(Sd,null):e.createElement(Td,null);case Hr.Source.ScreenShare:return n?e.createElement(Md,null):e.createElement(Nd,null);default:return}}const Bd=e.forwardRef((function(t,n){var i;const{className:r,quality:o}=function(){const t=Fl((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).participant),{className:n,connectionQualityObserver:i}=e.useMemo((()=>Pl(t)),[t]);return{className:n,quality:ed(i,ts.Unknown)}}(t),a=e.useMemo((()=>l(l({},Ud(t,{className:r})),{},{"data-lk-quality":o})),[o,t,r]);return e.createElement("div",l({ref:n},a),null!==(i=t.children)&&void 0!==i?i:function(t){switch(t){case ts.Excellent:return e.createElement(Id,null);case ts.Good:return e.createElement(Od,null);case ts.Poor:return e.createElement(xd,null);default:return e.createElement(_d,null)}}(o))})),Vd=e.forwardRef((function(t,n){let{participant:i}=t,o=r(t,hd);const a=Fl(i),{className:s,infoObserver:c}=e.useMemo((()=>function(e){return{className:"lk-participant-name",infoObserver:Cl(e)}}(a)),[a]),{identity:d,name:u}=ed(c,{name:a.name,identity:a.identity,metadata:a.metadata}),h=e.useMemo((()=>Ud(o,{className:s,"data-lk-participant-name":u})),[o,s,u]);return e.createElement("span",l({ref:n},h),""!==u?u:d,o.children)})),qd=e.forwardRef((function(t,n){var i;let{trackRef:o,show:a="always"}=t,s=r(t,pd);const{className:c,isMuted:d}=cd(o),u="always"===a||"muted"===a&&d||"unmuted"===a&&!d,h=e.useMemo((()=>Ud(s,{className:c})),[c,s]);return u?e.createElement("div",l(l({ref:n},h),{},{"data-lk-muted":d}),null!==(i=s.children)&&void 0!==i?i:Fd(o.source,!d)):null})),zd=t=>e.createElement("svg",l({width:320,height:320,viewBox:"0 0 320 320",preserveAspectRatio:"xMidYMid meet",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),e.createElement("path",{d:"M160 180C204.182 180 240 144.183 240 100C240 55.8172 204.182 20 160 20C115.817 20 79.9997 55.8172 79.9997 100C79.9997 144.183 115.817 180 160 180Z",fill:"white",fillOpacity:.25}),e.createElement("path",{d:"M97.6542 194.614C103.267 191.818 109.841 192.481 115.519 195.141C129.025 201.466 144.1 205 159.999 205C175.899 205 190.973 201.466 204.48 195.141C210.158 192.481 216.732 191.818 222.345 194.614C262.703 214.719 291.985 253.736 298.591 300.062C300.15 310.997 291.045 320 280 320H39.9997C28.954 320 19.8495 310.997 21.4087 300.062C28.014 253.736 57.2966 214.72 97.6542 194.614Z",fill:"white",fillOpacity:.25}));function Wd(t){var n;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[r,o]=e.useState(bl(t)),[a,s]=e.useState(null==r?void 0:r.isMuted),[c,d]=e.useState(null==r?void 0:r.isSubscribed),[u,h]=e.useState(null==r?void 0:r.track),[p,m]=e.useState("landscape"),f=e.useRef(),{className:g,trackObserver:v}=e.useMemo((()=>function(e){const t=bl(e),n=Sl(e.participant).pipe(Ac((()=>bl(e))),Qc(t));return{className:vl(e.source===Hr.Source.Camera||e.source===Hr.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:n}}(t)),[null!==(n=t.participant.sid)&&void 0!==n?n:t.participant.identity,t.source,Jc(t)&&t.publication.trackSid]);return e.useEffect((()=>{const e=v.subscribe((e=>{tl.debug("update track",e),o(e),s(null==e?void 0:e.isMuted),d(null==e?void 0:e.isSubscribed),h(null==e?void 0:e.track)}));return()=>null==e?void 0:e.unsubscribe()}),[v]),e.useEffect((()=>{var e,n;return u&&(f.current&&u.detach(f.current),null!=(e=i.element)&&e.current&&!(Zc(t.participant)&&"audio"===(null==u?void 0:u.kind))&&u.attach(i.element.current)),f.current=null==(n=i.element)?void 0:n.current,()=>{f.current&&(null==u||u.detach(f.current))}}),[u,i.element]),e.useEffect((()=>{var e,t;if("number"==typeof(null==(e=null==r?void 0:r.dimensions)?void 0:e.width)&&"number"==typeof(null==(t=null==r?void 0:r.dimensions)?void 0:t.height)){const e=r.dimensions.width>r.dimensions.height?"landscape":"portrait";m(e)}}),[r]),{publication:r,isMuted:a,isSubscribed:c,track:u,elementProps:Ud(i.props,l({className:g,"data-lk-local-participant":t.participant.isLocal,"data-lk-source":null==r?void 0:r.source},"video"===(null==r?void 0:r.kind)&&{"data-lk-orientation":p}))}}var Kd=/^\s+|\s+$/g,Hd=/^[-+]0x[0-9a-f]+$/i,Gd=/^0b[01]+$/i,Qd=/^0o[0-7]+$/i,Jd=parseInt,Yd="object"==typeof ps&&ps&&ps.Object===Object&&ps,$d="object"==typeof self&&self&&self.Object===Object&&self,Xd=Yd||$d||Function("return this")(),Zd=Object.prototype.toString,eu=Math.max,tu=Math.min,nu=function(){return Xd.Date.now()};function iu(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function ru(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==Zd.call(e)}(e))return NaN;if(iu(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=iu(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Kd,"");var n=Gd.test(e);return n||Qd.test(e)?Jd(e.slice(2),n?2:8):Hd.test(e)?NaN:+e}var ou=function(e,t,n){var i,r,o,a,s,c,l=0,d=!1,u=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=i,o=r;return i=r=void 0,l=t,a=e.apply(o,n)}function m(e){var n=e-c;return void 0===c||n>=t||n<0||u&&e-l>=o}function f(){var e=nu();if(m(e))return g(e);s=setTimeout(f,function(e){var n=t-(e-c);return u?tu(n,o-(e-l)):n}(e))}function g(e){return s=void 0,h&&i?p(e):(i=r=void 0,a)}function v(){var e=nu(),n=m(e);if(i=arguments,r=this,c=e,n){if(void 0===s)return function(e){return l=e,s=setTimeout(f,t),d?p(e):a}(c);if(u)return s=setTimeout(f,t),p(c)}return void 0===s&&(s=setTimeout(f,t)),a}return t=ru(t)||0,iu(n)&&(d=!!n.leading,o=(u="maxWait"in n)?eu(ru(n.maxWait)||0,t):o,h="trailing"in n?!!n.trailing:h),v.cancel=function(){void 0!==s&&clearTimeout(s),l=0,i=c=r=s=void 0},v.flush=function(){return void 0===s?a:g(nu())},v};const au=ms(ou);function su(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,i=arguments.length>2?arguments[2]:void 0;const r=(0,e.useRef)();!function(t){const n=(0,e.useRef)(t);n.current=t,(0,e.useEffect)((()=>()=>{n.current()}),[])}((()=>{r.current&&r.current.cancel()}));const o=(0,e.useMemo)((()=>{const e=au(t,n,i),o=function(){return e(...arguments)};return o.cancel=()=>{e.cancel()},o.isPending=()=>!!r.current,o.flush=()=>e.flush(),o}),[t,n,i]);return(0,e.useEffect)((()=>{r.current=au(t,n,i)}),[t,n,i]),o}const cu=e.forwardRef((function(t,n){let{onTrackClick:i,onClick:o,onSubscriptionStatusChanged:a,trackRef:s,manageSubscription:c}=t,d=r(t,md);const u=Ll(s),h=e.useRef(null);e.useImperativeHandle(n,(()=>h.current));const p=function(){let{threshold:t=0,root:n=null,rootMargin:i="0%",freezeOnceVisible:r=!1,initialIsIntersecting:o=!1,onChange:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var s;const[c,l]=(0,e.useState)(null),[d,u]=(0,e.useState)((()=>({isIntersecting:o,entry:void 0}))),h=(0,e.useRef)();h.current=a;const p=(null==(s=d.entry)?void 0:s.isIntersecting)&&r;(0,e.useEffect)((()=>{if(!c||!("IntersectionObserver"in window)||p)return;let e;const o=new IntersectionObserver((t=>{const n=Array.isArray(o.thresholds)?o.thresholds:[o.thresholds];t.forEach((t=>{const i=t.isIntersecting&&n.some((e=>t.intersectionRatio>=e));u({isIntersecting:i,entry:t}),h.current&&h.current(i,t),i&&r&&e&&(e(),e=void 0)}))}),{threshold:t,root:n,rootMargin:i});return o.observe(c),()=>{o.disconnect()}}),[c,JSON.stringify(t),n,i,p,r]);const m=(0,e.useRef)(null);(0,e.useEffect)((()=>{var e;!c&&null!=(e=d.entry)&&e.target&&!r&&!p&&m.current!==d.entry.target&&(m.current=d.entry.target,u({isIntersecting:o,entry:void 0}))}),[c,d.entry,r,p,o]);const f=[l,!!d.isIntersecting,d.entry];return f.ref=f[0],f.isIntersecting=f[1],f.entry=f[2],f}({root:h.current}),[m]=function(t,n,i){const r=t instanceof Function?t():t,[o,a]=(0,e.useState)(r),s=(0,e.useRef)(r),c=su(a,n,i);return s.current===r||(c(r),s.current=r),[o,c]}(p,3e3);e.useEffect((()=>{c&&u.publication instanceof os&&!1===(null==m?void 0:m.isIntersecting)&&!1===(null==p?void 0:p.isIntersecting)&&u.publication.setSubscribed(!1)}),[m,u,c]),e.useEffect((()=>{c&&u.publication instanceof os&&!0===(null==p?void 0:p.isIntersecting)&&u.publication.setSubscribed(!0)}),[p,u,c]);const{elementProps:f,publication:g,isSubscribed:v}=Wd(u,{element:h,props:d});e.useEffect((()=>{null==a||a(!!v)}),[v,a]);return e.createElement("video",l(l({ref:h},f),{},{muted:!0,onClick:e=>{null==o||o(e),null==i||i({participant:null==u?void 0:u.participant,track:g})}}))})),lu=e.forwardRef((function(t,n){let{trackRef:i,onSubscriptionStatusChanged:o,volume:a,muted:s}=t,c=r(t,fd);const d=Ll(i),u=e.useRef(null);e.useImperativeHandle(n,(()=>u.current));const{elementProps:h,isSubscribed:p,track:m,publication:f}=Wd(d,{element:u,props:c});return e.useEffect((()=>{null==o||o(!!p)}),[p,o]),e.useEffect((()=>{void 0===m||void 0===a||(m instanceof Qa?m.setVolume(a):tl.warn("Volume can only be set on remote audio tracks."))}),[a,m]),e.useEffect((()=>{void 0===f||void 0===s||(f instanceof os?f.setEnabled(!s):tl.warn("Can only call setEnabled on remote track publications."))}),[s,f,m]),e.createElement("audio",l({ref:u},h))}));function du(t){const n=!!jl();return t.participant&&!n?e.createElement(Ul.Provider,{value:t.participant},t.children):e.createElement(e.Fragment,null,t.children)}function uu(t){const n=!!Al();return t.trackRef&&!n?e.createElement(Dl.Provider,{value:t.trackRef},t.children):e.createElement(e.Fragment,null,t.children)}const hu=e.forwardRef((function(t,n){let{trackRef:i,children:o,onParticipantClick:a,disableSpeakingIndicator:s}=t,c=r(t,gd);var d,u;const h=Ll(i),{elementProps:p}=sd({htmlProps:c,disableSpeakingIndicator:s,onParticipantClick:a,trackRef:h}),m=dd(h.participant),f=Ml(),g=null==(d=function(t){const n=e.useContext(ql);if(!0===t){if(n)return n;throw Error("tried to access feature context, but none is present")}return n}())?void 0:d.autoSubscription,v=e.useCallback((e=>{h.source&&!e&&f&&f.pin.dispatch&&Xc(h,f.pin.state)&&f.pin.dispatch({msg:"clear_pin"})}),[h,f]);return e.createElement("div",l({ref:n,style:{position:"relative"}},p),e.createElement(uu,{trackRef:h},e.createElement(du,{participant:h.participant},null!==o&&void 0!==o?o:e.createElement(e.Fragment,null,!Jc(h)||"video"!==(null==(u=h.publication)?void 0:u.kind)&&h.source!==Hr.Source.Camera&&h.source!==Hr.Source.ScreenShare?Jc(h)&&e.createElement(lu,{trackRef:h,onSubscriptionStatusChanged:v}):e.createElement(cu,{trackRef:h,onSubscriptionStatusChanged:v,manageSubscription:g}),e.createElement("div",{className:"lk-participant-placeholder"},e.createElement(zd,null)),e.createElement("div",{className:"lk-participant-metadata"},e.createElement("div",{className:"lk-participant-metadata-item"},h.source===Hr.Source.Camera?e.createElement(e.Fragment,null,m&&e.createElement(wd,{style:{marginRight:"0.25rem"}}),e.createElement(qd,{trackRef:{participant:h.participant,source:Hr.Source.Microphone},show:"muted"}),e.createElement(Vd,null)):e.createElement(e.Fragment,null,e.createElement(Nd,{style:{marginRight:"0.25rem"}}),e.createElement(Vd,null,"'s screen"))),e.createElement(Bd,{className:"lk-participant-metadata-item"}))),e.createElement(Ad,{trackRef:h}))))}));function pu(t){let{trackRef:n}=t,i=r(t,vd);return e.createElement(hu,l({trackRef:n},i))}function mu(t){let{tracks:n}=t,i=r(t,bd);return e.createElement(e.Fragment,null,n.map((t=>e.createElement(Dl.Provider,{value:t,key:$c(t)},jd(i.children)))))}function fu(t){let{totalPageCount:n,nextPage:i,prevPage:r,currentPage:o,pagesContainer:a}=t;const[s,c]=e.useState(!1);return e.useEffect((()=>{let e;return a&&(e=Il(a.current,2e3).subscribe(c)),()=>{e&&e.unsubscribe()}}),[a]),e.createElement("div",{className:"lk-pagination-control","data-lk-user-interaction":s},e.createElement("button",{className:"lk-button",onClick:r},e.createElement(Cd,null)),e.createElement("span",{className:"lk-pagination-count"},"".concat(o," of ").concat(n)),e.createElement("button",{className:"lk-button",onClick:i},e.createElement(Cd,null)))}const gu=e.forwardRef((function(t,n){let{totalPageCount:i,currentPage:r}=t;const o=new Array(i).fill("").map(((t,n)=>n+1===r?e.createElement("span",{"data-lk-active":!0,key:n}):e.createElement("span",{key:n})));return e.createElement("div",{ref:n,className:"lk-pagination-indicator"},o)}));function vu(t){let{tracks:n}=t,i=r(t,yd);const o=e.createRef(),a=e.useMemo((()=>Ud(i,{className:"lk-grid-layout"})),[i]),{layout:s}=id(o,n.length),c=function(t,n){const[i,r]=e.useState(1),o=Math.max(Math.ceil(n.length/t),1);i>o&&r(o);const a=i*t,s=a-t,c=e=>{r((t=>"next"===e?t===o?t:t+1:1===t?t:t-1))},l=ad(n,t).slice(s,a);return{totalPageCount:o,nextPage:()=>c("next"),prevPage:()=>c("previous"),setPage:e=>{r(e>o?o:e<1?1:e)},firstItemIndex:s,lastItemIndex:a,tracks:l,currentPage:i}}(s.maxTiles,n);return function(t){var n;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=e.useRef(null),o=e.useRef(null),a=null!==(n=i.minSwipeDistance)&&void 0!==n?n:50,s=e=>{o.current=null,r.current=e.targetTouches[0].clientX},c=e=>{o.current=e.targetTouches[0].clientX},l=e.useCallback((()=>{if(!r.current||!o.current)return;const e=r.current-o.current,t=e<-a;e>a&&i.onLeftSwipe&&i.onLeftSwipe(),t&&i.onRightSwipe&&i.onRightSwipe()}),[a,i]);e.useEffect((()=>{const e=t.current;return e&&(e.addEventListener("touchstart",s,{passive:!0}),e.addEventListener("touchmove",c,{passive:!0}),e.addEventListener("touchend",l,{passive:!0})),()=>{e&&(e.removeEventListener("touchstart",s),e.removeEventListener("touchmove",c),e.removeEventListener("touchend",l))}}),[t,l])}(o,{onLeftSwipe:c.nextPage,onRightSwipe:c.prevPage}),e.createElement("div",l({ref:o,"data-lk-pagination":c.totalPageCount>1},a),e.createElement(mu,{tracks:c.tracks},i.children),n.length>s.maxTiles&&e.createElement(e.Fragment,null,e.createElement(gu,{totalPageCount:c.totalPageCount,currentPage:c.currentPage}),e.createElement(fu,l({pagesContainer:o},c))))}const bu=-1*(1-1.6);function yu(t){let{tracks:n,orientation:i}=t,o=r(t,kd);const a=e.useRef(null),[s,c]=e.useState(0),{width:d,height:u}=Zl(a),h=i||(u>=d?"vertical":"horizontal"),p="vertical"===h?Math.max(d*bu,130):Math.max(1.6*u,140),m=function(){const e=document.createElement("p");e.style.width="100%",e.style.height="200px";const t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);const n=e.offsetWidth;t.style.overflow="scroll";let i=e.offsetWidth;return n===i&&(i=t.clientWidth),document.body.removeChild(t),n-i}(),f=Math.max("vertical"===h?(u-m)/p:(d-m)/p,1);let g=Math.round(f);Math.abs(f-s)<.5?g=Math.round(s):s!==f&&c(f);const v=ad(n,g);return e.useLayoutEffect((()=>{a.current&&(a.current.dataset.lkOrientation=h,a.current.style.setProperty("--lk-max-visible-tiles",g.toString()))}),[g,h]),e.createElement("aside",l({key:h,className:"lk-carousel",ref:a},o),e.createElement(mu,{tracks:v},o.children))}function ku(t){let{volume:n,muted:i}=t;const r=ld([Hr.Source.Microphone,Hr.Source.ScreenShareAudio,Hr.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter((e=>!Zc(e.participant)&&e.publication.kind===Hr.Kind.Audio));return e.createElement("div",{style:{display:"none"}},r.map((t=>e.createElement(lu,{key:$c(t),trackRef:t,volume:n,muted:i}))))}var Tu=n(579);const Su=e=>{let{tracks:t}=e;const n=ad(t,1);return 0===n.length?null:(0,Tu.jsx)(cu,{trackRef:n[0]})},Cu=e=>{let{tracks:t}=e;const n=ad(t,1),i=n.shift(),r=ad(n,3);if(!i)return(0,Tu.jsx)(Tu.Fragment,{});if(0===r.length){const e=i;return(0,Tu.jsx)(cu,{trackRef:e})}return(0,Tu.jsxs)("div",{className:"lk-focus-layout",children:[(0,Tu.jsx)(yu,{tracks:r,children:(0,Tu.jsx)(hu,{})}),(0,Tu.jsx)(pu,{trackRef:i})]})};function Eu(t){let{url:n,token:i,layout:r}=t;const[o,a]=(0,e.useState)();return n&&i?(0,Tu.jsx)(Jl,{connectOptions:{autoSubscribe:!1},serverUrl:n,token:i,onError:a,children:o?(0,Tu.jsx)("div",{className:"error",children:o.message}):(0,Tu.jsx)(wu,{layout:r})}):(0,Tu.jsx)("div",{className:"error",children:"missing required params url and token"})}function wu(t){let{layout:n}=t;const r=function(){const t=e.useContext(Bl);if(!t)throw Error("tried to access room context outside of livekit room component");return t}(),[o]=(0,e.useState)(n),[a,s]=(0,e.useState)(!1),c=ld([Hr.Source.ScreenShare],{onlySubscribed:!0}),l=td();(0,e.useEffect)((()=>{function e(e){e.trackName.includes("ai-voice")||("audio"===e.kind&&e.setSubscribed(!0),"video"===e.kind&&e.setSubscribed(!0))}function t(t){"connected"===l&&e(t)}return"connected"===l&&r.remoteParticipants.forEach((t=>{t.trackPublications.forEach((t=>{e(t)}))})),r.on("trackPublished",t),()=>{r.off("trackPublished",t)}}),[r,l]),(0,e.useEffect)((()=>{const e=Date.now(),t=setInterval((async()=>{let n=!1,o=!1,a=!1,s=!1;for(const e of Array.from(r.remoteParticipants.values()))for(const t of Array.from(e.trackPublications.values()))if(t.isSubscribed&&(a=!0),t.kind===Hr.Kind.Video&&(o=!0,t.videoTrack)){const e=await t.videoTrack.getRTCStatsReport();e&&(s=Array.from(e).some((e=>"inbound-rtp"===e[1].type&&e[1].framesDecoded>0)))}const c=Date.now()-e;(s||!o&&a&&c>500||c>5e3&&a)&&(n=!0),n&&(i.A.startRecording(),clearInterval(t))}),100)}),[]),(0,e.useEffect)((()=>{c.length>0&&c[0].publication?s(!0):s(!1)}),[c]);const d=ld([Hr.Source.Camera,Hr.Source.ScreenShare,Hr.Source.Unknown],{onlySubscribed:!0}).slice(0,9).filter((e=>e.publication.kind===Hr.Kind.Video&&e.participant.identity!==r.localParticipant.identity));let u="dark";o.endsWith("-light")&&(u="light");let h="roomContainer";u&&(h+=" ".concat(u));let p=(0,Tu.jsx)(Tu.Fragment,{}),m=o;return a&&o.startsWith("grid")&&(m=o.replace("grid","speaker")),r.state!==ns.Disconnected&&(p=m.startsWith("speaker")?(0,Tu.jsx)(Cu,{tracks:d}):m.startsWith("single-speaker")?(0,Tu.jsx)(Su,{tracks:d}):(0,Tu.jsx)(vu,{tracks:d,children:(0,Tu.jsx)(hu,{})})),(0,Tu.jsxs)("div",{className:h,children:[p,(0,Tu.jsx)(ku,{})]})}const Pu=function(){return(0,Tu.jsx)("div",{className:"container",children:(0,Tu.jsx)(Eu,{url:i.A.getLiveKitURL(),token:i.A.getAccessToken(),layout:i.A.getLayout()})})},Ru=document.getElementById("root");if(!Ru)throw new Error("Failed to find the root element");(0,t.H)(Ru).render((0,Tu.jsx)(e.StrictMode,{children:(0,Tu.jsx)(Pu,{})}))})()})();
//# sourceMappingURL=main.3f6144a4.js.map